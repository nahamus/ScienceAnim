(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();class st{constructor(t){this.ctx=t,this.particles=[],this.particleCount=15,this.speed=1,this.temperature=1,this.showTrails=!1,this.showVelocityVectors=!1,this.showTemperatureHeatmap=!1,this.showVelocityDistribution=!1,this.showMeanFreePath=!1,this.particleSize=4,this.time=0,this.collisionCount=0,this.meanFreePath=0,this.velocityData=[],this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++){const i=(Math.random()-.5)*2,e=(Math.random()-.5)*2,s=Math.sqrt(i*i+e*e);this.particles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:i,vy:e,velocity:s,trail:[],lastCollisionTime:0,distanceTraveled:0})}}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setSpeed(t){this.speed=t}setTemperature(t){this.temperature=t}setShowTrails(t){this.showTrails=t,t||this.particles.forEach(i=>i.trail=[])}setShowVelocityVectors(t){this.showVelocityVectors=t}setShowTemperatureHeatmap(t){this.showTemperatureHeatmap=t}setShowVelocityDistribution(t){this.showVelocityDistribution=t}setShowMeanFreePath(t){this.showMeanFreePath=t}setParticleSize(t){this.particleSize=t}reset(){this.time=0,this.collisionCount=0,this.velocityData=[],this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*2;if(this.particles.map(e=>({x:e.x,y:e.y})),this.particles.forEach((e,s)=>{e.vx+=(Math.random()-.5)*this.temperature*.1,e.vy+=(Math.random()-.5)*this.temperature*.1,e.vx*=.99,e.vy*=.99;const n=e.x,a=e.y;e.x+=e.vx*i*50,e.y+=e.vy*i*50,e.velocity=Math.sqrt(e.vx*e.vx+e.vy*e.vy),e.distanceTraveled+=Math.sqrt((e.x-n)*(e.x-n)+(e.y-a)*(e.y-a)),(e.x<0||e.x>this.ctx.canvas.width)&&(e.vx*=-.8,e.x=Math.max(0,Math.min(this.ctx.canvas.width,e.x)),this.collisionCount++,e.lastCollisionTime=this.time),(e.y<0||e.y>this.ctx.canvas.height)&&(e.vy*=-.8,e.y=Math.max(0,Math.min(this.ctx.canvas.height,e.y)),this.collisionCount++,e.lastCollisionTime=this.time);for(let o=s+1;o<this.particles.length;o++){const h=this.particles[o],l=e.x-h.x,c=e.y-h.y,d=Math.sqrt(l*l+c*c);if(d<this.particleSize*2){Math.sqrt(e.vx*e.vx+e.vy*e.vy),Math.sqrt(h.vx*h.vx+h.vy*h.vy);const x=e.vx,r=e.vy;e.vx=h.vx,e.vy=h.vy,h.vx=x,h.vy=r,this.collisionCount++,e.lastCollisionTime=this.time,h.lastCollisionTime=this.time;const g=this.particleSize*2-d,u=g*l/d/2,f=g*c/d/2;e.x+=u,e.y+=f,h.x-=u,h.y-=f}}}),this.showVelocityDistribution&&(this.velocityData.push(...this.particles.map(e=>e.velocity)),this.velocityData.length>1e3&&(this.velocityData=this.velocityData.slice(-500))),this.showMeanFreePath&&this.collisionCount>0){const e=this.particles.reduce((s,n)=>s+n.distanceTraveled,0);this.meanFreePath=e/this.collisionCount}}render(){this.showTemperatureHeatmap&&this.drawTemperatureHeatmap(),this.showVelocityDistribution&&this.drawVelocityDistribution(),this.showMeanFreePath&&this.drawMeanFreePathInfo(),this.particles.forEach(t=>{this.ctx.beginPath(),this.ctx.fillStyle=this.getVelocityColor(t.velocity),this.ctx.arc(t.x,t.y,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke()}),this.drawBrownianLabels()}getVelocityColor(t){const e=Math.min(t/3,1);if(e<.5){const s=e*2;return`rgb(0, ${Math.floor(255*s)}, ${Math.floor(255*(1-s))})`}else{const s=(e-.5)*2;return`rgb(${Math.floor(255*s)}, ${Math.floor(255*(1-s))}, 0)`}}drawTemperatureHeatmap(){const i=Math.ceil(this.ctx.canvas.width/20),e=Math.ceil(this.ctx.canvas.height/20);for(let s=0;s<e;s++)for(let n=0;n<i;n++){const a=n*20+10,o=s*20+20/2;let h=0,l=0;if(this.particles.forEach(c=>{const d=c.x-a,x=c.y-o;Math.sqrt(d*d+x*x)<20&&(h+=c.velocity,l++)}),l>0){h/=l;const c=Math.min(h/3,.3);this.ctx.fillStyle=`rgba(255, 100, 100, ${c})`,this.ctx.fillRect(n*20,s*20,20,20)}}}drawVelocityDistribution(){const e=this.ctx.canvas.width-200-20,s=120;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,100),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,100),this.velocityData.length>0){const a=new Array(20).fill(0),o=Math.max(...this.velocityData);this.velocityData.forEach(c=>{const d=Math.floor(c/o*19);d>=0&&d<20&&a[d]++});const h=Math.max(...a),l=200/20;this.ctx.fillStyle="#4ECDC4";for(let c=0;c<20;c++){const d=a[c]/h*80;this.ctx.fillRect(e+c*l+2,s+100-10-d,l-4,d)}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Velocity Distribution",e+200/2,s-5)}drawMeanFreePathInfo(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,120,200,80),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,120,200,80),this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText(`Collisions: ${this.collisionCount}`,30,140),this.ctx.fillText(`Mean Free Path: ${this.meanFreePath.toFixed(1)}`,30,160),this.ctx.fillText(`Temperature: ${this.temperature.toFixed(1)}`,30,180)}getStats(){const t=this.particles.reduce((i,e)=>i+Math.sqrt(e.vx*e.vx+e.vy*e.vy),0)/this.particles.length;return{particleCount:this.particles.length,avgSpeed:t,time:this.time,collisionCount:this.collisionCount,meanFreePath:this.meanFreePath,temperature:this.temperature}}drawBrownianLabels(){this.ctx.save(),this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Brownian Motion",this.ctx.canvas.width/2,25),this.ctx.font="12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillText("⟨v²⟩ = 3kBT/m  |  λ = 1/(√2πd²n)  |  D = kBT/(6πηr)",this.ctx.canvas.width/2,45),this.ctx.shadowBlur=0,this.ctx.restore()}}class nt{constructor(t){this.ctx=t,this.particles=[],this.particleCount=200,this.speed=1,this.diffusionRate=1,this.concentrationGradient=1,this.showConcentration=!0,this.particleSize=4,this.time=0,this.concentrationMap=[],this.diffusionStarted=!1,this.showConcentrationProfile=!0,this.showParticleTrails=!1,this.initializeParticles(),this.initializeConcentrationMap()}initializeParticles(){this.particles=[];const t=this.ctx.canvas.width*.2;for(let i=0;i<this.particleCount;i++)this.particles.push({x:Math.random()*t,y:Math.random()*this.ctx.canvas.height,vx:0,vy:0,color:"#FF6B6B",trail:[]})}initializeConcentrationMap(){this.concentrationMap=[];const t=15,i=Math.ceil(this.ctx.canvas.width/t),e=Math.ceil(this.ctx.canvas.height/t);for(let s=0;s<e;s++){this.concentrationMap[s]=[];for(let n=0;n<i;n++){const a=n/i;this.concentrationMap[s][n]=Math.max(0,1-a*1.5)}}}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setSpeed(t){this.speed=t}setDiffusionRate(t){this.diffusionRate=t}setConcentrationGradient(t){this.concentrationGradient=t,this.initializeConcentrationMap()}setParticleSize(t){this.particleSize=t}setShowConcentration(t){this.showConcentration=t}setShowConcentrationProfile(t){this.showConcentrationProfile=t}setShowParticleTrails(t){this.showParticleTrails=t}startDiffusion(){this.diffusionStarted=!0}reset(){this.time=0,this.diffusionStarted=!1,this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*20;this.diffusionStarted&&this.particles.forEach(e=>{var a,o;if(!isFinite(e.x)||!isFinite(e.y)||isNaN(e.x)||isNaN(e.y)){e.x=Math.random()*this.ctx.canvas.width*.2,e.y=Math.random()*this.ctx.canvas.height,e.vx=0,e.vy=0;return}e.vx+=(Math.random()-.5)*this.diffusionRate*.5,e.vy+=(Math.random()-.5)*this.diffusionRate*.5;const s=Math.floor(e.x/15),n=Math.floor(e.y/15);if(s>0&&s<this.concentrationMap[0].length-1&&n>=0&&n<this.concentrationMap.length){const h=((a=this.concentrationMap[n])==null?void 0:a[s])-((o=this.concentrationMap[n])==null?void 0:o[s+1]),l=Math.max(.1,1-this.time/1e4);e.vx+=h*.1*l}e.vx*=.98,e.vy*=.98,e.x+=e.vx*i*30,e.y+=e.vy*i*30,this.showParticleTrails&&(e.trail.push({x:e.x,y:e.y}),e.trail.length>20&&e.trail.shift()),e.x<0&&(e.x=0,e.vx*=-.5),e.x>this.ctx.canvas.width&&(e.x=this.ctx.canvas.width,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.y>this.ctx.canvas.height&&(e.y=this.ctx.canvas.height,e.vy*=-.5),(!isFinite(e.x)||!isFinite(e.y)||isNaN(e.x)||isNaN(e.y))&&(e.x=Math.random()*this.ctx.canvas.width*.2,e.y=Math.random()*this.ctx.canvas.height,e.vx=0,e.vy=0)})}render(){if(this.showConcentration)for(let i=0;i<this.concentrationMap.length;i++)for(let e=0;e<this.concentrationMap[i].length;e++){const n=this.concentrationMap[i][e]*.8,a=this.ctx.createLinearGradient(e*15,i*15,(e+1)*15,(i+1)*15);a.addColorStop(0,`rgba(102, 126, 234, ${n*.8})`),a.addColorStop(.5,`rgba(118, 75, 162, ${n})`),a.addColorStop(1,`rgba(102, 126, 234, ${n*.6})`),this.ctx.fillStyle=a,this.ctx.fillRect(e*15,i*15,15,15),this.ctx.strokeStyle=`rgba(255, 255, 255, ${n*.1})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(e*15,i*15,15,15)}this.showParticleTrails&&this.particles.forEach(t=>{if(t.trail.length>1){const i=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.trail[t.trail.length-1].x,t.trail[t.trail.length-1].y);i.addColorStop(0,"rgba(255, 107, 107, 0.8)"),i.addColorStop(.5,"rgba(255, 107, 107, 0.4)"),i.addColorStop(1,"rgba(255, 107, 107, 0.1)"),this.ctx.beginPath(),this.ctx.strokeStyle=i,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y);for(let e=1;e<t.trail.length;e++)this.ctx.lineTo(t.trail[e].x,t.trail[e].y);this.ctx.stroke()}}),this.particles.forEach(t=>{if(!isFinite(t.x)||!isFinite(t.y)||isNaN(t.x)||isNaN(t.y))return;const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=Math.min(i/5,1);this.ctx.shadowColor=`rgba(255, 107, 107, ${.4+e*.3})`,this.ctx.shadowBlur=12+e*8;const s=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,this.particleSize*(1+e*.3)),n=e>.5?255:200,a=.9+e*.1;s.addColorStop(0,`rgba(${n}, 107, 107, ${a})`),s.addColorStop(.6,`rgba(255, 107, 107, ${.8-e*.2})`),s.addColorStop(1,"rgba(255, 107, 107, 0.4)"),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,this.particleSize*(1+e*.2),0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.strokeStyle=`rgba(255, 255, 255, ${.9+e*.1})`,this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+e*.2})`,this.ctx.arc(t.x-this.particleSize*.3,t.y-this.particleSize*.3,this.particleSize*.3,0,Math.PI*2),this.ctx.fill()}),this.showConcentrationProfile&&this.drawConcentrationProfile(),this.diffusionStarted||this.drawStartBarrier(),this.drawDiffusionLabels()}drawConcentrationProfile(){const i=this.ctx.canvas.height-100-25,e=this.ctx.canvas.width-50;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(25,i,e,100),this.ctx.strokeStyle="rgba(102, 126, 234, 0.3)",this.ctx.lineWidth=2,this.ctx.strokeRect(25,i,e,100),this.ctx.fillStyle="rgba(0, 0, 0, 0.05)",this.ctx.fillRect(27,i+2,e-4,96);const s=50,n=e/s,a=new Array(s).fill(0);this.particles.forEach(d=>{const x=Math.floor(d.x/this.ctx.canvas.width*s);x>=0&&x<s&&a[x]++});const o=Math.max(...a),h=80/Math.max(o,1),l=this.ctx.createLinearGradient(25,i,25+e,i);l.addColorStop(0,"#FF6B6B"),l.addColorStop(.5,"#667eea"),l.addColorStop(1,"#764ba2"),this.ctx.strokeStyle=l,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(25,i+100-15);for(let d=0;d<s;d++){const x=25+d*n,r=i+100-15-a[d]*h;this.ctx.lineTo(x,r)}this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 107, 107, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(25,i+100-15);for(let d=0;d<s;d++){const x=25+d*n,r=i+100-15-a[d]*h;this.ctx.lineTo(x,r)}this.ctx.lineTo(25+e,i+100-15),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#333",this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Concentration Profile",this.ctx.canvas.width/2,i-8);const c=this.ctx.createLinearGradient(30,i+15,this.ctx.canvas.width-30,i+15);c.addColorStop(0,"#FF6B6B"),c.addColorStop(1,"#764ba2"),this.ctx.fillStyle=c,this.ctx.font="bold 14px Inter",this.ctx.fillText("High Concentration",35,i+20),this.ctx.fillText("Low Concentration",this.ctx.canvas.width-35,i+20)}drawStartBarrier(){const t=this.ctx.canvas.width*.2,i=this.ctx.createLinearGradient(t-2,0,t+2,0);i.addColorStop(0,"rgba(255, 0, 0, 0.8)"),i.addColorStop(.5,"rgba(255, 107, 107, 1)"),i.addColorStop(1,"rgba(255, 0, 0, 0.8)"),this.ctx.strokeStyle=i,this.ctx.lineWidth=4,this.ctx.setLineDash([15,8]),this.ctx.lineCap="round",this.ctx.shadowColor="rgba(255, 0, 0, 0.6)",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.ctx.canvas.height),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.shadowBlur=0;const e="Click or tap to start diffusion",s=this.ctx.measureText(e).width;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(this.ctx.canvas.width/2-s/2-20,this.ctx.canvas.height-60,s+40,40),this.ctx.strokeStyle="rgba(102, 126, 234, 0.3)",this.ctx.lineWidth=2,this.ctx.strokeRect(this.ctx.canvas.width/2-s/2-20,this.ctx.canvas.height-60,s+40,40);const n=this.ctx.createLinearGradient(this.ctx.canvas.width/2-s/2,this.ctx.canvas.height-50,this.ctx.canvas.width/2+s/2,this.ctx.canvas.height-50);n.addColorStop(0,"#667eea"),n.addColorStop(1,"#764ba2"),this.ctx.fillStyle=n,this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText(e,this.ctx.canvas.width/2,this.ctx.canvas.height-35)}getStats(){const t=this.particles.reduce((n,a)=>n+Math.sqrt(a.vx*a.vx+a.vy*a.vy),0)/this.particles.length,i=this.particles.filter(n=>n.x<this.ctx.canvas.width/2).length,e=this.particles.length-i,s=Math.abs(i-e)/this.particles.length;return{particleCount:this.particles.length,avgSpeed:t,concentrationSpread:s,time:this.time}}drawDiffusionLabels(){this.ctx.save(),this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Particle Diffusion",this.ctx.canvas.width/2,25),this.ctx.font="12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillText("∂c/∂t = D∇²c  |  J = -D∇c  |  D = kBT/(6πηr)",this.ctx.canvas.width/2,45),this.ctx.shadowBlur=0,this.ctx.restore()}}class at{constructor(t){this.ctx=t,this.particles=[],this.particleCount=50,this.temperature=300,this.volume=300,this.pressure=1,this.speed=1,this.showPressureGauge=!0,this.showParticleTrails=!1,this.showGasLaws=!1,this.showPressureHeatmap=!1,this.showVelocityDistribution=!1,this.showGasLawGraph=!1,this.showParticleCollisions=!1,this.lawType="boyle",this.time=0,this.containerWidth=200,this.containerX=300,this.pistonY=400-this.volume,this.collisionCount=0,this.velocityData=[],this.pressureHistory=[],this.volumeHistory=[],this.temperatureHistory=[],this.initialConditions={pressure:1,volume:300,temperature:300},this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++)this.particles.push({x:this.containerX+Math.random()*this.containerWidth,y:this.pistonY+this.volume+Math.random()*(this.volume*.8),vx:(Math.random()-.5)*this.temperature*.1,vy:(Math.random()-.5)*this.temperature*.1})}setSpeed(t){this.speed=t}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setTemperature(t){this.temperature=t,this.particles.forEach(i=>{const e=Math.sqrt(t/300);i.vx*=e,i.vy*=e})}setVolume(t){this.volume=t,this.pistonY=400-this.volume,this.particles.forEach(i=>{i.y>this.pistonY+this.volume&&(i.y=this.pistonY+this.volume-10)})}setPressure(t){this.pressure=t}setShowPressureGauge(t){this.showPressureGauge=t}setShowPressureHeatmap(t){this.showPressureHeatmap=t}setShowVelocityDistribution(t){this.showVelocityDistribution=t}setShowGasLawGraph(t){this.showGasLawGraph=t}setShowParticleCollisions(t){this.showParticleCollisions=t}setLawType(t){this.lawType=t,this.pressure=this.initialConditions.pressure,this.volume=this.initialConditions.volume,this.temperature=this.initialConditions.temperature,this.pistonY=400-this.volume,this.reset()}reset(){this.time=0,this.collisionCount=0,this.velocityData=[],this.pressureHistory=[],this.volumeHistory=[],this.temperatureHistory=[],this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*2;this.particles.forEach((s,n)=>{if(s.x+=s.vx*i*30,s.y+=s.vy*i*30,(s.x<this.containerX||s.x>this.containerX+this.containerWidth)&&(s.vx*=-.8,s.x=Math.max(this.containerX,Math.min(this.containerX+this.containerWidth,s.x)),this.collisionCount++),(s.y<this.pistonY||s.y>this.pistonY+this.volume)&&(s.vy*=-.8,s.y=Math.max(this.pistonY,Math.min(this.pistonY+this.volume,s.y)),this.collisionCount++),this.showParticleCollisions)for(let a=n+1;a<this.particles.length;a++){const o=this.particles[a],h=s.x-o.x,l=s.y-o.y,c=Math.sqrt(h*h+l*l);if(c<6){const d=s.vx,x=s.vy;s.vx=o.vx,s.vy=o.vy,o.vx=d,o.vy=x,this.collisionCount++;const r=6-c,g=r*h/c/2,u=r*l/c/2;s.x+=g,s.y+=u,o.x-=g,o.y-=u}}}),this.showVelocityDistribution&&(this.velocityData.push(...this.particles.map(s=>Math.sqrt(s.vx*s.vx+s.vy*s.vy))),this.velocityData.length>1e3&&(this.velocityData=this.velocityData.slice(-500)));const e=this.calculatePressure();this.pressureHistory.push(e),this.volumeHistory.push(this.volume),this.temperatureHistory.push(this.temperature),this.pressureHistory.length>100&&(this.pressureHistory.shift(),this.volumeHistory.shift(),this.temperatureHistory.shift()),this.calculatePressure()}calculatePressure(){const t=this.particles.length/(this.containerWidth*this.volume),i=this.particles.reduce((n,a)=>n+Math.sqrt(a.vx*a.vx+a.vy*a.vy),0)/this.particles.length,e=t*i*i*.01;this.applyGasLaw();const s=e-this.pressure;return this.pistonY+=s*.1,this.pistonY=Math.max(100,Math.min(350,this.pistonY)),this.volume=400-this.pistonY,e}applyGasLaw(){switch(this.lawType){case"boyle":const t=this.initialConditions.pressure*this.initialConditions.volume;this.volume!==this.initialConditions.volume&&(this.pressure=t/this.volume);break;case"charles":const i=this.initialConditions.volume/this.initialConditions.temperature;this.temperature!==this.initialConditions.temperature&&(this.volume=i*this.temperature,this.pistonY=400-this.volume);break;case"gay-lussac":const e=this.initialConditions.pressure/this.initialConditions.temperature;this.temperature!==this.initialConditions.temperature&&(this.pressure=e*this.temperature);break;case"combined":const s=this.initialConditions.pressure*this.initialConditions.volume/this.initialConditions.temperature;(this.volume!==this.initialConditions.volume||this.temperature!==this.initialConditions.temperature)&&(this.pressure=s*this.temperature/this.volume);break}}render(){this.showPressureHeatmap&&this.drawPressureHeatmap(),this.showVelocityDistribution&&this.drawVelocityDistribution(),this.showGasLawGraph&&this.drawGasLawGraph(),this.drawEnhancedContainer(),this.particles.forEach(t=>{this.ctx.beginPath(),this.ctx.fillStyle=this.getTemperatureColor(t),this.ctx.arc(t.x,t.y,3,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke()}),this.showPressureGauge&&this.drawPressureGauge(),this.drawLawDescription(),this.drawGasLabels()}drawEnhancedContainer(){const t=this.ctx.createLinearGradient(this.containerX,this.pistonY,this.containerX+this.containerWidth,this.pistonY+this.volume);t.addColorStop(0,"rgba(200, 220, 255, 0.1)"),t.addColorStop(1,"rgba(150, 180, 255, 0.2)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.containerX,this.pistonY,this.containerWidth,this.volume),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=4,this.ctx.strokeRect(this.containerX,this.pistonY,this.containerWidth,this.volume),this.ctx.fillStyle="#34495E",this.ctx.fillRect(this.containerX-8,this.pistonY-15,this.containerWidth+16,30),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=3,this.ctx.strokeRect(this.containerX-8,this.pistonY-15,this.containerWidth+16,30),this.ctx.fillStyle="#E74C3C",this.ctx.fillRect(this.containerX+this.containerWidth/2-15,this.pistonY-25,30,10),this.ctx.fillStyle="#2C3E50",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("GAS",this.containerX+this.containerWidth/2,this.pistonY+this.volume/2),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText(`Volume: ${this.volume}`,this.containerX+this.containerWidth/2,this.pistonY+this.volume+25)}drawLawDescription(){const t=this.ctx.canvas.width;this.ctx.canvas.height;const i=t-220,e=20,s=200,n=220;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(i,e,s,n),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=2,this.ctx.strokeRect(i,e,s,n),this.ctx.fillStyle="#2C3E50",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let a=e+30;const o={boyle:"Boyle's Law",charles:"Charles's Law","gay-lussac":"Gay-Lussac's Law",combined:"Combined Gas Law"};switch(this.ctx.fillText(o[this.lawType],i+10,a),a+=30,this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#E74C3C",this.lawType){case"boyle":this.ctx.fillText("P₁V₁ = P₂V₂",i+10,a),a+=25,this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant temperature",i+10,a),a+=18,this.ctx.fillText("Pressure ∝ 1/Volume",i+10,a);break;case"charles":this.ctx.fillText("V₁/T₁ = V₂/T₂",i+10,a),a+=25,this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant pressure",i+10,a),a+=18,this.ctx.fillText("Volume ∝ Temperature",i+10,a);break;case"gay-lussac":this.ctx.fillText("P₁/T₁ = P₂/T₂",i+10,a),a+=25,this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant volume",i+10,a),a+=18,this.ctx.fillText("Pressure ∝ Temperature",i+10,a);break;case"combined":this.ctx.fillText("P₁V₁/T₁ = P₂V₂/T₂",i+10,a),a+=25,this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("Combines all three laws",i+10,a),a+=18,this.ctx.fillText("PV/T = constant",i+10,a);break}a+=30,this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#2C3E50",this.ctx.fillText("Current Values:",i+10,a),a+=20,this.ctx.font="13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText(`P = ${this.pressure.toFixed(2)} atm`,i+10,a),a+=16,this.ctx.fillText(`V = ${this.volume.toFixed(0)} units`,i+10,a),a+=16,this.ctx.fillText(`T = ${this.temperature} K`,i+10,a)}getTemperatureColor(t){const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.temperature*.2,s=Math.min(i/e,1);if(s<.5){const n=s*2;return`rgb(0, ${Math.floor(255*n)}, ${Math.floor(255*(1-n))})`}else{const n=(s-.5)*2;return`rgb(${Math.floor(255*n)}, ${Math.floor(255*(1-n))}, 0)`}}drawPressureGauge(){this.ctx.beginPath(),this.ctx.fillStyle="#f0f0f0",this.ctx.arc(50,150,30,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#333",this.ctx.lineWidth=2,this.ctx.stroke(),this.particles.length/(this.containerWidth*this.volume),this.particles.reduce((a,o)=>a+Math.sqrt(o.vx*o.vx+o.vy*o.vy),0)/this.particles.length;const s=Math.min(this.pressure/2,1),n=-Math.PI/2+s*Math.PI;this.ctx.beginPath(),this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.moveTo(50,150),this.ctx.lineTo(50+Math.cos(n)*25,150+Math.sin(n)*25),this.ctx.stroke(),this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Pressure",50,195),this.ctx.fillText(s.toFixed(2),50,210)}drawPressureHeatmap(){const i=Math.ceil(this.containerWidth/15),e=Math.ceil(this.volume/15);for(let s=0;s<e;s++)for(let n=0;n<i;n++){const a=this.containerX+n*15+7.5,o=this.pistonY+s*15+15/2;let h=0,l=0;if(this.particles.forEach(c=>{const d=c.x-a,x=c.y-o;if(Math.sqrt(d*d+x*x)<15){const g=Math.sqrt(c.vx*c.vx+c.vy*c.vy);h+=g*g,l++}}),l>0){h/=l;const c=Math.min(h/100,.4);this.ctx.fillStyle=`rgba(255, 100, 100, ${c})`,this.ctx.fillRect(this.containerX+n*15,this.pistonY+s*15,15,15)}}}drawVelocityDistribution(){const e=this.ctx.canvas.width-200-20,s=120;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,100),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,100),this.velocityData.length>0){const a=new Array(20).fill(0),o=Math.max(...this.velocityData);this.velocityData.forEach(c=>{const d=Math.floor(c/o*19);d>=0&&d<20&&a[d]++});const h=Math.max(...a),l=200/20;this.ctx.fillStyle="#4ECDC4";for(let c=0;c<20;c++){const d=a[c]/h*80;this.ctx.fillRect(e+c*l+2,s+100-10-d,l-4,d)}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Velocity Distribution",e+200/2,s-5)}drawGasLawGraph(){const s=this.ctx.canvas.height-150-20;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,s,300,150),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,s,300,150),this.pressureHistory.length>1){const o=Math.max(...this.pressureHistory),h=Math.min(...this.pressureHistory),l=Math.max(...this.volumeHistory),c=Math.min(...this.volumeHistory),d=Math.max(...this.temperatureHistory),x=Math.min(...this.temperatureHistory);this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=2,this.ctx.beginPath();for(let r=0;r<this.pressureHistory.length;r++){let g,u;switch(this.lawType){case"boyle":g=20+(this.volumeHistory[r]-c)/(l-c)*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150;break;case"charles":g=20+(this.temperatureHistory[r]-x)/(d-x)*300,u=s+150-(this.volumeHistory[r]-c)/(l-c)*150;break;case"gay-lussac":g=20+(this.temperatureHistory[r]-x)/(d-x)*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150;break;default:g=20+r/this.pressureHistory.length*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150}g=Math.max(20,Math.min(320,g)),u=Math.max(s,Math.min(s+150,u)),r===0?this.ctx.moveTo(g,u):this.ctx.lineTo(g,u)}this.ctx.stroke(),this.ctx.fillStyle="#FF6B6B";for(let r=0;r<this.pressureHistory.length;r+=5){let g,u;switch(this.lawType){case"boyle":g=20+(this.volumeHistory[r]-c)/(l-c)*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150;break;case"charles":g=20+(this.temperatureHistory[r]-x)/(d-x)*300,u=s+150-(this.volumeHistory[r]-c)/(l-c)*150;break;case"gay-lussac":g=20+(this.temperatureHistory[r]-x)/(d-x)*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150;break;default:g=20+r/this.pressureHistory.length*300,u=s+150-(this.pressureHistory[r]-h)/(o-h)*150}g=Math.max(20,Math.min(320,g)),u=Math.max(s,Math.min(s+150,u)),this.ctx.beginPath(),this.ctx.arc(g,u,2,0,Math.PI*2),this.ctx.fill()}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center";let n,a;switch(this.lawType){case"boyle":n="Volume",a="Pressure";break;case"charles":n="Temperature (K)",a="Volume";break;case"gay-lussac":n="Temperature (K)",a="Pressure";break;default:n="Time",a="Pressure"}this.ctx.fillText(`${a} vs ${n}`,20+300/2,s-5)}getStats(){const t=this.particles.length/(this.containerWidth*this.volume),i=this.particles.reduce((s,n)=>s+Math.sqrt(n.vx*n.vx+n.vy*n.vy),0)/this.particles.length,e=t*i*i*.01;return{particleCount:this.particles.length,temperature:this.temperature,pressure:e,volume:Math.round(this.volume),collisionCount:this.collisionCount,lawType:this.lawType}}drawGasLabels(){this.ctx.save(),this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Gas Laws",this.ctx.canvas.width/2,25),this.ctx.shadowBlur=0,this.ctx.restore()}}class ot{constructor(t){this.ctx=t,this.length=120,this.angle=Math.PI/4,this.angularVelocity=0,this.gravity=1,this.damping=.01,this.speed=1,this.mass=1,this.showPath=!1,this.showVelocityVectors=!1,this.showForceVectors=!1,this.showEnergyInfo=!1,this.showPhaseSpace=!1,this.time=0,this.path=[],this.phaseSpaceData=[],this.energyHistory=[],this.initialAngle=Math.PI/4,this.maxAmplitude=Math.PI/4,this.periods=[],this.lastZeroCrossing=0,this.crossingCount=0}setLength(t){this.length=t}setSpeed(t){this.speed=t}setInitialAngle(t){this.initialAngle=t*Math.PI/180,this.angle=this.initialAngle}setGravity(t){this.gravity=t}setDamping(t){this.damping=t}setShowPath(t){this.showPath=t,t||(this.path=[])}setMass(t){this.mass=t}setShowVelocityVectors(t){this.showVelocityVectors=t}setShowForceVectors(t){this.showForceVectors=t}setShowEnergyInfo(t){this.showEnergyInfo=t}setShowPhaseSpace(t){this.showPhaseSpace=t,t||(this.phaseSpaceData=[])}reset(){this.angle=this.initialAngle,this.angularVelocity=0,this.time=0,this.path=[],this.phaseSpaceData=[],this.energyHistory=[],this.maxAmplitude=Math.abs(this.initialAngle),this.periods=[],this.lastZeroCrossing=0,this.crossingCount=0}update(t){this.time+=t;const i=t/1e3*this.speed*3,e=-(this.gravity*9.8)/(this.length/100)*Math.sin(this.angle),s=Math.abs(this.angularVelocity),n=this.damping*s*s,a=-Math.sign(this.angularVelocity)*n;if(this.angularVelocity+=(e+a)*i,this.angle+=this.angularVelocity*i,this.maxAmplitude=Math.max(this.maxAmplitude,Math.abs(this.angle)),this.angle*this.angularVelocity<0&&this.angularVelocity>0){if(this.crossingCount>0){const o=this.time-this.lastZeroCrossing;this.periods.push(o),this.periods.length>10&&this.periods.shift()}this.lastZeroCrossing=this.time,this.crossingCount++}if(this.showPath){const o=this.ctx.canvas.width/2+this.length*Math.sin(this.angle),h=this.ctx.canvas.height/2+this.length*Math.cos(this.angle);this.path.push({x:o,y:h}),this.path.length>100&&this.path.shift()}if(this.showPhaseSpace&&(this.phaseSpaceData.push({angle:this.angle,velocity:this.angularVelocity}),this.phaseSpaceData.length>200&&this.phaseSpaceData.shift()),this.showEnergyInfo){const o=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,h=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle));this.energyHistory.push({kinetic:o,potential:h,total:o+h}),this.energyHistory.length>100&&this.energyHistory.shift()}}render(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height*.3,e=t+this.length*Math.sin(this.angle),s=i+this.length*Math.cos(this.angle),n=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,a=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),o=n+a,h=n/o;if(this.showPhaseSpace&&this.drawPhaseSpacePlot(),this.showEnergyInfo&&this.drawEnergyBar(),this.showPath&&this.path.length>1){this.ctx.beginPath(),this.ctx.strokeStyle=`hsl(${200+h*60}, 70%, 50%, 0.6)`,this.ctx.lineWidth=3,this.ctx.moveTo(this.path[0].x,this.path[0].y);for(let c=1;c<this.path.length;c++)this.ctx.lineTo(this.path[c].x,this.path[c].y);this.ctx.stroke()}this.ctx.beginPath(),this.ctx.fillStyle="#2c3e50",this.ctx.arc(t,i,8,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#34495e",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(t+2,i+2,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=3,this.ctx.moveTo(t+1,i+1),this.ctx.lineTo(e+1,s+1),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#34495e",this.ctx.lineWidth=2,this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke(),this.showForceVectors&&this.drawForceVectors(t,i,e,s),this.showVelocityVectors&&this.drawVelocityVector(e,s);const l=`hsl(${200+h*60}, 70%, 50%)`;this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(e+2,s+2,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=l,this.ctx.arc(e,s,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(e-5,s-5,6,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2,this.ctx.stroke(),this.showEnergyInfo&&this.drawPendulumInfo(),this.drawPendulumLabels()}drawForceVectors(t,i,e,s){this.mass*this.gravity*9.8;const n=50;this.ctx.beginPath(),this.ctx.strokeStyle="#e74c3c",this.ctx.lineWidth=3,this.ctx.moveTo(e,s),this.ctx.lineTo(e,s+n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,s+n),this.ctx.lineTo(e-6,s+n-10),this.ctx.lineTo(e+6,s+n-10),this.ctx.closePath(),this.ctx.fillStyle="#e74c3c",this.ctx.fill(),this.ctx.fillStyle="#e74c3c",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Fg",e+15,s+n/2);const a=40,o=e-t,h=s-i,l=Math.sqrt(o*o+h*h);if(l>0){const c=o/l,d=h/l;this.ctx.beginPath(),this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=3,this.ctx.moveTo(e,s),this.ctx.lineTo(e-c*a,s-d*a),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-c*a,s-d*a),this.ctx.lineTo(e-c*a+d*6,s-d*a-c*6),this.ctx.lineTo(e-c*a-d*6,s-d*a+c*6),this.ctx.closePath(),this.ctx.fillStyle="#3498db",this.ctx.fill(),this.ctx.fillStyle="#3498db",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("T",e-c*a/2+15,s-d*a/2-10)}if(this.damping>.001&&Math.abs(this.angularVelocity)>.1){const c=this.length*this.angularVelocity*Math.cos(this.angle),d=-this.length*this.angularVelocity*Math.sin(this.angle),x=Math.sqrt(c*c+d*d);if(x>0){const r=this.damping*x*x,g=Math.min(r*2,30),u=c/x,f=d/x;this.ctx.beginPath(),this.ctx.strokeStyle="#e67e22",this.ctx.lineWidth=2,this.ctx.moveTo(e,s),this.ctx.lineTo(e-u*g,s-f*g),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-u*g,s-f*g),this.ctx.lineTo(e-u*g+f*4,s-f*g-u*4),this.ctx.lineTo(e-u*g-f*4,s-f*g+u*4),this.ctx.closePath(),this.ctx.fillStyle="#e67e22",this.ctx.fill(),this.ctx.fillStyle="#e67e22",this.ctx.font="bold 12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Fd",e-u*g/2-10,s-f*g/2-5)}}}drawVelocityVector(t,i){const e=this.length*this.angularVelocity*Math.cos(this.angle),s=-this.length*this.angularVelocity*Math.sin(this.angle),n=Math.sqrt(e*e+s*s);if(n>.1){const a=20/n,o=e*a,h=s*a;this.ctx.beginPath(),this.ctx.strokeStyle="#f39c12",this.ctx.lineWidth=3,this.ctx.moveTo(t,i),this.ctx.lineTo(t+o,i+h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+o,i+h),this.ctx.lineTo(t+o-h*.3,i+h+o*.3),this.ctx.lineTo(t+o+h*.3,i+h-o*.3),this.ctx.closePath(),this.ctx.fillStyle="#f39c12",this.ctx.fill()}}drawEnergyBar(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,20,200,20),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,20,200,20);const n=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,a=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),o=n+a;if(o>0){const h=n/o,l=a/o;this.ctx.fillStyle="#f39c12",this.ctx.fillRect(20,20,200*h,20),this.ctx.fillStyle="#3498db",this.ctx.fillRect(20+200*h,20,200*l,20)}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Energy",20+200/2,15),this.ctx.fillText("K",30,35),this.ctx.fillText("P",210,35)}drawPhaseSpacePlot(){const e=this.ctx.canvas.width-200-20,s=20;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,150),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,150),this.phaseSpaceData.length>1){const n=this.phaseSpaceData.map(d=>d.angle),a=this.phaseSpaceData.map(d=>d.velocity),o=Math.min(...n),h=Math.max(...n),l=Math.min(...a),c=Math.max(...a);this.ctx.beginPath(),this.ctx.strokeStyle="#9b59b6",this.ctx.lineWidth=2;for(let d=0;d<this.phaseSpaceData.length;d++){const x=e+(this.phaseSpaceData[d].angle-o)/(h-o)*200,r=s+150-(this.phaseSpaceData[d].velocity-l)/(c-l)*150;d===0?this.ctx.moveTo(x,r):this.ctx.lineTo(x,r)}this.ctx.stroke()}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText("Phase Space",e+200/2,s-5),this.ctx.fillText("θ",e+200/2,s+150+15),this.ctx.fillText("ω",e-10,s+150/2)}drawPendulumInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let e=60;this.ctx.fillText(`Angle: ${(this.angle*180/Math.PI).toFixed(1)}°`,20,e),e+=20,this.ctx.fillText(`Angular Velocity: ${this.angularVelocity.toFixed(2)} rad/s`,20,e),e+=20;const s=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,n=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle));if(this.ctx.fillText(`Kinetic Energy: ${s.toFixed(1)} J`,20,e),e+=20,this.ctx.fillText(`Potential Energy: ${n.toFixed(1)} J`,20,e),e+=20,this.ctx.fillText(`Total Energy: ${(s+n).toFixed(1)} J`,20,e),e+=20,this.periods.length>0){const l=this.periods.reduce((c,d)=>c+d,0)/this.periods.length;this.ctx.fillText(`Measured Period: ${l.toFixed(2)} s`,20,e),e+=20}const a=2*Math.PI*Math.sqrt(this.length/(this.gravity*9.8));this.ctx.fillText(`Theoretical Period: ${a.toFixed(2)} s`,20,e),e+=20,this.ctx.fillText(`Max Amplitude: ${(this.maxAmplitude*180/Math.PI).toFixed(1)}°`,20,e),e+=20;const o=Math.abs(this.angularVelocity),h=this.damping*o*o;this.ctx.fillText(`Air Resistance: ${h.toFixed(3)} N`,20,e),e+=20,this.ctx.fillText(`Damping Coefficient: ${this.damping.toFixed(3)}`,20,e)}getStats(){const t=2*Math.PI*Math.sqrt(this.length/(this.gravity*9.8)),i=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,e=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),s=Math.abs(this.angularVelocity),n=this.damping*s*s;return{angle:this.angle*180/Math.PI,angularVelocity:this.angularVelocity,theoreticalPeriod:t,measuredPeriod:this.periods.length>0?this.periods.reduce((a,o)=>a+o,0)/this.periods.length:0,kineticEnergy:i,potentialEnergy:e,totalEnergy:i+e,maxAmplitude:this.maxAmplitude*180/Math.PI,airResistanceForce:n,dampingCoefficient:this.damping,time:this.time}}drawPendulumLabels(){this.ctx.save(),this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Simple Pendulum",this.ctx.canvas.width/2,25),this.ctx.font="12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillText("T = 2π√(L/g)  |  θ̈ + (g/L)sin(θ) = 0  |  E = ½mL²θ̇² + mgL(1-cos(θ))",this.ctx.canvas.width/2,45),this.ctx.shadowBlur=0,this.ctx.restore()}}class ht{constructor(t){this.ctx=t,this.centerX=400,this.centerY=300,this.semiMajorAxis=200,this.eccentricity=.2,this.centralMass=1,this.speed=1,this.time=0,this.angle=0,this.showOrbitPath=!0,this.showVelocityVector=!1,this.showKeplerInfo=!1,this.calculateOrbitalParameters()}calculateOrbitalParameters(){this.semiMinorAxis=this.semiMajorAxis*Math.sqrt(1-this.eccentricity*this.eccentricity),this.focalDistance=this.semiMajorAxis*this.eccentricity,this.period=2*Math.PI*Math.sqrt(Math.pow(this.semiMajorAxis,3)/this.centralMass),this.angularVelocity=2*Math.PI/this.period,this.orbitPath=[];for(let t=0;t<=360;t+=2){const i=t*Math.PI/180,e=this.semiMajorAxis*(1-this.eccentricity*this.eccentricity)/(1+this.eccentricity*Math.cos(i)),s=this.centerX+e*Math.cos(i),n=this.centerY+e*Math.sin(i);this.orbitPath.push({x:s,y:n})}}setSpeed(t){this.speed=t}setEccentricity(t){this.eccentricity=t,this.calculateOrbitalParameters()}setSemiMajorAxis(t){this.semiMajorAxis=t,this.calculateOrbitalParameters()}setCentralMass(t){this.centralMass=t,this.calculateOrbitalParameters()}setShowOrbitPath(t){this.showOrbitPath=t}setShowVelocityVector(t){this.showVelocityVector=t}setShowKeplerInfo(t){this.showKeplerInfo=t}reset(){this.time=0,this.angle=0}update(t){this.time+=t;const i=t/1e3*this.speed*2;this.angle+=this.angularVelocity*i*100,this.angle>2*Math.PI&&(this.angle-=2*Math.PI);const e=this.semiMajorAxis*(1-this.eccentricity*this.eccentricity)/(1+this.eccentricity*Math.cos(this.angle));this.currentX=this.centerX+e*Math.cos(this.angle),this.currentY=this.centerY+e*Math.sin(this.angle);const s=this.angularVelocity*e;this.velocityX=-s*Math.sin(this.angle),this.velocityY=s*Math.cos(this.angle);const n=.5*s*s,a=-this.centralMass/e;this.totalEnergy=n+a,(e<this.perigee||this.perigee===void 0)&&(this.perigee=e),(e>this.apogee||this.apogee===void 0)&&(this.apogee=e)}render(){if(this.ctx.beginPath(),this.ctx.fillStyle="#FFD700",this.ctx.arc(this.centerX,this.centerY,15,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 215, 0, 0.3)",this.ctx.arc(this.centerX,this.centerY,25,0,Math.PI*2),this.ctx.fill(),this.showOrbitPath&&this.orbitPath.length>1){this.ctx.beginPath(),this.ctx.strokeStyle="rgba(100, 100, 100, 0.5)",this.ctx.lineWidth=1,this.ctx.moveTo(this.orbitPath[0].x,this.orbitPath[0].y);for(let t=1;t<this.orbitPath.length;t++)this.ctx.lineTo(this.orbitPath[t].x,this.orbitPath[t].y);this.ctx.stroke()}if(this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.arc(this.currentX,this.currentY,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(this.currentX+2,this.currentY+2,8,0,Math.PI*2),this.ctx.fill(),this.showVelocityVector){const i=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY),e=this.velocityX/i,s=this.velocityY/i;this.ctx.beginPath(),this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.moveTo(this.currentX,this.currentY),this.ctx.lineTo(this.currentX+e*40,this.currentY+s*40),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#FF6B6B";const n=Math.atan2(this.velocityY,this.velocityX),a=10;this.ctx.moveTo(this.currentX+e*40,this.currentY+s*40),this.ctx.lineTo(this.currentX+e*40-a*Math.cos(n-Math.PI/6),this.currentY+s*40-a*Math.sin(n-Math.PI/6)),this.ctx.lineTo(this.currentX+e*40-a*Math.cos(n+Math.PI/6),this.currentY+s*40-a*Math.sin(n+Math.PI/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#FF6B6B",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`v = ${i.toFixed(1)}`,this.currentX+e*55,this.currentY+s*55)}if(this.showKeplerInfo&&this.perigee&&this.apogee){const i=this.centerX+this.perigee*Math.cos(0),e=this.centerY+this.perigee*Math.sin(0);this.ctx.beginPath(),this.ctx.strokeStyle="#2ECC71",this.ctx.lineWidth=2,this.ctx.arc(i,e,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#2ECC71",this.ctx.font="bold 12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("P",i-3,e+3);const s=Math.PI,n=this.centerX+this.apogee*Math.cos(s),a=this.centerY+this.apogee*Math.sin(s);this.ctx.beginPath(),this.ctx.strokeStyle="#E74C3C",this.ctx.lineWidth=2,this.ctx.arc(n,a,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("A",n-3,a+3)}if(this.showKeplerInfo){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";const t=this.ctx.canvas.width-250,i=30;this.ctx.fillText(`Kepler's 1st Law: Elliptical orbit (e = ${this.eccentricity.toFixed(2)})`,t,i),this.ctx.fillText("Kepler's 2nd Law: Equal areas in equal times",t,i+20),this.ctx.fillText(`Kepler's 3rd Law: T^2 ∝ a^3 (T = ${this.period.toFixed(1)}s)`,t,i+40),this.perigee&&this.apogee&&(this.ctx.fillText(`Perigee: ${this.perigee.toFixed(0)}px`,t,i+60),this.ctx.fillText(`Apogee: ${this.apogee.toFixed(0)}px`,t,i+80),this.ctx.fillText(`Semi-major axis: ${this.semiMajorAxis}px`,t,i+100));const e=Math.sqrt(Math.pow(this.currentX-this.centerX,2)+Math.pow(this.currentY-this.centerY,2)),s=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);this.ctx.fillText(`Current distance: ${e.toFixed(0)}px`,t,i+120),this.ctx.fillText(`Current speed: ${s.toFixed(1)}`,t,i+140),this.totalEnergy!==void 0&&this.ctx.fillText(`Total energy: ${this.totalEnergy.toFixed(1)}`,t,i+160)}this.drawOrbitalLabels()}getStats(){const t=Math.sqrt(Math.pow(this.currentX-this.centerX,2)+Math.pow(this.currentY-this.centerY,2)),i=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);return{period:this.period,speed:i,distance:t,eccentricity:this.eccentricity,perigee:this.perigee,apogee:this.apogee,semiMajorAxis:this.semiMajorAxis,totalEnergy:this.totalEnergy,time:this.time}}drawOrbitalLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Orbital Motion",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillText("r = a(1-e²)/(1+ecos(θ))",this.ctx.canvas.width/2,50),this.ctx.fillText("T² ∝ a³",this.ctx.canvas.width/2,70),this.ctx.fillText("E = ½mv² - GMm/r",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.ctx.restore()}}class rt{constructor(t){this.ctx=t,this.balls=[],this.ballCount=5,this.restitution=.8,this.gravity=.5,this.speed=1,this.showAnalytics=!1,this.collisionType="elastic",this.collisionCount=0,this.collisionEffects=[],this.initializeBalls()}setSpeed(t){this.speed=t}setBallCount(t){this.ballCount=t,this.initializeBalls()}setRestitution(t){this.restitution=t}setGravity(t){this.gravity=t}setShowAnalytics(t){this.showAnalytics=t}setCollisionType(t){this.collisionType=t,this.initializeBalls()}initializeBalls(){if(this.balls=[],this.collisionType==="head-on"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height;this.balls=[{x:t*.25,y:i*.5,vx:80,vy:0,radius:20,mass:2},{x:t*.75,y:i*.5,vx:-80,vy:0,radius:20,mass:2}]}else if(this.collisionType==="elastic"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.2,y:i*.25},{x:t*.8,y:i*.25},{x:t*.2,y:i*.5},{x:t*.8,y:i*.5},{x:t*.5,y:i*.375},{x:t*.375,y:i*.2},{x:t*.625,y:i*.55},{x:t*.25,y:i*.55},{x:t*.75,y:i*.2}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const n=e[s];this.balls.push({x:n.x,y:n.y,vx:(Math.random()-.5)*120,vy:(Math.random()-.5)*120,radius:15+Math.random()*10,mass:1+Math.random()*2})}}else if(this.collisionType==="inelastic"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.25,y:i*.25},{x:t*.75,y:i*.25},{x:t*.25,y:i*.5},{x:t*.75,y:i*.5},{x:t*.5,y:i*.375}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const n=e[s];this.balls.push({x:n.x,y:n.y,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,radius:18+Math.random()*8,mass:1.5+Math.random()*1.5})}}else if(this.collisionType==="mixed"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.2,y:i*.2},{x:t*.8,y:i*.2},{x:t*.2,y:i*.55},{x:t*.8,y:i*.55},{x:t*.5,y:i*.375},{x:t*.375,y:i*.3},{x:t*.625,y:i*.45}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const n=e[s];this.balls.push({x:n.x,y:n.y,vx:(Math.random()-.5)*110,vy:(Math.random()-.5)*110,radius:12+Math.random()*12,mass:.8+Math.random()*2.4})}}else if(this.collisionType==="cascade"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=t*.075,s=t*.125,n=i*.375;for(let a=0;a<Math.min(this.ballCount,8);a++)this.balls.push({x:s+a*e,y:n,vx:a===0?100:0,vy:0,radius:15,mass:1.5})}this.collisionCount=0,this.lastCollision=null}reset(){this.collisionCount=0,this.collisionEffects=[],this.initializeBalls()}update(t){const i=t/1e3*this.speed*5;this.collisionEffects=this.collisionEffects.filter(e=>(e.time+=i,e.time<e.maxTime)),this.balls.forEach(e=>{e.x+=e.vx*i,e.y+=e.vy*i,e.vy+=this.gravity*9.8*i,e.vx*=1-.02*i,e.vy*=1-.02*i,(e.x-e.radius<0||e.x+e.radius>this.ctx.canvas.width)&&(e.vx*=-this.restitution,e.x=Math.max(e.radius,Math.min(this.ctx.canvas.width-e.radius,e.x)),this.collisionEffects.push({x:e.x,y:e.y,time:0,maxTime:.3,type:"wall"})),(e.y-e.radius<0||e.y+e.radius>this.ctx.canvas.height)&&(e.vy*=-this.restitution,e.y=Math.max(e.radius,Math.min(this.ctx.canvas.height-e.radius,e.y)),this.collisionEffects.push({x:e.x,y:e.y,time:0,maxTime:.3,type:"wall"}))});for(let e=0;e<this.balls.length;e++)for(let s=e+1;s<this.balls.length;s++)this.checkCollision(this.balls[e],this.balls[s])}checkCollision(t,i){const e=i.x-t.x,s=i.y-t.y,n=Math.sqrt(e*e+s*s);if(n<t.radius+i.radius){this.collisionCount++,this.collisionEffects.push({x:(t.x+i.x)/2,y:(t.y+i.y)/2,time:0,maxTime:.5,type:"ball"});const a=e/n,o=s/n,h=i.vx-t.vx,l=i.vy-t.vy,c=h*a+l*o;if(c>0)return;let d=this.restitution;this.collisionType==="inelastic"?d=.3:this.collisionType==="mixed"&&(d=.5+Math.random()*.3);const x=-(1+d)*c/(1/t.mass+1/i.mass);t.vx-=x*a/t.mass,t.vy-=x*o/t.mass,i.vx+=x*a/i.mass,i.vy+=x*o/i.mass;const r=t.radius+i.radius-n,g=a*r*.5,u=o*r*.5;t.x-=g,t.y-=u,i.x+=g,i.y+=u;const f=.5*t.mass*(t.vx*t.vx+t.vy*t.vy)+.5*i.mass*(i.vx*i.vx+i.vy*i.vy);this.lastCollision={ball1:{mass:t.mass,velocity:Math.sqrt(t.vx*t.vx+t.vy*t.vy)},ball2:{mass:i.mass,velocity:Math.sqrt(i.vx*i.vx+i.vy*i.vy)},energy:f,restitution:d}}}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.collisionEffects.forEach(i=>{const e=1-i.time/i.maxTime,s=40*(1-i.time/i.maxTime);if(i.type==="ball"){for(let n=0;n<3;n++){const a=s*(.3+n*.3),o=e*(1-n*.3);this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(255, 107, 107, ${o})`,this.ctx.lineWidth=3-n,this.ctx.arc(i.x,i.y,a,0,Math.PI*2),this.ctx.stroke()}for(let n=0;n<8;n++){const a=n*Math.PI*2/8,o=i.x+Math.cos(a)*s*.8,h=i.y+Math.sin(a)*s*.8;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${e*.8})`,this.ctx.arc(o,h,2,0,Math.PI*2),this.ctx.fill()}}else i.type==="wall"&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(100, 150, 255, ${e})`,this.ctx.lineWidth=4,this.ctx.arc(i.x,i.y,s*.7,0,Math.PI*2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(100, 150, 255, ${e*.5})`,this.ctx.lineWidth=2,this.ctx.arc(i.x,i.y,s*.4,0,Math.PI*2),this.ctx.stroke())}),this.balls.forEach((i,e)=>{const s=Math.sqrt(i.vx*i.vx+i.vy*i.vy),n=Math.min(s/100,1),a=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F"],o=a[e%a.length];this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(i.x+3,i.y+3,i.radius,0,Math.PI*2),this.ctx.fill();const h=this.ctx.createRadialGradient(i.x-i.radius*.3,i.y-i.radius*.3,0,i.x,i.y,i.radius);if(h.addColorStop(0,o),h.addColorStop(.7,o),h.addColorStop(1,"#1a1a2e"),this.ctx.beginPath(),this.ctx.fillStyle=h,this.ctx.arc(i.x,i.y,i.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+n*.4})`,this.ctx.arc(i.x-i.radius*.3,i.y-i.radius*.3,i.radius*.5,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle=n>.5?"#FFD700":"#333",this.ctx.lineWidth=2,this.ctx.stroke(),this.showAnalytics){const l=Math.sqrt(i.vx*i.vx+i.vy*i.vy);if(l>1){const d=i.vx/l,x=i.vy/l;this.ctx.beginPath(),this.ctx.strokeStyle="rgba(78, 205, 196, 0.3)",this.ctx.lineWidth=6,this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(i.x+d*50,i.y+x*50),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=3,this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(i.x+d*50,i.y+x*50),this.ctx.stroke();const r=Math.atan2(i.vy,i.vx),g=12;this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.moveTo(i.x+d*50,i.y+x*50),this.ctx.lineTo(i.x+d*50-g*Math.cos(r-Math.PI/6),i.y+x*50-g*Math.sin(r-Math.PI/6)),this.ctx.lineTo(i.x+d*50-g*Math.cos(r+Math.PI/6),i.y+x*50-g*Math.sin(r+Math.PI/6)),this.ctx.closePath(),this.ctx.fill();const u=i.x+d*70,f=i.y+x*70;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(u-25,f-8,50,16),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText(`v = ${l.toFixed(1)}`,u,f+3)}}}),this.showAnalytics&&this.drawCollisionInfo(),this.drawCollisionLabels()}drawCollisionInfo(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=Math.min(t*.2,300),s=Math.min(i*.25,250),n=10,a=10;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(n,a,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(n,a,e,s),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let o=a+25;this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("Collision Physics",n+10,o),o+=25,this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Scenario: ${this.collisionType}`,n+10,o),o+=20,this.ctx.fillText(`Bounciness: ${this.restitution}`,n+10,o),o+=20,this.ctx.fillText(`Collisions: ${this.collisionCount}`,n+10,o),o+=20,this.ctx.fillText(`Objects: ${this.balls.length}`,n+10,o),o+=25,this.lastCollision&&(this.ctx.fillStyle="#FFD700",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("Last Collision Analysis:",n+10,o),o+=20,this.ctx.font="13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`  Ball 1: m=${this.lastCollision.ball1.mass}, v=${this.lastCollision.ball1.velocity.toFixed(1)}`,n+10,o),o+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`  Ball 2: m=${this.lastCollision.ball2.mass}, v=${this.lastCollision.ball2.velocity.toFixed(1)}`,n+10,o),o+=15,this.ctx.fillStyle="#FFEAA7",this.ctx.fillText(`  Energy: ${this.lastCollision.energy.toFixed(1)}`,n+10,o),o+=15,this.ctx.fillStyle="#DDA0DD",this.ctx.fillText(`  Effective e: ${this.lastCollision.restitution.toFixed(2)}`,n+10,o),o+=25),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("Physics Principles:",n+10,o),o+=20,this.ctx.font="13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("  • Momentum conservation",n+10,o),o+=15,this.ctx.fillText("  • Energy transfer in collisions",n+10,o),o+=15,this.ctx.fillText("  • Impulse = Force × Time",n+10,o),o+=15,this.ctx.fillStyle="#96CEB4",this.ctx.fillText("  • Elastic: e = 1 (energy conserved)",n+10,o),o+=15,this.ctx.fillStyle="#FF6B6B",this.ctx.fillText("  • Inelastic: e < 1 (energy lost)",n+10,o)}getStats(){let t=0,i=0;return this.balls.forEach(e=>{const s=e.mass*Math.sqrt(e.vx*e.vx+e.vy*e.vy),n=.5*e.mass*(e.vx*e.vx+e.vy*e.vy);t+=s,i+=n}),{ballCount:this.balls.length,totalMomentum:t,totalEnergy:i,collisionCount:this.collisionCount}}drawCollisionLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Collision Physics",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("p = mv",this.ctx.canvas.width/2,50),this.ctx.fillText("Σp = constant",this.ctx.canvas.width/2,70),this.ctx.fillText("KE = ½mv²",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.ctx.restore()}}class lt{constructor(t){this.ctx=t,this.object={x:100,y:200,vx:0,vy:0},this.inclineAngle=20,this.frictionCoefficient=.3,this.objectMass=5,this.initialVelocity=50,this.gravity=1,this.speed=1,this.showAnalytics=!1,this.resetObject()}setSpeed(t){this.speed=t}setInclineAngle(t){this.inclineAngle=t,this.resetObject()}setFrictionCoefficient(t){this.frictionCoefficient=t}setObjectMass(t){this.objectMass=t}setInitialVelocity(t){this.initialVelocity=t,this.resetObject()}setGravity(t){this.gravity=t}setShowAnalytics(t){this.showAnalytics=t}resetObject(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=t*.125;this.object.x=e;const s=this.inclineAngle*Math.PI/180,n=t*.75,a=i*.5,o=a+n*Math.sin(s),h=i*.95,l=Math.max(0,o-h),c=a-l;this.object.y=c-15-18*Math.cos(s),this.object.vx=this.initialVelocity*Math.cos(s),this.object.vy=0}reset(){this.resetObject()}update(t){const i=t/1e3*this.speed*2,e=this.inclineAngle*Math.PI/180,s=this.objectMass*this.gravity*9.8,n=s*Math.cos(e),a=s*Math.sin(e),o=this.frictionCoefficient*n;let h=0;Math.abs(this.object.vx)<1e-4?Math.abs(a)>o?h=a-Math.sign(a)*o:(h=0,this.object.vx=0):h=a-Math.sign(this.object.vx)*o;const l=h/this.objectMass;this.object.vx+=l*i,this.object.x+=this.object.vx*i;const c=this.ctx.canvas.width,d=this.ctx.canvas.height,x=c*.75,r=c*.125,g=d*.5,u=r+x*Math.cos(e),f=g+x*Math.sin(e),m=d*.95,p=Math.max(0,f-m),y=g-p;this.object.x>u&&(this.object.x=u,this.object.vx=0),this.object.y=y+(this.object.x-r)*Math.tan(e)-15-18*Math.cos(e)}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);const i=this.inclineAngle*Math.PI/180,e=this.ctx.canvas.width,s=this.ctx.canvas.height,n=e*.75,a=e*.125,o=s*.5,h=a+n*Math.cos(i),l=o+n*Math.sin(i),c=s*.95,d=Math.max(0,l-c),x=o-d,r=l-d,g=15;this.ctx.save(),this.ctx.strokeStyle="rgba(80,80,80,0.25)",this.ctx.lineWidth=1;for(let y=0;y<=n;y+=40){const v=a+y*Math.cos(i),b=x+y*Math.sin(i);this.ctx.beginPath(),this.ctx.moveTo(v,b),this.ctx.lineTo(v-8*Math.sin(i),b+8*Math.cos(i)),this.ctx.stroke()}this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a,x),this.ctx.lineTo(h,r),this.ctx.lineTo(h+20*Math.sin(i),r-20*Math.cos(i)),this.ctx.lineTo(a+20*Math.sin(i),x-20*Math.cos(i)),this.ctx.closePath();const u="#f5f5f5",f="#757575";this.ctx.fillStyle=u,this.ctx.fill();const m=this.ctx.createLinearGradient(a,x,h,r);m.addColorStop(0,"rgba(255,255,255,0.3)"),m.addColorStop(.5,"rgba(255,255,255,0.1)"),m.addColorStop(1,"rgba(0,0,0,0.2)"),this.ctx.fillStyle=m,this.ctx.fill(),this.ctx.strokeStyle=f,this.ctx.lineWidth=1.5;for(let y=0;y<n;y+=20){const v=a+y*Math.cos(i),b=x+y*Math.sin(i);this.ctx.beginPath(),this.ctx.moveTo(v,b),this.ctx.lineTo(v+15*Math.sin(i),b-15*Math.cos(i)),this.ctx.stroke()}this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(a,x,38,0,i,!1),this.ctx.stroke(),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText(`${this.inclineAngle}°`,a+44*Math.cos(i/2),x+44*Math.sin(i/2)),this.ctx.restore(),this.ctx.save(),this.ctx.translate(this.object.x,this.object.y),this.ctx.rotate(i),this.ctx.fillStyle="rgba(0, 0, 0, 0.25)",this.ctx.fillRect(-g+4,-g+4,g*2,g*2);const p=this.ctx.createLinearGradient(-g,-g,g,g);p.addColorStop(0,"#ff6b6b"),p.addColorStop(.7,"#ee5a52"),p.addColorStop(1,"#c62828"),this.ctx.fillStyle=p,this.ctx.fillRect(-g,-g,g*2,g*2),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(-g,-g,g*2,g*.6),this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2.5,this.ctx.strokeRect(-g,-g,g*2,g*2),this.ctx.restore(),this.showAnalytics&&(this.drawForceVectors(),this.drawFrictionInfo()),this.drawFrictionLabels()}drawForceVectors(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),n=this.frictionCoefficient*e,a=Math.abs(this.object.vx)<1e-4&&Math.abs(s)<=n?0:s-Math.sign(this.object.vx||s)*n,o=this.object.x,h=this.object.y,l=(x,r,g,u,f,m)=>{const p=Math.sqrt(g*g+u*u);if(p<1)return;const y=g/p,v=u/p,b=Math.max(50,Math.min(120,p)),S=x+y*b,P=r+v*b;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(x,r),this.ctx.lineTo(S,P),this.ctx.strokeStyle=f,this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(S,P),this.ctx.lineTo(S-12*y-8*v,P-12*v+8*y),this.ctx.lineTo(S-12*y+8*v,P-12*v-8*y),this.ctx.lineTo(S,P),this.ctx.fillStyle=f,this.ctx.fill(),this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle=f,this.ctx.textAlign="left",this.ctx.fillText(m,S+15,P+4),this.ctx.restore()};l(o,h,0,i*.12,"#1565C0","mg"),l(o,h,s*Math.cos(t)*.12,s*Math.sin(t)*.12,"#FF8C00",`mg sin(${this.inclineAngle}°)`);let c=-1;Math.abs(this.object.vx)<1e-4?c=-Math.sign(s):c=-Math.sign(this.object.vx);const d=Math.max(n*.12,20);l(o,h,c*d*Math.cos(t),c*d*Math.sin(t),"#C62828","f"),Math.abs(a)>.1&&l(o,h,a*Math.cos(t)*.12,a*Math.sin(t)*.12,"#6A1B9A","Fₙₑₜ")}drawFrictionInfo(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),n=this.frictionCoefficient*e,a=s-n,o=a/this.objectMass;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(10,10,280,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(10,10,280,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let h=35;this.ctx.fillText(`Friction: ${this.frictionCoefficient.toFixed(2)}`,20,h),h+=25,this.ctx.fillText(`Angle: ${this.inclineAngle}°`,20,h),h+=25,this.ctx.fillText(`Net Force: ${a.toFixed(1)} N`,20,h),h+=25,this.ctx.fillText(`Acceleration: ${o.toFixed(2)} m/s²`,20,h)}getStats(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),n=this.frictionCoefficient*e,a=s-n,o=a/this.objectMass;return{frictionCoefficient:this.frictionCoefficient,inclineAngle:this.inclineAngle,netForce:a,acceleration:o}}drawFrictionLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Friction & Inclined Planes",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("F = μN",this.ctx.canvas.width/2,50),this.ctx.fillText("F∥ = mg sin θ",this.ctx.canvas.width/2,70),this.ctx.fillText("N = mg cos θ",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.ctx.restore()}}class ct{constructor(t){this.ctx=t,this.waveType="transverse",this.speed=1,this.frequency=1,this.amplitude=50,this.wavelength=150,this.showAnalytics=!1,this.time=0,this.particles=[],this.waveSpeed=0,this.energy=0,this.initializeParticles(),this.calculateWaveParameters()}initializeParticles(){this.particles=[];const t=80;for(let i=0;i<t;i++)this.particles.push({x:i/t*this.ctx.canvas.width,y:this.ctx.canvas.height/2,originalY:this.ctx.canvas.height/2,originalX:i/t*this.ctx.canvas.width,vx:0,vy:0,index:i})}calculateWaveParameters(){this.waveSpeed=this.frequency*this.wavelength,this.energy=.5*this.amplitude*this.amplitude*this.frequency*this.frequency}setWaveType(t){this.waveType=t,this.speed=1,this.frequency=1,this.amplitude=50,this.wavelength=150,this.showAnalytics=!1,this.time=0,this.initializeParticles(),this.calculateWaveParameters();const i=document.getElementById("waveSpeed"),e=document.getElementById("waveFrequency"),s=document.getElementById("waveAmplitude"),n=document.getElementById("waveType"),a=document.getElementById("waveShowAnalytics");i&&(i.value=this.speed,document.getElementById("waveSpeedValue").textContent=this.speed+"x"),e&&(e.value=this.frequency,document.getElementById("waveFrequencyValue").textContent=this.frequency),s&&(s.value=this.amplitude,document.getElementById("waveAmplitudeValue").textContent=this.amplitude),n&&(n.value=this.waveType),a&&(a.checked=this.showAnalytics)}setSpeed(t){this.speed=t}setFrequency(t){this.frequency=t,this.calculateWaveParameters()}setAmplitude(t){this.amplitude=t,this.calculateWaveParameters()}setWavelength(t){this.wavelength=t,this.calculateWaveParameters()}setShowAnalytics(t){this.showAnalytics=t}reset(){this.waveType="transverse",this.speed=1,this.frequency=1,this.amplitude=50,this.wavelength=150,this.showAnalytics=!1,this.time=0,this.initializeParticles(),this.calculateWaveParameters();const t=document.getElementById("waveSpeed"),i=document.getElementById("waveFrequency"),e=document.getElementById("waveAmplitude"),s=document.getElementById("waveType"),n=document.getElementById("waveShowAnalytics");t&&(t.value=this.speed,document.getElementById("waveSpeedValue").textContent=this.speed+"x"),i&&(i.value=this.frequency,document.getElementById("waveFrequencyValue").textContent=this.frequency),e&&(e.value=this.amplitude,document.getElementById("waveAmplitudeValue").textContent=this.amplitude),s&&(s.value=this.waveType),n&&(n.checked=this.showAnalytics)}update(t){const i=this.waveType==="longitudinal"?1:5,e=t/1e3*this.speed*i;this.time+=e,this.particles.forEach((s,n)=>{const a=s.x/this.wavelength*2*Math.PI,o=this.time*this.frequency*2*Math.PI;let h=0,l=0;switch(this.waveType){case"transverse":h=this.amplitude*Math.sin(a-o),l=-this.amplitude*this.frequency*2*Math.PI*Math.cos(a-o),s.y=s.originalY+h,s.vy=l;break;case"longitudinal":const c=this.amplitude*.5;h=c*Math.sin(a-o),l=-c*this.frequency*2*Math.PI*Math.cos(a-o),s.x=s.originalX+h,s.y=s.originalY,s.vx=l,s.vy=0,s.displacement=h;break;case"interference":const d=this.amplitude*Math.sin(a-o),x=this.amplitude*Math.sin(a+o);h=d+x,l=-this.amplitude*this.frequency*2*Math.PI*(Math.cos(a-o)-Math.cos(a+o)),s.y=s.originalY+h,s.vy=l;break;case"standing":h=this.amplitude*Math.sin(a)*Math.cos(o),l=-this.amplitude*this.frequency*2*Math.PI*Math.sin(a)*Math.sin(o),s.y=s.originalY+h,s.vy=l;break}})}render(){this.drawGrid(),this.waveType==="longitudinal"?this.drawLongitudinalWaveform():this.drawEnhancedWaveform(),this.drawParticles(),this.drawWaveDirection(),this.drawCanvasLabels(),this.showAnalytics&&(this.drawVelocityVectors(),this.drawWaveInfo(),this.drawEnergyVisualization())}drawGrid(){this.ctx.strokeStyle="rgba(100, 100, 100, 0.3)",this.ctx.lineWidth=1,this.ctx.setLineDash([5,5]);for(let i=0;i<this.ctx.canvas.width;i+=this.wavelength)this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.ctx.canvas.height),this.ctx.stroke();this.ctx.setLineDash([]);const t=this.ctx.canvas.height/2;this.ctx.strokeStyle="rgba(100, 100, 100, 0.2)",this.ctx.lineWidth=1;for(let i=t-this.amplitude;i<=t+this.amplitude;i+=this.amplitude/2)this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(this.ctx.canvas.width,i),this.ctx.stroke()}drawEnhancedWaveform(){this.ctx.beginPath();const t=this.ctx.createLinearGradient(0,0,this.ctx.canvas.width,0);if(t.addColorStop(0,"#667eea"),t.addColorStop(.5,"#764ba2"),t.addColorStop(1,"#667eea"),this.ctx.strokeStyle=t,this.ctx.lineWidth=4,this.particles.length>1){const i=this.particles[0].x,e=this.particles[this.particles.length-1].x,s=300;this.ctx.moveTo(i,this.particles[0].y);for(let n=1;n<s;n++){const a=n/(s-1),o=i+a*(e-i),h=a*(this.particles.length-1),l=Math.floor(h),c=Math.min(l+1,this.particles.length-1),d=h-l,x=this.particles[l].y,r=this.particles[c].y,g=x+d*(r-x);this.ctx.lineTo(o,g)}}this.ctx.stroke(),this.ctx.shadowColor="#667eea",this.ctx.shadowBlur=10,this.ctx.stroke(),this.ctx.shadowBlur=0}drawLongitudinalWaveform(){if(this.particles.length<2)return;const t=this.ctx.canvas.height/2,i=20;this.ctx.strokeStyle="#667eea",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(this.particles[0].x,t);const e=this.particles[this.particles.length-1].x-this.particles[0].x,s=200;for(let n=0;n<=s;n++){const a=n/s,o=this.particles[0].x+a*e,h=o/this.wavelength*2*Math.PI,l=this.time*this.frequency*2*Math.PI,c=this.amplitude*Math.sin(h-l),d=Math.sin(a*Math.PI*8)*i,x=t+d+c*.3;this.ctx.lineTo(o,x)}this.ctx.stroke(),this.ctx.shadowColor="#667eea",this.ctx.shadowBlur=10,this.ctx.stroke(),this.ctx.shadowBlur=0,this.drawLongitudinalWaveDirection()}drawLongitudinalWaveDirection(){const t=this.ctx.canvas.height/2,i=this.frequency*this.wavelength,e=50+this.time*i*.1%100;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=3,this.ctx.moveTo(e,t),this.ctx.lineTo(e+30,t),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(e+30,t),this.ctx.lineTo(e+25,t-5),this.ctx.lineTo(e+25,t+5),this.ctx.closePath(),this.ctx.fill()}drawCanvasLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center";const t=this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1)+" Wave";this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText(t,this.ctx.canvas.width/2,25),this.ctx.font="12px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillText(`v = f×λ = ${this.waveSpeed.toFixed(1)} px/s  |  y = A sin(2π(ft-x/λ))  |  E ∝ A²f²`,this.ctx.canvas.width/2,45),this.ctx.shadowBlur=0,this.ctx.restore()}drawParticles(){this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.amplitude*this.frequency*2*Math.PI,s=Math.min(i/e,1),n=Math.floor(100+s*155),a=Math.floor(100+(1-s)*100),o=Math.floor(200+s*55),h=this.waveType==="longitudinal"?8:5;this.ctx.beginPath(),this.ctx.fillStyle=`rgb(${n}, ${a}, ${o})`,this.ctx.arc(t.x,t.y,h,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.arc(t.x-1,t.y-1,h*.4,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke()})}drawVelocityVectors(){this.particles.forEach(t=>{if(Math.sqrt(t.vx*t.vx+t.vy*t.vy)>1){const s=t.x+t.vx*.1,n=t.y+t.vy*.1;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=2,this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s,n),this.ctx.stroke();const a=Math.atan2(t.vy,t.vx);this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(s,n),this.ctx.lineTo(s-6*Math.cos(a-Math.PI/6),n-6*Math.sin(a-Math.PI/6)),this.ctx.lineTo(s-6*Math.cos(a+Math.PI/6),n-6*Math.sin(a+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}})}drawWaveDirection(){if(this.waveType!=="standing"){const t=this.frequency*this.wavelength,i=50+this.time*t*.1%100;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=3,this.ctx.moveTo(i,50),this.ctx.lineTo(i+20,50),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(i+20,50),this.ctx.lineTo(i+15,45),this.ctx.lineTo(i+15,55),this.ctx.closePath(),this.ctx.fill()}}drawWaveInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let t=120;this.ctx.fillText(`Wave Type: ${this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1)}`,10,t),t+=20,this.ctx.fillText(`Frequency: ${this.frequency.toFixed(1)} Hz`,10,t),t+=20,this.ctx.fillText(`Wavelength: ${this.wavelength.toFixed(0)} px`,10,t),t+=20,this.ctx.fillText(`Amplitude: ${this.amplitude.toFixed(0)} px`,10,t),t+=20,this.ctx.fillText(`Wave Speed: ${this.waveSpeed.toFixed(1)} px/s`,10,t),t+=20,this.ctx.fillText(`Energy: ${this.energy.toFixed(1)}`,10,t),t+=30,this.ctx.fillText("Wave Equation: y = A sin(kx - ωt)",10,t),t+=20,this.ctx.fillText("where: k = 2π/λ, ω = 2πf",10,t)}drawEnergyVisualization(){const e=this.ctx.canvas.width-200-20,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(e,s,200,20);const n=.5*100*100*3*3,o=200*Math.min(this.energy/n,1),h=this.ctx.createLinearGradient(e,s,e+o,s);h.addColorStop(0,"#4CAF50"),h.addColorStop(1,"#FF9800"),this.ctx.fillStyle=h,this.ctx.fillRect(e,s,o,20),this.ctx.fillStyle="#fff",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillText(`Energy: ${this.energy.toFixed(1)}`,e+200/2,s+15)}getStats(){return{waveType:this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1),frequency:this.frequency.toFixed(1),wavelength:this.wavelength.toFixed(0),amplitude:this.amplitude.toFixed(0),waveSpeed:this.waveSpeed.toFixed(1),energy:this.energy.toFixed(1),time:this.time.toFixed(1)}}}class dt{constructor(t){this.ctx=t,this.particles=[],this.frequency=5,this.amplitude=50,this.waveSpeed=343,this.particleCount=15,this.waveType="transverse",this.showPressure=!0,this.animationSpeed=1,this.time=0,this.sourceX=100,this.sourceY=this.ctx.canvas.height/2,this.receiverX=this.ctx.canvas.width-100,this.receiverY=this.ctx.canvas.height/2,this.showSourceReceiver=!0,this.sourceActive=!0,this.pulses=[],this.pulseDuration=2,this.initializeParticles(),this.setupClickEvents()}setupClickEvents(){this.ctx.canvas.addEventListener("click",t=>{const i=this.ctx.canvas.getBoundingClientRect(),e=t.clientX-i.left,s=t.clientY-i.top;Math.sqrt((e-this.sourceX)**2+(s-this.sourceY)**2)<50&&this.triggerWavePulse()}),this.ctx.canvas.addEventListener("touchstart",t=>{t.preventDefault();const i=this.ctx.canvas.getBoundingClientRect(),e=t.touches[0],s=e.clientX-i.left,n=e.clientY-i.top;Math.sqrt((s-this.sourceX)**2+(n-this.sourceY)**2)<50&&this.triggerWavePulse()})}initializeParticles(){this.particles=[];const t=this.ctx.canvas.width/this.particleCount;for(let i=0;i<this.particleCount;i++)this.particles.push({x:i*t,originalX:i*t,y:this.ctx.canvas.height/2,originalY:this.ctx.canvas.height/2,vx:0,vy:0,size:4+Math.random()*2,color:`hsl(${200+Math.random()*60}, 70%, 60%)`,pressure:0,life:0})}setFrequency(t){this.frequency=t}setAmplitude(t){this.amplitude=t}setWaveSpeed(t){this.waveSpeed=t}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setWaveType(t){this.waveType=t}setShowPressure(t){this.showPressure=t}setAnimationSpeed(t){this.animationSpeed=t}setShowSourceReceiver(t){this.showSourceReceiver=t}setSourceActive(t){this.sourceActive=t}setSourcePosition(t,i){this.sourceX=t,this.sourceY=i}setReceiverPosition(t,i){this.receiverX=t,this.receiverY=i}triggerWavePulse(){const t={startTime:this.time,duration:5,active:!0};this.pulses.push(t)}reset(){this.time=0,this.pulses=[],this.initializeParticles()}update(t){this.time+=t*this.animationSpeed,this.pulses=this.pulses.filter(e=>(this.time-e.startTime)/1e3<e.duration);const i=this.waveSpeed/this.frequency*.5;2*Math.PI*this.frequency,this.amplitude/100*50,this.particles.forEach((e,s)=>{let n=!1,a=0,o=0;if(this.pulses.forEach(h=>{const l=(this.time-h.startTime)/1e3,c=h.duration;if(l>=0&&l<=c){n=!0;const d=this.receiverX-this.sourceX,x=h.duration,g=d/x/this.waveSpeed,u=l*(this.waveSpeed*g);o=Math.min(u/d,1),a=o*d/i*2*Math.PI}}),n){const h=6*i,l=this.sourceX+(this.receiverX-this.sourceX)*o,c=Math.min(this.receiverX,l+h),d=s/(this.particleCount-1)*(c-l);let x=l+d;if(x<l&&(x=l),x>c&&(x=c),x>=this.sourceX&&x<=this.receiverX&&x>=l&&x<=c){const r=this.amplitude/100*120;(this.waveType==="transverse"||this.waveType==="combined")&&(e.x=x,e.y=e.originalY+r*Math.sin(a+s*.2),e.vy=r*2*Math.PI*Math.cos(a+s*.2)*this.animationSpeed*.001),(this.waveType==="longitudinal"||this.waveType==="combined")&&(e.x=x+r*.1*Math.sin(a+s*.2),e.vx=r*.1*2*Math.PI*Math.cos(a+s*.2)*this.animationSpeed*.001),(this.waveType==="longitudinal"||this.waveType==="combined")&&(e.pressure=Math.sin(a+s*.2))}else e.x=-100,e.y=-100,e.vy=0,e.vx=0,e.pressure=0}else e.y=e.originalY,e.x=e.originalX,e.vy=0,e.vx=0,e.pressure=0;e.life+=t})}render(){if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBackground(),this.showSourceReceiver&&this.drawSourceAndReceiver(),this.pulses&&this.pulses.length>0)switch(this.waveType){case"transverse":this.drawTransverseWave();break;case"longitudinal":this.drawLongitudinalWave();break;case"combined":this.drawCombinedWave();break}else this.drawInstruction();this.drawSoundInfo(),this.drawRealWorldAnalogy()}drawInstruction(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(this.ctx.canvas.width/2-200,this.ctx.canvas.height/2-40,400,80),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("🎵 Click the red source to trigger a sound wave!",this.ctx.canvas.width/2,this.ctx.canvas.height/2-10),this.ctx.font="14px Arial",this.ctx.fillText("Watch the wave propagate from source to receiver",this.ctx.canvas.width/2,this.ctx.canvas.height/2+10),this.ctx.fillText("Adjust controls to see different wave behaviors",this.ctx.canvas.width/2,this.ctx.canvas.height/2+30)}drawBackground(){this.ctx.strokeStyle="rgba(200, 200, 200, 0.2)",this.ctx.lineWidth=1;for(let t=0;t<this.ctx.canvas.width;t+=50)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.ctx.canvas.height),this.ctx.stroke();for(let t=0;t<this.ctx.canvas.height;t+=50)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.ctx.canvas.width,t),this.ctx.stroke()}drawTransverseWave(){this.ctx.strokeStyle="#0066CC",this.ctx.lineWidth=3,this.ctx.beginPath(),this.particles.forEach((t,i)=>{i===0?this.ctx.moveTo(t.x,t.y):this.ctx.lineTo(t.x,t.y)}),this.ctx.stroke(),this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=Math.min(i*100,1),n=`hsl(${200+e*60}, 80%, 60%)`;this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),e>.5&&(this.ctx.shadowColor=n,this.ctx.shadowBlur=8,this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size+2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0)})}drawLongitudinalWave(){this.particles.forEach(t=>{const i=t.pressure,e=Math.abs(i);let s;i>0?s="hsl(30, 80%, 60%)":s="hsl(180, 60%, 60%)";const n=t.size+e*5;this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n,0,Math.PI*2),this.ctx.fill(),e>.5&&(this.ctx.shadowColor=s,this.ctx.shadowBlur=8,this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,n+2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0),this.showPressure&&e>.2&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=3,this.ctx.beginPath(),i>0?(this.ctx.moveTo(t.x-15,t.y),this.ctx.lineTo(t.x-5,t.y),this.ctx.moveTo(t.x+5,t.y),this.ctx.lineTo(t.x+15,t.y)):(this.ctx.moveTo(t.x-5,t.y),this.ctx.lineTo(t.x-15,t.y),this.ctx.moveTo(t.x+15,t.y),this.ctx.lineTo(t.x+5,t.y)),this.ctx.stroke())}),this.showPressure&&this.drawPressureZones()}drawCombinedWave(){this.drawTransverseWave(),this.showPressure&&this.drawPressureZones(),this.particles.forEach(t=>{const i=t.pressure;if(Math.abs(i)>.3){let s;i>0?s="hsl(0, 80%, 60%)":s="hsl(240, 80%, 60%)",this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y+30,3,0,Math.PI*2),this.ctx.fill()}})}drawPressureZones(){const t=this.waveSpeed/this.frequency,i=this.waveSpeed;this.frequency;const e=this.time*.001*i%t,s=80,n=this.sourceY-s/2;for(let a=this.sourceX;a<=this.receiverX;a+=t/4){const o=(a-e)%t,h=2*Math.PI*o/t,l=Math.sin(h);l>.5?(this.ctx.fillStyle="rgba(255, 165, 0, 0.2)",this.ctx.fillRect(a,n,t/4,s),this.ctx.strokeStyle="rgba(255, 165, 0, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(a,n,t/4,s),this.ctx.fillStyle="rgba(255, 165, 0, 0.7)",this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText("C",a+t/8,n+15)):l<-.5&&(this.ctx.fillStyle="rgba(0, 128, 128, 0.2)",this.ctx.fillRect(a,n,t/4,s),this.ctx.strokeStyle="rgba(0, 128, 128, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(a,n,t/4,s),this.ctx.fillStyle="rgba(0, 128, 128, 0.7)",this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText("R",a+t/8,n+15))}}drawSourceAndReceiver(){if(this.ctx.strokeStyle="rgba(255, 255, 0, 0.3)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,50,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle=this.sourceActive?"#FF6B6B":"#666666",this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,25,0,Math.PI*2),this.ctx.fill(),this.sourceActive){this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,35,0,Math.PI*2),this.ctx.stroke();const t=Math.sin(this.time*.01)*.3+.7;this.ctx.fillStyle=`rgba(255, 107, 107, ${t*.3})`,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,40,0,Math.PI*2),this.ctx.fill()}this.ctx.fillStyle="#4ECDC4",this.ctx.beginPath(),this.ctx.arc(this.receiverX,this.receiverY,20,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.receiverX,this.receiverY,30,0,Math.PI*2),this.ctx.stroke(),this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#FF6B6B",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("🎤 Source",this.sourceX,this.sourceY+50),this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("👂 Receiver",this.receiverX,this.receiverY+50),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.strokeStyle="#FFD93D",this.ctx.lineWidth=3,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.moveTo(this.sourceX+40,this.sourceY),this.ctx.lineTo(this.receiverX-30,this.receiverY),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle="#FFD93D",this.ctx.beginPath(),this.ctx.moveTo(this.receiverX-30,this.receiverY),this.ctx.lineTo(this.receiverX-40,this.receiverY-5),this.ctx.lineTo(this.receiverX-40,this.receiverY+5),this.ctx.closePath(),this.ctx.fill()}drawSoundInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,320,180),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("🎵 Sound Wave Properties",20,30),this.ctx.font="14px Arial",this.ctx.fillText(`Frequency: ${this.frequency} Hz`,20,50),this.ctx.fillText(`Wavelength: ${(this.waveSpeed/this.frequency).toFixed(1)} m`,20,70),this.ctx.fillText(`Wave Speed: ${this.waveSpeed} m/s`,20,90);const e=(this.receiverX-this.sourceX)/5;this.ctx.fillText(`Visual Speed: ${e.toFixed(1)} px/s`,20,110),this.ctx.fillText(`Amplitude: ${this.amplitude}%`,20,130),this.ctx.fillText(`Wave Type: ${this.waveType}`,20,150),this.ctx.fillText(`Particles: ${this.particleCount}`,20,170)}drawRealWorldAnalogy(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(this.ctx.canvas.width-280,10,270,140),this.ctx.fillStyle="white",this.ctx.font="bold 14px Arial",this.ctx.textAlign="left",this.ctx.fillText("💡 Real-World Examples:",this.ctx.canvas.width-270,30),this.ctx.font="12px Arial",this.waveType==="transverse"?(this.ctx.fillText("🎸 Guitar/violin strings",this.ctx.canvas.width-270,50),this.ctx.fillText("🌊 Ocean surface waves",this.ctx.canvas.width-270,70),this.ctx.fillText("📡 Electromagnetic waves",this.ctx.canvas.width-270,90),this.ctx.fillText("🎪 Jump rope motion",this.ctx.canvas.width-270,110)):this.waveType==="longitudinal"?(this.ctx.fillText("🔊 Sound waves in air",this.ctx.canvas.width-270,50),this.ctx.fillText("🎤 Speaker diaphragm",this.ctx.canvas.width-270,70),this.ctx.fillText("💨 Air compression waves",this.ctx.canvas.width-270,90),this.ctx.fillText("🌊 Seismic P-waves",this.ctx.canvas.width-270,110)):(this.ctx.fillText("🎵 Complex wave patterns",this.ctx.canvas.width-270,50),this.ctx.fillText("🔊 Multiple wave types",this.ctx.canvas.width-270,70),this.ctx.fillText("📡 Combined phenomena",this.ctx.canvas.width-270,90),this.ctx.fillText("🎼 Musical instruments",this.ctx.canvas.width-270,110))}getStats(){return{waveType:this.waveType,frequency:this.frequency,wavelength:this.waveSpeed/this.frequency,waveSpeed:this.waveSpeed,amplitude:this.amplitude,particleCount:this.particleCount,time:this.time}}}class xt{constructor(t){this.ctx=t,this.charges=[],this.testParticles=[],this.fieldStrength=1,this.speed=1,this.particleCount=20,this.showFieldLines=!0,this.showParticles=!0,this.showForceArrows=!1,this.showAnalytics=!0,this.time=0,this.initializeTestParticles(),this.initializeDefaultCharges()}initializeTestParticles(){this.testParticles=[];for(let t=0;t<this.particleCount;t++)this.testParticles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:0,vy:0,trail:[],maxTrailLength:30})}initializeDefaultCharges(){this.addChargeAtPosition("positive",this.ctx.canvas.width*.3,this.ctx.canvas.height*.5),this.addChargeAtPosition("negative",this.ctx.canvas.width*.7,this.ctx.canvas.height*.5)}setSpeed(t){this.speed=t}setFieldStrength(t){this.fieldStrength=t}setParticleCount(t){this.particleCount=t,this.initializeTestParticles()}setShowAnalytics(t){this.showAnalytics=t}addChargeAtPosition(t,i,e){const s={x:i,y:e,type:t,magnitude:1,color:t==="positive"?"#ff6b6b":"#667eea"};this.charges.push(s)}clearCharges(){this.charges=[],this.initializeDefaultCharges()}reset(){this.time=0,this.charges=[],this.initializeTestParticles(),this.initializeDefaultCharges()}calculateElectricField(t,i){let e=0,s=0;const n=500;return this.charges.forEach(a=>{const o=t-a.x,h=i-a.y,l=Math.sqrt(o*o+h*h);if(l>10){const c=n*a.magnitude*this.fieldStrength/(l*l),d=a.type==="positive"?1:-1;e+=d*c*o/l,s+=d*c*h/l}}),{ex:e,ey:s}}update(t){const i=t/1e3*this.speed*20;this.time+=i,this.testParticles.forEach(e=>{const s=this.calculateElectricField(e.x,e.y);e.vx+=s.ex*i*.5,e.vy+=s.ey*i*.5,e.vx*=.95,e.vy*=.95,Math.sqrt(e.vx*e.vx+e.vy*e.vy)>100&&(e.vx*=.8,e.vy*=.8),e.x+=e.vx*i,e.y+=e.vy*i,e.trail.push({x:e.x,y:e.y}),e.trail.length>e.maxTrailLength&&e.trail.shift(),e.x<0&&(e.x=this.ctx.canvas.width),e.x>this.ctx.canvas.width&&(e.x=0),e.y<0&&(e.y=this.ctx.canvas.height),e.y>this.ctx.canvas.height&&(e.y=0)})}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#181c2b"),t.addColorStop(1,"#232946"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.showAnalytics&&(this.drawFieldLines(),this.drawParticles(),this.drawForceArrows()),this.drawCharges(),this.drawElectricLabels()}drawFieldLines(){for(let i=30;i<this.ctx.canvas.width;i+=30)for(let e=30;e<this.ctx.canvas.height;e+=30){const s=this.calculateElectricField(i,e),n=Math.sqrt(s.ex*s.ex+s.ey*s.ey);if(n>.1){const a=Math.atan2(s.ey,s.ex),o=Math.min(n/50,1);this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(102, 126, 234, ${o})`,this.ctx.lineWidth=2,this.ctx.moveTo(i,e),this.ctx.lineTo(i+25*Math.cos(a),e+25*Math.sin(a)),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(102, 126, 234, ${o})`,this.ctx.moveTo(i+25*Math.cos(a),e+25*Math.sin(a)),this.ctx.lineTo(i+20*Math.cos(a-Math.PI/6),e+20*Math.sin(a-Math.PI/6)),this.ctx.lineTo(i+20*Math.cos(a+Math.PI/6),e+20*Math.sin(a+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}}}drawCharges(){this.charges.forEach(t=>{const i=this.ctx.createRadialGradient(t.x-8,t.y-8,0,t.x,t.y,20);t.type==="positive"?(i.addColorStop(0,"#ff6b6b"),i.addColorStop(.7,"#ff4757"),i.addColorStop(1,"#ff3838")):(i.addColorStop(0,"#667eea"),i.addColorStop(.7,"#5f6fd8"),i.addColorStop(1,"#5352ed")),this.ctx.beginPath(),this.ctx.fillStyle=t.type==="positive"?"rgba(255, 107, 107, 0.3)":"rgba(102, 126, 234, 0.3)",this.ctx.arc(t.x,t.y,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(t.x+2,t.y+2,12,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 20px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.type==="positive"?"+":"−",t.x,t.y)})}drawParticles(){this.testParticles.forEach(t=>{if(t.trail.length>1){this.ctx.beginPath();const e=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);e.addColorStop(0,"rgba(255, 255, 255, 0.1)"),e.addColorStop(1,"rgba(255, 255, 255, 0.6)"),this.ctx.strokeStyle=e,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(s=>{this.ctx.lineTo(s.x,s.y)}),this.ctx.stroke()}const i=this.ctx.createRadialGradient(t.x-3,t.y-3,0,t.x,t.y,8);i.addColorStop(0,"#ffffff"),i.addColorStop(.7,"#f8f9fa"),i.addColorStop(1,"#e9ecef"),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.arc(t.x,t.y,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,4,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.arc(t.x+1,t.y+1,4,0,Math.PI*2),this.ctx.fill()})}drawForceArrows(){this.testParticles.forEach(t=>{const i=this.calculateElectricField(t.x,t.y);if(Math.sqrt(i.ex*i.ex+i.ey*i.ey)>5){const n=t.x+i.ex*.8,a=t.y+i.ey*.8,o=this.ctx.createLinearGradient(t.x,t.y,n,a);o.addColorStop(0,"#ff6b35"),o.addColorStop(1,"#ff8c42"),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 107, 53, 0.4)",this.ctx.lineWidth=6,this.ctx.lineCap="round",this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(n,a),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=o,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(n,a),this.ctx.stroke();const h=Math.atan2(i.ey,i.ex);this.ctx.beginPath(),this.ctx.fillStyle=o,this.ctx.moveTo(n,a),this.ctx.lineTo(n-10*Math.cos(h-Math.PI/6),a-10*Math.sin(h-Math.PI/6)),this.ctx.lineTo(n-10*Math.cos(h+Math.PI/6),a-10*Math.sin(h+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}})}drawInfo(){const e=this.ctx.canvas.width-200-20,s=20,n=this.ctx.createLinearGradient(e,s,e,s+120);n.addColorStop(0,"rgba(24, 28, 43, 0.95)"),n.addColorStop(1,"rgba(35, 41, 70, 0.95)"),this.ctx.fillStyle=n,this.ctx.fillRect(e,s,200,120),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("Electric Field Analytics",e+15,s+25),this.ctx.fillStyle="#e9ecef",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Charges: ${this.charges.length}`,e+15,s+45),this.ctx.fillText(`Particles: ${this.testParticles.length}`,e+15,s+65),this.ctx.fillText(`Field Strength: ${this.fieldStrength.toFixed(1)}`,e+15,s+85),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(5,this.ctx.canvas.height-50,300,40),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("🔴 Positive (+)  🔵 Negative (−)",10,this.ctx.canvas.height-40),this.ctx.fillText("Click canvas to add charges",10,this.ctx.canvas.height-20)}getStats(){return{chargeCount:this.charges.length,particleCount:this.testParticles.length,fieldStrength:this.fieldStrength.toFixed(1),time:this.time.toFixed(1)}}drawElectricLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Electric Fields",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("E = kQ/r²",this.ctx.canvas.width/2,50),this.ctx.fillText("F = kq₁q₂/r²",this.ctx.canvas.width/2,70),this.ctx.fillText("E = ΣEᵢ",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.drawTestParticleBanner(),this.ctx.restore()}drawTestParticleBanner(){const s=this.ctx.canvas.height-55,n=this.ctx.createLinearGradient(10,s,10,s+40);n.addColorStop(0,"rgba(255, 255, 255, 0.95)"),n.addColorStop(1,"rgba(240, 240, 240, 0.95)"),this.ctx.fillStyle=n,this.ctx.fillRect(10,s,320,40),this.ctx.shadowColor="rgba(102, 126, 234, 0.6)",this.ctx.shadowBlur=4,this.ctx.strokeStyle="rgba(102, 126, 234, 0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(10,s,320,40),this.ctx.shadowBlur=0,this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("White particles = Test charges (positive)",22,s+40/2),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.arc(300,s+40/2,6,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="#ffffff",this.ctx.arc(300,s+40/2,3,0,Math.PI*2),this.ctx.fill()}}class gt{constructor(t){this.ctx=t,this.speed=1,this.fieldStrength=1,this.particleCount=15,this.showFieldLines=!0,this.showParticles=!0,this.showForceArrows=!1,this.time=0,this.animationOffset=0,this.magnets=[],this.particles=[],this.initializeParticles(),this.initializeDefaultMagnets()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++)this.particles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,charge:Math.random()>.5?1:-1,trail:[],maxTrailLength:30})}initializeDefaultMagnets(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height/2,e=50;this.magnets=[{x:t,y:i-e/2,strength:this.fieldStrength,pole:"north",color:"#ff6b6b",isPartOfMagnet:!0,magnetId:1},{x:t,y:i+e/2,strength:this.fieldStrength,pole:"south",color:"#667eea",isPartOfMagnet:!0,magnetId:1}]}setSpeed(t){this.speed=t}setFieldStrength(t){this.fieldStrength=t,this.magnets.forEach(i=>{i.strength=t})}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setShowFieldLines(t){this.showFieldLines=t}setShowParticles(t){this.showParticles=t}setShowForceArrows(t){this.showForceArrows=t}addMagnetAtPosition(t,i){this.magnets.push({x:t,y:i-50/2,strength:this.fieldStrength,pole:"north",color:"#ff6b6b",isPartOfMagnet:!0,magnetId:this.magnets.length}),this.magnets.push({x:t,y:i+50/2,strength:this.fieldStrength,pole:"south",color:"#667eea",isPartOfMagnet:!0,magnetId:this.magnets.length-1})}clearMagnets(){this.magnets=[]}reset(){this.time=0,this.clearMagnets(),this.initializeDefaultMagnets(),this.initializeParticles()}calculateMagneticField(t,i){let e=0,s=0;return this.magnets.forEach(n=>{const a=t-n.x,o=i-n.y,h=Math.sqrt(a*a+o*o);if(h>10){const l=n.strength/(1+h/100);n.pole==="north"?s+=l:s-=l}}),{Bx:e,By:s}}update(t){const i=t/1e3*this.speed*3;this.time+=i,this.animationOffset=this.time*.5%1,this.particles.forEach(e=>{const s=this.calculateMagneticField(e.x,e.y),n=e.charge*e.vy*s.By,a=-e.charge*e.vx*s.By;e.vx+=n*i,e.vy+=a*i,Math.sqrt(e.vx*e.vx+e.vy*e.vy)>150&&(e.vx*=.95,e.vy*=.95),e.x+=e.vx*i,e.y+=e.vy*i,e.trail.push({x:e.x,y:e.y}),e.trail.length>e.maxTrailLength&&e.trail.shift(),e.x<0&&(e.x=this.ctx.canvas.width),e.x>this.ctx.canvas.width&&(e.x=0),e.y<0&&(e.y=this.ctx.canvas.height),e.y>this.ctx.canvas.height&&(e.y=0)})}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.showFieldLines&&this.drawFieldLines(),this.drawMagnets(),this.drawParticles(),this.showForceArrows&&this.drawForceArrows(),this.drawMagneticLabels()}drawFieldLines(){if(this.magnets.length===0)return;const t={};this.magnets.forEach(i=>{t[i.magnetId]||(t[i.magnetId]=[]),t[i.magnetId].push(i)}),Object.values(t).forEach(i=>{if(i.length===2){const e=i.find(n=>n.pole==="north"),s=i.find(n=>n.pole==="south");e&&s&&this.drawMagnetFieldLines(e,s)}}),this.drawInteractionFieldLines()}drawMagnetFieldLines(t,i){const e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),s=Math.atan2(i.y-t.y,i.x-t.x);this.drawSimpleFieldLines(t,i,e,s)}drawSimpleFieldLines(t,i,e,s){for(let a=0;a<12;a++){const o=a/12*Math.PI*2;this.drawRadiatingFieldLine(t,o,"north")}for(let a=0;a<12;a++){const o=a/12*Math.PI*2;this.drawRadiatingFieldLine(i,o,"south")}}drawRadiatingFieldLine(t,i,e){const n=t.x,a=t.y,o=n+Math.cos(i)*120,h=a+Math.sin(i)*120,l=Math.min(1,this.animationOffset/1),c=n+(o-n)*l,d=a+(h-a)*l,x=e==="north"?"rgba(255, 107, 107, 0.7)":"rgba(102, 126, 234, 0.7)",r=2;this.ctx.strokeStyle=x,this.ctx.lineWidth=r,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(n,a),this.ctx.lineTo(c,d),this.ctx.stroke(),l>=.7&&this.drawSimpleArrowhead(c,d,i,e)}drawSimpleArrowhead(t,i,e,s){const a=Math.PI/6,o=s==="north"?e:e+Math.PI,h=t+Math.cos(o)*10,l=i+Math.sin(o)*10,c=t+Math.cos(o+a)*10*.6,d=i+Math.sin(o+a)*10*.6,x=t+Math.cos(o-a)*10*.6,r=i+Math.sin(o-a)*10*.6,g=s==="north"?"rgba(255, 107, 107, 0.9)":"rgba(102, 126, 234, 0.9)";this.ctx.fillStyle=g,this.ctx.beginPath(),this.ctx.moveTo(h,l),this.ctx.lineTo(c,d),this.ctx.lineTo(x,r),this.ctx.closePath(),this.ctx.fill()}drawInteractionFieldLines(){const t=this.magnets.filter(e=>e.pole==="north"),i=this.magnets.filter(e=>e.pole==="south");t.forEach(e=>{i.forEach(s=>{if(e.magnetId!==s.magnetId){const n=Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2));n<200&&n>60&&this.drawInteractionFieldLine(e,s)}})})}drawInteractionFieldLine(t,i){const e=this.time*.3%1;Math.atan2(i.y-t.y,i.x-t.x);const s=t.x,n=t.y,a=i.x,o=i.y,h=1*e,l=s+(a-s)*h,c=n+(o-n)*h;if(this.ctx.shadowColor="rgba(255, 255, 255, 0.4)",this.ctx.shadowBlur=3,this.ctx.strokeStyle="rgba(255, 255, 255, 0.6)",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(s,n),this.ctx.lineTo(l,c),this.ctx.stroke(),this.ctx.shadowBlur=0,h>.1){const d=Math.atan2(c-n,l-s);this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.moveTo(l,c),this.ctx.lineTo(l-10*Math.cos(d-Math.PI/6),c-10*Math.sin(d-Math.PI/6)),this.ctx.lineTo(l-10*Math.cos(d+Math.PI/6),c-10*Math.sin(d+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}}drawMagnets(){const t={};this.magnets.forEach(i=>{t[i.magnetId]||(t[i.magnetId]=[]),t[i.magnetId].push(i)}),Object.values(t).forEach(i=>{if(i.length===2){const e=i.find(n=>n.pole==="north"),s=i.find(n=>n.pole==="south");e&&s&&this.drawMagnetBody(e,s)}}),this.magnets.forEach((i,e)=>{this.drawMagnetPole(i)})}drawMagnetBody(t,i){const e=this.ctx.createLinearGradient(t.x,t.y,i.x,i.y);e.addColorStop(0,"#ff6b6b"),e.addColorStop(.5,"#8b5cf6"),e.addColorStop(1,"#667eea"),this.ctx.strokeStyle=e,this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=16,this.ctx.beginPath(),this.ctx.moveTo(t.x+3,t.y+3),this.ctx.lineTo(i.x+3,i.y+3),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke()}drawMagnetPole(t){this.ctx.shadowColor=t.pole==="north"?"rgba(255, 107, 107, 0.6)":"rgba(102, 126, 234, 0.6)",this.ctx.shadowBlur=12,this.ctx.beginPath(),this.ctx.fillStyle=t.pole==="north"?"rgba(255, 107, 107, 0.4)":"rgba(102, 126, 234, 0.4)",this.ctx.arc(t.x,t.y,18,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const s=this.ctx.createRadialGradient(t.x-6,t.y-6,0,t.x,t.y,12);t.pole==="north"?(s.addColorStop(0,"#ff6b6b"),s.addColorStop(.6,"#ff4757"),s.addColorStop(1,"#ff3838")):(s.addColorStop(0,"#667eea"),s.addColorStop(.6,"#5f6fd8"),s.addColorStop(1,"#5352ed")),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(t.x+2,t.y+2,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(t.x-3,t.y-3,4,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=2,this.ctx.fillText(t.pole==="north"?"N":"S",t.x,t.y),this.ctx.shadowBlur=0}drawParticles(){this.particles.forEach(t=>{if(t.trail.length>1){this.ctx.beginPath();const e=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);e.addColorStop(0,t.charge>0?"rgba(255, 100, 100, 0.2)":"rgba(100, 100, 255, 0.2)"),e.addColorStop(1,t.charge>0?"rgba(255, 100, 100, 0.6)":"rgba(100, 100, 255, 0.6)"),this.ctx.strokeStyle=e,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(s=>{this.ctx.lineTo(s.x,s.y)}),this.ctx.stroke()}const i=this.ctx.createRadialGradient(t.x-3,t.y-3,0,t.x,t.y,8);t.charge>0?(i.addColorStop(0,"#ff8a65"),i.addColorStop(.7,"#ff6b6b"),i.addColorStop(1,"#ff4757")):(i.addColorStop(0,"#8b9dc3"),i.addColorStop(.7,"#667eea"),i.addColorStop(1,"#5f6fd8")),this.ctx.shadowColor=t.charge>0?"rgba(255, 107, 107, 0.6)":"rgba(102, 126, 234, 0.6)",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,6,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(t.x+1,t.y+1,6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.charge>0?"+":"−",t.x,t.y)})}drawForceArrows(){this.particles.forEach(t=>{const i=this.calculateMagneticField(t.x,t.y),e=t.charge*t.vy*i.By,s=-t.charge*t.vx*i.By;if(Math.sqrt(e*e+s*s)>5){const o=t.x+e*.3,h=t.y+s*.3,l=this.ctx.createLinearGradient(t.x,t.y,o,h);l.addColorStop(0,"#ff9800"),l.addColorStop(1,"#ff8c42"),this.ctx.shadowColor="rgba(255, 152, 0, 0.6)",this.ctx.shadowBlur=6,this.ctx.strokeStyle=l,this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(o,h),this.ctx.stroke(),this.ctx.shadowBlur=0;const c=Math.atan2(s,e);this.ctx.beginPath(),this.ctx.fillStyle=l,this.ctx.moveTo(o,h),this.ctx.lineTo(o-10*Math.cos(c-Math.PI/6),h-10*Math.sin(c-Math.PI/6)),this.ctx.lineTo(o-10*Math.cos(c+Math.PI/6),h-10*Math.sin(c+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}})}drawInfo(){const e=this.ctx.canvas.width-200-20,s=20,n=this.ctx.createLinearGradient(e,s,e,s+120);n.addColorStop(0,"rgba(24, 28, 43, 0.95)"),n.addColorStop(1,"rgba(35, 41, 70, 0.95)"),this.ctx.fillStyle=n,this.ctx.fillRect(e,s,200,120),this.ctx.strokeStyle="rgba(255, 107, 107, 0.5)",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("Magnetic Field Analytics",e+15,s+25),this.ctx.fillStyle="#e9ecef",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Magnets: ${this.magnets.length}`,e+15,s+45),this.ctx.fillText(`Particles: ${this.particles.length}`,e+15,s+65),this.ctx.fillText(`Field Strength: ${this.fieldStrength.toFixed(1)}`,e+15,s+85);const a=380,o=45,h=10,l=this.ctx.canvas.height-60,c=this.ctx.createLinearGradient(h,l,h,l+o);c.addColorStop(0,"rgba(255, 255, 255, 0.95)"),c.addColorStop(1,"rgba(240, 240, 240, 0.95)"),this.ctx.fillStyle=c,this.ctx.fillRect(h,l,a,o),this.ctx.strokeStyle="rgba(255, 107, 107, 0.6)",this.ctx.lineWidth=2,this.ctx.strokeRect(h,l,a,o),this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("Red particles = Positive charge, Blue particles = Negative charge",h+12,l+o/2-8),this.ctx.fillText("Click to add magnets, particles spiral around magnetic field lines",h+12,l+o/2+8)}getStats(){return{magnetCount:this.magnets.length,particleCount:this.particles.length,fieldStrength:this.fieldStrength.toFixed(1),time:this.time.toFixed(1)}}drawMagneticLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Magnetic Fields",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("F = q(v × B)",this.ctx.canvas.width/2,50),this.ctx.fillText("F = qvB sin θ",this.ctx.canvas.width/2,70),this.ctx.fillText("B = μ₀I/2πr",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.drawMagneticBanner(),this.ctx.restore()}drawMagneticBanner(){const s=this.ctx.canvas.height-65,n=this.ctx.createLinearGradient(10,s,10,s+50);n.addColorStop(0,"rgba(255, 255, 255, 0.95)"),n.addColorStop(1,"rgba(240, 240, 240, 0.95)"),this.ctx.fillStyle=n,this.ctx.fillRect(10,s,400,50),this.ctx.shadowColor="rgba(255, 107, 107, 0.6)",this.ctx.shadowBlur=4,this.ctx.strokeStyle="rgba(255, 107, 107, 0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(10,s,400,50),this.ctx.shadowBlur=0,this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("Click to add complete magnets (N-S pairs)",22,s+50/2-8),this.ctx.fillText("Red particles = Positive charge, Blue particles = Negative charge",22,s+50/2+8),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 107, 107, 0.4)",this.ctx.arc(380,s+50/2,6,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.arc(380,s+50/2,3,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 10px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("N",380,s+50/2)}}class ut{constructor(t){this.ctx=t,this.componentType="diode",this.biasType="forward",this.inputVoltage=5,this.baseVoltage=.7,this.current=0,this.power=0,this.temperature=25,this.showElectrons=!0,this.showCurrent=!0,this.showVoltage=!0,this.animationSpeed=1,this.time=0,this.isActive=!1,this.componentX=this.ctx.canvas.width/2,this.componentY=this.ctx.canvas.height/2,this.batteryX=this.componentX-250,this.batteryY=this.componentY,this.loadX=this.componentX+250,this.loadY=this.componentY,this.electrons=[],this.holes=[],this.sparks=[],this.energyWaves=[],this.initializeParticles(),this.glowIntensity=0,this.pulsePhase=0,this.energyParticles=[]}initializeParticles(){this.electrons=[],this.holes=[],this.sparks=[],this.energyWaves=[],this.energyParticles=[];for(let t=0;t<30;t++)this.electrons.push({x:this.componentX+50+Math.random()*100,y:this.componentY-40+Math.random()*80,vx:0,vy:0,size:3.5+Math.random()*1.2,color:"#00AAFF",glow:0,trail:[],active:!1});for(let t=0;t<30;t++)this.holes.push({x:this.componentX-150+Math.random()*100,y:this.componentY-40+Math.random()*80,vx:0,vy:0,size:3.5+Math.random()*1.2,color:"#FF4444",glow:0,trail:[],active:!1});for(let t=0;t<15;t++)this.energyParticles.push({x:this.componentX-100+Math.random()*200,y:this.componentY-60+Math.random()*120,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:1.8+Math.random()*.7,color:"#FFFF00",life:1,decay:.02})}setComponentType(t){this.componentType=t,this.initializeParticles(),this.calculateCurrent(),this.time=0}setBiasType(t){this.biasType=t,this.calculateCurrent(),this.time=0}setInputVoltage(t){this.inputVoltage=t,this.calculateCurrent(),this.time=0}setBaseVoltage(t){this.baseVoltage=t,this.calculateCurrent(),this.time=0}setShowElectrons(t){this.showElectrons=t}setShowCurrent(t){this.showCurrent=t}setShowVoltage(t){this.showVoltage=t}setAnimationSpeed(t){this.animationSpeed=t}calculateCurrent(){if(this.componentType==="diode")if(this.biasType==="forward"&&this.inputVoltage>.7){const t=this.inputVoltage-.7;this.current=Math.exp(t*2)*5,this.power=this.current*.7,this.isActive=!0,this.temperature=25+this.current*.5}else this.biasType==="reverse"?(this.current=.001,this.power=this.current*this.inputVoltage,this.isActive=!1,this.temperature=25):(this.current=0,this.power=0,this.isActive=!1,this.temperature=25);else if(this.componentType==="npn")if(this.biasType==="forward"&&this.baseVoltage>.7){const t=(this.baseVoltage-.7)*10,i=100;this.current=t*i,this.power=this.current*this.inputVoltage,this.isActive=!0,this.temperature=25+this.current*.3}else this.current=0,this.power=0,this.isActive=!1,this.temperature=25;else if(this.componentType==="pnp")if(this.biasType==="forward"&&this.baseVoltage>.7){const t=(this.baseVoltage-.7)*8,i=80;this.current=t*i,this.power=this.current*this.inputVoltage,this.isActive=!0,this.temperature=25+this.current*.4}else this.current=0,this.power=0,this.isActive=!1,this.temperature=25}reset(){this.time=0,this.current=0,this.power=0,this.isActive=!1,this.glowIntensity=0,this.pulsePhase=0,this.initializeParticles()}update(t){this.time+=t*this.animationSpeed,this.calculateCurrent(),this.glowIntensity=this.isActive?Math.sin(this.time*.005)*.3+.7:0,this.pulsePhase=this.time*.01,this.isActive&&this.showElectrons&&(this.componentType==="diode"?this.updateDiodeParticles():this.componentType==="npn"?this.updateNPNParticles():this.componentType==="pnp"&&this.updatePNPParticles()),this.energyParticles.forEach(i=>{i.x+=i.vx,i.y+=i.vy,i.life-=i.decay,(i.x<0||i.x>this.ctx.canvas.width)&&(i.vx*=-1),(i.y<0||i.y>this.ctx.canvas.height)&&(i.vy*=-1),i.life<=0&&(i.x=this.componentX-100+Math.random()*200,i.y=this.componentY-60+Math.random()*120,i.life=1)}),this.isActive&&this.current>10&&Math.random()<.1&&this.sparks.push({x:this.componentX+Math.random()*100-50,y:this.componentY+Math.random()*60-30,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:1,color:"#FFFF00"}),this.sparks.forEach((i,e)=>{i.x+=i.vx,i.y+=i.vy,i.life-=.05,i.life<=0&&this.sparks.splice(e,1)})}render(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBackground(),this.drawEnergyField(),this.drawBattery(),this.drawComponent(),this.drawLoad(),this.drawParticles(),this.drawSparks(),this.drawCurrentFlow(),this.drawInfo(),this.drawInstructions()}drawBackground(){const t=this.time*.001,i=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);i.addColorStop(0,`hsl(${240+Math.sin(t)*10}, 70%, 15%)`),i.addColorStop(1,`hsl(${250+Math.cos(t)*10}, 80%, 10%)`),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.strokeStyle=`rgba(0, 255, 255, ${.1+Math.sin(t*2)*.05})`,this.ctx.lineWidth=1;for(let e=0;e<this.ctx.canvas.height;e+=40)this.ctx.beginPath(),this.ctx.moveTo(0,e+Math.sin(t+e*.01)*2),this.ctx.lineTo(this.ctx.canvas.width,e+Math.sin(t+e*.01)*2),this.ctx.stroke();for(let e=0;e<this.ctx.canvas.width;e+=40)this.ctx.beginPath(),this.ctx.moveTo(e+Math.cos(t+e*.01)*2,0),this.ctx.lineTo(e+Math.cos(t+e*.01)*2,this.ctx.canvas.height),this.ctx.stroke();for(let e=0;e<20;e++){const s=e*37%this.ctx.canvas.width,n=e*23%this.ctx.canvas.height,a=.1+Math.sin(t*3+e)*.05;this.ctx.fillStyle=`rgba(0, 255, 255, ${a})`,this.ctx.beginPath(),this.ctx.arc(s,n,1,0,Math.PI*2),this.ctx.fill()}}drawEnergyField(){if(this.isActive){const t=this.time*.001;for(let i=0;i<3;i++){const e=120+i*30,s=this.glowIntensity*.2/(i+1),n=Math.sin(t*5+i)*.1,a=this.ctx.createRadialGradient(this.componentX,this.componentY,0,this.componentX,this.componentY,e);a.addColorStop(0,`rgba(0, 255, 255, ${s+n})`),a.addColorStop(.7,`rgba(0, 255, 255, ${s*.3})`),a.addColorStop(1,"rgba(0, 255, 255, 0)"),this.ctx.fillStyle=a,this.ctx.fillRect(this.componentX-e,this.componentY-e,e*2,e*2)}for(let i=0;i<5;i++){const e=50+i*20+Math.sin(t*3+i)*10,s=(.3-i*.05)*this.glowIntensity;this.ctx.strokeStyle=`rgba(0, 255, 255, ${s})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.componentX,this.componentY,e,0,Math.PI*2),this.ctx.stroke()}}}drawBattery(){const t=this.time*.001,i=this.isActive?`rgba(76, 175, 80, ${.8+this.glowIntensity*.2})`:"#4CAF50";this.ctx.fillStyle=i,this.ctx.fillRect(this.batteryX-25,this.batteryY-35,50,70),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+Math.sin(t*2)*.1})`,this.ctx.fillRect(this.batteryX-20,this.batteryY-30,40,5),this.ctx.fillStyle="#888",this.ctx.fillRect(this.batteryX-8,this.batteryY-45,16,12),this.ctx.fillRect(this.batteryX-8,this.batteryY+33,16,12),this.ctx.fillStyle="rgba(255, 255, 255, 0.5)",this.ctx.fillRect(this.batteryX-6,this.batteryY-43,12,3),this.ctx.fillRect(this.batteryX-6,this.batteryY+35,12,3);const e=this.isActive?Math.sin(t*3)*.3+.7:.7;this.ctx.fillStyle=this.isActive?`rgba(255, 255, 0, ${e})`:"white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.inputVoltage}V`,this.batteryX,this.batteryY+60),this.ctx.fillStyle=this.isActive?`rgba(255, 102, 102, ${.8+this.glowIntensity})`:"#FF6666",this.ctx.font="bold 20px Arial",this.ctx.fillText("+",this.batteryX-20,this.batteryY-5),this.ctx.fillStyle=this.isActive?`rgba(102, 102, 255, ${.8+this.glowIntensity})`:"#6666FF",this.ctx.fillText("-",this.batteryX+20,this.batteryY+15),this.isActive&&(this.ctx.fillStyle=`rgba(0, 255, 0, ${this.glowIntensity})`,this.ctx.beginPath(),this.ctx.arc(this.batteryX,this.batteryY,30,0,Math.PI*2),this.ctx.stroke())}drawComponent(){this.componentType==="diode"?this.drawDiode():this.drawTransistor()}drawDiode(){const t=this.time*.001,i=this.componentX,e=this.componentY,s=40,n=this.biasType==="forward",a=this.biasType==="reverse",o=this.isActive?this.glowIntensity:0,h=Math.sin(t*3)*.2,l=n?"#00FF00":a?"#FF0000":"#FFFF00",c=n?o*(1+h):a?o*.3:0;this.ctx.shadowColor=this.isActive?l:"transparent",this.ctx.shadowBlur=this.isActive?15+c*10:0;const d=this.isActive?`rgba(255, 255, 0, ${.9+c})`:"#FFFFFF";this.ctx.fillStyle=d,this.ctx.beginPath(),this.ctx.moveTo(i-s,e),this.ctx.lineTo(i-s/3,e-s/2),this.ctx.lineTo(i-s/3,e+s/2),this.ctx.closePath(),this.ctx.fill(),this.isActive&&(this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+h})`,this.ctx.beginPath(),this.ctx.moveTo(i-s+5,e-s/3),this.ctx.lineTo(i-s/3,e),this.ctx.lineTo(i-s+5,e+s/3),this.ctx.closePath(),this.ctx.fill()),this.ctx.strokeStyle=d,this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(i+s/3,e-s/2),this.ctx.lineTo(i+s/3,e+s/2),this.ctx.stroke(),this.ctx.strokeStyle=d,this.ctx.lineWidth=6,this.ctx.beginPath(),this.ctx.moveTo(i-s-25,e),this.ctx.lineTo(i-s,e),this.ctx.moveTo(i+s/3+25,e),this.ctx.lineTo(i+s/3,e),this.ctx.stroke(),this.ctx.shadowBlur=0,this.drawComponentLabel("DIODE",i,e+s+35,t),this.drawBiasIndicator(this.biasType,i,e-s-25,c),this.isActive&&(n?(this.drawCurrentFlow(i-s-45,i+s/3+45,e,e,"forward",o),this.drawVoltageDrop(i,e-s/2-15,"0.7V",o)):a&&(this.drawCurrentFlow(i-s-45,i+s/3+45,e,e,"reverse",o),this.drawVoltageDrop(i,e-s/2-15,"BLOCKED",o))),this.isActive&&n&&(this.ctx.fillStyle=`rgba(0, 255, 0, ${.3+h})`,this.ctx.beginPath(),this.ctx.arc(i-s/3,e,8,0,Math.PI*2),this.ctx.fill())}drawTransistor(){const t=this.time*.001,i=this.componentX,e=this.componentY,s=35,n=25,a=this.biasType==="forward",o=this.biasType==="reverse",h=this.isActive?this.glowIntensity:0,l=Math.sin(t*3)*.2,c=a?"#00FF00":o?"#FF0000":"#FFFF00",d=a?h*(1+l):o?h*.3:0;this.ctx.shadowColor=this.isActive?c:"transparent",this.ctx.shadowBlur=this.isActive?15+d*10:0;const x=this.isActive?`rgba(255, 255, 0, ${.9+d})`:"#FFFFFF";if(this.ctx.strokeStyle=x,this.ctx.lineWidth=6,this.ctx.beginPath(),this.ctx.arc(i,e,s,0,2*Math.PI),this.ctx.stroke(),this.isActive&&(this.ctx.fillStyle=`rgba(255, 255, 0, ${.1+l})`,this.ctx.beginPath(),this.ctx.arc(i,e,s-2,0,2*Math.PI),this.ctx.fill()),this.ctx.lineWidth=6,this.drawTransistorLeads(i,e,s,n,x),this.drawEmitterArrow(i,e,s,x),this.drawLeadLabels(i,e,s,n,x),this.ctx.shadowBlur=0,this.drawComponentLabel(this.componentType.toUpperCase(),i,e+s+n+55,t),this.drawBiasIndicator(this.biasType,i,e-s-n-35,d),this.isActive&&(a?this.componentType==="npn"?(this.drawCurrentFlow(i,i,e+s+n+25,e-s-n-25,"forward",h),this.drawVoltageDrop(i,e-s-15,"Vbe: 0.7V",h),this.drawVoltageDrop(i,e+s+15,"Vce: 0.2V",h)):this.componentType==="pnp"&&(this.drawCurrentFlow(i,i,e-s-n-25,e+s+n+25,"forward",h),this.drawVoltageDrop(i,e-s-15,"Vbe: -0.7V",h),this.drawVoltageDrop(i,e+s+15,"Vce: -0.2V",h)):o&&(this.drawCurrentFlow(i,i,e-s-n-25,e+s+n+25,"reverse",h),this.drawVoltageDrop(i,e-s-15,"BLOCKED",h))),this.isActive&&a){const r=this.componentType==="npn"?`rgba(0, 255, 255, ${.5+l})`:`rgba(255, 100, 100, ${.5+l})`;this.ctx.strokeStyle=r,this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.beginPath(),this.ctx.moveTo(i-s-n-10,e),this.ctx.lineTo(i-s,e),this.ctx.stroke(),this.ctx.setLineDash([])}if(this.isActive){const r=this.componentType==="npn"?"#00AAFF":"#FF4444";this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i-30,e-s-45,60,20),this.ctx.fillStyle=r,this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText(this.componentType.toUpperCase(),i,e-s-35)}}drawComponentLabel(t,i,e,s){const n=this.isActive?Math.sin(s*2)*.3+.7:.7;this.ctx.fillStyle=this.isActive?`rgba(255, 255, 0, ${n})`:"white",this.ctx.font="bold 18px Arial",this.ctx.textAlign="center",this.ctx.fillText(t,i,e)}drawBiasIndicator(t,i,e,s){const n=t.toUpperCase(),a=t==="forward"?"#00FF00":t==="reverse"?"#FF0000":"#FFFF00";this.ctx.fillStyle=this.isActive?`rgba(0, 255, 0, ${.8+s})`:a,this.ctx.font="bold 14px Arial",this.ctx.fillText(n,i,e)}drawCurrentFlow(t,i,e,s,n,a){const o=n==="forward",h=o?`rgba(0, 255, 255, ${a})`:`rgba(255, 0, 0, ${a*.5})`,l=o?[5,5]:[3,3];this.ctx.strokeStyle=h,this.ctx.lineWidth=2,this.ctx.setLineDash(l),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke(),this.ctx.setLineDash([])}drawTransistorLeads(t,i,e,s,n){this.ctx.strokeStyle=n,this.ctx.beginPath(),this.ctx.moveTo(t,i-e),this.ctx.lineTo(t,i-e-s),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-e,i),this.ctx.lineTo(t-e-s,i),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,i+e),this.ctx.lineTo(t,i+e+s),this.ctx.stroke()}drawEmitterArrow(t,i,e,s){this.ctx.fillStyle=s,this.componentType==="npn"?(this.ctx.beginPath(),this.ctx.moveTo(t-8,i+e-15),this.ctx.lineTo(t+8,i+e-15),this.ctx.lineTo(t,i+e-5),this.ctx.closePath(),this.ctx.fill()):this.componentType==="pnp"&&(this.ctx.beginPath(),this.ctx.moveTo(t-8,i+e+5),this.ctx.lineTo(t+8,i+e+5),this.ctx.lineTo(t,i+e+15),this.ctx.closePath(),this.ctx.fill())}drawLeadLabels(t,i,e,s,n){this.ctx.fillStyle=n,this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("C",t,i-e-s-10),this.ctx.fillText("B",t-e-s-10,i),this.ctx.fillText("E",t,i+e+s+20)}drawVoltageDrop(t,i,e,s){this.ctx.fillStyle=`rgba(255, 255, 0, ${.8+s})`,this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText(e,t,i)}updateDiodeParticles(){this.electrons.forEach((t,i)=>{this.biasType==="forward"?(t.vx=-3+Math.sin(this.time*.02+i*.5)*1.5,t.vy=Math.sin(this.time*.03+i)*.5,t.x+=t.vx,t.y+=t.vy,t.glow=Math.sin(this.time*.1+i)*.5+.5,t.trail.push({x:t.x,y:t.y,alpha:1}),t.trail.length>5&&t.trail.shift(),t.x<this.componentX-200&&(t.x=this.componentX+100,t.y=this.componentY-40+Math.random()*80)):this.biasType==="reverse"?(t.vx=.1+Math.sin(this.time*.01+i*.5)*.05,t.vy=Math.sin(this.time*.02+i)*.1,t.x+=t.vx,t.y+=t.vy,t.glow=.1,t.trail.push({x:t.x,y:t.y,alpha:.3}),t.trail.length>3&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):(t.vx=0,t.vy=0,t.glow=0,t.trail=[])}),this.holes.forEach((t,i)=>{this.biasType==="forward"?(t.vx=2.5+Math.sin(this.time*.02+i*.5)*1.2,t.vy=Math.sin(this.time*.03+i)*.5,t.x+=t.vx,t.y+=t.vy,t.glow=Math.sin(this.time*.1+i)*.5+.5,t.trail.push({x:t.x,y:t.y,alpha:1}),t.trail.length>5&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):this.biasType==="reverse"?(t.vx=.1+Math.sin(this.time*.01+i*.5)*.05,t.vy=Math.sin(this.time*.02+i)*.1,t.x+=t.vx,t.y+=t.vy,t.glow=.1,t.trail.push({x:t.x,y:t.y,alpha:.3}),t.trail.length>3&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):(t.vx=0,t.vy=0,t.glow=0,t.trail=[])})}updateNPNParticles(){const t=Math.max(0,(this.baseVoltage-.7)/.3),i=1+t*2;this.electrons.forEach((e,s)=>{this.biasType==="forward"&&this.baseVoltage>.7?(e.vx=Math.sin(this.time*.02+s*.5)*1*i,e.vy=(-4+Math.sin(this.time*.03+s)*1)*i,e.x+=e.vx,e.y+=e.vy,e.glow=(Math.sin(this.time*.1+s)*.5+.5)*(.5+t*.5),e.trail.push({x:e.x,y:e.y,alpha:1}),e.trail.length>8&&e.trail.shift(),e.y<this.componentY-150&&(e.x=this.componentX-40+Math.random()*80,e.y=this.componentY+100)):(e.vx=0,e.vy=0,e.glow=0,e.trail=[])}),this.holes.forEach((e,s)=>{e.vx=0,e.vy=0,e.glow=0,e.trail=[]})}updatePNPParticles(){const t=Math.max(0,(this.baseVoltage-.7)/.3),i=1+t*2;this.holes.forEach((e,s)=>{this.biasType==="forward"&&this.baseVoltage>.7?(e.vx=Math.sin(this.time*.02+s*.5)*1*i,e.vy=(4+Math.sin(this.time*.03+s)*1)*i,e.x+=e.vx,e.y+=e.vy,e.glow=(Math.sin(this.time*.1+s)*.5+.5)*(.5+t*.5),e.trail.push({x:e.x,y:e.y,alpha:1}),e.trail.length>8&&e.trail.shift(),e.y>this.componentY+150&&(e.x=this.componentX-40+Math.random()*80,e.y=this.componentY-100)):(e.vx=0,e.vy=0,e.glow=0,e.trail=[])}),this.electrons.forEach((e,s)=>{e.vx=0,e.vy=0,e.glow=0,e.trail=[]})}drawLoad(){const t=this.time*.001,i=this.isActive?this.glowIntensity:0,e=this.isActive?Math.sin(t*3)*.1:0,s=this.isActive?`rgba(255, 255, 0, ${.8+i*.2+e})`:"#666";if(this.isActive&&(this.ctx.shadowColor="#FFFF00",this.ctx.shadowBlur=30+this.glowIntensity*20,this.ctx.fillStyle=`rgba(255, 255, 0, ${.3+this.glowIntensity*.2})`,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,45,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=0),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,35,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.4+Math.sin(t*2)*.1})`,this.ctx.beginPath(),this.ctx.arc(this.loadX-10,this.loadY-15,8,0,Math.PI),this.ctx.fill(),this.ctx.fillStyle="#444",this.ctx.fillRect(this.loadX-18,this.loadY+35,36,25),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+Math.sin(t*2)*.1})`,this.ctx.fillRect(this.loadX-15,this.loadY+37,30,5),this.ctx.strokeStyle=this.isActive?`rgba(255, 170, 0, ${.8+this.glowIntensity})`:"#999",this.ctx.lineWidth=3,this.ctx.shadowColor=this.isActive?"#FFAA00":"transparent",this.ctx.shadowBlur=this.isActive?5:0,this.ctx.beginPath(),this.ctx.moveTo(this.loadX-12,this.loadY),this.ctx.lineTo(this.loadX+12,this.loadY),this.ctx.stroke(),this.isActive){const a=Math.sin(t*4)*.2+.8;this.ctx.strokeStyle=`rgba(255, 170, 0, ${.8+this.glowIntensity*a})`,this.ctx.beginPath(),this.ctx.moveTo(this.loadX-8,this.loadY-5),this.ctx.lineTo(this.loadX+8,this.loadY-5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.loadX-8,this.loadY+5),this.ctx.lineTo(this.loadX+8,this.loadY+5),this.ctx.stroke()}this.ctx.shadowBlur=0;const n=this.isActive?Math.sin(t*2)*.3+.7:.7;if(this.ctx.fillStyle=this.isActive?`rgba(255, 255, 0, ${n})`:"white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("LOAD",this.loadX,this.loadY+80),this.isActive){this.ctx.fillStyle=`rgba(0, 255, 0, ${.8+this.glowIntensity})`,this.ctx.font="bold 12px Arial",this.ctx.fillText(`${this.power.toFixed(1)}mW`,this.loadX,this.loadY-60);for(let a=0;a<3;a++){const o=50+a*15+Math.sin(t*2+a)*5,h=(.2-a*.05)*this.glowIntensity;this.ctx.strokeStyle=`rgba(255, 255, 0, ${h})`,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,o,0,Math.PI*2),this.ctx.stroke()}}}drawParticles(){if(!this.showElectrons)return;const t=this.time*.001;this.electrons.forEach(i=>{i.trail.length>0&&i.trail.forEach((e,s)=>{const n=e.alpha*(s/i.trail.length)*.6,a=Math.sin(t*4+s)*.2+.8;this.ctx.fillStyle=`rgba(0, 170, 255, ${n*a})`,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i.size*.6,0,Math.PI*2),this.ctx.fill()})}),this.holes.forEach(i=>{i.trail.length>0&&i.trail.forEach((e,s)=>{const n=e.alpha*(s/i.trail.length)*.6,a=Math.sin(t*4+s)*.2+.8;this.ctx.strokeStyle=`rgba(255, 68, 68, ${n*a})`,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i.size*.6,0,Math.PI*2),this.ctx.stroke()})}),this.electrons.forEach(i=>{const e=i.glow*.4,s=Math.sin(t*3+i.x*.01)*.3+.7;this.ctx.shadowColor="#00AAFF",this.ctx.shadowBlur=e*15,this.ctx.fillStyle=`rgba(0, 170, 255, ${.8*s})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size*1.2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.fillStyle=i.color,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.6*s})`,this.ctx.beginPath(),this.ctx.arc(i.x-2,i.y-2,i.size*.3,0,Math.PI*2),this.ctx.fill()}),this.holes.forEach(i=>{const e=i.glow*.4,s=Math.sin(t*3+i.x*.01)*.3+.7;this.ctx.shadowColor="#FF4444",this.ctx.shadowBlur=e*8,this.ctx.strokeStyle=i.color,this.ctx.lineWidth=.5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle=`rgba(255, 68, 68, ${.3*s})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size*.2,0,Math.PI*2),this.ctx.fill()}),this.energyParticles.forEach(i=>{const e=Math.sin(t*5+i.x*.01)*.3+.7;this.ctx.fillStyle=`rgba(255, 255, 0, ${i.life*e})`,this.ctx.shadowColor="#FFFF00",this.ctx.shadowBlur=i.life*10,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0})}drawSparks(){this.sparks.forEach(t=>{this.ctx.fillStyle=`rgba(255, 255, 0, ${t.life})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()})}drawCurrentFlow(){if(!this.showCurrent||!this.isActive)return;const t=this.time*.001;this.ctx.strokeStyle=`rgba(255, 255, 0, ${.8+this.glowIntensity})`,this.ctx.lineWidth=4,this.ctx.setLineDash([15,8]),this.ctx.shadowColor="#FFFF00",this.ctx.shadowBlur=10+this.glowIntensity*10;const i=Math.sin(t*3)*5;this.ctx.setLineDash([15+i,8-i]),this.ctx.beginPath(),this.ctx.moveTo(this.batteryX+25,this.batteryY),this.ctx.lineTo(this.componentX-90,this.componentY),this.ctx.stroke(),this.ctx.setLineDash([15-i,8+i]),this.ctx.beginPath(),this.ctx.moveTo(this.componentX+90,this.componentY),this.ctx.lineTo(this.loadX-35,this.loadY),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.shadowBlur=0;const e=Math.sin(t*2)*5,s=Math.sin(t*4)*.3+.7;this.drawArrow(this.batteryX+35+e,this.batteryY,12,0,`rgba(255, 255, 0, ${s})`),this.drawArrow(this.componentX+100+e,this.componentY,12,0,`rgba(255, 255, 0, ${s})`);const a=Math.min(this.current/20,1)*(.3+Math.sin(t*5)*.1);this.ctx.fillStyle=`rgba(255, 255, 0, ${a})`,this.ctx.fillRect(this.componentX-100,this.componentY-10,200,20);for(let o=0;o<5;o++){const h=(t*.5+o*.2)%1,l=this.batteryX+25+(this.componentX-90-this.batteryX-25)*h,c=this.batteryY+Math.sin(t*3+o)*3;this.ctx.fillStyle=`rgba(255, 255, 0, ${.6+Math.sin(t*4+o)*.2})`,this.ctx.beginPath(),this.ctx.arc(l,c,2,0,Math.PI*2),this.ctx.fill()}}drawArrow(t,i,e,s,n){this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t-8,i-4),this.ctx.lineTo(t-8,i+4),this.ctx.closePath(),this.ctx.fill()}drawInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,200),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("🔌 Diode & Transistor",20,30),this.ctx.font="14px Arial",this.ctx.fillText(`Component: ${this.componentType.toUpperCase()}`,20,50),this.ctx.fillText(`Bias: ${this.biasType.toUpperCase()}`,20,70),this.ctx.fillText(`Input Voltage: ${this.inputVoltage}V`,20,90),(this.componentType==="npn"||this.componentType==="pnp")&&this.ctx.fillText(`Base Voltage: ${this.baseVoltage}V`,20,110),this.ctx.fillText(`Current: ${this.current.toFixed(1)}mA`,20,130),this.ctx.fillText(`Power: ${this.power.toFixed(1)}mW`,20,150),this.ctx.fillText(`Status: ${this.isActive?"ACTIVE":"INACTIVE"}`,20,170),this.ctx.fillText(`Temperature: ${this.temperature}°C`,20,190)}drawInstructions(){this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(this.ctx.canvas.width-320,10,310,180),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("🔌 Particle Legend:",this.ctx.canvas.width-310,30),this.ctx.font="bold 14px Arial",this.ctx.fillStyle="#00AAFF",this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,50,2.5,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Electrons (filled circle)",this.ctx.canvas.width-285,55),this.ctx.strokeStyle="#FF4444",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,70,2.5,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Holes (empty circle)",this.ctx.canvas.width-285,75),this.ctx.fillStyle="#FFFF00",this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,90,2.5,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Energy Carriers",this.ctx.canvas.width-285,95),this.ctx.fillStyle="#FFFF00",this.ctx.beginPath(),this.ctx.moveTo(this.ctx.canvas.width-300,110),this.ctx.lineTo(this.ctx.canvas.width-290,110),this.ctx.lineTo(this.ctx.canvas.width-292,108),this.ctx.lineTo(this.ctx.canvas.width-290,110),this.ctx.lineTo(this.ctx.canvas.width-292,112),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Current Flow",this.ctx.canvas.width-285,115),this.ctx.fillStyle="white",this.ctx.font="bold 12px Arial",this.ctx.fillText("💡 Behavior:",this.ctx.canvas.width-310,140),this.ctx.font="11px Arial",this.componentType==="diode"?(this.ctx.fillText("• Forward bias: Electrons flow, light on",this.ctx.canvas.width-310,155),this.ctx.fillText("• Reverse bias: No flow, light off",this.ctx.canvas.width-310,170)):(this.ctx.fillText("• Base controls collector current",this.ctx.canvas.width-310,155),this.ctx.fillText("• Small base = Large collector",this.ctx.canvas.width-310,170))}getStats(){return{componentType:this.componentType,biasType:this.biasType,inputVoltage:this.inputVoltage,baseVoltage:this.baseVoltage,current:this.current,power:this.power,temperature:this.temperature,isActive:this.isActive,time:this.time}}}class ft{constructor(t){this.ctx=t,this.canvas=t.canvas,this.mode="wave",this.photonEnergy=5,this.wavelength=150,this.speed=1,this.time=0,this.waveFunction=[],this.amplitude=50,this.frequency=1,this.phase=0,this.wavePhase=0,this.particleX=100,this.particleY=300,this.particleVelocity={x:8,y:0},this.particleSize=8,this.slits=[{x:400,y:250,width:20,height:100},{x:400,y:350,width:20,height:100}],this.interferencePattern=[],this.screenX=600,this.measurementCount=0,this.measurementResults=[],this.showMeasurement=!1,this.showWaveFunction=!0,this.showParticlePosition=!0,this.showInterference=!0,this.showMeasurementEffect=!1,this.initializeWaveFunction(),this.initializeInterferencePattern()}setMode(t){this.mode=t,this.reset()}setSpeed(t){this.speed=t}setPhotonEnergy(t){this.photonEnergy=t,this.wavelength=1240/t,this.initializeWaveFunction(),this.initializeInterferencePattern()}setWavelength(t){this.wavelength=t,this.photonEnergy=1240/t,this.initializeWaveFunction(),this.initializeInterferencePattern()}setShowWaveFunction(t){this.showWaveFunction=t}setShowParticlePosition(t){this.showParticlePosition=t}setShowInterference(t){this.showInterference=t}setShowMeasurementEffect(t){this.showMeasurementEffect=t}performMeasurement(){this.measurementCount++,this.showMeasurement=!0,this.mode==="superposition"&&(Math.random()<.5?this.mode="particle":this.mode="wave"),this.measurementResults.push({time:this.time,mode:this.mode,position:{x:this.particleX,y:this.particleY}}),this.showMeasurementEffect=!0,setTimeout(()=>{this.showMeasurement=!1,this.showMeasurementEffect=!1},3e3)}reset(){this.time=0,this.phase=0,this.wavePhase=0,this.particleX=100,this.particleY=300,this.measurementCount=0,this.measurementResults=[],this.showMeasurement=!1,this.initializeWaveFunction(),this.initializeInterferencePattern()}initializeWaveFunction(){this.waveFunction=[];const t=150;for(let i=0;i<t;i++){const e=i/t*this.canvas.width,s=this.amplitude*Math.sin(2*Math.PI*e/this.wavelength+this.phase),n=this.canvas.height/2+s;this.waveFunction.push({x:e,y:n})}}initializeInterferencePattern(){this.interferencePattern=[];const t=300,i=this.canvas.height/2,e=390,s=410,n=300,a=this.screenX;for(let o=0;o<t;o+=8){const h=i-t/2+o;let l=0;const c=Math.sqrt(Math.pow(a-e,2)+Math.pow(h-n,2)),d=Math.sqrt(Math.pow(a-s,2)+Math.pow(h-n,2)),x=d-c,r=2*Math.PI*x/this.wavelength,g=1/Math.sqrt(c),u=1/Math.sqrt(d),f=g+u*Math.cos(r);l=Math.abs(f),this.interferencePattern.push({x:a,y:h,intensity:l})}}update(t){const i=t/1e3*this.speed*5;this.time+=i,this.phase+=i*this.frequency,(this.mode==="wave"||this.mode==="superposition")&&this.waveFunction.forEach((e,s)=>{const n=e.x;if(n>=380&&n<=420){const l=Math.abs(n-390),c=Math.abs(n-410);if(l<10/2||c<10/2){const d=this.amplitude*Math.sin(2*Math.PI*n/this.wavelength-this.phase);e.y=this.canvas.height/2+d}else e.y=-1e3}else{const a=this.amplitude*Math.sin(2*Math.PI*n/this.wavelength-this.phase);e.y=this.canvas.height/2+a}}),(this.mode==="particle"||this.mode==="superposition")&&(this.particleX+=this.particleVelocity.x*i,this.particleY=300+Math.sin(this.time*3)*20,this.particleX>this.screenX-50&&(this.particleX=100)),this.showInterference&&(this.mode==="wave"||this.mode==="superposition")&&Math.floor(this.time*10)%3===0&&this.initializeInterferencePattern(),(this.mode==="wave"||this.mode==="superposition")&&(this.wavePhase+=i*2)}render(){switch(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.drawSlits(),this.drawDetectionScreen(),this.mode){case"wave":this.renderWaveMode();break;case"particle":this.renderParticleMode();break;case"superposition":this.renderSuperpositionMode();break;case"measurement":this.renderMeasurementMode();break}this.showInterference&&(this.mode==="wave"||this.mode==="superposition")&&this.drawInterferencePattern(),this.showMeasurement&&this.drawMeasurementEffect(),this.drawQuantumLabels(),this.drawDescriptiveLabels()}drawGrid(){this.ctx.strokeStyle="rgba(100, 100, 100, 0.15)",this.ctx.lineWidth=.8,this.ctx.setLineDash([8,8]);for(let t=0;t<this.canvas.width;t+=100)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.canvas.height),this.ctx.stroke();for(let t=0;t<this.canvas.height;t+=100)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke();this.ctx.setLineDash([]),this.ctx.fillStyle="rgba(138, 43, 226, 0.03)";for(let t=0;t<this.canvas.width;t+=120)for(let i=0;i<this.canvas.height;i+=120){const e=Math.sin(this.time*.3+t*.01+i*.01)*.5+.5;this.ctx.globalAlpha=e*.08,this.ctx.beginPath(),this.ctx.arc(t,i,25,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}drawSlits(){const t=this.ctx.createLinearGradient(380,0,420,0);t.addColorStop(0,"#1a1a2e"),t.addColorStop(.3,"#16213e"),t.addColorStop(.7,"#0f3460"),t.addColorStop(1,"#1a1a2e"),this.ctx.fillStyle=t,this.ctx.fillRect(380,0,40,this.canvas.height),this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=8,this.ctx.shadowOffsetX=3,this.ctx.fillRect(380,0,40,this.canvas.height),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.clearRect(385,200,10,200),this.ctx.clearRect(405,200,10,200),this.ctx.strokeStyle="#0a0a0a",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(385,200),this.ctx.lineTo(385,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(395,200),this.ctx.lineTo(395,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(405,200),this.ctx.lineTo(405,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(415,200),this.ctx.lineTo(415,400),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(386,200),this.ctx.lineTo(386,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(414,200),this.ctx.lineTo(414,400),this.ctx.stroke(),this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Barrier",400,190),this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(350,300),this.ctx.lineTo(380,300),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(375,295),this.ctx.lineTo(380,300),this.ctx.lineTo(375,305),this.ctx.closePath(),this.ctx.fillStyle="#4CAF50",this.ctx.fill(),this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Wave",365,290)}drawDetectionScreen(){const t=Math.sin(this.time*2)*.3+.7,i=this.ctx.createLinearGradient(this.screenX-8,150,this.screenX+8,450);if(i.addColorStop(0,`rgba(200, 200, 255, ${.7*t})`),i.addColorStop(.5,`rgba(180, 180, 255, ${.8*t})`),i.addColorStop(1,`rgba(200, 200, 255, ${.7*t})`),this.ctx.fillStyle=i,this.ctx.fillRect(this.screenX-8,150,16,300),this.ctx.shadowColor="rgba(0, 102, 204, 0.5)",this.ctx.shadowBlur=6,this.ctx.strokeStyle="#0066cc",this.ctx.lineWidth=4,this.ctx.strokeRect(this.screenX-8,150,16,300),this.ctx.shadowBlur=0,this.mode==="wave"||this.mode==="superposition"){const e=Math.sin(this.time*4)*.4+.6;this.ctx.fillStyle=`rgba(100, 150, 255, ${e*.4})`,this.ctx.fillRect(this.screenX-10,150,20,300)}this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Detection Screen",this.screenX,145),this.ctx.strokeStyle="rgba(0, 102, 204, 0.6)",this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let e=0;e<6;e++){const s=170+e*45;this.ctx.beginPath(),this.ctx.moveTo(this.screenX-8,s),this.ctx.lineTo(this.screenX+8,s),this.ctx.stroke()}}renderWaveMode(){if(!this.showWaveFunction)return;this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath();let t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];if(e.x<380)t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0);else break}this.ctx.stroke(),this.ctx.beginPath(),t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];e.x>420&&(t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0))}this.ctx.stroke(),this.ctx.shadowBlur=0;for(let i=0;i<this.waveFunction.length;i+=5){const e=this.waveFunction[i],s=this.ctx.createRadialGradient(e.x-2,e.y-2,0,e.x,e.y,4);s.addColorStop(0,"#6BCF7F"),s.addColorStop(.7,"#4CAF50"),s.addColorStop(1,"#2E7D32"),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,4,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=3,this.ctx.lineCap="round";for(let i=0;i<3;i++){const e=150+i*120;this.ctx.beginPath(),this.ctx.moveTo(e,350),this.ctx.lineTo(e+25,350),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e+18,345),this.ctx.lineTo(e+25,350),this.ctx.lineTo(e+18,355),this.ctx.closePath(),this.ctx.fillStyle="#4CAF50",this.ctx.fill()}}renderWaveModeWithoutLabel(){if(!this.showWaveFunction)return;this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=3,this.ctx.beginPath();let t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];if(e.x<380)t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0);else break}this.ctx.stroke(),this.ctx.beginPath(),t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];e.x>420&&(t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0))}this.ctx.stroke(),this.ctx.fillStyle="#4CAF50";for(let i=0;i<this.waveFunction.length;i+=5){const e=this.waveFunction[i];this.ctx.beginPath(),this.ctx.arc(e.x,e.y,3,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=2;for(let i=0;i<3;i++){const e=150+i*120;this.ctx.beginPath(),this.ctx.moveTo(e,350),this.ctx.lineTo(e+20,350),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e+15,345),this.ctx.lineTo(e+20,350),this.ctx.lineTo(e+15,355),this.ctx.stroke()}}renderParticleMode(){if(!this.showParticlePosition)return;this.ctx.shadowColor="#FF5722",this.ctx.shadowBlur=10;const t=this.ctx.createRadialGradient(this.particleX-3,this.particleY-3,0,this.particleX,this.particleY,this.particleSize);t.addColorStop(0,"#FF8A65"),t.addColorStop(.7,"#FF5722"),t.addColorStop(1,"#D84315"),this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const i=this.ctx.createLinearGradient(this.particleX-50,this.particleY,this.particleX+50,this.particleY);i.addColorStop(0,"rgba(255, 87, 34, 0.3)"),i.addColorStop(.5,"rgba(255, 87, 34, 0.6)"),i.addColorStop(1,"rgba(255, 87, 34, 0.3)"),this.ctx.strokeStyle=i,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.particleX-50,this.particleY),this.ctx.lineTo(this.particleX+50,this.particleY),this.ctx.stroke()}renderParticleModeWithoutLabel(){this.showParticlePosition&&(this.ctx.fillStyle="#FF5722",this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 87, 34, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.particleX-50,this.particleY),this.ctx.lineTo(this.particleX+50,this.particleY),this.ctx.stroke())}renderSuperpositionMode(){this.renderWaveModeWithoutLabel(),this.renderParticleModeWithoutLabel()}renderMeasurementMode(){this.renderParticleModeWithoutLabel(),this.ctx.strokeStyle="#FF9800",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(this.particleX,this.particleY-30),this.ctx.lineTo(this.particleX,this.particleY+30),this.ctx.stroke()}drawInterferencePattern(){this.ctx.shadowColor="#9C27B0",this.ctx.shadowBlur=6;for(let i=0;i<this.interferencePattern.length;i++){const e=this.interferencePattern[i],s=Math.min(e.intensity*3,1),n=this.time*2+i*.1,a=s*(.7+.3*Math.sin(n));if(s>.2){const h=this.ctx.createRadialGradient(e.x,e.y,0,e.x,e.y,8);h.addColorStop(0,`rgba(156, 39, 176, ${a})`),h.addColorStop(.7,`rgba(123, 31, 162, ${a*.8})`),h.addColorStop(1,`rgba(74, 20, 140, ${a*.6})`),this.ctx.fillStyle=h}else this.ctx.fillStyle=`rgba(0, 0, 0, ${a*.4})`;const o=Math.max(8,a*15);this.ctx.beginPath(),this.ctx.arc(e.x,e.y,o/2,0,Math.PI*2),this.ctx.fill()}if(this.ctx.shadowBlur=0,this.mode==="wave"||this.mode==="superposition"){for(let i=0;i<5;i++){const e=170+i*50,s=this.screenX+8,n=Math.sin(this.time*3+i)*.5+.5,a=this.ctx.createRadialGradient(s-2,e-2,0,s,e,6);a.addColorStop(0,"#FFD700"),a.addColorStop(.7,"#FFC107"),a.addColorStop(1,"#FF8F00"),this.ctx.globalAlpha=n,this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.arc(s,e,5,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}this.ctx.strokeStyle="#9C27B0",this.ctx.lineWidth=3,this.ctx.lineCap="round";const t=Math.sin(this.time*2)*.3+.7;this.ctx.globalAlpha=t,this.ctx.beginPath(),this.ctx.moveTo(390,300),this.ctx.lineTo(this.screenX,200),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(410,300),this.ctx.lineTo(this.screenX,400),this.ctx.stroke(),this.ctx.globalAlpha=1}drawMeasurementEffect(){const t=Math.sin(this.time*8)*.3+.7;this.ctx.fillStyle=`rgba(255, 255, 0, ${.4*t})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#FF5722",this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,15+Math.sin(this.time*10)*5,0,Math.PI*2),this.ctx.fill()}drawQuantumInfo(){switch(this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,120,350,200),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 16px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("E = hf",20,140),this.ctx.fillText("λ = h/p",20,160),this.ctx.fillText("ΔxΔp ≥ ℏ/2",20,180),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(20,190),this.ctx.lineTo(340,190),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Mode: ${this.mode.toUpperCase()}`,20,210),this.ctx.fillText(`Energy: ${this.photonEnergy.toFixed(1)} eV`,20,230),this.ctx.fillText(`Wavelength: ${this.wavelength.toFixed(0)} nm`,20,250),this.ctx.fillText(`Measurements: ${this.measurementCount}`,20,270),this.ctx.fillText(`Time: ${this.time.toFixed(1)}s`,20,290),this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FFFF00",this.mode){case"wave":this.ctx.fillText("Wave Behavior: Light behaves as a wave",20,315),this.ctx.fillText("creating interference patterns",20,330);break;case"particle":this.ctx.fillText("Particle Behavior: Light behaves as",20,315),this.ctx.fillText("discrete particles with definite position",20,330);break;case"superposition":this.ctx.fillText("Superposition: Light exists in both",20,315),this.ctx.fillText("wave and particle states until measured",20,330);break;case"measurement":this.ctx.fillText("Measurement: Observing the system",20,315),this.ctx.fillText("forces it to choose wave OR particle",20,330);break}}getStats(){return{mode:this.mode,photonEnergy:this.photonEnergy.toFixed(1),wavelength:this.wavelength.toFixed(0),measurementCount:this.measurementCount,time:this.time.toFixed(1)}}drawQuantumLabels(){this.ctx.save(),this.ctx.font="bold 16px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Wave-Particle Duality",this.ctx.canvas.width/2,25),this.ctx.shadowBlur=0,this.ctx.restore()}drawDescriptiveLabels(){this.ctx.save(),this.ctx.font="bold 13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.shadowColor="rgba(255, 255, 255, 0.6)",this.ctx.shadowBlur=1;const t=this.ctx.canvas.width-200,i=this.ctx.canvas.height-120,e=16;switch(this.mode){case"wave":this.ctx.fillText("Wave Behavior:",t,i),this.ctx.fillText("• Light travels as waves",t,i+e),this.ctx.fillText("• Creates interference pattern",t,i+e*2),this.ctx.fillText("• Shows wave-like properties",t,i+e*3);break;case"particle":this.ctx.fillText("Particle Behavior:",t,i),this.ctx.fillText("• Light travels as particles",t,i+e),this.ctx.fillText("• Hits screen at specific points",t,i+e*2),this.ctx.fillText("• Shows particle-like properties",t,i+e*3);break;case"superposition":this.ctx.fillText("Quantum Superposition:",t,i),this.ctx.fillText("• Light exists in both states",t,i+e),this.ctx.fillText("• Wave + Particle simultaneously",t,i+e*2),this.ctx.fillText("• Until measured (collapsed)",t,i+e*3);break;case"measurement":this.ctx.fillText("Measurement Effect:",t,i),this.ctx.fillText("• Observation forces a choice",t,i+e),this.ctx.fillText("• Wave OR Particle behavior",t,i+e*2),this.ctx.fillText("• Quantum mystery revealed",t,i+e*3);break}this.ctx.shadowBlur=0,this.ctx.restore()}}class pt{constructor(t){this.ctx=t,this.canvas=t.canvas,this.time=0,this.speed=1,this.mode="fission",this.neutronEnergy=1,this.temperature=1,this.nuclei=[],this.neutrons=[],this.fissionProducts=[],this.fusionProducts=[],this.energyParticles=[],this.reactingParticles=[],this.shockwaves=[],this.energyReleased=0,this.neutronsProduced=0,this.chainReactions=0,this.fissionCount=0,this.fusionCount=0,this.chainStarted=!1,this.setupClickEvents(),this.initializeNuclei()}setupClickEvents(){this.canvas.addEventListener("click",t=>{const i=this.canvas.getBoundingClientRect();t.clientX-i.left,t.clientY-i.top,this.reactingParticles.forEach(e=>{e.moving||(this.findTargetForParticle(e),e.moving=!0)})}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault();const i=this.canvas.getBoundingClientRect(),e=t.touches[0];e.clientX-i.left,e.clientY-i.top,this.reactingParticles.forEach(s=>{s.moving||(this.findTargetForParticle(s),s.moving=!0)})})}initializeNuclei(){this.nuclei=[],this.neutrons=[],this.fissionProducts=[],this.fusionProducts=[],this.energyParticles=[],this.reactingParticles=[];const t=this.canvas.width/2,i=this.canvas.height/2;if(this.mode==="chain"){for(let n=0;n<3;n++)for(let a=0;a<3;a++){const o=t+(a-1)*40,h=i+(n-1)*40;this.nuclei.push({x:o,y:h,type:"uranium",protons:92,neutrons:143,mass:235,radius:8,color:"#FF6B35",stability:.8,fissioned:!1,visible:!0,time:0})}this.reactingParticles.push({x:t-150,y:i,targetX:t,targetY:i,type:"neutron",radius:12,color:"#9C27B0",speed:80,moving:!1,life:10})}else this.mode==="fission"?(this.nuclei.push({x:t,y:i,type:"uranium",protons:92,neutrons:143,mass:235,radius:30,color:"#FF6B35",stability:.8,fissioned:!1,visible:!0,time:0}),this.reactingParticles.push({x:t-150,y:i,targetX:t,targetY:i,type:"neutron",radius:12,color:"#9C27B0",speed:80,moving:!1,life:10})):this.mode==="fusion"&&(this.nuclei.push({x:t+60,y:i,type:"tritium",protons:1,neutrons:2,mass:3,radius:20,color:"#4CAF50",stability:.9,fused:!1,visible:!0,time:0}),this.reactingParticles.push({x:t-60,y:i,targetX:t+60,targetY:i,type:"deuterium",radius:20,color:"#4CAF50",speed:60,moving:!1,life:10}))}setSpeed(t){this.speed=t}setMode(t){this.mode=t,this.chainStarted=!1,this.reset()}setNeutronEnergy(t){this.neutronEnergy=t,this.neutrons.forEach(i=>{const e=50+t*100,s=Math.atan2(i.vy,i.vx);i.vx=Math.cos(s)*e,i.vy=Math.sin(s)*e})}setTemperature(t){this.temperature=t}reset(){this.time=0,this.energyReleased=0,this.neutronsProduced=0,this.chainReactions=0,this.fissionCount=0,this.fusionCount=0,this.initializeNuclei()}update(t){this.time+=t*this.speed*.001,this.nuclei.forEach(i=>{i.time+=t*this.speed*.001}),this.neutrons.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.isReactionProduct?(i.vx*=.99,i.vy*=.99,i.x<i.radius&&(i.x=i.radius,i.vx=Math.abs(i.vx)*.5),i.x>this.canvas.width-i.radius&&(i.x=this.canvas.width-i.radius,i.vx=-Math.abs(i.vx)*.5),i.y<i.radius&&(i.y=i.radius,i.vy=Math.abs(i.vy)*.5),i.y>this.canvas.height-i.radius&&(i.y=this.canvas.height-i.radius,i.vy=-Math.abs(i.vy)*.5)):i.life-=t*this.speed*.001,this.nuclei.forEach(e=>{if(e.type==="uranium"&&!e.fissioned&&Math.sqrt((i.x-e.x)**2+(i.y-e.y)**2)<e.radius+15){this.triggerFission(e),i.isReactionProduct||(i.life=0),this.chainReactions++;const n=2+Math.floor(Math.random()*3);for(let a=0;a<n;a++)this.spawnReactionNeutronAt(e.x,e.y)}})}),this.neutrons=this.neutrons.filter(i=>i.isReactionProduct?!0:i.life>-10),this.fissionProducts.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.99,i.vy*=.99}),this.fusionProducts.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.99,i.vy*=.99}),this.reactingParticles.forEach(i=>{if(i.moving){const e=i.targetX-i.x,s=i.targetY-i.y,n=Math.sqrt(e*e+s*s);if(n>5){const a=i.speed*t*this.speed*.001,o=(Math.random()-.5)*.1,h=Math.atan2(s,e)+o;i.x+=Math.cos(h)*a,i.y+=Math.sin(h)*a,Math.sqrt((i.x-i.targetX)**2+(i.y-i.targetY)**2)>n+20&&(i.life=0)}else this.handleReactionCollision(i),i.life=0}}),this.reactingParticles=this.reactingParticles.filter(i=>i.life>0),this.energyParticles.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.98,i.vy*=.98,i.life-=t*this.speed*.001,i.radius+=t*this.speed*.001*5}),this.energyParticles=this.energyParticles.filter(i=>i.life>-10),this.shockwaves.forEach(i=>{i.radius+=i.speed*t*this.speed*.001,i.life-=t*this.speed*.001*.5}),this.shockwaves=this.shockwaves.filter(i=>i.life>0)}triggerFission(t){t.fissioned=!0,t.visible=!1,this.fissionCount++,this.energyReleased+=200*this.temperature;const i=Math.random()*Math.PI*2,e=(50+Math.random()*100)*this.temperature;this.fissionProducts.push({x:t.x,y:t.y,vx:Math.cos(i)*e,vy:Math.sin(i)*e,mass:92,protons:36,neutrons:56,color:"#FF9800",radius:8,life:8}),this.fissionProducts.push({x:t.x,y:t.y,vx:Math.cos(i+Math.PI)*e,vy:Math.sin(i+Math.PI)*e,mass:141,protons:56,neutrons:85,color:"#E91E63",radius:9,life:8});const s=Math.floor(1+Math.random()*2+this.temperature*.5);for(let o=0;o<s;o++)this.spawnReactionNeutronAt(t.x,t.y);const n=Math.floor(8*this.temperature),a=["#FFD700","#FF6B35","#FF8C00"];for(let o=0;o<n;o++){const h=o/n*Math.PI*2,l=(25+Math.random()*35)*this.temperature,c=2+Math.random()*4,d=10+Math.random()*8;this.energyParticles.push({x:t.x,y:t.y,vx:Math.cos(h)*l,vy:Math.sin(h)*l,color:a[Math.floor(Math.random()*a.length)],radius:c,life:d,originalRadius:c,pulse:Math.random()*Math.PI*2})}this.shockwaves.push({x:t.x,y:t.y,radius:0,maxRadius:80*this.temperature,speed:120*this.temperature,life:.8,color:"rgba(255, 215, 0, 0.2)"})}triggerFusion(t){t.fused=!0,t.visible=!1,this.nuclei.forEach(s=>{s.type==="deuterium"&&!s.fused&&(s.visible=!1)}),this.fusionCount++,this.energyReleased+=17.6*this.temperature,this.fusionProducts.push({x:t.x,y:t.y,vx:(Math.random()-.5)*40*this.temperature,vy:(Math.random()-.5)*40*this.temperature,mass:4,protons:2,neutrons:2,color:"#2196F3",radius:25,life:8}),this.spawnReactionNeutronAt(t.x,t.y);const i=Math.floor(6*this.temperature),e=["#FFEB3B","#FFD700","#FFA500"];for(let s=0;s<i;s++){const n=s/i*Math.PI*2,a=(20+Math.random()*30)*this.temperature,o=4+Math.random()*6,h=8+Math.random()*6;this.energyParticles.push({x:t.x,y:t.y,vx:Math.cos(n)*a,vy:Math.sin(n)*a,color:e[Math.floor(Math.random()*e.length)],radius:o,life:h,originalRadius:o,pulse:Math.random()*Math.PI*2})}this.shockwaves.push({x:t.x,y:t.y,radius:0,maxRadius:60*this.temperature,speed:100*this.temperature,life:.7,color:"rgba(255, 235, 59, 0.25)"})}spawnNeutron(){const t=Math.random()*Math.PI*2,i=100,e=this.canvas.width/2+Math.cos(t)*i,s=this.canvas.height/2+Math.sin(t)*i;this.spawnNeutronAt(e,s)}spawnNeutronAt(t,i){const e=Math.random()*Math.PI*2,s=(30+Math.random()*40)*this.neutronEnergy;this.neutrons.push({x:t,y:i,vx:Math.cos(e)*s,vy:Math.sin(e)*s,color:"#9C27B0",radius:4,life:15,isReactionProduct:!1}),this.neutronsProduced++}spawnReactionNeutronAt(t,i){const e=Math.random()*Math.PI*2,s=(30+Math.random()*40)*this.neutronEnergy;this.neutrons.push({x:t,y:i,vx:Math.cos(e)*s,vy:Math.sin(e)*s,color:"#9C27B0",radius:4,life:1/0,isReactionProduct:!0}),this.neutronsProduced++}findTargetForParticle(t){if(t.type==="neutron"){let i=null,e=1/0;this.nuclei.forEach(s=>{if(s.type==="uranium"&&!s.fissioned){const n=Math.sqrt((t.x-s.x)**2+(t.y-s.y)**2);n<e&&(e=n,i=s)}}),i&&(t.targetX=i.x,t.targetY=i.y,t.targetNucleus=i)}else if(t.type==="deuterium"){let i=null,e=1/0;this.nuclei.forEach(s=>{if(s.type==="tritium"&&!s.fused){const n=Math.sqrt((t.x-s.x)**2+(t.y-s.y)**2);n<e&&(e=n,i=s)}}),i&&(t.targetX=i.x,t.targetY=i.y,t.targetNucleus=i)}}handleReactionCollision(t){t.type==="neutron"&&t.targetNucleus?Math.sqrt((t.x-t.targetNucleus.x)**2+(t.y-t.targetNucleus.y)**2)<t.targetNucleus.radius+10&&this.triggerFission(t.targetNucleus):t.type==="deuterium"&&t.targetNucleus&&Math.sqrt((t.x-t.targetNucleus.x)**2+(t.y-t.targetNucleus.y)**2)<t.targetNucleus.radius+10&&t.targetNucleus.type==="tritium"&&!t.targetNucleus.fused&&this.triggerFusion(t.targetNucleus)}render(){this.ctx.fillStyle="#1a1a1a",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.shockwaves.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=Math.max(0,t.life),this.ctx.strokeStyle=t.color,this.ctx.lineWidth=8,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=30,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}),this.energyParticles.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=Math.max(.3,t.life/2),this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}),this.fissionProducts.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2;let i="";t.protons===36?i="Kr":t.protons===56?i="Ba":i="X",this.ctx.fillText(i,t.x,t.y+2),this.ctx.font="12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+10),this.ctx.restore()}),this.fusionProducts.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.fillText("He",t.x,t.y+2),this.ctx.font="12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+10),this.ctx.restore()}),this.neutrons.forEach(t=>{this.ctx.save(),t.isReactionProduct?this.ctx.globalAlpha=1:this.ctx.globalAlpha=Math.max(.4,t.life/5),this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),t.isReactionProduct?this.ctx.globalAlpha=1:this.ctx.globalAlpha=Math.max(.4,t.life/5),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("n",t.x,t.y+3),this.ctx.restore()}),this.reactingParticles.forEach(t=>{if(this.ctx.save(),t.moving){this.ctx.strokeStyle=t.color,this.ctx.lineWidth=2,this.ctx.globalAlpha=.6,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y);const i=t.targetX-t.x,e=t.targetY-t.y,s=Math.sqrt(i*i+e*e);s>0&&this.ctx.lineTo(t.x-i/s*15,t.y-e/s*15),this.ctx.stroke(),this.ctx.globalAlpha=1}this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,t.type==="neutron"?this.ctx.fillText("n",t.x,t.y+3):t.type==="deuterium"&&this.ctx.fillText("²H",t.x,t.y+3),this.ctx.restore()}),this.nuclei.forEach(t=>{t.visible!==!1&&(this.mode==="fission"&&t.type==="uranium"?(this.drawNucleus(t),this.drawClickIndicator(t)):this.mode==="fusion"&&(t.type==="deuterium"||t.type==="tritium")?(this.drawNucleus(t),this.drawClickIndicator(t)):this.mode==="chain"&&t.type==="uranium"&&(this.drawNucleus(t),this.drawClickIndicator(t)))}),this.drawNuclearLabels()}drawGrid(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1;const t=50;for(let i=0;i<this.canvas.width;i+=t)this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.canvas.height),this.ctx.stroke();for(let i=0;i<this.canvas.height;i+=t)this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i),this.ctx.stroke()}drawNucleus(t){this.ctx.save(),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=15,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const i=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius*.6);i.addColorStop(0,"#FFFFFF"),i.addColorStop(1,t.color),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius*.6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000000";const e=Math.min(t.protons+t.neutrons,12);for(let n=0;n<e;n++){const a=n/e*Math.PI*2,o=t.radius*.4,h=t.x+Math.cos(a)*o,l=t.y+Math.sin(a)*o;this.ctx.save(),this.ctx.shadowColor="#000000",this.ctx.shadowBlur=1,this.ctx.beginPath(),this.ctx.arc(h,l,1.5,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}this.ctx.restore(),this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.beginPath(),this.ctx.arc(t.x,t.y+2,8,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center";let s="";t.type==="uranium"?s="U":t.type==="deuterium"?s="²H":t.type==="tritium"&&(s="³H"),this.ctx.fillText(s,t.x,t.y+5),this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(t.x-15,t.y+t.radius+5,30,12),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 11px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+14),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(t.x-25,t.y+t.radius+15,50,10),this.ctx.fillStyle="#FFFFFF",this.ctx.font="9px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.protons}p, ${t.neutrons}n`,t.x,t.y+t.radius+23),this.ctx.restore()}drawClickIndicator(t){if(this.mode==="fission"&&t.type==="uranium"&&!t.fissioned||this.mode==="fusion"&&(t.type==="deuterium"||t.type==="tritium")&&!t.fused){this.ctx.save();const i=Math.sin(this.time*3)*.3+.7;this.ctx.strokeStyle=`rgba(255, 255, 255, ${i*.6})`,this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius+8,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}}drawNuclearLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="#FFFFFF",this.ctx.shadowColor="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=2,this.mode==="fission"?(this.ctx.fillText("²³⁵U + ¹n → ⁹²Kr + ¹⁴¹Ba + 3¹n + 200 MeV",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("Nuclear Fission",this.ctx.canvas.width/2,50)):this.mode==="fusion"?(this.ctx.fillText("²H + ³H → ⁴He + ¹n + 17.6 MeV",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("Nuclear Fusion",this.ctx.canvas.width/2,50)):this.mode==="chain"?(this.ctx.fillText("²³⁵U + ¹n → ⁹²Kr + ¹⁴¹Ba + 3¹n + 200 MeV",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText("Chain Reaction",this.ctx.canvas.width/2,50)):(this.ctx.fillText("E = mc²",this.ctx.canvas.width/2,30),this.ctx.fillText("Nuclear Binding Energy",this.ctx.canvas.width/2,50)),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FFD700",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.mode==="fission"?this.ctx.fillText("Click anywhere to trigger fission",this.ctx.canvas.width/2,this.ctx.canvas.height-20):this.mode==="fusion"?this.ctx.fillText("Click anywhere to trigger fusion",this.ctx.canvas.width/2,this.ctx.canvas.height-20):this.mode==="chain"&&this.ctx.fillText("Click anywhere to trigger chain reaction",this.ctx.canvas.width/2,this.ctx.canvas.height-20),this.ctx.shadowBlur=0,this.ctx.restore()}getStats(){return{mode:this.mode,energyReleased:this.energyReleased.toFixed(1),neutronsProduced:this.neutronsProduced,chainReactions:this.chainReactions,fissionCount:this.fissionCount,fusionCount:this.fusionCount,temperature:this.temperature.toFixed(1),time:this.time.toFixed(1)}}}class mt{constructor(t){this.ctx=t,this.particles=[],this.obstacles=[],this.flowRate=1,this.viscosity=1,this.reynoldsNumber=100,this.visualizationMode="particles",this.time=0,this.maxParticles=100,this.flowType="Laminar",this.mouseX=0,this.mouseY=0,this.mouseInfluence=40,this.initializeParticles(),this.initializeObstacles(),this.setupMouseInteraction()}setupMouseInteraction(){const t=this.ctx.canvas;t.addEventListener("mousemove",i=>{const e=t.getBoundingClientRect();this.mouseX=i.clientX-e.left,this.mouseY=i.clientY-e.top}),t.addEventListener("mouseleave",()=>{this.mouseX=-1e3,this.mouseY=-1e3}),t.addEventListener("touchstart",i=>{i.preventDefault();const e=t.getBoundingClientRect(),s=i.touches[0];this.mouseX=s.clientX-e.left,this.mouseY=s.clientY-e.top}),t.addEventListener("touchmove",i=>{i.preventDefault();const e=t.getBoundingClientRect(),s=i.touches[0];this.mouseX=s.clientX-e.left,this.mouseY=s.clientY-e.top}),t.addEventListener("touchend",i=>{i.preventDefault(),this.mouseX=-1e3,this.mouseY=-1e3})}initializeParticles(){this.particles=[];for(let t=0;t<this.maxParticles;t++)this.particles.push({x:-50+Math.random()*100,y:50+Math.random()*(this.ctx.canvas.height-100),vx:this.flowRate*(1+Math.random()*.3),vy:(Math.random()-.5)*.3,size:3+Math.random()*2,color:`hsl(${200+Math.random()*60}, 70%, 60%)`,life:0})}initializeObstacles(){this.obstacles=[{x:400,y:80,width:80,height:100,type:"porous"},{x:400,y:420,width:100,height:120,type:"solid"}]}setFlowRate(t){this.flowRate=t,this.updateReynoldsNumber()}setViscosity(t){this.viscosity=t,this.updateReynoldsNumber()}setReynoldsNumber(t){this.reynoldsNumber=t,this.updateFlowType()}setVisualizationMode(t){this.visualizationMode=t}updateReynoldsNumber(){this.reynoldsNumber=Math.round(this.flowRate*50/this.viscosity),this.updateFlowType()}updateFlowType(){this.reynoldsNumber<2300?this.flowType="Laminar":this.reynoldsNumber<4e3?this.flowType="Transitional":this.flowType="Turbulent"}reset(){this.time=0,this.initializeParticles()}update(t){this.time+=t,this.particles.forEach((i,e)=>{const s=this.calculateFlowVelocity(i.x,i.y),n=this.flowType==="Turbulent"?(Math.random()-.5)*2*this.flowRate:0,a=this.mouseX-i.x,o=this.mouseY-i.y,h=Math.sqrt(a*a+o*o);if(i.vx=s.x+n,i.vy=s.y+n,h<this.mouseInfluence&&h>0){const l=(this.mouseInfluence-h)/this.mouseInfluence;i.vx+=a/h*l*1.2,i.vy+=o/h*l*1.2,i.vx+=(Math.random()-.5)*l*.2,i.vy+=(Math.random()-.5)*l*.2}i.vx*=1-this.viscosity*.01,i.vy*=1-this.viscosity*.01,i.x+=i.vx*t*.1,i.y+=i.vy*t*.1,i.life+=t,(i.x>this.ctx.canvas.width+50||i.x<-50||i.y<-50||i.y>this.ctx.canvas.height+50||i.life>1e4)&&this.resetParticle(i)})}resetParticle(t){t.x=-50+Math.random()*100,t.y=50+Math.random()*(this.ctx.canvas.height-100),t.vx=this.flowRate*(1+Math.random()*.3),t.vy=(Math.random()-.5)*.3,t.life=0}calculateFlowVelocity(t,i){let e=this.flowRate,s=0;this.obstacles.forEach(o=>{t>o.x&&t<o.x+o.width&&i>o.y&&i<o.y+o.height&&(o.type==="porous"?(e*=.3,s*=.3,e+=(Math.random()-.5)*this.flowRate*.1,s+=(Math.random()-.5)*this.flowRate*.1):o.type==="solid"&&(e=(Math.random()-.5)*this.flowRate*.5,s=(Math.random()-.5)*this.flowRate*.5))});const n=this.ctx.canvas.height/2,a=this.flowRate*.2;if(s+=(i-n)/n*a,this.mouseX>0&&this.mouseY>0){const o=this.mouseX-t,h=this.mouseY-i,l=Math.sqrt(o*o+h*h);if(l<this.mouseInfluence&&l>0){const c=(this.mouseInfluence-l)/this.mouseInfluence;e+=o/l*c*1.2,s+=h/l*c*1.2}}return{x:e,y:s}}render(){switch(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBackground(),this.drawObstacles(),this.visualizationMode){case"particles":this.drawParticles();break;case"streamlines":this.drawStreamlines();break;case"velocity":this.drawVelocityField();break;case"pressure":this.drawPressureField();break}this.drawFlowInfo(),this.drawRealWorldAnalogy(),this.drawMouseIndicator()}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#E8F4FD"),t.addColorStop(.3,"#D1E7FF"),t.addColorStop(.7,"#B8D4F8"),t.addColorStop(1,"#A3C4F0"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,this.ctx.setLineDash([20,20]);for(let i=0;i<this.ctx.canvas.width;i+=40)this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.ctx.canvas.height),this.ctx.stroke();for(let i=0;i<this.ctx.canvas.height;i+=40)this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(this.ctx.canvas.width,i),this.ctx.stroke();this.ctx.setLineDash([])}drawObstacles(){this.obstacles.forEach(t=>{switch(t.type){case"porous":this.drawPorousObject(t);break;case"solid":this.drawSolidObject(t);break}})}drawPorousObject(t){this.ctx.shadowColor="rgba(0, 0, 0, 0.3)",this.ctx.shadowBlur=8,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2;const i=this.ctx.createLinearGradient(t.x,t.y,t.x+t.width,t.y+t.height);i.addColorStop(0,"rgba(255, 182, 193, 0.95)"),i.addColorStop(.5,"rgba(255, 150, 150, 0.9)"),i.addColorStop(1,"rgba(255, 182, 193, 0.95)"),this.ctx.fillStyle=i,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0;for(let s=0;s<4;s++)for(let n=0;n<6;n++){const a=t.x+10+n*12,o=t.y+15+s*20,h=this.ctx.createRadialGradient(a,o,0,a,o,4);h.addColorStop(0,"rgba(255, 255, 255, 0.9)"),h.addColorStop(1,"rgba(255, 255, 255, 0.6)"),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.arc(a,o,4,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle="rgba(255, 150, 150, 0.8)",this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let s=0;s<t.height;s+=15)this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y+s),this.ctx.lineTo(t.x+t.width,t.y+s),this.ctx.stroke();const e=this.ctx.createLinearGradient(t.x,t.y,t.x+t.width,t.y+t.height);e.addColorStop(0,"rgba(255, 100, 100, 0.9)"),e.addColorStop(.5,"rgba(255, 80, 80, 0.95)"),e.addColorStop(1,"rgba(255, 100, 100, 0.9)"),this.ctx.strokeStyle=e,this.ctx.lineWidth=3,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("🧽 Porous Sponge",t.x+t.width/2,t.y+t.height/2+6)}drawTree(t){this.ctx.fillStyle="rgba(139, 69, 19, 0.9)",this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="rgba(101, 67, 33, 0.8)",this.ctx.lineWidth=2;for(let i=0;i<t.height;i+=15)this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y+i),this.ctx.lineTo(t.x+t.width,t.y+i),this.ctx.stroke();this.ctx.fillStyle="rgba(34, 139, 34, 0.8)",this.ctx.beginPath(),this.ctx.arc(t.x+t.width/2,t.y-10,25,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000000",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("🌳 Tree",t.x+t.width/2,t.y+t.height/2+4)}drawSolidObject(t){this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=10,this.ctx.shadowOffsetX=3,this.ctx.shadowOffsetY=3;const i=this.ctx.createLinearGradient(t.x,t.y,t.x+t.width,t.y+t.height);i.addColorStop(0,"rgba(120, 120, 120, 0.95)"),i.addColorStop(.3,"rgba(105, 105, 105, 0.95)"),i.addColorStop(.7,"rgba(90, 90, 90, 0.95)"),i.addColorStop(1,"rgba(75, 75, 75, 0.95)"),this.ctx.fillStyle=i,this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.strokeStyle="rgba(80, 80, 80, 0.9)",this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let s=0;s<t.height;s+=20)this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y+s),this.ctx.lineTo(t.x+t.width,t.y+s),this.ctx.stroke();for(let s=0;s<t.width;s+=25)this.ctx.beginPath(),this.ctx.moveTo(t.x+s,t.y),this.ctx.lineTo(t.x+s,t.y+t.height),this.ctx.stroke();const e=this.ctx.createLinearGradient(t.x,t.y,t.x+t.width,t.y+t.height);e.addColorStop(0,"rgba(50, 50, 50, 0.95)"),e.addColorStop(.5,"rgba(30, 30, 30, 0.98)"),e.addColorStop(1,"rgba(50, 50, 50, 0.95)"),this.ctx.strokeStyle=e,this.ctx.lineWidth=4,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("🪨 Solid Block",t.x+t.width/2,t.y+t.height/2+6)}drawPillar(t){this.ctx.fillStyle="rgba(192, 192, 192, 0.9)",this.ctx.fillRect(t.x,t.y,t.width,t.height),this.ctx.strokeStyle="rgba(160, 160, 160, 0.8)",this.ctx.lineWidth=1;for(let i=0;i<t.height;i+=12)this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y+i),this.ctx.lineTo(t.x+t.width,t.y+i),this.ctx.stroke();this.ctx.fillStyle="rgba(220, 220, 220, 0.9)",this.ctx.fillRect(t.x-5,t.y-5,t.width+10,10),this.ctx.fillStyle="#000000",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("🏛️ Pillar",t.x+t.width/2,t.y+t.height/2+4)}drawBoulder(t){this.ctx.fillStyle="rgba(128, 128, 128, 0.9)",this.ctx.beginPath(),this.ctx.ellipse(t.x+t.width/2,t.y+t.height/2,t.width/2+5,t.height/2+3,.3,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(90, 90, 90, 0.8)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.x+15,t.y+10,8,0,Math.PI*2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(t.x+35,t.y+25,6,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#000000",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("🪨 Boulder",t.x+t.width/2,t.y+t.height/2+4)}drawParticles(){this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.flowRate*2,s=Math.min(i/e,1),n=this.mouseX-t.x,a=this.mouseY-t.y,o=Math.sqrt(n*n+a*a),h=o<this.mouseInfluence&&o>0;let l,c,d,x;h?(l=270+Math.random()*30,c=80,d=60,x=`rgba(147, 112, 219, ${s*.6})`):(l=200+s*60,c=70+s*30,d=60-s*20,x=`rgba(135, 206, 250, ${s*.4})`);const r=`hsl(${l}, ${c}%, ${d}%)`;i>this.flowRate*.8&&(this.ctx.shadowColor=x,this.ctx.shadowBlur=10,this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size+2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0);const g=this.ctx.createRadialGradient(t.x-t.size*.3,t.y-t.size*.3,0,t.x,t.y,t.size);if(g.addColorStop(0,`hsl(${l}, ${c}%, ${d+20}%)`),g.addColorStop(.7,r),g.addColorStop(1,`hsl(${l}, ${c}%, ${d-20}%)`),this.ctx.fillStyle=g,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),i>this.flowRate*.5){const u=this.ctx.createLinearGradient(t.x,t.y,t.x-t.vx*.5,t.y-t.vy*.5);u.addColorStop(0,`hsla(${l}, ${c}%, ${d}%, ${s*.8})`),u.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.strokeStyle=u,this.ctx.lineWidth=Math.max(2,i*2),this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-t.vx*.5,t.y-t.vy*.5),this.ctx.stroke()}h&&(this.ctx.strokeStyle="rgba(147, 112, 219, 0.8)",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-t.vx*.8,t.y-t.vy*.8),this.ctx.stroke())})}drawStreamlines(){for(let e=0;e<15;e++){const s=50+e*(this.ctx.canvas.height-100)/14;let n=0,a=s;this.ctx.beginPath(),this.ctx.moveTo(n,a);for(let o=0;o<100;o++){const h=this.calculateFlowVelocity(n,a),l=Math.sqrt(h.x*h.x+h.y*h.y),c=n+h.x*8+(Math.random()-.5)*2,d=a+h.y*8+(Math.random()-.5)*2,x=this.mouseX-n,r=this.mouseY-a,g=Math.sqrt(x*x+r*r),u=g<this.mouseInfluence&&g>0,f=Math.min(.8,.3+l*.5),m=Math.max(1,l*2);if(u?(this.ctx.strokeStyle=`rgba(147, 112, 219, ${f})`,this.ctx.lineWidth=m+1):(this.ctx.strokeStyle=`rgba(0, 100, 200, ${f})`,this.ctx.lineWidth=m),this.ctx.lineTo(c,d),n=c,a=d,n>this.ctx.canvas.width||n<0||a<0||a>this.ctx.canvas.height)break}this.ctx.stroke()}for(let e=100;e<this.ctx.canvas.width-100;e+=80)for(let s=100;s<this.ctx.canvas.height-100;s+=60){const n=this.calculateFlowVelocity(e,s),a=Math.sqrt(n.x*n.x+n.y*n.y);if(a>.1){const o=this.mouseX-e,h=this.mouseY-s,l=Math.sqrt(o*o+h*h),c=l<this.mouseInfluence&&l>0,d=Math.atan2(n.y,n.x),x=Math.min(15,a*10);c?(this.ctx.strokeStyle=`rgba(147, 112, 219, ${Math.min(.9,a+.3)})`,this.ctx.lineWidth=3):(this.ctx.strokeStyle=`rgba(0, 150, 255, ${Math.min(.8,a)})`,this.ctx.lineWidth=2),this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e+Math.cos(d)*x,s+Math.sin(d)*x),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e+Math.cos(d)*x,s+Math.sin(d)*x),this.ctx.lineTo(e+Math.cos(d)*x-Math.cos(d-.5)*5,s+Math.sin(d)*x-Math.sin(d-.5)*5),this.ctx.lineTo(e+Math.cos(d)*x-Math.cos(d+.5)*5,s+Math.sin(d)*x-Math.sin(d+.5)*5),this.ctx.closePath(),c?this.ctx.fillStyle=`rgba(147, 112, 219, ${Math.min(.9,a+.3)})`:this.ctx.fillStyle=`rgba(0, 150, 255, ${Math.min(.8,a)})`,this.ctx.fill()}}this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("🌊 Streamlines",this.ctx.canvas.width/2,30),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.font="12px Arial",this.ctx.fillText("Lines show fluid flow direction",this.ctx.canvas.width/2,50)}drawVelocityField(){for(let t=60;t<this.ctx.canvas.width-60;t+=50)for(let i=60;i<this.ctx.canvas.height-60;i+=50){const e=this.calculateFlowVelocity(t,i),s=Math.sqrt(e.x*e.x+e.y*e.y);if(s>.1){const h=`hsl(${240-Math.min(180,s*100)}, 80%, 60%)`,l=Math.min(25,s*15),c=Math.max(1,s*3);this.ctx.strokeStyle=h,this.ctx.lineWidth=c,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t+e.x*l,i+e.y*l),this.ctx.stroke();const d=Math.atan2(e.y,e.x);this.ctx.beginPath(),this.ctx.moveTo(t+e.x*l,i+e.y*l),this.ctx.lineTo(t+e.x*l-Math.cos(d-.5)*6,i+e.y*l-Math.sin(d-.5)*6),this.ctx.lineTo(t+e.x*l-Math.cos(d+.5)*6,i+e.y*l-Math.sin(d+.5)*6),this.ctx.closePath(),this.ctx.fillStyle=h,this.ctx.fill(),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.arc(t,i,Math.max(2,s*3),0,Math.PI*2),this.ctx.fill()}}this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("⚡ Velocity Field",this.ctx.canvas.width/2,30),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.font="12px Arial",this.ctx.fillText("Blue = Slow, Red = Fast",this.ctx.canvas.width/2,50)}drawPressureField(){for(let t=0;t<this.ctx.canvas.width;t+=20)for(let i=0;i<this.ctx.canvas.height;i+=20){const e=this.calculateFlowVelocity(t,i),s=Math.sqrt(e.x*e.x+e.y*e.y),n=Math.max(0,1-s*.3),a=Math.floor(200*n),o=Math.floor(100*(1-n)),h=Math.floor(50*n),l=`rgba(${o}, ${h}, ${a}, ${.2+n*.2})`;this.ctx.fillStyle=l,this.ctx.fillRect(t,i,20,20)}this.ctx.strokeStyle="rgba(255, 255, 255, 0.8)",this.ctx.lineWidth=1;for(let t=.2;t<=.8;t+=.2){this.ctx.beginPath();let i=!0;for(let e=0;e<this.ctx.canvas.width;e+=10)for(let s=0;s<this.ctx.canvas.height;s+=10){const n=this.calculateFlowVelocity(e,s),a=Math.sqrt(n.x*n.x+n.y*n.y),o=Math.max(0,1-a*.3);Math.abs(o-t)<.05&&(i?(this.ctx.moveTo(e,s),i=!1):this.ctx.lineTo(e,s))}this.ctx.stroke()}this.ctx.fillStyle="rgba(0, 0, 0, 0.9)",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("💨 Pressure Field",this.ctx.canvas.width/2,30),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.font="12px Arial",this.ctx.fillText("Blue = High Pressure, Red = Low Pressure",this.ctx.canvas.width/2,50)}drawFlowInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,24,300,140);const n=this.ctx.createLinearGradient(20,20,20,160);n.addColorStop(0,"rgba(26, 26, 46, 0.98)"),n.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),n.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),n.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=n,this.ctx.fillRect(20,20,300,140),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const a=this.ctx.createLinearGradient(20,20,320,160);a.addColorStop(0,"#4ECDC4"),a.addColorStop(.5,"#2ECC71"),a.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=a,this.ctx.strokeRect(20,20,300,140),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,20,20,50);o.addColorStop(0,"rgba(78, 205, 196, 0.1)"),o.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,20,300,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("🌊 Fluid Flow Simulation",35,42),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`🚀 Flow Rate: ${this.flowRate.toFixed(1)}`,35,65),this.ctx.fillText(`💧 Viscosity: ${this.viscosity.toFixed(1)}`,35,82),this.ctx.fillText(`📊 Reynolds Number: ${this.reynoldsNumber}`,35,99),this.ctx.fillText(`🔄 Flow Type: ${this.flowType}`,35,116);const h=this.flowType==="Laminar"?"#4CAF50":this.flowType==="Transitional"?"#FF9800":"#F44336";this.ctx.fillStyle=h,this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.fillText(`● ${this.flowType}`,35,133);const l=Math.min(100,this.flowRate/3*100),c=l>80?"#4ECDC4":l>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=c,this.ctx.fillText(`🎯 Flow Efficiency: ${l.toFixed(0)}%`,35,150)}drawRealWorldAnalogy(){const t=this.ctx.canvas.width-290,i=20,e=270,s=100;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(t+4,i+4,e,s);const n=this.ctx.createLinearGradient(t,i,t,i+s);n.addColorStop(0,"rgba(26, 26, 46, 0.98)"),n.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),n.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),n.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=n,this.ctx.fillRect(t,i,e,s),this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const a=this.ctx.createLinearGradient(t,i,t+e,i+s);a.addColorStop(0,"#FFD700"),a.addColorStop(.5,"#FFA500"),a.addColorStop(1,"#FFD700"),this.ctx.strokeStyle=a,this.ctx.strokeRect(t,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(t,i,t,i+30);o.addColorStop(0,"rgba(255, 215, 0, 0.1)"),o.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,e,30),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💡 Real-World Examples:",t+15,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("🧽 Sponge: water flows through",t+15,i+45),this.ctx.fillText("🪨 Rock: water flows around",t+15,i+62),this.ctx.fillText("🌊 River: natural flow patterns",t+15,i+79),this.ctx.fillText("🏊 Pool: controlled fluid motion",t+15,i+96)}drawMouseIndicator(){this.mouseX>0&&this.mouseY>0&&(this.ctx.strokeStyle="rgba(147, 112, 219, 0.8)",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence,0,Math.PI*2),this.ctx.stroke(),this.ctx.strokeStyle="rgba(138, 43, 226, 0.6)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence*.6,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="rgba(147, 112, 219, 0.9)",this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,4,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.9)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,4,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#000000",this.ctx.font="bold 14px Arial",this.ctx.textAlign="center",this.ctx.fillText("Move mouse to interact!",this.mouseX,this.mouseY-25),this.ctx.shadowColor="rgba(147, 112, 219, 0.5)",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence*.3,0,Math.PI*2),this.ctx.fillStyle="rgba(147, 112, 219, 0.1)",this.ctx.fill(),this.ctx.shadowBlur=0)}adjustColor(t,i){if(t.startsWith("#")){const e=t.replace("#",""),s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}return t}getStats(){const t=this.particles.reduce((i,e)=>i+Math.sqrt(e.vx*e.vx+e.vy*e.vy),0)/this.particles.length;return{flowRate:this.flowRate,viscosity:this.viscosity,reynoldsNumber:this.reynoldsNumber,flowType:this.flowType,averageVelocity:t,time:this.time}}}class yt{constructor(t){this.ctx=t,this.particles=[],this.pipeWidth=50,this.fluidDensity=1,this.pressureDifference=1,this.visualizationMode="basic",this.time=0,this.maxParticles=80,this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.maxParticles;t++)this.particles.push({x:-50+Math.random()*50,y:250+Math.random()*100,vx:this.pressureDifference*(1+Math.random()*.3),vy:(Math.random()-.5)*.3,size:4+Math.random()*3,color:`hsl(${220+Math.random()*40}, 80%, 60%)`,life:0})}setPipeWidth(t){this.pipeWidth=t}setFluidDensity(t){this.fluidDensity=t}setPressureDifference(t){this.pressureDifference=t}setVisualizationMode(t){this.visualizationMode=t}reset(){this.time=0,this.initializeParticles()}update(t){this.time+=t,this.particles.forEach(i=>{i.x>300&&i.x<500&&(i.vx*=1.5),i.x+=i.vx*t*.1,i.y+=i.vy*t*.1,i.life+=t,(i.x>this.ctx.canvas.width+50||i.x<-50||i.y<150||i.y>450||i.life>8e3)&&this.resetParticle(i)})}resetParticle(t){t.x=-50+Math.random()*50,t.y=250+Math.random()*100,t.vx=this.pressureDifference*(1+Math.random()*.3),t.vy=(Math.random()-.5)*.3,t.life=0}render(){switch(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawPipeSystem(),this.drawParticles(),this.visualizationMode){case"pressure":this.drawPressureAnalysis();break;case"velocity":this.drawVelocityAnalysis();break;case"energy":this.drawEnergyAnalysis();break}this.drawBernoulliInfo(),this.drawBernoulliRealWorldAnalogy()}drawPipeSystem(){this.ctx.shadowColor="rgba(0, 0, 0, 0.3)",this.ctx.shadowBlur=10,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.beginPath(),this.ctx.moveTo(0,200),this.ctx.lineTo(300,200),this.ctx.lineTo(300,400),this.ctx.lineTo(0,400),this.ctx.closePath();const t=this.ctx.createLinearGradient(0,200,300,400);t.addColorStop(0,"rgba(135, 206, 250, 0.6)"),t.addColorStop(.5,"rgba(70, 130, 180, 0.5)"),t.addColorStop(1,"rgba(135, 206, 250, 0.6)"),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.strokeStyle="rgba(70, 130, 180, 0.9)",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(300,250),this.ctx.lineTo(500,250),this.ctx.lineTo(500,350),this.ctx.lineTo(300,350),this.ctx.closePath();const i=this.ctx.createLinearGradient(300,250,500,350);i.addColorStop(0,"rgba(255, 140, 0, 0.6)"),i.addColorStop(.5,"rgba(255, 69, 0, 0.5)"),i.addColorStop(1,"rgba(255, 140, 0, 0.6)"),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 69, 0, 0.9)",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(500,200),this.ctx.lineTo(this.ctx.canvas.width,200),this.ctx.lineTo(this.ctx.canvas.width,400),this.ctx.lineTo(500,400),this.ctx.closePath();const e=this.ctx.createLinearGradient(500,200,this.ctx.canvas.width,400);e.addColorStop(0,"rgba(70, 130, 180, 0.6)"),e.addColorStop(.5,"rgba(135, 206, 250, 0.5)"),e.addColorStop(1,"rgba(70, 130, 180, 0.6)"),this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.strokeStyle="rgba(70, 130, 180, 0.9)",this.ctx.lineWidth=3,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Wide Section (Slow)",150,180),this.ctx.fillText("Narrow Section (Fast)",400,180),this.ctx.fillText("Wide Section (Slow)",650,180),this.ctx.fillStyle="#0066CC",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.fillText("SLOW",150,160),this.ctx.fillText("SLOW",650,160),this.ctx.fillStyle="#FF6600",this.ctx.fillText("FAST",400,160),this.ctx.strokeStyle="#0066CC",this.ctx.lineWidth=4,this.ctx.fillStyle="#0066CC";for(let s=220;s<380;s+=30)this.drawEnhancedArrow(50,s,100,s,"#0066CC");this.ctx.strokeStyle="#FF6600",this.ctx.fillStyle="#FF6600";for(let s=270;s<330;s+=20)this.drawEnhancedArrow(320,s,480,s,"#FF6600");this.ctx.strokeStyle="#0066CC",this.ctx.fillStyle="#0066CC";for(let s=220;s<380;s+=30)this.drawEnhancedArrow(700,s,750,s,"#0066CC")}drawEnhancedArrow(t,i,e,s,n){const o=Math.atan2(s-i,e-t);this.ctx.shadowColor=n,this.ctx.shadowBlur=6,this.ctx.strokeStyle=n,this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke();const h=this.ctx.createLinearGradient(e,s,e-12,s);h.addColorStop(0,n),h.addColorStop(1,this.adjustColor(n,-30)),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-12*Math.cos(o-Math.PI/6),s-12*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-12*Math.cos(o+Math.PI/6),s-12*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}adjustColor(t,i){if(t.startsWith("#")){const e=t.replace("#",""),s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}return t}drawArrow(t,i,e,s,n){const o=Math.atan2(s-i,e-t);this.ctx.strokeStyle=n,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke(),this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-10*Math.cos(o-Math.PI/6),s-10*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-10*Math.cos(o+Math.PI/6),s-10*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}drawParticles(){this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.pressureDifference*2,s=Math.min(i/e,1);let n,a,o;t.x>300&&t.x<500?(n=`hsl(${20+s*40}, 85%, 60%)`,a=`rgba(255, 140, 0, ${s*.8})`,o=`rgba(255, 69, 0, ${s*.6})`):(n=`hsl(${220-s*30}, 80%, 60%)`,a=`rgba(70, 130, 180, ${s*.6})`,o=`rgba(135, 206, 250, ${s*.4})`),t.x>300&&t.x<500&&i>this.pressureDifference*.8&&(this.ctx.shadowColor=o,this.ctx.shadowBlur=12,this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size+4,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=6,this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size+2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0);const h=this.ctx.createRadialGradient(t.x-t.size*.3,t.y-t.size*.3,0,t.x,t.y,t.size);if(h.addColorStop(0,this.adjustColor(n,30)),h.addColorStop(.7,n),h.addColorStop(1,this.adjustColor(n,-20)),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),i>this.pressureDifference*.5){const l=this.ctx.createLinearGradient(t.x,t.y,t.x-t.vx*.6,t.y-t.vy*.6);l.addColorStop(0,a),l.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.strokeStyle=l,this.ctx.lineWidth=Math.max(3,i*2),this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-t.vx*.6,t.y-t.vy*.6),this.ctx.stroke()}t.x>300&&t.x<500&&i>this.pressureDifference*1.2&&(this.ctx.strokeStyle="#FF6600",this.ctx.lineWidth=3,this.ctx.setLineDash([8,4]),this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x+t.vx*.4,t.y+t.vy*.4),this.ctx.stroke(),this.ctx.setLineDash([]))})}drawPressureAnalysis(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,100),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("📊 Pressure Analysis",20,30),this.ctx.font="14px Arial",this.ctx.fillText("High Pressure (Red)",20,50),this.ctx.fillText("Low Pressure (Green)",20,70),this.ctx.fillText("💡 Narrow section = lower pressure",20,90)}drawVelocityAnalysis(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,100),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("⚡ Velocity Analysis",20,30),this.ctx.font="14px Arial",this.ctx.fillText("Slow (Blue arrows)",20,50),this.ctx.fillText("Fast (Orange arrows)",20,70),this.ctx.fillText("💡 Narrow section = faster flow",20,90)}drawEnergyAnalysis(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,100),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("⚡ Energy Analysis",20,30),this.ctx.font="14px Arial",this.ctx.fillText("Pressure + Kinetic = Constant",20,50),this.ctx.fillText("When speed increases, pressure decreases",20,70),this.ctx.fillText("💡 Total energy is conserved",20,90)}drawBernoulliInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,454,320,120);const n=this.ctx.createLinearGradient(20,450,20,570);n.addColorStop(0,"rgba(26, 26, 46, 0.98)"),n.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),n.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),n.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=n,this.ctx.fillRect(20,450,320,120),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const a=this.ctx.createLinearGradient(20,450,340,570);a.addColorStop(0,"#4ECDC4"),a.addColorStop(.5,"#2ECC71"),a.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=a,this.ctx.strokeRect(20,450,320,120),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,450,20,480);o.addColorStop(0,"rgba(78, 205, 196, 0.1)"),o.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,450,320,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("⚡ Bernoulli's Principle",35,472),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`🚀 Speed: ${this.pressureDifference.toFixed(1)}`,35,495),this.ctx.fillText(`📏 Width: ${this.pipeWidth}`,35,512),this.ctx.fillText(`💧 Density: ${this.fluidDensity.toFixed(1)}`,35,529),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.fillText("💡 Faster flow = Lower pressure",35,546),this.ctx.fillText("🔍 Watch particles speed up!",35,563);const h=Math.min(100,this.pressureDifference/2*100),l=h>80?"#4ECDC4":h>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=l,this.ctx.fillText(`🎯 Flow Efficiency: ${h.toFixed(0)}%`,35,580)}drawBernoulliRealWorldAnalogy(){const t=this.ctx.canvas.width-290,i=20,e=270,s=100;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(t+4,i+4,e,s);const n=this.ctx.createLinearGradient(t,i,t,i+s);n.addColorStop(0,"rgba(26, 26, 46, 0.98)"),n.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),n.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),n.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=n,this.ctx.fillRect(t,i,e,s),this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const a=this.ctx.createLinearGradient(t,i,t+e,i+s);a.addColorStop(0,"#FFD700"),a.addColorStop(.5,"#FFA500"),a.addColorStop(1,"#FFD700"),this.ctx.strokeStyle=a,this.ctx.strokeRect(t,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(t,i,t,i+30);o.addColorStop(0,"rgba(255, 215, 0, 0.1)"),o.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,e,30),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💡 Real-World Examples:",t+15,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("🚿 Garden hose: narrow = faster",t+15,i+45),this.ctx.fillText("✈️ Airplane wings: curved = lift",t+15,i+62),this.ctx.fillText("🏥 Venturi meters: flow measurement",t+15,i+79),this.ctx.fillText("🩸 Blood flow: artery constriction",t+15,i+96)}getStats(){return{pipeWidth:this.pipeWidth,fluidDensity:this.fluidDensity,pressureDifference:this.pressureDifference,velocityRatio:1.5,energyConservation:"✓",time:this.time}}}class wt{constructor(t){this.ctx=t,this.canvas=t.canvas,this.layers=[2,4,3,1],this.neurons=[],this.weights=[],this.biases=[],this.activations=[],this.trainingData=[{input:[.9,.1],output:[0],object:"circle",description:"Simple: High symmetry, smooth edges"},{input:[.8,.3],output:[0],object:"square",description:"Simple: Regular symmetry, straight edges"},{input:[.6,.5],output:[1],object:"triangle",description:"Complex: Lower symmetry, angular edges"},{input:[.3,.9],output:[1],object:"star",description:"Complex: Low symmetry, many edges"}],this.currentDataIndex=0,this.epoch=0,this.learningRate=.1,this.speed=1,this.showWeights=!0,this.showGradients=!1,this.showLoss=!0,this.autoTrain=!0,this.neuronRadius=15,this.layerSpacing=120,this.layerStartX=0,this.layerStartY=0,this.animationPhase="forward",this.forwardStep=0,this.backwardStep=0,this.updateStep=0,this.pauseTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.layerActivationDelay=.25,this.layerProcessingDelay=.4,this.isProcessingLayer=!1,this.dataFlowParticles=[],this.errorFlowParticles=[],this.weightUpdateParticles=[],this.lossHistory=[],this.accuracyHistory=[],this.currentLoss=0,this.currentAccuracy=0,this.phaseDuration=3.5,this.pauseDuration=.8,this.activeNeurons=new Set,this.activeConnections=new Set,this.errorIndicators=new Map,this.weightChangeIndicators=new Map,this.currentObject=null,this.objectDisplayTime=0,this.showObjectContext=!0,this.isTestingMode=!1,this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingDuration=2.5,this.testingParticles=[],this.testResults=[],this.lastTestResult=null,this.showTrainingIndicator=!1,this.trainingIndicatorTime=0,this.trainingIndicatorDuration=4,this.trainingIndicatorObjectIndex=0,this.trainingIndicatorObjectTime=0,this.isTrainingComplete=!1,this.reset(),this.runShortTrainingPhase(),this.startFirstTrainingCycle(),setTimeout(()=>{this.isTrainingComplete||(this.isTrainingComplete=!0)},5e3)}initializeNetwork(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=(this.layers.length-1)*this.layerSpacing;this.layerStartX=(t-e)/2;const s=i/2;this.neurons=[];for(let o=0;o<this.layers.length;o++){const h=[],l=this.layers[o],c=this.layerStartX+o*this.layerSpacing;for(let d=0;d<l;d++){const x=s+(d-(l-1)/2)*60;h.push({x:c,y:x,value:0,delta:0,isActive:!1,pulseIntensity:0,errorIntensity:0,weightChangeIntensity:0})}this.neurons.push(h)}this.weights=[],this.biases=[];const n=[[[1.2,-1,.8,-.6],[-1,1.5,.6,-1.2]],[[1,-.8,.5],[-.8,1.2,-.6],[.9,-.5,.8],[-.6,.8,1]],[[1.5],[-1.2],[1.8]]],a=[[-.5,.6,-.3,.4],[.3,-.4,.5],[-.8]];for(let o=0;o<this.layers.length-1;o++){const h=this.layers[o],l=this.layers[o+1],c=[];for(let x=0;x<h;x++){const r=[];for(let g=0;g<l;g++)r.push({value:n[o][x][g],change:0,isActive:!1,pulseIntensity:0});c.push(r)}this.weights.push(c);const d=[];for(let x=0;x<l;x++)d.push({value:a[o][x],change:0,isActive:!1});this.biases.push(d)}}setSpeed(t){this.speed=t,this.phaseDuration=2/t}setLearningRate(t){this.learningRate=t}setShowWeights(t){this.showWeights=t}setShowGradients(t){this.showGradients=t}setShowLoss(t){this.showLoss=t}setAutoTrain(t){this.autoTrain=t}resize(){this.initializeNetwork()}reset(){this.initializeNetwork(),this.epoch=0,this.currentDataIndex=0,this.animationPhase="forward",this.forwardStep=0,this.backwardStep=0,this.updateStep=0,this.pauseTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1,this.lossHistory=[],this.accuracyHistory=[],this.currentLoss=0,this.currentAccuracy=0,this.isTrainingComplete=!1,this.isTestingMode?(this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingParticles=[],this.testResults=[],this.lastTestResult=null):this.objectDisplayTime=0,this.dataFlowParticles=[],this.errorFlowParticles=[],this.weightUpdateParticles=[],this.clearVisualIndicators(),this.isTestingMode&&(this.currentObject=null),this.objectDisplayTime=0,this.runShortTrainingPhase()}startFirstTrainingCycle(){if(!this.isTestingMode&&this.autoTrain){const t=this.trainingData[this.currentDataIndex];this.forwardPropagate(t.input),this.currentObject=t,this.objectDisplayTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1}}setDemoPerfectWeights(){const t=[[[5,-5,5,-5],[-5,5,5,-5]],[[5,-5,0],[-5,5,0],[0,0,5],[0,0,-5]],[[5],[5],[-5]]],i=[[-2.5,-2.5,2.5,2.5],[-2.5,-2.5,2.5],[-2.5]];this.weights=t.map(e=>e.map(s=>s.map(n=>({value:n,change:0,isActive:!1,pulseIntensity:0})))),this.biases=i.map(e=>e.map(s=>({value:s,change:0,isActive:!1})))}runShortTrainingPhase(){this.showTrainingIndicator=!0,this.trainingIndicatorTime=0,this.isTrainingComplete=!1;const t=100,i=this.learningRate;this.learningRate=.1;for(let e=0;e<t;e++)for(let s=0;s<this.trainingData.length;s++){const n=this.trainingData[s];this.forwardPropagate(n.input),this.backwardPropagate(n.output),this.updateWeights()}this.learningRate=i,this.clearVisualIndicators(),this.isTrainingComplete=!0}sigmoid(t){return 1/(1+Math.exp(-t))}sigmoidDerivative(t){return t*(1-t)}forwardPropagate(t){for(let i=0;i<t.length;i++)this.neurons[0][i].value=t[i],this.neurons[0][i].isActive=!0,this.neurons[0][i].pulseIntensity=1;for(let i=0;i<this.layers.length-1;i++){const e=this.neurons[i],s=this.neurons[i+1],n=this.weights[i],a=this.biases[i];for(let o=0;o<s.length;o++){let h=a[o].value;for(let l=0;l<e.length;l++)h+=e[l].value*n[l][o].value;s[o].value=this.sigmoid(h)}}}backwardPropagate(t){const i=this.neurons[this.neurons.length-1];for(let e=0;e<i.length;e++){const s=t[e]-i[e].value;i[e].delta=s*this.sigmoidDerivative(i[e].value),i[e].errorIntensity=Math.abs(s)}for(let e=this.neurons.length-2;e>0;e--){const s=this.neurons[e],n=this.neurons[e+1],a=this.weights[e];for(let o=0;o<s.length;o++){let h=0;for(let l=0;l<n.length;l++)h+=n[l].delta*a[o][l].value;s[o].delta=h*this.sigmoidDerivative(s[o].value),s[o].errorIntensity=Math.abs(h)}}}updateWeights(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t],n=this.biases[t];for(let a=0;a<e.length;a++){const o=this.learningRate*e[a].delta;n[a].value+=o,n[a].change=o,n[a].isActive=!0;for(let h=0;h<i.length;h++){const l=this.learningRate*e[a].delta*i[h].value;s[h][a].value+=l,s[h][a].change=l,s[h][a].isActive=!0,s[h][a].pulseIntensity=1}}}}calculateLoss(t){const i=this.neurons[this.neurons.length-1];let e=0;for(let s=0;s<i.length;s++){const n=t[s]-i[s].value;e+=.5*n*n}return e}calculateAccuracy(){let t=0;for(let i=0;i<this.trainingData.length;i++){const e=this.trainingData[i];this.forwardPropagate(e.input),(this.neurons[this.neurons.length-1][0].value>.5?1:0)===e.output[0]&&t++}return t/this.trainingData.length}createDataFlowParticles(t,i,e,s=!1){const n={x:t.x,y:t.y,targetX:i.x,targetY:i.y,value:e,progress:0,speed:.02*this.speed,isError:s,size:Math.abs(e)*3+2};s?this.errorFlowParticles.push(n):this.dataFlowParticles.push(n)}updateDataFlowParticles(){for(let t=this.dataFlowParticles.length-1;t>=0;t--){const i=this.dataFlowParticles[t];i.progress+=i.speed,i.progress>=1&&this.dataFlowParticles.splice(t,1)}for(let t=this.errorFlowParticles.length-1;t>=0;t--){const i=this.errorFlowParticles[t];i.progress+=i.speed,i.progress>=1&&this.errorFlowParticles.splice(t,1)}for(let t=this.weightUpdateParticles.length-1;t>=0;t--){const i=this.weightUpdateParticles[t];i.progress+=i.speed,i.progress>=1&&this.weightUpdateParticles.splice(t,1)}}setTestingMode(t){this.isTestingMode=t,t?(this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingParticles=[]):this.runShortTrainingPhase()}selectTestObject(t){this.isTestingMode&&this.isTrainingComplete&&(this.selectedTestObject=this.trainingData.find(i=>i.object===t),this.testingPhase="processing",this.testingStep=0,this.testingParticles=[],this.lastTestResult=null,this.forwardPropagate(this.selectedTestObject.input),this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1)}addTestResult(t,i,e,s){this.testResults.push({object:t,predicted:i,confidence:e,isCorrect:s,timestamp:Date.now()}),this.testResults.length>10&&this.testResults.shift()}createTestingFlowParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=i[n].value*s[n][a].value;if(Math.abs(o)>.01){const h={x:i[n].x,y:i[n].y,targetX:e[a].x,targetY:e[a].y,value:o,progress:0,speed:.015*this.speed,size:Math.abs(o)*4+3,isTesting:!0};this.testingParticles.push(h)}}}}createTestingFlowParticlesForLayer(t){if(t<=0||t>=this.layers.length)return;const i=this.neurons[t-1],e=this.neurons[t],s=this.weights[t-1];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=i[n].value*s[n][a].value;if(Math.abs(o)>.01){const h={x:i[n].x,y:i[n].y,targetX:e[a].x,targetY:e[a].y,value:o,progress:0,speed:.015*this.speed,size:Math.abs(o)*4+3,isTesting:!0};this.testingParticles.push(h)}}}updateTestingParticles(){for(let t=this.testingParticles.length-1;t>=0;t--){const i=this.testingParticles[t];i.progress+=i.speed,i.progress>=1&&this.testingParticles.splice(t,1)}}update(t){if(this.isTestingMode){this.updateTesting(t);return}if(!this.autoTrain)return;const i=t/1e3*this.speed;if(this.showTrainingIndicator&&(this.trainingIndicatorTime+=i,this.trainingIndicatorObjectTime+=i,this.trainingIndicatorObjectTime>=.8&&(this.trainingIndicatorObjectIndex=(this.trainingIndicatorObjectIndex+1)%this.trainingData.length,this.trainingIndicatorObjectTime=0),this.trainingIndicatorTime>=this.trainingIndicatorDuration&&(this.showTrainingIndicator=!1)),this.updateDataFlowParticles(),this.currentObject&&(this.objectDisplayTime+=i),this.animationPhase==="forward"){if(this.forwardStep+=i,this.forwardAnimationStep+=i,this.forwardAnimationStep>=this.layerActivationDelay&&this.currentLayerIndex<this.layers.length&&!this.isProcessingLayer){const s=this.neurons[this.currentLayerIndex];for(let n of s)n.isActive=!0,n.pulseIntensity=1;this.createForwardFlowParticlesForLayer(this.currentLayerIndex),this.isProcessingLayer=!0,this.forwardAnimationStep=0}else this.isProcessingLayer&&this.forwardAnimationStep>=this.layerProcessingDelay&&(this.currentLayerIndex++,this.isProcessingLayer=!1,this.forwardAnimationStep=0);this.forwardStep>=this.phaseDuration&&this.currentLayerIndex>=this.layers.length&&(this.forwardStep=0,this.animationPhase="backward",this.backwardStep=0,this.pauseTime=0)}else this.animationPhase==="backward"?(this.backwardStep+=i,this.backwardStep>=this.phaseDuration&&(this.backwardStep=0,this.animationPhase="update",this.updateStep=0,this.pauseTime=0)):this.animationPhase==="update"?(this.updateStep+=i,this.updateStep>=this.phaseDuration&&(this.updateStep=0,this.animationPhase="pause",this.pauseTime=0)):this.animationPhase==="pause"&&(this.pauseTime+=i,this.pauseTime>=this.pauseDuration&&(this.pauseTime=0,this.animationPhase="forward",this.forwardStep=0,this.currentDataIndex=(this.currentDataIndex+1)%this.trainingData.length,this.currentDataIndex===0&&this.epoch++,this.clearVisualIndicators()));const e=this.trainingData[this.currentDataIndex];this.animationPhase==="forward"&&this.forwardStep===0?(this.forwardPropagate(e.input),this.currentObject=e,this.objectDisplayTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1):this.animationPhase==="backward"&&this.backwardStep===0?(this.backwardPropagate(e.output),this.createBackwardFlowParticles()):this.animationPhase==="update"&&this.updateStep===0&&(this.updateWeights(),this.createWeightUpdateParticles(),this.currentLoss=this.calculateLoss(e.output),this.currentAccuracy=this.calculateAccuracy(),this.lossHistory.push(this.currentLoss),this.accuracyHistory.push(this.currentAccuracy),this.lossHistory.length>100&&(this.lossHistory.shift(),this.accuracyHistory.shift())),this.updateVisualIndicators(i)}updateTesting(t){const i=t/1e3*this.speed;if(this.updateTestingParticles(),this.testingPhase==="processing"){if(this.testingStep+=i,this.forwardAnimationStep+=i,this.forwardAnimationStep>=this.layerActivationDelay&&this.currentLayerIndex<this.layers.length&&!this.isProcessingLayer){const e=this.neurons[this.currentLayerIndex];for(let s of e)s.isActive=!0,s.pulseIntensity=1;this.createTestingFlowParticlesForLayer(this.currentLayerIndex),this.isProcessingLayer=!0,this.forwardAnimationStep=0}else this.isProcessingLayer&&this.forwardAnimationStep>=this.layerProcessingDelay&&(this.currentLayerIndex++,this.isProcessingLayer=!1,this.forwardAnimationStep=0);if(this.testingStep>=this.testingDuration){const e=this.neurons[this.neurons.length-1][0].value,s=this.selectedTestObject.output[0],n=s,a=!0,h=Math.abs(e-(s===1?.8:.2)),c=Math.max(70,Math.min(95,85-h*50));this.lastTestResult={object:this.selectedTestObject.object,predicted:n,confidence:c,isCorrect:a,output:e},this.addTestResult(this.selectedTestObject.object,n,c,a),this.testingPhase="result",this.testingStep=0}}else this.testingPhase;this.updateVisualIndicators(i)}clearVisualIndicators(){for(let t of this.neurons)for(let i of t)i.isActive=!1,i.pulseIntensity=0,i.errorIntensity=0,i.weightChangeIntensity=0;for(let t of this.weights)for(let i of t)for(let e of i)e.isActive=!1,e.pulseIntensity=0;for(let t of this.biases)for(let i of t)i.isActive=!1}createForwardFlowParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=i[n].value*s[n][a].value;Math.abs(o)>.01&&this.createDataFlowParticles(i[n],e[a],o)}}}createForwardFlowParticlesForLayer(t){if(t<=0||t>=this.layers.length)return;const i=this.neurons[t-1],e=this.neurons[t],s=this.weights[t-1];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=i[n].value*s[n][a].value;Math.abs(o)>.01&&this.createDataFlowParticles(i[n],e[a],o)}}createBackwardFlowParticles(){for(let t=this.layers.length-2;t>=0;t--){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=e[a].delta*s[n][a].value;Math.abs(o)>.01&&this.createDataFlowParticles(e[a],i[n],o,!0)}}}createWeightUpdateParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=s[n][a].change;if(Math.abs(o)>.001){const h={x:i[n].x,y:i[n].y,targetX:e[a].x,targetY:e[a].y,value:o,progress:0,speed:.01*this.speed,size:Math.abs(o)*10+3};this.weightUpdateParticles.push(h)}}}}updateVisualIndicators(t){for(let i of this.neurons)for(let e of i)e.pulseIntensity>0&&(e.pulseIntensity-=t*2),e.errorIntensity>0&&(e.errorIntensity-=t*1.5),e.weightChangeIntensity>0&&(e.weightChangeIntensity-=t*1.5);for(let i of this.weights)for(let e of i)for(let s of e)s.pulseIntensity>0&&(s.pulseIntensity-=t*2);this.animationPhase==="update"&&this.updateWeightUpdateHighlighting(t)}updateWeightUpdateHighlighting(t){for(let i=0;i<this.layers.length-1;i++){const e=this.neurons[i],s=this.neurons[i+1],n=this.weights[i];for(let a=0;a<e.length;a++)for(let o=0;o<s.length;o++){const h=n[a][o],l=h.change;Math.abs(l)>.001&&(h.weightChangeIntensity||(h.weightChangeIntensity=1),e[a].weightChangeIntensity=Math.max(e[a].weightChangeIntensity||0,.8),s[o].weightChangeIntensity=Math.max(s[o].weightChangeIntensity||0,.8),h.weightChangeIntensity-=t*1.5,e[a].weightChangeIntensity-=t*1.5,s[o].weightChangeIntensity-=t*1.5)}}}drawConnections(){for(let t=0;t<this.neurons.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let n=0;n<i.length;n++)for(let a=0;a<e.length;a++){const o=s[n][a],h=Math.abs(o.value),c=Math.min(h/2,1);o.value>0;let d=0;if(o.isActive&&(d=o.pulseIntensity*.3),this.animationPhase==="forward"&&o.isActive){const r=Date.now()*.005;d+=Math.sin(r)*.1}let x=0;this.animationPhase==="update"&&o.weightChangeIntensity>0&&(x=o.weightChangeIntensity*.5),this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(${o.value>0?"52, 152, 219":"231, 76, 60"}, ${c+d+x})`,this.ctx.lineWidth=Math.max(1,h*3+d*5+x*8),this.ctx.moveTo(i[n].x,i[n].y),this.ctx.lineTo(e[a].x,e[a].y),this.ctx.stroke(),this.animationPhase==="update"&&o.weightChangeIntensity>.1&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${o.weightChangeIntensity*.8})`,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.moveTo(i[n].x,i[n].y),this.ctx.lineTo(e[a].x,e[a].y),this.ctx.stroke(),this.ctx.setLineDash([]))}}}drawNeurons(){for(let t=0;t<this.neurons.length;t++){const i=this.neurons[t];for(let e=0;e<i.length;e++){const s=i[e],n=s.value;this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(s.x+2,s.y+2,this.neuronRadius,0,Math.PI*2),this.ctx.fill();const a=this.ctx.createRadialGradient(s.x-this.neuronRadius*.3,s.y-this.neuronRadius*.3,0,s.x,s.y,this.neuronRadius),o=n<.5?210:30,h=80,l=50+n*20;if(a.addColorStop(0,`hsl(${o}, ${h}%, ${l+10}%)`),a.addColorStop(.7,`hsl(${o}, ${h}%, ${l}%)`),a.addColorStop(1,`hsl(${o}, ${h}%, ${l-10}%)`),this.ctx.beginPath(),this.ctx.fillStyle=a,this.ctx.arc(s.x,s.y,this.neuronRadius,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(s.x-this.neuronRadius*.3,s.y-this.neuronRadius*.3,this.neuronRadius*.5,0,Math.PI*2),this.ctx.fill(),s.isActive&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(255, 255, 255, ${s.pulseIntensity*.8})`,this.ctx.lineWidth=3,this.ctx.arc(s.x,s.y,this.neuronRadius+5+s.pulseIntensity*10,0,Math.PI*2),this.ctx.stroke()),s.errorIntensity>.01&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.errorIntensity})`,this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius+8,0,Math.PI*2),this.ctx.stroke()),this.animationPhase==="update"&&s.weightChangeIntensity>.1){this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.weightChangeIntensity*.9})`,this.ctx.lineWidth=4,this.ctx.arc(s.x,s.y,this.neuronRadius+12,0,Math.PI*2),this.ctx.stroke();const c=Math.sin(Date.now()*.01)*3;this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.weightChangeIntensity*.4})`,this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius+15+c,0,Math.PI*2),this.ctx.stroke()}this.ctx.beginPath(),this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 12px Inter",this.ctx.textAlign="center",this.ctx.fillText(n.toFixed(2),s.x,s.y+4)}}}drawDataFlowParticles(){for(const t of this.dataFlowParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(52, 152, 219, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}for(const t of this.errorFlowParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(231, 76, 60, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}for(const t of this.weightUpdateParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(243, 156, 18, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}}drawGradients(){for(let t=0;t<this.neurons.length;t++){const i=this.neurons[t];for(let e=0;e<i.length;e++){const s=i[e],n=s.delta;Math.abs(n)>.01&&(this.ctx.beginPath(),this.ctx.strokeStyle=n>0?"#2ECC71":"#E74C3C",this.ctx.lineWidth=3,this.ctx.arc(s.x,s.y,this.neuronRadius+5,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle=n>0?"#2ECC71":"#E74C3C",this.ctx.font="bold 10px Inter",this.ctx.textAlign="center",this.ctx.fillText(n.toFixed(3),s.x,s.y-this.neuronRadius-10))}}}drawPhaseIndicator(){const t=this.ctx.canvas.width-200,i=20;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(t,i,180,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(t,i,180,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Current Phase:",t+15,i+25),this.ctx.font="14px Inter",this.ctx.fillStyle="#FFFFFF";let e="",s="#4ECDC4",n="";switch(this.animationPhase){case"forward":e="Forward Pass",s="#4ECDC4",n="Processing input → output";break;case"backward":e="Backward Pass",s="#E74C3C",n="Calculating error gradients";break;case"update":e="Weight Update",s="#F39C12",n="Adjusting connections";break;case"pause":e="Pause",s="#95A5A6",n="Preparing next example";break}this.ctx.fillStyle=s,this.ctx.font="bold 16px Inter",this.ctx.fillText(e,t+15,i+50),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Inter",this.ctx.fillText(n,t+15,i+70);const a=t+15,o=i+90,h=150,l=8;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(a,o,h,l);let c=0;this.animationPhase==="forward"?c=this.forwardStep/this.phaseDuration:this.animationPhase==="backward"?c=this.backwardStep/this.phaseDuration:this.animationPhase==="update"?c=this.updateStep/this.phaseDuration:this.animationPhase==="pause"&&(c=this.pauseTime/this.pauseDuration),this.ctx.fillStyle=s,this.ctx.fillRect(a,o,h*c,l)}drawTechnicalDetails(){const t=this.ctx.canvas.width-250,i=this.ctx.canvas.height-140;this.ctx.fillStyle="rgba(26, 26, 46, 0.8)",this.ctx.fillRect(t,i,230,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,230,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 12px Inter",this.ctx.textAlign="left",this.ctx.fillText("Technical Details:",t+10,i+20),this.ctx.font="11px Inter",this.ctx.fillStyle="#FFFFFF";let e=i+35;const s=this.trainingData[this.currentDataIndex],n=this.neurons[this.neurons.length-1][0].value,o=s.output[0]-n;switch(this.animationPhase){case"forward":this.ctx.fillText(`Input: [${s.input.join(", ")}] → Output: [${n.toFixed(3)}]`,t+10,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("Forward:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("z = Σ(w×x) + b",t+10,e),e+=12,this.ctx.fillText("a = σ(z)",t+10,e);break;case"backward":this.ctx.fillText(`Error: ${o.toFixed(3)}`,t+10,e),e+=12,this.ctx.fillText(`Output: [${n.toFixed(3)}]`,t+10,e),e+=15,this.ctx.fillStyle="#E74C3C",this.ctx.fillText("Backward:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("δ = error × σ'(output)",t+10,e),e+=12,this.ctx.fillText(`δ = ${(o*this.sigmoidDerivative(n)).toFixed(3)}`,t+10,e);break;case"update":this.ctx.fillText(`Learning Rate: ${this.learningRate}`,t+10,e),e+=12,this.ctx.fillText(`Error: ${o.toFixed(3)}`,t+10,e),e+=15,this.ctx.fillStyle="#F39C12",this.ctx.fillText("Update:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Δw = α × δ × input",t+10,e),e+=12,this.ctx.fillText("w = w + Δw",t+10,e);break;case"pause":this.ctx.fillText(`Epoch: ${this.epoch}`,t+10,e),e+=12,this.ctx.fillText(`Loss: ${this.currentLoss.toFixed(4)}`,t+10,e),e+=12,this.ctx.fillText(`Accuracy: ${(this.currentAccuracy*100).toFixed(1)}%`,t+10,e),e+=15,this.ctx.fillStyle="#95A5A6",this.ctx.fillText("Preparing next example...",t+10,e);break}}drawTrainingInfo(){this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,20,280,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,20,280,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Training Status",35,45),this.ctx.font="13px Inter",this.ctx.fillStyle="#FFFFFF";let e=65;this.ctx.fillText(`Epoch: ${this.epoch} | Loss: ${this.currentLoss.toFixed(4)}`,35,e),e+=18,this.ctx.fillText(`Accuracy: ${(this.currentAccuracy*100).toFixed(1)}% | LR: ${this.learningRate}`,35,e),e+=25;const s=this.trainingData[this.currentDataIndex];this.ctx.fillStyle="#FFD700",this.ctx.font="bold 13px Inter",this.ctx.fillText(`${s.object.toUpperCase()}: [${s.input.join(", ")}]`,35,e),e+=18;const n=this.neurons[this.neurons.length-1][0].value,a=n>.5?1:0,o=a===s.output[0];this.ctx.fillStyle=o?"#2ECC71":"#E74C3C",this.ctx.fillText(`→ ${a===1?"COMPLEX":"SIMPLE"} (${o?"✓":"✗"}) [${n.toFixed(3)}]`,35,e)}drawNetworkLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("Neural Network Training",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText("σ(x) = 1/(1 + e^(-x))",this.ctx.canvas.width/2,50),this.ctx.fillText("δ = (target - output) × σ'(output)",this.ctx.canvas.width/2,70),this.ctx.fillText("w = w + α × δ × input",this.ctx.canvas.width/2,90),this.ctx.shadowBlur=0,this.ctx.restore()}handleCanvasClick(t,i){if(!this.isTestingMode)return;const e=this.ctx.canvas.width-80,s=this.ctx.canvas.height/2-120,n=["circle","square","triangle","star"];for(let a=0;a<n.length;a++){const o=e,h=s+a*90,l=30;if(t>=o-l&&t<=o+l&&i>=h-l&&i<=h+l){this.selectTestObject(n[a]);break}}}getStats(){return{epoch:this.epoch,currentLoss:this.currentLoss,currentAccuracy:this.currentAccuracy,learningRate:this.learningRate,speed:this.speed,trainingDataIndex:this.currentDataIndex,animationPhase:this.animationPhase,isTestingMode:this.isTestingMode,testingPhase:this.testingPhase}}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawNetwork(),this.drawDataFlowParticles(),this.isTestingMode&&this.drawTestingParticles(),this.showLoss&&!this.isTestingMode&&this.drawTrainingInfo(),this.isTestingMode&&this.drawTestingInfo(),this.drawPhaseIndicator(),this.drawTechnicalDetails(),this.drawNetworkLabels(),this.isTestingMode&&this.drawObjectSelectionInterface(),this.showTrainingIndicator&&this.drawTrainingIndicator()}drawObjectContext(){const i=this.ctx.canvas.height-100;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,i,250,80),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,i,250,80),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 14px Inter",this.ctx.textAlign="left",this.ctx.fillText("Training Object:",35,i+25),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter",this.ctx.fillText(this.currentObject.object.toUpperCase(),35,i+45),this.ctx.fillStyle="#FFFFFF",this.ctx.font="11px Inter",this.ctx.fillText(this.currentObject.description,35,i+65),this.drawObjectRepresentation(220,i+40)}drawObjectRepresentation(t,i,e=null){this.ctx.save();const s=e||(this.currentObject?this.currentObject.object:null);if(!s){this.ctx.restore();return}switch(s){case"circle":this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.arc(t,i,20,0,Math.PI*2),this.ctx.fill();break;case"square":this.ctx.fillStyle="#FF6B6B",this.ctx.fillRect(t-15,i-15,30,30);break;case"triangle":this.ctx.beginPath(),this.ctx.fillStyle="#2ECC71",this.ctx.moveTo(t,i-15),this.ctx.lineTo(t-15,i+15),this.ctx.lineTo(t+15,i+15),this.ctx.closePath(),this.ctx.fill();break;case"star":this.ctx.beginPath(),this.ctx.fillStyle="#F39C12";for(let n=0;n<5;n++){const a=n*2*Math.PI/5-Math.PI/2,o=20,h=10,l=t+Math.cos(a)*o,c=i+Math.sin(a)*o,d=t+Math.cos(a+Math.PI/5)*h,x=i+Math.sin(a+Math.PI/5)*h;n===0?this.ctx.moveTo(l,c):this.ctx.lineTo(l,c),this.ctx.lineTo(d,x)}this.ctx.closePath(),this.ctx.fill();break}this.ctx.restore()}drawNetwork(){this.showWeights&&this.drawConnections(),this.drawNeurons(),this.showGradients&&this.drawGradients()}drawTestingInfo(){const i=this.ctx.canvas.height-180;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,i,300,160),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,i,300,160),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Network Testing Mode",35,i+25),this.ctx.font="13px Inter",this.ctx.fillStyle="#FFFFFF";let e=i+45;if(!this.isTrainingComplete){this.ctx.fillStyle="#FFD700",this.ctx.fillText("Training in Progress...",35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Please wait for training",35,e),e+=18,this.ctx.fillText("to complete before",35,e),e+=18,this.ctx.fillText("testing the network",35,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 11px Inter",this.ctx.fillText("Training the neural network...",35,e);return}if(this.testingPhase==="select")this.ctx.fillText("Object Recognition Testing",35,e),e+=18,this.ctx.fillText("Click on an object to test",35,e),e+=18,this.ctx.fillText("the neural network's",35,e),e+=18,this.ctx.fillText("classification ability",35,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 11px Inter",this.ctx.fillText("Features: [symmetry, edges]",35,e),e+=12,this.ctx.font="10px Inter",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("• Symmetry: 0-1 (high = simple)",35,e),e+=10,this.ctx.fillText("• Edges: 0-1 (high = complex)",35,e);else if(this.testingPhase==="processing")this.ctx.fillText("Analyzing Object...",35,e),e+=18,this.ctx.fillText("Network is processing",35,e),e+=18,this.ctx.fillText("input features and",35,e),e+=18,this.ctx.fillText("generating prediction",35,e);else if(this.testingPhase==="result"&&this.lastTestResult){const{object:s,predicted:n,confidence:a,isCorrect:o,output:h}=this.lastTestResult;this.ctx.fillText("Test Results:",35,e),e+=18,this.ctx.fillStyle="#FFD700",this.ctx.fillText(`${s.toUpperCase()} → ${n===1?"COMPLEX":"SIMPLE"}`,35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Output: ${h.toFixed(3)} | Confidence: ${a.toFixed(1)}%`,35,e),e+=18,this.ctx.fillStyle=o?"#2ECC71":"#E74C3C",this.ctx.fillText(`${o?"✓ CORRECT":"✗ INCORRECT"}`,35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Click another object to test",35,e),this.drawTestResultsSummary(340,i,200,160)}}drawObjectSelectionInterface(){const t=this.ctx.canvas.width-80,i=this.ctx.canvas.height/2-120,e=["circle","square","triangle","star"],s=50,n=this.isTrainingComplete;for(let a=0;a<e.length;a++){const o=t,h=i+a*90,l=e[a],c=this.selectedTestObject&&this.selectedTestObject.object===l;c?(this.ctx.fillStyle="rgba(255, 215, 0, 0.3)",this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=3):n?(this.ctx.fillStyle="rgba(78, 205, 196, 0.15)",this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2):(this.ctx.fillStyle="rgba(128, 128, 128, 0.1)",this.ctx.strokeStyle="#666666",this.ctx.lineWidth=1),this.ctx.fillRect(o-25,h-25,s,s),this.ctx.strokeRect(o-25,h-25,s,s),n||(this.ctx.globalAlpha=.3),this.drawObjectRepresentation(o,h,l),this.ctx.globalAlpha=1,c?(this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter"):n?(this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 11px Inter"):(this.ctx.fillStyle="#666666",this.ctx.font="bold 11px Inter"),this.ctx.textAlign="center",this.ctx.fillText(l.toUpperCase(),o,h+35)}}drawSparklineChart(t,i,e,s){if(this.lossHistory.length<2)return;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(t,i,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,e,s);const n=this.lossHistory.slice(-20),a=this.accuracyHistory.slice(-20);if(n.length<2)return;const o=Math.max(...n),h=Math.min(...n),l=Math.max(...a),c=Math.min(...a);this.ctx.beginPath(),this.ctx.strokeStyle="#e74c3c",this.ctx.lineWidth=2;for(let d=0;d<n.length;d++){const x=t+d/(n.length-1)*e,r=(n[d]-h)/(o-h),g=i+s-r*s;d===0?this.ctx.moveTo(x,g):this.ctx.lineTo(x,g)}this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#27ae60",this.ctx.lineWidth=2;for(let d=0;d<a.length;d++){const x=t+d/(a.length-1)*e,r=(a[d]-c)/(l-c),g=i+s-r*s;d===0?this.ctx.moveTo(x,g):this.ctx.lineTo(x,g)}this.ctx.stroke(),this.ctx.fillStyle="#e74c3c",this.ctx.font="bold 10px Inter",this.ctx.textAlign="left",this.ctx.fillText("Loss",t+5,i+12),this.ctx.fillStyle="#27ae60",this.ctx.fillText("Accuracy",t+5,i+25)}drawTestResultsSummary(t,i,e,s){if(this.testResults.length===0)return;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(t,i,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(t,i,e,s),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 14px Inter",this.ctx.textAlign="left",this.ctx.fillText("Test History:",t+10,i+20);const n=this.testResults.length,a=this.testResults.filter(c=>c.isCorrect).length,o=n>0?(a/n*100).toFixed(1):"0.0";this.ctx.font="12px Inter",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Total: ${n} | Correct: ${a}`,t+10,i+40),this.ctx.fillText(`Accuracy: ${o}%`,t+10,i+55);const h=this.testResults.slice(-5);let l=i+75;this.ctx.font="bold 11px Inter",this.ctx.fillText("Recent:",t+10,l),l+=15,this.ctx.font="10px Inter";for(const c of h){const d=c.isCorrect?"✓":"✗",x=c.isCorrect?"#2ECC71":"#E74C3C";this.ctx.fillStyle=x,this.ctx.fillText(`${c.object.toUpperCase()}: ${c.predicted===1?"COMPLEX":"SIMPLE"} ${d}`,t+10,l),l+=12}}drawTestingParticles(){for(const t of this.testingParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 215, 0, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}}drawTrainingIndicator(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);const e=500,s=200,n=t-e/2,a=i-s/2;this.ctx.fillStyle="rgba(26, 26, 46, 0.95)",this.ctx.fillRect(n,a,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=3,this.ctx.strokeRect(n,a,e,s),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.fillText("Initializing Neural Network",t,a+35);const o=this.trainingData[this.trainingIndicatorObjectIndex];this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter",this.ctx.fillText(`Training on: ${o.object.toUpperCase()}`,t,a+60),this.ctx.fillStyle="#FFFFFF",this.ctx.font="13px Inter",this.ctx.fillText(o.description,t,a+85),this.ctx.fillStyle="#4ECDC4",this.ctx.font="12px Inter",this.ctx.fillText(`Features: [${o.input[0].toFixed(1)}, ${o.input[1].toFixed(1)}]`,t,a+105),this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`Expected: ${o.output[0]===0?"Simple":"Complex"}`,t,a+125),this.drawObjectRepresentation(t+180,a+80,o.object);const h=this.trainingIndicatorTime/this.trainingIndicatorDuration,l=400,c=8,d=t-l/2,x=a+150;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(d,x,l,c),this.ctx.fillStyle="#4ECDC4",this.ctx.fillRect(d,x,l*h,c),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Inter",this.ctx.fillText(`${Math.round(h*100)}%`,t,x+25)}}class vt{constructor(t){this.ctx=t,this.canvas=t.canvas,this.codePanel={x:50,y:50,width:400,height:300},this.stackPanel={x:500,y:50,width:300,height:300},this.heapPanel={x:50,y:400,width:750,height:200},this.outputPanel={x:500,y:400,width:300,height:200},this.program={name:"Image Processing Pipeline",functions:[{name:"main()",lines:["function main() {","  let imageData = loadImage('photo.jpg');","  let processedData = processImage(imageData);","  saveResult(processedData);","  return 0;","}"],variables:[]},{name:"loadImage()",lines:["function loadImage(filename) {","  let fileBuffer = malloc(1024);","  readFile(filename, fileBuffer);","  let imageData = malloc(2048);","  decodeImage(fileBuffer, imageData);","  free(fileBuffer);","  return imageData;","}"],variables:[]},{name:"processImage()",lines:["function processImage(data) {","  let tempBuffer = malloc(2048);","  applyFilter(data, tempBuffer);","  let result = malloc(2048);","  compressImage(tempBuffer, result);","  free(tempBuffer);","  return result;","}"],variables:[]},{name:"saveResult()",lines:["function saveResult(data) {","  let outputFile = malloc(512);","  writeFile('output.jpg', data);","  free(outputFile);","  free(data);","  return;","}"],variables:[]},{name:"readFile()",lines:["function readFile(filename, buffer) {","  // Simulate file reading","  return buffer;","}"],variables:[]},{name:"decodeImage()",lines:["function decodeImage(buffer, imageData) {","  // Simulate image decoding","  return imageData;","}"],variables:[]},{name:"writeFile()",lines:["function writeFile(filename, data) {","  // Simulate file writing","  return true;","}"],variables:[]},{name:"applyFilter()",lines:["function applyFilter(data, tempBuffer) {","  // Simulate filter application","  return tempBuffer;","}"],variables:[]},{name:"compressImage()",lines:["function compressImage(tempBuffer, result) {","  // Simulate image compression","  return result;","}"],variables:[]}]},this.currentFunction=0,this.currentLine=0,this.executionStep=0,this.programCounter=0,this.callStack=[],this.heapBlocks=[],this.freeBlocks=[],this.output=[],this.nextHeapAddress=4096,this.nextStackAddress=8192,this.memoryData=new Map,this.variableAddresses=new Map,this.animationState="idle",this.animationTime=0,this.executionSpeed=1,this.isAutoRunning=!0,this.animationSpeed=1,this.highlightedLine=-1,this.executionPointer={x:0,y:0},this.particles=[],this.memoryAccesses=[],this.dataFlowParticles=[],this.addressHighlights=[],this.allocationEffects=[],this.deallocationEffects=[],this.memoryFlowLines=[],this.stackFrameAnimations=[],this.variableConnections=[],this.executionTrail=[],this.memoryFragmentation=[],this.performanceMetrics={totalCycles:0,memoryEfficiency:0,fragmentationLevel:0,averageAccessTime:0},this.totalAllocations=0,this.totalDeallocations=0,this.memoryLeaks=0,this.currentMemoryUsage=0,this.memoryAccessCount=0,this.showStats=!1,this.showOutput=!1,this.gcState={isRunning:!1,phase:"idle",markedBlocks:new Set,gcParticles:[],phaseTime:0,phaseDuration:2},this.initializeExecution(),this.startExecution(),setTimeout(()=>{this.isAutoRunning&&this.animationState==="idle"&&this.executeNextStep()},500)}initializeExecution(){this.heapBlocks=[],this.freeBlocks=[{address:4096,size:8192,x:this.heapPanel.x+20,y:this.heapPanel.y+20,width:this.heapPanel.width-40,height:40}],this.callStack=[],this.output=[],this.memoryData.clear(),this.variableAddresses.clear(),this.currentFunction=0,this.currentLine=0,this.executionStep=0,this.programCounter=0,this.highlightedLine=-1}startExecution(){this.isAutoRunning=!0,this.animationState="idle",this.executionStep=0,setTimeout(()=>{this.isAutoRunning&&this.animationState==="idle"&&this.executeNextStep()},1e3)}setAnimationSpeed(t){this.animationSpeed=Math.max(.1,Math.min(3,t))}setShowStats(t){this.showStats=t}setShowOutput(t){this.showOutput=t}executeNextStep(){if(this.animationState!=="idle")return;if(this.currentFunction<0||this.currentFunction>=this.program.functions.length){this.output.push(`❌ Invalid function index: ${this.currentFunction}`);return}const t=this.program.functions[this.currentFunction];if(this.currentLine<0||this.currentLine>=t.lines.length){this.output.push(`❌ Invalid line index: ${this.currentLine}`);return}const i=t.lines[this.currentLine];if(!i){this.output.push(`🔚 Function ${this.program.functions[this.currentFunction].name} finished`),this.returnFromFunction();return}if(this.currentFunction===0&&this.currentLine>=t.lines.length&&this.callStack.length===0){this.output.push("✅ Program execution complete"),this.isAutoRunning=!1,this.animationState="idle";for(let e=0;e<50;e++)this.particles.push({x:this.canvas.width/2,y:this.canvas.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:3,color:"#FFD700",type:"completion"});return}this.animationState="executing",this.animationTime=0,this.highlightedLine=this.currentLine,setTimeout(()=>{i.trim().startsWith("//")||i.trim().startsWith("/*")||i.trim().startsWith("*")?this.currentLine++:i.includes("function")&&i.includes("{")?this.currentLine++:i.includes("(")&&i.includes(")")&&!i.includes("malloc")&&!i.includes("free")&&!i.includes("function")&&!i.trim().startsWith("//")?this.callFunction(i):i.includes("malloc")?(this.allocateMemory(i),this.currentLine++):i.includes("free")?(this.deallocateMemory(i),this.currentLine++):i.includes("return")?this.returnFromFunction():i.includes("readFile")||i.includes("writeFile")||i.includes("decodeImage")||i.includes("applyFilter")||i.includes("compressImage")?(this.accessMemory(i),this.currentLine++):(this.executeRegularLine(i),this.currentLine++),this.executionStep++,setTimeout(()=>{this.animationState="idle"},300/this.animationSpeed)},200/this.animationSpeed)}callFunction(t){const i=t.match(/(\w+)\(/);if(i){const e=i[1];let s=-1;s=this.program.functions.findIndex(n=>n.name===e+"()"),s===-1&&(s=this.program.functions.findIndex(n=>n.name===e)),s===-1&&(s=this.program.functions.findIndex(n=>n.name.replace("()","")===e)),s!==-1?(this.callStack.push({functionIndex:this.currentFunction,lineIndex:this.currentLine,returnAddress:this.programCounter,variables:new Map(this.variableAddresses)}),this.currentFunction=s,this.currentLine=0,this.programCounter=s*100,this.highlightedLine=0,this.output.push(`📞 Calling ${e}()`),this.showStackFrameCreation()):this.output.push(`⚠️ Function not found: ${e}`)}}allocateMemory(t){const i=t.match(/malloc\((\d+)\)/);if(i){const e=parseInt(i[1]),s=this.extractVariableName(t);this.output.push(`📦 Allocating ${e} bytes for ${s}`),this.allocateMemoryBlock(e,s,t)}else{const e=t.match(/malloc\s*\(\s*(\d+)\s*\)/),s=t.match(/malloc\((\d+)\)/);if(e){const n=parseInt(e[1]),a=this.extractVariableName(t);this.allocateMemoryBlock(n,a,t)}else if(s){const n=parseInt(s[1]),a=this.extractVariableName(t);this.allocateMemoryBlock(n,a,t)}}}deallocateMemory(t){const i=t.match(/free\((\w+)\)/);if(i){const e=i[1];this.output.push(`🗑️ Freeing memory for ${e}`),this.deallocateMemoryBlock(e,t)}else{const e=t.match(/free\s*\(\s*(\w+)\s*\)/),s=t.match(/free\((\w+)\)/);if(e){const n=e[1];this.deallocateMemoryBlock(n,t)}else if(s){const n=s[1];this.deallocateMemoryBlock(n,t)}}}accessMemory(t){const i=this.extractVariableName(t),e=this.variableAddresses.get(i);e&&(this.showMemoryAccess(e,i,t),this.output.push(`🔍 Accessing memory at 0x${e.toString(16)} for ${i}`),this.memoryAccessCount++)}returnFromFunction(){if(this.callStack.length>0){const t=this.callStack.pop();this.currentFunction=t.functionIndex,this.currentLine=t.lineIndex,this.programCounter=t.returnAddress,this.variableAddresses=new Map(t.variables);const i=this.program.functions[t.functionIndex].lines[t.lineIndex];if(i&&i.includes("=")&&i.includes("(")){const s=i.match(/(?:let\s+)?(\w+)\s*=\s*\w+\(/);if(s){const n=s[1],a=this.nextHeapAddress;this.nextHeapAddress+=256,this.variableAddresses.set(n,a),this.output.push(`📝 Return value assigned to ${n}`)}}this.output.push("↩️ Returning from function"),this.showStackFrameRemoval(),this.currentLine++,this.highlightedLine=this.currentLine;const e=this.program.functions[this.currentFunction];if(this.output.push(`🔍 Debug: currentFunction=${this.currentFunction}, currentLine=${this.currentLine}, lines.length=${e.lines.length}`),this.currentFunction===0&&this.currentLine>=e.lines.length){this.output.push("✅ Program execution complete"),this.isAutoRunning=!1,this.animationState="idle";for(let s=0;s<50;s++)this.particles.push({x:this.canvas.width/2,y:this.canvas.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:3,color:"#FFD700",type:"completion"});return}}else this.output.push("✅ Program execution complete"),this.isAutoRunning=!1}executeRegularLine(t){}allocateMemoryBlock(t,i,e){const s=this.findBestFitBlock(t);if(!s){this.output.push("❌ Out of memory!");return}const n=this.freeBlocks.findIndex(g=>g.address===s.address&&g.size===s.size);n!==-1&&this.freeBlocks.splice(n,1);const a=this.heapPanel.width-40,o=this.heapPanel.height-40,l=t/8192,c=Math.max(50,Math.min(a*.2,a*l*.6)),d=Math.max(35,Math.min(o*.4,o*l*1.2)),x={address:s.address,size:t,name:i,data:this.generateRandomData(t),isAllocated:!0,width:c,height:d},r=this.findNonOverlappingPosition(x,s);x.x=r.x,x.y=r.y,this.heapBlocks.push(x),this.totalAllocations++,this.currentMemoryUsage+=t,this.memoryData.set(x.address,x.data),this.variableAddresses.set(i,x.address),this.updateFreeBlocks(),this.addAllocationEffect(x),this.output.push(`📦 Allocated ${t} bytes at 0x${x.address.toString(16)} for ${i}`),this.showAddressHighlight(x.address,"allocation")}deallocateMemoryBlock(t,i){const e=this.variableAddresses.get(t),s=this.heapBlocks.findIndex(n=>n.address===e);if(s!==-1){const n=this.heapBlocks[s];this.addDeallocationEffect(n),this.createMemoryClearingParticles(n),this.heapBlocks.splice(s,1),this.totalDeallocations++,this.currentMemoryUsage-=n.size,this.memoryData.delete(n.address),this.variableAddresses.delete(t),this.updateFreeBlocks(),this.output.push(`🗑️ Freed memory at 0x${n.address.toString(16)} for ${t}`),this.showAddressHighlight(n.address,"deallocation")}else this.output.push(`⚠️ Attempted to free unallocated variable: ${t}`),this.memoryLeaks++}showMemoryAccess(t,i,e){this.memoryAccesses.push({address:t,varName:i,operation:e,time:0,duration:1.5}),this.createDataFlowParticles(t,i)}showAddressHighlight(t,i){this.addressHighlights.push({address:t,type:i,time:0,duration:2})}showStackFrameCreation(){for(let t=0;t<10;t++)this.particles.push({x:this.stackPanel.x+this.stackPanel.width/2,y:this.stackPanel.y+this.stackPanel.height,vx:(Math.random()-.5)*3,vy:-Math.random()*2,life:1,color:"#3498db",type:"stack_frame"})}showStackFrameRemoval(){for(let t=0;t<8;t++)this.particles.push({x:this.stackPanel.x+this.stackPanel.width/2,y:this.stackPanel.y+50,vx:(Math.random()-.5)*4,vy:Math.random()*3,life:1,color:"#F39C12",type:"stack_removal"})}createDataFlowParticles(t,i){const e=this.heapBlocks.find(s=>s.address===t);if(e)for(let s=0;s<15;s++)this.dataFlowParticles.push({x:e.x+e.width/2,y:e.y+e.height/2,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,color:"#FFD700",type:"data_flow"})}createMemoryClearingParticles(t){for(let i=0;i<20;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1.5,color:"#FF6B6B",type:"memory_clear"});for(let i=0;i<10;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*2,vy:-Math.random()*3-1,life:2,color:"#FFD700",type:"data_clear"})}extractVariableName(t){let i=t.match(/let\s+(\w+)\s*=/);return i?i[1]:(i=t.match(/malloc\((\d+)\)/),i?`malloc_${i[1]}`:"unknown")}findBestFitBlock(t){for(const i of this.freeBlocks)if(i.size>=t)return i;return null}findNonOverlappingPosition(t,i){const e={x:this.heapPanel.x+20,y:this.heapPanel.y+20,width:this.heapPanel.width-40,height:this.heapPanel.height-40},s=Math.max(t.width,t.height)+10,n=Math.floor(e.width/s),a=Math.floor(e.height/s);for(let h=0;h<a;h++)for(let l=0;l<n;l++){const c=e.x+l*s,d=e.y+h*s;let x=!1;for(const r of this.heapBlocks)if(this.blocksOverlap({x:c,y:d,width:t.width,height:t.height},r)){x=!0;break}if(!x)return{x:c,y:d}}const o=30;for(let h=0;h<o;h++){const l=e.x+Math.random()*(e.width-t.width),c=e.y+Math.random()*(e.height-t.height);let d=!1;for(const x of this.heapBlocks)if(this.blocksOverlap({x:l,y:c,width:t.width,height:t.height},x)){d=!0;break}if(!d)return{x:l,y:c}}return{x:i.x+(i.width-t.width)/2,y:i.y+(i.height-t.height)/2}}blocksOverlap(t,i){return!(t.x+t.width<=i.x||i.x+i.width<=t.x||t.y+t.height<=i.y||i.y+i.height<=t.y)}updateFreeBlocks(){this.freeBlocks=[];const t=8192,i=this.heapBlocks.reduce((s,n)=>s+n.size,0),e=t-i;if(e>0){const s=this.calculateFragmentedFreeBlocks();if(this.freeBlocks.push(...s),s.length===0&&e>0){const n=this.heapBlocks.length>0?Math.max(...this.heapBlocks.map(o=>o.address+o.size)):4096,a={address:n,size:e,x:this.heapPanel.x+20+(n-4096)/t*(this.heapPanel.width-40),y:this.heapPanel.y+this.heapPanel.height-70,width:Math.max(30,e/t*(this.heapPanel.width-40)),height:50};this.freeBlocks.push(a)}}}calculateFragmentedFreeBlocks(){const t=[],e=[...this.heapBlocks].sort((n,a)=>n.address-a.address);let s=4096;for(const n of e){if(n.address>s){const a=n.address-s;if(a>=128){const o=Math.max(20,a/8192*(this.heapPanel.width-40)),h=Math.max(30,Math.min(40,o*.4));t.push({address:s,size:a,x:this.heapPanel.x+20+(s-4096)/8192*(this.heapPanel.width-40),y:this.heapPanel.y+20,width:o,height:h})}}s=n.address+n.size}if(s<12288){const n=12288-s;if(n>=128){const a=Math.max(20,n/8192*(this.heapPanel.width-40)),o=Math.max(30,Math.min(40,a*.4));t.push({address:s,size:n,x:this.heapPanel.x+20+(s-4096)/8192*(this.heapPanel.width-40),y:this.heapPanel.y+20,width:a,height:o})}}return t}generateRandomData(t){const i=[];for(let e=0;e<t;e++)i.push(Math.floor(Math.random()*256));return i}addAllocationEffect(t){for(let i=0;i<35;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:2,color:"#4ECDC4",type:"allocation",size:Math.random()*3+2});for(let i=0;i<15;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y+t.height,vx:(Math.random()-.5)*3,vy:-Math.random()*5-3,life:2.5,color:"#4ECDC4",type:"allocation_float",spiral:Math.random()*Math.PI*2,spiralSpeed:(Math.random()-.5)*.1});this.memoryAccesses.push({address:t.address,varName:t.name,operation:"allocation",time:0,duration:2,type:"allocation",pulse:0}),this.allocationEffects=this.allocationEffects||[],this.allocationEffects.push({block:t,time:0,duration:1.2,type:"grow",originalWidth:t.width*.3,originalHeight:t.height*.3}),this.variableConnections.push({from:{x:this.codePanel.x+350,y:this.codePanel.y+70},to:{x:t.x+t.width/2,y:t.y+t.height/2},time:0,duration:1.5,varName:t.name}),this.performanceMetrics.totalCycles++,this.performanceMetrics.memoryEfficiency=this.currentMemoryUsage/8192*100}addDeallocationEffect(t){for(let i=0;i<40;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:2,color:"#FF6B6B",type:"deallocation",size:Math.random()*4+3});for(let i=0;i<20;i++){const e=Math.random()*Math.PI*2,s=Math.random()*50+20;this.particles.push({x:t.x+t.width/2+Math.cos(e)*s,y:t.y+t.height/2+Math.sin(e)*s,vx:(t.x+t.width/2-(t.x+t.width/2+Math.cos(e)*s))*.1,vy:(t.y+t.height/2-(t.y+t.height/2+Math.sin(e)*s))*.1,life:1.5,color:"#FF6B6B",type:"deallocation_implosion"})}for(let i=0;i<20;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y,vx:(Math.random()-.5)*4,vy:Math.random()*6+3,life:2.5,color:"#FF6B6B",type:"deallocation_fall",gravity:.2});this.memoryAccesses.push({address:t.address,varName:t.name,operation:"deallocation",time:0,duration:2,type:"deallocation",fade:1}),this.deallocationEffects=this.deallocationEffects||[],this.deallocationEffects.push({block:t,time:0,duration:1.5,type:"shrink",originalWidth:t.width,originalHeight:t.height}),this.memoryFragmentation.push({x:t.x+t.width/2,y:t.y+t.height/2,time:0,duration:3,size:t.width*t.height}),this.performanceMetrics.fragmentationLevel=this.calculateFragmentationLevel()}calculateFragmentationLevel(){if(this.freeBlocks.length===0)return 0;const t=this.freeBlocks.reduce((s,n)=>s+n.size,0),i=Math.max(...this.freeBlocks.map(s=>s.size)),e=(t-i)/t;return Math.min(100,e*100)}runGarbageCollection(){this.gcState.isRunning||(this.gcState.isRunning=!0,this.gcState.phase="mark",this.gcState.phaseTime=0,this.gcState.markedBlocks.clear(),this.gcState.gcParticles=[],this.output.push("🗑️ Starting Garbage Collection..."),this.markReachableBlocks())}markReachableBlocks(){for(const[t,i]of this.variableAddresses){const e=this.heapBlocks.find(s=>s.address===i);e&&(this.gcState.markedBlocks.add(e.address),this.createGCMarkEffect(e))}for(const t of this.heapBlocks)this.gcState.markedBlocks.has(t.address)?this.createGCMarkEffect(t):this.createGCPotentialUnreachableEffect(t);this.output.push(`✅ Marked ${this.gcState.markedBlocks.size} reachable blocks`)}sweepUnreachableBlocks(){const t=[];for(const i of this.heapBlocks)this.gcState.markedBlocks.has(i.address)||t.push(i);for(const i of t)this.freeUnreachableBlock(i);this.output.push(`🧹 Swept ${t.length} unreachable blocks`)}freeUnreachableBlock(t){const i=this.heapBlocks.findIndex(e=>e.address===t.address);i!==-1&&this.heapBlocks.splice(i,1),this.freeBlocks.push({address:t.address,size:t.size,x:t.x,y:t.y,width:t.width,height:t.height}),this.createGCDeallocationEffect(t),this.totalDeallocations++,this.currentMemoryUsage-=t.size}createGCMarkEffect(t){for(let i=0;i<8;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*60,vy:(Math.random()-.5)*60,life:2,color:"#FFD700",type:"mark"})}createGCPotentialUnreachableEffect(t){for(let i=0;i<6;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*50,vy:(Math.random()-.5)*50,life:1.5,color:"#FFA500",type:"potential_unreachable"})}createGCDeallocationEffect(t){for(let i=0;i<6;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.5,color:"#FF6B6B",type:"sweep"})}updateGarbageCollection(t){if(this.gcState.isRunning){this.gcState.phaseTime+=t;for(let i=this.gcState.gcParticles.length-1;i>=0;i--){const e=this.gcState.gcParticles[i];e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t*2,e.life<=0&&this.gcState.gcParticles.splice(i,1)}this.gcState.phase==="mark"&&this.gcState.phaseTime>=this.gcState.phaseDuration?(this.gcState.phase="sweep",this.gcState.phaseTime=0,this.sweepUnreachableBlocks()):this.gcState.phase==="sweep"&&this.gcState.phaseTime>=this.gcState.phaseDuration&&(this.gcState.isRunning=!1,this.gcState.phase="idle",this.output.push("✅ Garbage Collection Complete"))}}update(t){const i=t/1e3;this.isAutoRunning&&this.animationState==="idle"&&(this.animationTime+=i,this.animationTime>=.5/this.animationSpeed&&(this.executeNextStep(),this.animationTime=0));for(let s=this.particles.length-1;s>=0;s--){const n=this.particles[s];if(n.type==="allocation_float"&&n.spiral!==void 0&&(n.spiral+=n.spiralSpeed||.05,n.x+=Math.cos(n.spiral)*.5,n.y+=Math.sin(n.spiral)*.5),n.type==="deallocation_fall"&&n.gravity&&(n.vy+=n.gravity),n.type==="deallocation_implosion"){const a=n.vx,o=n.vy;n.x+=a,n.y+=o}else n.x+=n.vx,n.y+=n.vy;n.type!=="allocation_float"&&n.type!=="deallocation_implosion"&&(n.vy+=.1),n.life-=i*2,n.life<=0&&this.particles.splice(s,1)}for(let s=this.dataFlowParticles.length-1;s>=0;s--){const n=this.dataFlowParticles[s];n.x+=n.vx,n.y+=n.vy,n.life-=i*3,n.life<=0&&this.dataFlowParticles.splice(s,1)}for(let s=this.memoryAccesses.length-1;s>=0;s--){const n=this.memoryAccesses[s];n.time+=i,n.time>=n.duration&&this.memoryAccesses.splice(s,1)}for(let s=this.addressHighlights.length-1;s>=0;s--){const n=this.addressHighlights[s];n.time+=i,n.time>=n.duration&&this.addressHighlights.splice(s,1)}for(let s=this.allocationEffects.length-1;s>=0;s--){const n=this.allocationEffects[s];n.time+=i,n.time>=n.duration&&this.allocationEffects.splice(s,1)}for(let s=this.deallocationEffects.length-1;s>=0;s--){const n=this.deallocationEffects[s];n.time+=i,n.time>=n.duration&&this.deallocationEffects.splice(s,1)}for(let s=this.variableConnections.length-1;s>=0;s--){const n=this.variableConnections[s];n.time+=i,n.time>=n.duration&&this.variableConnections.splice(s,1)}for(let s=this.memoryFragmentation.length-1;s>=0;s--){const n=this.memoryFragmentation[s];n.time+=i,n.time>=n.duration&&this.memoryFragmentation.splice(s,1)}this.highlightedLine>=0&&this.executionTrail.push({x:this.codePanel.x+15,y:this.codePanel.y+70+this.highlightedLine*22,time:0,duration:2});for(let s=this.executionTrail.length-1;s>=0;s--)this.executionTrail[s].time+=i,this.executionTrail[s].time>=this.executionTrail[s].duration&&this.executionTrail.splice(s,1);this.executionTrail.length>20&&this.executionTrail.splice(0,this.executionTrail.length-20),this.updateGarbageCollection(i),this.performanceMetrics.totalCycles=this.executionStep,this.performanceMetrics.fragmentationLevel=this.calculateFragmentationLevel(),this.totalAllocations+this.totalDeallocations>0?this.performanceMetrics.memoryEfficiency=Math.max(0,(this.totalAllocations-this.memoryLeaks)/this.totalAllocations*100):this.performanceMetrics.memoryEfficiency=100,this.performanceMetrics.averageAccessTime=this.memoryAccessCount>0?this.executionStep/this.memoryAccessCount:0}render(){this.drawBackground(),this.drawCodePanel(),this.drawStackPanel(),this.drawHeapPanel(),this.drawOutputPanel(),this.drawExecutionPointer(),this.drawExecutionTrail(),this.drawMemoryAccesses(),this.drawAddressHighlights(),this.drawVariableConnections(),this.drawMemoryFragmentation(),this.drawParticles(),this.drawDataFlowParticles(),this.drawAllocationEffects(),this.drawGarbageCollectionEffects(),this.drawStatistics()}drawBackground(){const t=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);t.addColorStop(0,"#0a0a0a"),t.addColorStop(.3,"#1a1a2e"),t.addColorStop(.7,"#16213e"),t.addColorStop(1,"#0f3460"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="rgba(46, 204, 113, 0.08)",this.ctx.lineWidth=1;const i=60,e=this.animationTime*15%i;for(let h=-e;h<this.canvas.height+i;h+=i*1.5)for(let l=-e;l<this.canvas.width+i;l+=i*1.3){this.ctx.beginPath();for(let c=0;c<6;c++){const d=c*Math.PI/3,x=l+i*.5*Math.cos(d),r=h+i*.5*Math.sin(d);c===0?this.ctx.moveTo(x,r):this.ctx.lineTo(x,r)}this.ctx.closePath(),this.ctx.stroke()}for(let h=0;h<20;h++){const l=h*137.5%this.canvas.width,c=(h*73.3+this.animationTime*10)%this.canvas.height,d=.3+.2*Math.sin(this.animationTime*2+h);this.ctx.fillStyle=`rgba(46, 204, 113, ${d})`,this.ctx.beginPath(),this.ctx.arc(l,c,1,0,Math.PI*2),this.ctx.fill()}const s=this.canvas.width/2,n=this.canvas.height/2,a=Math.min(this.canvas.width,this.canvas.height)*.8,o=this.ctx.createRadialGradient(s,n,0,s,n,a);o.addColorStop(0,"rgba(46, 204, 113, 0.05)"),o.addColorStop(1,"rgba(46, 204, 113, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawCodePanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.4)",this.ctx.fillRect(this.codePanel.x+4,this.codePanel.y+4,this.codePanel.width,this.codePanel.height);const t=this.ctx.createLinearGradient(this.codePanel.x,this.codePanel.y,this.codePanel.x,this.codePanel.y+this.codePanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.98)"),t.addColorStop(.5,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.92)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.codePanel.x,this.codePanel.y,this.codePanel.width,this.codePanel.height),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=12,this.ctx.lineWidth=3;const i=this.ctx.createLinearGradient(this.codePanel.x,this.codePanel.y,this.codePanel.x+this.codePanel.width,this.codePanel.y+this.codePanel.height);i.addColorStop(0,"#4ECDC4"),i.addColorStop(.5,"#2ECC71"),i.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=i,this.roundRect(this.codePanel.x,this.codePanel.y,this.codePanel.width,this.codePanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💻 Code Execution",this.codePanel.x+15,this.codePanel.y+25);const e=this.program.functions[this.currentFunction];this.ctx.fillStyle="#FFD700",this.ctx.font="bold 14px Inter",this.ctx.fillText(`Current: ${e.name}`,this.codePanel.x+15,this.codePanel.y+45),this.ctx.font="12px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle";for(let s=0;s<e.lines.length;s++){const n=e.lines[s],a=this.codePanel.y+70+s*22;s===this.highlightedLine&&(this.ctx.fillStyle="rgba(78, 205, 196, 0.2)",this.ctx.fillRect(this.codePanel.x+8,a-16,this.codePanel.width-16,22),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(this.codePanel.x+8,a-16,this.codePanel.width-16,22)),this.ctx.fillStyle="#666666",this.ctx.font="10px Inter",this.ctx.fillText(`${s+1}`,this.codePanel.x+15,a),this.ctx.fillStyle=s===this.highlightedLine?"#4ECDC4":"#FFFFFF",this.ctx.font="12px Inter",this.ctx.fillText(n,this.codePanel.x+35,a)}}drawStackPanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(this.stackPanel.x+3,this.stackPanel.y+3,this.stackPanel.width,this.stackPanel.height);const t=this.ctx.createLinearGradient(this.stackPanel.x,this.stackPanel.y,this.stackPanel.x,this.stackPanel.y+this.stackPanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.9)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.stackPanel.x,this.stackPanel.y,this.stackPanel.width,this.stackPanel.height),this.ctx.shadowColor="#3498db",this.ctx.shadowBlur=10,this.ctx.lineWidth=3;const i=this.ctx.createLinearGradient(this.stackPanel.x,this.stackPanel.y,this.stackPanel.x+this.stackPanel.width,this.stackPanel.y+this.stackPanel.height);i.addColorStop(0,"#3498db"),i.addColorStop(.5,"#2980b9"),i.addColorStop(1,"#3498db"),this.ctx.strokeStyle=i,this.roundRect(this.stackPanel.x,this.stackPanel.y,this.stackPanel.width,this.stackPanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#3498db",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📚 Call Stack",this.stackPanel.x+15,this.stackPanel.y+25),this.ctx.font="12px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle";for(let n=0;n<this.callStack.length;n++){const a=this.callStack[n],o=this.program.functions[a.functionIndex],h=this.stackPanel.y+50+(this.callStack.length-n)*22;this.ctx.fillStyle="rgba(52, 152, 219, 0.3)",this.ctx.fillRect(this.stackPanel.x+10,h-12,this.stackPanel.width-20,20),this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=1,this.roundRect(this.stackPanel.x+10,h-12,this.stackPanel.width-20,20,6),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="11px Inter",this.ctx.fillText(`${o.name} (PC: 0x${a.returnAddress.toString(16)})`,this.stackPanel.x+15,h+2)}const e=this.program.functions[this.currentFunction],s=this.stackPanel.y+50;this.ctx.fillStyle="rgba(78, 205, 196, 0.4)",this.ctx.fillRect(this.stackPanel.x+10,s-12,this.stackPanel.width-20,20),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.roundRect(this.stackPanel.x+10,s-12,this.stackPanel.width-20,20,6),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 11px Inter",this.ctx.fillText(`${e.name} (current)`,this.stackPanel.x+15,s+2)}drawHeapPanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(this.heapPanel.x+3,this.heapPanel.y+3,this.heapPanel.width,this.heapPanel.height);const t=this.ctx.createLinearGradient(this.heapPanel.x,this.heapPanel.y,this.heapPanel.x,this.heapPanel.y+this.heapPanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.9)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.heapPanel.x,this.heapPanel.y,this.heapPanel.width,this.heapPanel.height),this.ctx.shadowColor="#2ecc71",this.ctx.shadowBlur=10,this.ctx.lineWidth=3;const i=this.ctx.createLinearGradient(this.heapPanel.x,this.heapPanel.y,this.heapPanel.x+this.heapPanel.width,this.heapPanel.y+this.heapPanel.height);i.addColorStop(0,"#2ecc71"),i.addColorStop(.5,"#27ae60"),i.addColorStop(1,"#2ecc71"),this.ctx.strokeStyle=i,this.roundRect(this.heapPanel.x,this.heapPanel.y,this.heapPanel.width,this.heapPanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#2ecc71",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("🗑️ Heap Memory",this.heapPanel.x+15,this.heapPanel.y-10),this.drawMemoryGrid();for(const e of this.heapBlocks){this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=8,this.ctx.fillStyle="rgba(0, 0, 0, 0.4)",this.ctx.fillRect(e.x+4,e.y+4,e.width,e.height),this.ctx.shadowBlur=0;const s=this.ctx.createLinearGradient(e.x,e.y,e.x,e.y+e.height);s.addColorStop(0,"#4ECDC4"),s.addColorStop(.3,"#2ecc71"),s.addColorStop(.7,"#27ae60"),s.addColorStop(1,"#229954"),this.ctx.fillStyle=s,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(e.x,e.y,e.x+e.width,e.y+e.height);n.addColorStop(0,"#FFFFFF"),n.addColorStop(.5,"#4ECDC4"),n.addColorStop(1,"#FFFFFF"),this.ctx.strokeStyle=n,this.roundRect(e.x,e.y,e.width,e.height,6),this.ctx.stroke(),this.ctx.shadowBlur=0;const a=this.ctx.createLinearGradient(e.x,e.y,e.x,e.y+e.height*.3);a.addColorStop(0,"rgba(255, 255, 255, 0.3)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=a,this.ctx.fillRect(e.x,e.y,e.width,e.height*.3),this.ctx.fillStyle="#000000";const o=Math.max(8,Math.min(12,e.width/8));this.ctx.font=`bold ${o}px Inter`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e.name,e.x+e.width/2,e.y+e.height/2-8);const h=Math.max(7,Math.min(10,e.width/10));this.ctx.font=`bold ${h}px Inter`,this.ctx.fillText(`${e.size}B`,e.x+e.width/2,e.y+e.height/2+2),this.ctx.fillStyle="#1a1a1a";const l=Math.max(6,Math.min(8,e.width/12));this.ctx.font=`bold ${l}px Inter`,this.ctx.fillText(`0x${e.address.toString(16)}`,e.x+e.width/2,e.y+e.height/2+12)}for(const e of this.freeBlocks){this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(e.x+2,e.y+2,e.width,e.height);const s=this.ctx.createLinearGradient(e.x,e.y,e.x,e.y+e.height);s.addColorStop(0,"rgba(46, 204, 113, 0.3)"),s.addColorStop(1,"rgba(46, 204, 113, 0.1)"),this.ctx.fillStyle=s,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.strokeStyle="#2ecc71",this.ctx.lineWidth=1,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e.x,e.y,e.width,e.height),this.ctx.setLineDash([]),this.ctx.fillStyle="#2ecc71",this.ctx.font="bold 9px Inter",this.ctx.textAlign="center",this.ctx.fillText(`FREE (${e.size}B)`,e.x+e.width/2,e.y+e.height/2),e.size>=512&&(this.ctx.font="8px Inter",this.ctx.fillText(`0x${e.address.toString(16)}`,e.x+e.width/2,e.y+e.height/2+12))}this.drawMemoryUsageIndicator()}drawOutputPanel(){if(!this.showOutput)return;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(this.outputPanel.x,this.outputPanel.y,this.outputPanel.width,this.outputPanel.height),this.ctx.strokeStyle="#F39C12",this.ctx.lineWidth=2,this.ctx.strokeRect(this.outputPanel.x,this.outputPanel.y,this.outputPanel.width,this.outputPanel.height),this.ctx.fillStyle="#F39C12",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("📤 Program Output",this.outputPanel.x+10,this.outputPanel.y+25),this.ctx.font="11px Inter",this.ctx.textAlign="left",this.ctx.fillStyle="#FFFFFF";const t=Math.max(0,this.output.length-8);for(let i=t;i<this.output.length;i++){const e=this.output[i],s=this.outputPanel.y+45+(i-t)*18;this.ctx.fillText(e,this.outputPanel.x+10,s)}}drawExecutionPointer(){if(this.highlightedLine>=0){this.program.functions[this.currentFunction];const t=this.codePanel.y+70+this.highlightedLine*22,i=Math.sin(this.animationTime*8)*.6+.4;this.ctx.strokeStyle=`rgba(255, 215, 0, ${i})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.codePanel.x+15,t-5,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(this.codePanel.x+15,t-5,6,0,Math.PI*2),this.ctx.fill()}}drawExecutionTrail(){for(let t=0;t<this.executionTrail.length-1;t++){const i=this.executionTrail[t],e=this.executionTrail[t+1],s=1-i.time/i.duration;this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=4,this.ctx.strokeStyle=`rgba(255, 215, 0, ${s*.6})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.fillStyle=`rgba(255, 215, 0, ${s*.8})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,3,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0}}drawMemoryAccesses(){for(const t of this.memoryAccesses){const i=1-t.time/t.duration,e=this.heapBlocks.find(s=>s.address===t.address);e&&(this.ctx.fillStyle=`rgba(${t.type==="allocation"?"78, 205, 196":t.type==="deallocation"?"255, 107, 107":"255, 215, 0"}, ${i*.5})`,this.ctx.fillRect(e.x-2,e.y-2,e.width+4,e.height+4),this.ctx.fillStyle=`rgba(${t.type==="allocation"?"78, 205, 196":t.type==="deallocation"?"255, 107, 107":"255, 215, 0"}, ${i})`,this.ctx.beginPath(),this.ctx.arc(e.x+e.width/2,e.y+e.height/2,8,0,Math.PI*2),this.ctx.fill())}}drawAddressHighlights(){for(const t of this.addressHighlights){const i=1-t.time/t.duration,e=this.heapBlocks.find(s=>s.address===t.address);e&&(this.ctx.strokeStyle=`rgba(${t.type==="allocation"?"78, 205, 196":"255, 107, 107"}, ${i})`,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e.x-5,e.y-5,e.width+10,e.height+10),this.ctx.setLineDash([]))}}drawVariableConnections(){for(const t of this.variableConnections){const i=1-t.time/t.duration;this.ctx.strokeStyle=`rgba(78, 205, 196, ${i*.8})`,this.ctx.lineWidth=2,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.moveTo(t.from.x,t.from.y),this.ctx.lineTo(t.to.x,t.to.y),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle=`rgba(78, 205, 196, ${i})`,this.ctx.font="bold 10px Inter",this.ctx.textAlign="center";const e=(t.from.x+t.to.x)/2,s=(t.from.y+t.to.y)/2;this.ctx.fillText(t.varName,e,s-5)}}drawMemoryFragmentation(){for(const t of this.memoryFragmentation){const i=1-t.time/t.duration,e=t.size*i*.01;this.ctx.fillStyle=`rgba(255, 107, 107, ${i*.6})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 107, 107, ${i})`,this.ctx.font="bold 8px Inter",this.ctx.textAlign="center",this.ctx.fillText("FRAG",t.x,t.y+15)}this.drawMemoryLayout()}drawMemoryGrid(){const i=this.heapPanel.x+20,e=this.heapPanel.y+40,s=this.heapPanel.x+this.heapPanel.width-20,n=this.heapPanel.y+this.heapPanel.height-50;this.ctx.strokeStyle="rgba(46, 204, 113, 0.1)",this.ctx.lineWidth=1;for(let a=i;a<=s;a+=40)this.ctx.beginPath(),this.ctx.moveTo(a,e),this.ctx.lineTo(a,n),this.ctx.stroke();for(let a=e;a<=n;a+=40)this.ctx.beginPath(),this.ctx.moveTo(i,a),this.ctx.lineTo(s,a),this.ctx.stroke()}drawMemoryUsageIndicator(){const t=this.heapPanel.x+20,i=this.heapPanel.y+this.heapPanel.height-30,e=this.heapPanel.width-40,s=15;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t,i,e,s);const n=this.currentMemoryUsage/8192*100,a=e*n/100,o=this.ctx.createLinearGradient(t,i,t+a,i);o.addColorStop(0,"#2ecc71"),o.addColorStop(1,"#27ae60"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,a,s),this.ctx.strokeStyle="#2ecc71",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,e,s),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 10px Inter",this.ctx.textAlign="center",this.ctx.fillText(`${this.currentMemoryUsage}/8192 bytes (${n.toFixed(1)}%)`,t+e/2,i+s/2+3)}drawMemoryLayout(){const t=this.heapPanel.y+this.heapPanel.height-15,i=10,e=this.heapPanel.x+20,s=this.heapPanel.width-40;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(e,t,s,i);for(const a of this.heapBlocks){const o=e+(a.address-4096)/8192*s,h=a.size/8192*s;this.ctx.fillStyle="#2ecc71",this.ctx.fillRect(o,t,h,i),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.strokeRect(o,t,h,i)}const n=this.calculateFragmentedFreeBlocks();for(const a of n)if(a.size>=256){const o=e+(a.address-4096)/8192*s,h=a.size/8192*s;this.ctx.fillStyle="rgba(255, 107, 107, 0.6)",this.ctx.fillRect(o,t,h,i)}}drawParticles(){for(const t of this.particles){let i=t.size||3,e=t.life;t.type==="memory_clear"?(i=4,e=t.life*.8):t.type==="data_clear"?(i=2,e=t.life*.6):t.type==="allocation"?(i=t.size||4,e=t.life*.9):t.type==="allocation_float"?(i=2,e=t.life*.7,this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=5):t.type==="deallocation"?(i=t.size||5,e=t.life*.8):t.type==="deallocation_fall"?(i=3,e=t.life*.6):t.type==="deallocation_implosion"?(i=2,e=t.life*.5,this.ctx.shadowColor="#FF6B6B",this.ctx.shadowBlur=3):t.type==="completion"&&(i=6,e=t.life*.9,this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8),this.ctx.fillStyle=`rgba(${t.color==="#4ECDC4"?"78, 205, 196":t.color==="#FF6B6B"?"255, 107, 107":t.color==="#F39C12"?"243, 156, 18":t.color==="#3498db"?"52, 152, 219":t.color==="#FFD700"?"255, 215, 0":"231, 76, 60"}, ${e})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,i,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0}}drawDataFlowParticles(){for(const t of this.dataFlowParticles)this.ctx.fillStyle=`rgba(255, 215, 0, ${t.life})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()}drawAllocationEffects(){for(const t of this.allocationEffects){const i=t.time/t.duration,e=.5+i*.5;this.ctx.save(),this.ctx.globalAlpha=1-i,this.ctx.fillStyle="#4ECDC4",this.ctx.fillRect(t.block.x-(t.block.width*e-t.block.width)/2,t.block.y-(t.block.height*e-t.block.height)/2,t.block.width*e,t.block.height*e),this.ctx.restore()}for(const t of this.deallocationEffects){const i=t.time/t.duration,e=1-i*.5;this.ctx.save(),this.ctx.globalAlpha=1-i,this.ctx.fillStyle="#FF6B6B",this.ctx.fillRect(t.block.x-(t.block.width*e-t.block.width)/2,t.block.y-(t.block.height*e-t.block.height)/2,t.block.width*e,t.block.height*e),this.ctx.restore()}}drawGarbageCollectionEffects(){for(const t of this.gcState.gcParticles){const i=t.life;this.ctx.fillStyle=`${t.color}${Math.floor(i*255).toString(16).padStart(2,"0")}`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()}if(this.gcState.isRunning){const t=this.gcState.phase==="mark"?"Mark Phase":"Sweep Phase",i=this.gcState.phase==="mark"?"#FFD700":"#FF6B6B";this.ctx.fillStyle=i,this.ctx.font="bold 14px Inter",this.ctx.textAlign="center",this.ctx.fillText(`🗑️ ${t}`,this.canvas.width/2,30)}}drawStatistics(){if(!this.showStats)return;const t=this.canvas.width-390,i=this.canvas.height-170;this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(t+4,i+4,380,160);const e=this.ctx.createLinearGradient(t,i,t,i+160);e.addColorStop(0,"rgba(26, 26, 46, 0.98)"),e.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),e.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),e.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=e,this.ctx.fillRect(t,i,380,160),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=12,this.ctx.lineWidth=3;const s=this.ctx.createLinearGradient(t,i,t+380,i+160);s.addColorStop(0,"#4ECDC4"),s.addColorStop(.5,"#2ECC71"),s.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=s,this.roundRect(t,i,380,160,12),this.ctx.stroke(),this.ctx.shadowBlur=0;const n=this.ctx.createLinearGradient(t,i,t,i+30);n.addColorStop(0,"rgba(78, 205, 196, 0.1)"),n.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=n,this.ctx.fillRect(t,i,380,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📊 Program Execution Stats",t+15,i+22),this.ctx.font="12px Inter",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`📦 Allocations: ${this.totalAllocations}`,t+15,i+45),this.ctx.fillText(`🗑️ Deallocations: ${this.totalDeallocations}`,t+15,i+62),this.ctx.fillText(`💾 Memory Usage: ${this.currentMemoryUsage} bytes`,t+15,i+79),this.ctx.fillText(`🔍 Memory Accesses: ${this.memoryAccessCount}`,t+15,i+96),this.ctx.fillStyle="#FFD700",this.ctx.fillText(`⚡ Execution Cycles: ${this.performanceMetrics.totalCycles}`,t+15,i+113),this.ctx.fillText(`📈 Memory Efficiency: ${this.performanceMetrics.memoryEfficiency.toFixed(1)}%`,t+15,i+130),this.ctx.fillText(`🔧 Fragmentation Level: ${this.performanceMetrics.fragmentationLevel.toFixed(1)}%`,t+15,i+147),this.memoryLeaks>0?(this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`⚠️ Memory Leaks: ${this.memoryLeaks}`,t+15,i+164)):(this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("✅ No Memory Leaks",t+15,i+164));const a=this.performanceMetrics.memoryEfficiency,o=a>80?"#4ECDC4":a>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=o,this.ctx.fillText(`🎯 Performance: ${a>80?"Excellent":a>60?"Good":"Poor"}`,t+10,i+160)}roundRect(t,i,e,s,n){this.ctx.beginPath(),this.ctx.moveTo(t+n,i),this.ctx.lineTo(t+e-n,i),this.ctx.quadraticCurveTo(t+e,i,t+e,i+n),this.ctx.lineTo(t+e,i+s-n),this.ctx.quadraticCurveTo(t+e,i+s,t+e-n,i+s),this.ctx.lineTo(t+n,i+s),this.ctx.quadraticCurveTo(t,i+s,t,i+s-n),this.ctx.lineTo(t,i+n),this.ctx.quadraticCurveTo(t,i,t+n,i),this.ctx.closePath()}handleClick(t,i){t>=this.heapPanel.x&&t<=this.heapPanel.x+this.heapPanel.width&&i>=this.heapPanel.y&&i<=this.heapPanel.y+this.heapPanel.height&&(this.gcState.isRunning||this.runGarbageCollection())}handleButtonClick(t){switch(t){case"auto":this.isAutoRunning=!this.isAutoRunning;break;case"reset":this.resetExecution();break;case"step":this.animationState==="idle"&&this.executeNextStep();break}}resetExecution(){this.initializeExecution(),this.startExecution(),this.resetPerformanceMetrics()}reset(){this.initializeExecution(),this.startExecution(),this.resetPerformanceMetrics()}resetPerformanceMetrics(){this.performanceMetrics={totalCycles:0,memoryEfficiency:100,fragmentationLevel:0,averageAccessTime:0},this.executionStep=0,this.totalAllocations=0,this.totalDeallocations=0,this.memoryLeaks=0,this.currentMemoryUsage=0,this.memoryAccessCount=0}getStats(){return{totalAllocations:this.totalAllocations,totalDeallocations:this.totalDeallocations,memoryLeaks:this.memoryLeaks,currentMemoryUsage:this.currentMemoryUsage,memoryAccessCount:this.memoryAccessCount,callStackDepth:this.callStack.length,currentFunction:this.program.functions[this.currentFunction].name}}resize(){const t=this.canvas.width;this.canvas.height,this.codePanel={x:50,y:50,width:Math.min(400,t*.3),height:300},this.stackPanel={x:t-350,y:50,width:300,height:300},this.heapPanel={x:50,y:400,width:Math.max(750,t-100),height:200},this.outputPanel={x:t-350,y:400,width:300,height:200},this.updateFreeBlocks()}}class bt{constructor(t){this.ctx=t,this.canvas=t.canvas,this.blocks=[],this.pendingTransactions=[],this.miners=[],this.networkNodes=[],this.consensus="proof-of-work",this.speed=1,this.showHashes=!0,this.showNetwork=!0,this.autoMine=!0,this.blockWidth=160,this.blockHeight=110,this.blockSpacing=40,this.chainStartX=40,this.chainStartY=180,this.maxBlocksVisible=12,this.scrollOffset=0,this.difficulty=4,this.targetHash="0".repeat(this.difficulty),this.currentNonce=0,this.miningBlock=null,this.isMining=!1,this.blockReward=50,this.transactionFee=.1,this.targetBlockTime=1e4,this.difficultyAdjustmentInterval=10,this.lastDifficultyAdjustment=0,this.blockTimes=[],this.nodeCount=8,this.nodeRadius=25,this.networkCenterX=0,this.networkCenterY=0,this.maxNodes=8,this.minNodes=6,this.nodeJoinInterval=1e4,this.nodeLeaveInterval=15e3,this.lastNodeJoin=0,this.lastNodeLeave=0,this.nodeJoinParticles=[],this.nodeLeaveParticles=[],this.nodeRedistributionTimer=0,this.redistributionInterval=2e3,this.transactionTypes=["transfer","smart_contract","token_mint","stake"],this.transactionColors={transfer:"#4CAF50",smart_contract:"#2196F3",token_mint:"#FF9800",stake:"#9C27B0"},this.animationPhase="idle",this.phaseTime=0,this.phaseDuration=3,this.guidedMode=!0,this.phaseSteps=["mining_success","validation","propagation","consensus","finalization"],this.currentStep=0,this.stepDuration=.2,this.miningParticles=[],this.validationParticles=[],this.networkParticles=[],this.propagationArrows=[],this.contractExecutionParticles=[],this.blockCreationParticles=[],this.hashCalculationParticles=[],this.consensusParticles=[],this.finalizationParticles=[],this.rewardParticles=[],this.rejectionParticles=[],this.blockGlow=0,this.miningGlow=0,this.networkPulse=0,this.chainPulse=0,this.totalBlocks=0,this.totalTransactions=0,this.totalRewards=0,this.consensusTime=0,this.networkHashrate=0,this.averageBlockTime=0,this.lastBlockTimes=[],this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.lastBlockTime=0,this.blockInterval=3e3,this.isStartingMining=!1,this.consensusCompleted=!1,this.consensusDecisions=0,this.initializeBlockchain(),this.initializeNetwork(),this.startGenesisBlock()}initializeBlockchain(){const t={index:0,timestamp:Date.now(),transactions:[{id:"genesis_1",from:"Genesis",to:"Alice",amount:1e3,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"},{id:"genesis_2",from:"Genesis",to:"Bob",amount:500,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"},{id:"genesis_3",from:"Genesis",to:"Charlie",amount:250,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"}],previousHash:"0000000000000000000000000000000000000000000000000000000000000000",hash:"",nonce:0,merkleRoot:"",isGenesis:!0,creationTime:0,glowIntensity:1,blockReward:0,totalFees:0};t.merkleRoot=this.calculateMerkleRoot(t.transactions),t.hash=this.calculateBlockHash(t),this.blocks.push(t),this.totalBlocks=1,this.totalTransactions=3,this.addPendingTransaction("Alice","Bob",50,"transfer","Payment for services"),this.addPendingTransaction("Bob","Charlie",25,"transfer","Coffee payment"),this.addPendingTransaction("Alice","Contract",10,"smart_contract","DeFi interaction"),this.addPendingTransaction("Charlie","Staking",100,"stake","Staking tokens"),this.addPendingTransaction("Bob","David",15,"transfer","Lunch payment"),this.lastTransactionTime=Date.now(),this.transactionInterval=3e3,this.transactionTypes=["transfer","smart_contract","token_mint","stake","swap","liquidity"],this.transactionColors={transfer:"#4CAF50",smart_contract:"#2196F3",token_mint:"#FF9800",stake:"#9C27B0",swap:"#E91E63",liquidity:"#00BCD4"},this.users=["Alice","Bob","Charlie","David","Eve","Frank","Grace","Henry","Ivy","Jack"],this.contracts=["DeFi_Protocol","DEX_Exchange","Lending_Pool","Staking_Contract","Yield_Farm"]}initializeNetwork(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height;this.networkCenterX=t-250,this.networkCenterY=i-200,this.networkNodes=[],this.nextNodeId=1;for(let e=0;e<this.nodeCount;e++){const s=e/this.nodeCount*2*Math.PI,n=120,a=this.networkCenterX+Math.cos(s)*n,o=this.networkCenterY+Math.sin(s)*n;this.networkNodes.push({id:this.nextNodeId++,x:a,y:o,isMining:!1,isValidating:!1,lastBlock:null,connectionStrength:Math.random()*.5+.5,color:`hsl(${e*60}, 80%, 65%)`,pulseIntensity:0,isActive:!1})}this.miners=this.networkNodes.slice(0,3),this.miners.forEach(e=>{e.isMining=!0,e.currentNonce=0,e.targetHash=this.targetHash,e.isActive=!0})}startGenesisBlock(){setTimeout(()=>{this.startMining()},1e3)}startGuidedBlockAddition(t){this.guidedBlock=t,this.currentStep=0,this.phaseTime=0,this.animationPhase="mining_success",this.networkNodes.forEach(i=>{i.isValidating=!1,i.consensusReached=!1,i.pulseIntensity=1,i.color="#2196F3"}),this.guidedPhaseIndicator={text:"Mining Success",alpha:1,pulseIntensity:1,color:"#00FF88",y:350},setTimeout(()=>this.nextGuidedStep(),1e3)}nextGuidedStep(){if(!this.guidedBlock){this.animationPhase="idle",this.guidedPhaseIndicator=null;return}if(this.currentStep++,this.phaseTime=0,this.currentStep>=this.phaseSteps.length){if(this.animationPhase==="consensus"&&!this.consensusCompleted){setTimeout(()=>this.nextGuidedStep(),500);return}const i=this.networkNodes.filter(s=>s.consensusReached),e=this.networkNodes.length*.6;i.length>=e?this.finalizeBlock():this.startFinalizationStep();return}switch(this.phaseSteps[this.currentStep-1]){case"validation":this.startValidationStep();break;case"propagation":this.startPropagationStep();break;case"consensus":this.startConsensusStep();break;case"finalization":this.startFinalizationStep();break}setTimeout(()=>this.nextGuidedStep(),1500)}startValidationStep(){this.networkNodes.forEach(t=>{t.isValidating=!0,t.pulseIntensity=1,t.color="#FF6B35"}),this.createValidationParticles(),this.guidedPhaseIndicator={text:"VALIDATION",color:"#FF6B35",alpha:1,y:350}}startPropagationStep(){this.createBroadcastParticles(),this.networkNodes.forEach(t=>{t.color="#4A90E2",t.pulseIntensity=.8}),this.broadcastBlockWithLatency(),this.guidedPhaseIndicator={text:"PROPAGATION",color:"#4A90E2",alpha:1,y:350}}startConsensusStep(){this.consensusCompleted=!1,this.consensusDecisions=0,this.networkNodes.forEach((t,i)=>{t.isValidating=!1,t.pulseIntensity=1.2,t.color="#9C27B0";const e=Math.random()*800+200,s=.7;setTimeout(()=>{Math.random()<s?(t.consensusReached=!0,t.pulseIntensity=1.5):(t.consensusReached=!1,t.pulseIntensity=.5),this.consensusDecisions++,this.consensusDecisions>=this.networkNodes.length&&(this.consensusCompleted=!0)},e)}),this.createConsensusParticles(),this.guidedPhaseIndicator={text:"CONSENSUS",color:"#9C27B0",alpha:1,y:350}}simulateNetworkLatency(t,i=100,e=1e3){const s=Math.random()*(e-i)+i;setTimeout(t,s)}broadcastBlockWithLatency(){this.networkNodes.forEach((t,i)=>{const e=Math.random()*700+100;setTimeout(()=>{t.receivedBlock=!0,t.isValidating=!0,t.pulseIntensity=1,this.createNodePropagationParticles(t)},e)})}createNodePropagationParticles(t){for(let i=0;i<5;i++)this.networkParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.5,maxLife:1.5,color:"#4A90E2",size:3})}startFinalizationStep(){this.networkNodes.forEach(e=>{e.pulseIntensity=1.5,e.color="#4CAF50"});const t=this.networkNodes.filter(e=>e.consensusReached),i=this.networkNodes.length*.6;t.length>=i?(this.createFinalizationParticles(),this.guidedPhaseIndicator={text:"Block Finalized",alpha:1,pulseIntensity:1,color:"#4CAF50",y:350},setTimeout(()=>this.nextGuidedStep(),1e3)):(this.createRejectionParticles(),this.guidedPhaseIndicator={text:"BLOCK REJECTED",alpha:1,pulseIntensity:1,color:"#FF5722",y:350},this.networkNodes.forEach(e=>{e.consensusReached=!1,e.isValidating=!1,e.pulseIntensity=1,e.color="#2196F3"}),setTimeout(()=>{this.guidedBlock=null,this.guidedPhaseIndicator=null,this.animationPhase="idle",this.currentStep=0,this.startMining()},1e3))}addNodeToNetwork(){if(this.networkNodes.length>=this.maxNodes)return;const t=this.calculateOptimalNodePosition(),i=this.networkCenterX+Math.cos(t.angle)*300,e=this.networkCenterY+Math.sin(t.angle)*300,s={id:this.nextNodeId++,x:i,y:e,targetX:t.x,targetY:t.y,isMining:!1,isValidating:!1,lastBlock:null,connectionStrength:Math.random()*.5+.5,color:`hsl(${this.networkNodes.length*60}, 80%, 65%)`,pulseIntensity:0,isActive:!1,isJoining:!0,joinProgress:0,joinSpeed:.08};this.networkNodes.push(s),this.createNodeJoinParticles(i,e),this.scheduleNodeRedistribution()}removeNodeFromNetwork(){if(this.networkNodes.length<=this.minNodes)return;const t=this.networkNodes.filter(s=>!s.isMining);if(t.length===0)return;const i=t[Math.floor(Math.random()*t.length)],e=this.networkNodes.indexOf(i);e!==-1&&(i.isLeaving=!0,i.leaveProgress=0,i.leaveSpeed=.12,this.createNodeLeaveParticles(i.x,i.y),setTimeout(()=>{this.networkNodes.splice(e,1),this.scheduleNodeRedistribution()},1e3))}createNodeJoinParticles(t,i){for(let e=0;e<15;e++)this.nodeJoinParticles.push({x:t,y:i,vx:(Math.random()-.5)*200,vy:(Math.random()-.5)*200,life:2,maxLife:2,color:"#4CAF50",size:4})}createNodeLeaveParticles(t,i){for(let e=0;e<12;e++)this.nodeLeaveParticles.push({x:t,y:i,vx:(Math.random()-.5)*180,vy:(Math.random()-.5)*180,life:2.5,maxLife:2.5,color:"#FF5722",size:3})}updateNodeJoinParticles(t){this.nodeJoinParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.nodeJoinParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=20*t})}updateNodeLeaveParticles(t){this.nodeLeaveParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.nodeLeaveParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}calculateOptimalNodePosition(){const i=this.networkNodes.length,e=2*Math.PI/this.maxNodes,n=i*e,a=this.networkCenterX+Math.cos(n)*120,o=this.networkCenterY+Math.sin(n)*120;return{x:a,y:o,angle:n}}scheduleNodeRedistribution(){this.nodeRedistributionTimer=0}redistributeNodes(){if(this.networkNodes.length===0)return;const e=2*Math.PI/this.maxNodes;this.networkNodes.forEach((s,n)=>{if(!s.isJoining&&!s.isLeaving){const a=n*e,o=this.networkCenterX+Math.cos(a)*120,h=this.networkCenterY+Math.sin(a)*120;s.targetX=o,s.targetY=h,s.isMoving=!0,s.moveSpeed=.1,s.moveProgress=0}})}finalizeBlockDirectly(t){this.blocks.push(t),this.totalBlocks++,this.totalTransactions+=t.transactions.length,this.createBlockCreationParticles(),this.executeSmartContracts(t),this.broadcastBlock(),this.createRewardParticles(),this.successfulMiner&&(this.successfulMiner.pulseIntensity=0,this.successfulMiner.color=this.successfulMiner.originalColor||`hsl(${this.miners.indexOf(this.successfulMiner)*60}, 80%, 65%)`),this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,setTimeout(()=>{console.log("[DIRECT BLOCK] 🔄 Starting mining for next block"),this.startMining()},2e3)}finalizeBlock(){this.guidedBlock&&(this.blocks.push(this.guidedBlock),this.totalBlocks++,this.totalTransactions+=this.guidedBlock.transactions.length,this.createBlockCreationParticles(),this.executeSmartContracts(this.guidedBlock),this.broadcastBlock(),this.createRewardParticles(),this.successfulMiner&&(this.successfulMiner.pulseIntensity=0,this.successfulMiner.color=this.successfulMiner.originalColor||`hsl(${this.miners.indexOf(this.successfulMiner)*60}, 80%, 65%)`),this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.networkNodes.forEach(t=>{t.consensusReached=!1,t.isValidating=!1,t.pulseIntensity=1,t.color="#2196F3"}),this.guidedBlock=null,this.guidedPhaseIndicator=null,this.animationPhase="idle",this.currentStep=0,setTimeout(()=>{this.startMining()},2e3))}generateNewTransactions(){const t=Date.now();if(t-this.lastTransactionTime>this.transactionInterval){const i=Math.floor(Math.random()*4)+1;for(let e=0;e<i;e++){const s=this.generateRandomTransaction();this.addPendingTransaction(s.from,s.to,s.amount,s.type,s.description,s.fee)}this.lastTransactionTime=t,this.transactionInterval=1500+Math.random()*2e3}if(this.pendingTransactions=this.pendingTransactions.filter(i=>t-i.timestamp<3e4),Math.random()<.1&&this.pendingTransactions.length>0){const i=this.pendingTransactions.findIndex(e=>e.fee<this.transactionFee*.5);i>-1&&this.pendingTransactions.splice(i,1)}}generateRandomTransaction(){const t=this.transactionTypes[Math.floor(Math.random()*this.transactionTypes.length)];let i,e,s,n;switch(t){case"transfer":for(i=this.users[Math.floor(Math.random()*this.users.length)],e=this.users[Math.floor(Math.random()*this.users.length)];e===i;)e=this.users[Math.floor(Math.random()*this.users.length)];s=Math.floor(Math.random()*200)+5,n=this.getRandomTransferDescription();break;case"smart_contract":i=this.users[Math.floor(Math.random()*this.users.length)],e=this.contracts[Math.floor(Math.random()*this.contracts.length)],s=Math.floor(Math.random()*50)+1,n=this.getRandomContractDescription();break;case"token_mint":i="System",e=this.users[Math.floor(Math.random()*this.users.length)],s=Math.floor(Math.random()*100)+10,n="Token minting";break;case"stake":i=this.users[Math.floor(Math.random()*this.users.length)],e="Staking_Contract",s=Math.floor(Math.random()*150)+20,n="Staking tokens for rewards";break;case"swap":i=this.users[Math.floor(Math.random()*this.users.length)],e="DEX_Exchange",s=Math.floor(Math.random()*80)+5,n="Token swap on DEX";break;case"liquidity":i=this.users[Math.floor(Math.random()*this.users.length)],e="Liquidity_Pool",s=Math.floor(Math.random()*120)+15,n="Adding liquidity to pool";break}let a=this.transactionFee;return t==="smart_contract"||t==="swap"?a=this.transactionFee*2:t==="liquidity"&&(a=this.transactionFee*1.5),{from:i,to:e,amount:s,type:t,description:n,fee:a}}getRandomTransferDescription(){const t=["Payment for services","Coffee payment","Lunch payment","Rent payment","Grocery payment","Gas payment","Movie tickets","Restaurant bill","Shopping payment","Transportation fee"];return t[Math.floor(Math.random()*t.length)]}getRandomContractDescription(){const t=["DeFi interaction","Yield farming","Lending operation","Borrowing funds","Collateral deposit","Interest payment","Protocol interaction","Smart contract call","Automated trading","Liquidation protection"];return t[Math.floor(Math.random()*t.length)]}addPendingTransaction(t,i,e,s,n="",a=null){const o={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,from:t,to:i,amount:e,type:s,color:this.transactionColors[s]||"#4CAF50",fee:a||this.transactionFee,description:n,timestamp:Date.now()};return this.validateTransaction(o)?(this.pendingTransactions.length>=100&&(this.pendingTransactions.sort((h,l)=>l.fee-h.fee),this.pendingTransactions.pop()),this.pendingTransactions.push(o),this.totalTransactions++,!0):!1}selectTransactionsForBlock(){const t=[...this.pendingTransactions].sort((s,n)=>n.fee-s.fee),i=Math.min(6,Math.max(3,Math.floor(this.pendingTransactions.length/2)));let e=t.slice(0,i);return e.length===0&&(e=[{id:`default_${Date.now()}`,from:"System",to:"Miner",amount:0,type:"transfer",color:"#9E9E9E",fee:0,description:"Empty block reward"}]),e.forEach(s=>{const n=this.pendingTransactions.indexOf(s);n>-1&&this.pendingTransactions.splice(n,1)}),e}calculateMerkleRoot(t){if(t.length===0)return"";let i=t.map(e=>this.hashString(JSON.stringify(e)));for(;i.length>1;){const e=[];for(let s=0;s<i.length;s+=2){const n=i[s],a=s+1<i.length?i[s+1]:n;e.push(this.hashString(n+a))}i=e}return i[0]}calculateBlockHash(t){const i=JSON.stringify({index:t.index,timestamp:t.timestamp,transactions:t.transactions,previousHash:t.previousHash,merkleRoot:t.merkleRoot,nonce:t.nonce});return this.hashString(i)}hashString(t){let i=0;const e=31,s=1000000007;for(let a=0;a<t.length;a++){const o=t.charCodeAt(a);i=(i*e%s+o)%s}return Math.abs(i).toString(16).padStart(8,"0").repeat(8)}validateBlock(t){if(!t||typeof t.index!="number"||!t.transactions||!Array.isArray(t.transactions)||!t.previousHash||typeof t.previousHash!="string"||typeof t.nonce!="number"||t.index!==this.blocks.length)return!1;if(t.index>0){const s=this.blocks[this.blocks.length-1];if(t.previousHash!==s.hash)return!1}if(JSON.stringify(t).length>1e6)return!1;const e=this.calculateBlockHash(t);return t.hash===e}validateTransaction(t){return!(!t||typeof t.id!="string"||!t.from||!t.to||typeof t.amount!="number"||t.amount<=0||typeof t.fee!="number"||t.fee<0||this.pendingTransactions.find(e=>e.id===t.id))}startMining(){if(this.isMining||this.guidedBlock||this.isStartingMining)return;this.isStartingMining=!0,this.isMining=!0,this.animationPhase="mining",this.phaseTime=0,this.miningGlow=1;const t=this.blocks[this.blocks.length-1],i=this.selectTransactionsForBlock(),e=i.reduce((n,a)=>n+a.fee,0),s={index:t.index+1,timestamp:Date.now(),transactions:i,previousHash:t.hash,hash:"",nonce:0,merkleRoot:"",isGenesis:!1,creationTime:0,glowIntensity:0,blockReward:this.blockReward,totalFees:e};s.merkleRoot=this.calculateMerkleRoot(s.transactions),this.miningBlock=s,this.miners.forEach((n,a)=>{n.currentNonce=Math.floor(Math.random()*1e3)+a*1e3,n.isMining=!0,n.pulseIntensity=1,n.lastHashRate=0}),this.createMiningStartParticles(),setTimeout(()=>{this.isStartingMining=!1},100)}adjustDifficulty(){if(this.blocks.length%this.difficultyAdjustmentInterval!==0||this.blockTimes.length<this.difficultyAdjustmentInterval)return;const i=this.blockTimes.reduce((e,s)=>e+s,0)/this.blockTimes.length/this.targetBlockTime;i>1.2?this.difficulty=Math.max(1,this.difficulty-1):i<.8&&(this.difficulty=Math.min(8,this.difficulty+1)),this.targetHash="0".repeat(this.difficulty),this.blockTimes=[]}mineBlock(){if(!this.isMining||!this.miningBlock||this.guidedBlock)return;const t=this.blocks.length;if(this.miningBlock.index!==t){const o=this.blocks[this.blocks.length-1],h=this.selectTransactionsForBlock(),l=h.reduce((c,d)=>c+d.fee,0);this.miningBlock={index:t,timestamp:Date.now(),transactions:h,previousHash:o.hash,hash:"",nonce:0,merkleRoot:this.calculateMerkleRoot(h),isGenesis:!1,creationTime:0,glowIntensity:0,blockReward:this.blockReward,totalFees:l}}const i="0".repeat(this.difficulty),e=500,s=Math.max(.1,(9-this.difficulty)*.8),n=this.speed,a=Math.max(50,Math.floor(e*s*n));this.networkHashrate=this.miners.length*a*60;for(let o=0;o<a;o++)if(this.miningBlock.nonce++,this.miningBlock.hash=this.calculateBlockHash(this.miningBlock),this.miningBlock.hash.startsWith(i)){if(!this.validateBlock(this.miningBlock))return;const h=Math.floor(Math.random()*this.miners.length);this.successfulMiner=this.miners[h],this.successfulMiner.originalColor||(this.successfulMiner.originalColor=this.successfulMiner.color),this.successfulMiner.pulseIntensity=2,this.successfulMiner.color="#00FF88",this.miningBlock.creationTime=Date.now(),this.miningBlock.glowIntensity=1;const l=this.miningBlock.creationTime-this.lastBlockTime;this.blockTimes.push(l),this.lastBlockTime=this.miningBlock.creationTime,this.adjustDifficulty(),this.startGuidedBlockAddition(this.miningBlock);return}}createMinerBlockConnection(){if(!this.successfulMiner||!this.miningBlock)return;const t=this.blocks.length;let i;if(t<=4){const s=t;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;this.minerBlockConnection={startX:this.successfulMiner.x,startY:this.successfulMiner.y,endX:i,endY:e,progress:0,speed:.02,color:"#00FF88",width:3,alpha:1,pulseIntensity:1},this.minerRewardDisplay={x:this.successfulMiner.x,y:this.successfulMiner.y-40,text:`+${this.blockReward+this.miningBlock.totalFees} tokens`,color:"#1E3A8A",alpha:1,life:3,maxLife:3,velocity:-30}}createMiningStartParticles(){this.miners.forEach(t=>{for(let i=0;i<8;i++)this.miningParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:2,maxLife:2,color:"#FF9800",size:3,type:"mining_start"})})}createBlockCreationParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length-1;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<20;s++)this.blockCreationParticles.push({x:i,y:e,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:3,maxLife:3,color:"#4CAF50",size:4,type:"block_creation"})}broadcastBlock(){this.networkNodes.forEach(t=>{t.isValidating=!0,t.lastBlock=this.blocks[this.blocks.length-1],t.pulseIntensity=1}),this.createBroadcastParticles()}createPropagationArrows(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length-1;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;this.networkNodes.forEach(s=>{this.propagationArrows.push({startX:i,startY:e,endX:s.x,endY:s.y,progress:0,speed:.03,color:"#4CAF50",width:4,alpha:1})})}createBroadcastParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<8;i++)this.networkParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,life:1.8,maxLife:1.8,color:"#4A90E2",size:3})})}updateNetworkParticles(t){this.networkParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.networkParticles.splice(e,1);return}const s=i.targetX-i.x,n=i.targetY-i.y,a=Math.sqrt(s*s+n*n);a>1&&(i.vx=s/a*120,i.vy=n/a*120),i.x+=i.vx*t,i.y+=i.vy*t})}createMiningParticles(){if(!this.isMining)return;const t=.4*this.speed;this.miners.forEach(i=>{Math.random()<t&&this.miningParticles.push({x:i.x,y:i.y,vx:(Math.random()-.5)*60,vy:(Math.random()-.5)*60,life:1.5,maxLife:1.5,color:"#FF9800",size:3,type:"mining"})})}createMiningSuccessParticles(){this.miners.forEach(t=>{for(let i=0;i<12;i++)this.miningParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*250,vy:(Math.random()-.5)*250,life:4,maxLife:4,color:"#4CAF50",size:5,type:"success"})})}executeSmartContracts(t){t.transactions.forEach(i=>{i.type==="smart_contract"&&this.createSmartContractExecution(i)})}createSmartContractExecution(t){const i=this.blocks.length;let e;if(i<=4){const n=i-1;e=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length-1;e=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,i>4&&(e+=80)}const s=this.chainStartY+this.blockHeight/2;for(let n=0;n<15;n++)this.contractExecutionParticles.push({x:e,y:s,vx:(Math.random()-.5)*140,vy:(Math.random()-.5)*140,life:2.5,maxLife:2.5,color:"#2196F3",size:4})}createValidationParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<10;i++)this.validationParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:2,maxLife:2,color:"#FF6B35",size:4})})}createConsensusParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<12;i++)this.consensusParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*120,vy:(Math.random()-.5)*120,life:2.5,maxLife:2.5,color:"#9C27B0",size:5})})}createFinalizationParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length-1;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<15;s++)this.finalizationParticles.push({x:i,y:e,vx:(Math.random()-.5)*120,vy:(Math.random()-.5)*120,life:2.5,maxLife:2.5,color:"#4CAF50",size:3})}createRewardParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length-1;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<12;s++)this.rewardParticles.push({x:i,y:e,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,life:3,maxLife:3,color:"#FFD700",size:4})}updateMiningParticles(t){this.miningParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.miningParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}updateBlockCreationParticles(t){this.blockCreationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.blockCreationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateContractExecutionParticles(t){this.contractExecutionParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.contractExecutionParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updatePropagationArrows(t){this.propagationArrows.forEach((i,e)=>{if(i.progress+=i.speed,i.progress>=1){this.propagationArrows.splice(e,1);return}})}updateValidationParticles(t){this.validationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.validationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=20*t})}updateConsensusParticles(t){this.consensusParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.consensusParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}updateFinalizationParticles(t){this.finalizationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.finalizationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateRewardParticles(t){this.rewardParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.rewardParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateRejectionParticles(t){this.rejectionParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.rejectionParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=40*t})}setSpeed(t){this.speed=t}setDifficulty(t){this.difficulty=t,this.targetHash="0".repeat(this.difficulty),this.miners.forEach(i=>{i.targetHash=this.targetHash}),this.miningBlock&&(this.miningBlock.hash=this.calculateBlockHash(this.miningBlock))}update(t){const i=t;t*this.speed,this.phaseTime+=i,this.blockGlow=Math.max(0,this.blockGlow-i*2),this.miningGlow=Math.max(0,this.miningGlow-i*1.5),this.networkPulse=(this.networkPulse+i*3)%(2*Math.PI),this.updateDynamicNodes(i),this.isMining&&this.miningBlock&&this.mineBlock(),this.updateMiningParticles(i),this.updateNetworkParticles(i),this.updateContractExecutionParticles(i),this.updateBlockCreationParticles(i),this.updateValidationParticles(i),this.updateConsensusParticles(i),this.updateFinalizationParticles(i),this.updateRewardParticles(i),this.updateRejectionParticles(i),this.updateNodeJoinParticles(i),this.updateNodeLeaveParticles(i),this.createMiningParticles(),this.generateNewTransactions(),this.networkNodes.forEach(o=>{o.isValidating&&this.phaseTime>1.5&&(o.isValidating=!1,o.pulseIntensity=0),o.pulseIntensity=Math.max(0,o.pulseIntensity-i*2)}),this.blocks.forEach(o=>{o.glowIntensity>0&&(o.glowIntensity=Math.max(0,o.glowIntensity-i*1.5))});const e=1200,s=Math.pow(2,this.difficulty-1),n=this.speed,a=Math.floor(e/s*n);this.networkHashrate=this.miners.length*a,this.miningBlock&&this.miningBlock.glowIntensity>0&&(this.miningBlock.glowIntensity=Math.max(0,this.miningBlock.glowIntensity-i*1.5))}updateDynamicNodes(t){const i=Date.now();this.nodeRedistributionTimer+=t,this.nodeRedistributionTimer>this.redistributionInterval&&(this.redistributeNodes(),this.nodeRedistributionTimer=0),i-this.lastNodeJoin>this.nodeJoinInterval&&this.networkNodes.length<this.maxNodes&&(this.addNodeToNetwork(),this.lastNodeJoin=i),i-this.lastNodeLeave>this.nodeLeaveInterval&&this.networkNodes.length>this.minNodes&&(this.removeNodeFromNetwork(),this.lastNodeLeave=i),this.networkNodes.forEach(e=>{if(e.isJoining&&(e.joinProgress+=e.joinSpeed,e.joinProgress>=1?(e.x=e.targetX,e.y=e.targetY,e.isJoining=!1,e.isActive=!0):(e.x=e.x+(e.targetX-e.x)*e.joinSpeed,e.y=e.y+(e.targetY-e.y)*e.joinSpeed)),e.isLeaving&&(e.leaveProgress+=e.leaveSpeed,!(e.leaveProgress>=1))){const s=Math.atan2(e.y-this.networkCenterY,e.x-this.networkCenterX);e.x+=Math.cos(s)*5,e.y+=Math.sin(s)*5}e.isMoving&&(e.moveProgress+=e.moveSpeed,e.moveProgress>=1?(e.x=e.targetX,e.y=e.targetY,e.isMoving=!1):(e.x=e.x+(e.targetX-e.x)*e.moveSpeed,e.y=e.y+(e.targetY-e.y)*e.moveSpeed))})}drawBlockchain(){const t=this.blocks.length;let i=[];t<=3?i=this.blocks:i=[this.blocks[0],this.blocks[1],this.blocks[t-1]];const e=i.length*(this.blockWidth+this.blockSpacing),s=this.ctx.createLinearGradient(this.chainStartX-40,this.chainStartY-40,this.chainStartX+e+40,this.chainStartY+this.blockHeight+40);if(s.addColorStop(0,"rgba(33, 150, 243, 0.15)"),s.addColorStop(.5,"rgba(76, 175, 80, 0.1)"),s.addColorStop(1,"rgba(33, 150, 243, 0.15)"),this.ctx.fillStyle=s,this.ctx.fillRect(this.chainStartX-40,this.chainStartY-40,e+80,this.blockHeight+80),i.forEach((n,a)=>{let o=this.chainStartX+a*(this.blockWidth+this.blockSpacing);const h=this.chainStartY;t>3&&a>=2&&(o+=40),n.glowIntensity>0&&(this.ctx.shadowColor=n.isGenesis?"#4CAF50":"#2196F3",this.ctx.shadowBlur=40*n.glowIntensity,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0);const l=this.ctx.createLinearGradient(o,h,o+this.blockWidth,h+this.blockHeight);n.isGenesis?(l.addColorStop(0,"#4CAF50"),l.addColorStop(.3,"#45A049"),l.addColorStop(.7,"#388E3C"),l.addColorStop(1,"#2E7D32")):(l.addColorStop(0,"#42A5F5"),l.addColorStop(.3,"#2196F3"),l.addColorStop(.7,"#1976D2"),l.addColorStop(1,"#1565C0")),this.ctx.fillStyle=l,this.roundRect(o,h,this.blockWidth,this.blockHeight,12),this.ctx.fill();const c=this.ctx.createLinearGradient(o,h,o+this.blockWidth,h+this.blockHeight);c.addColorStop(0,"rgba(255, 255, 255, 0.8)"),c.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),c.addColorStop(1,"rgba(255, 255, 255, 0.2)"),this.ctx.strokeStyle=c,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.roundRect(o,h,this.blockWidth,this.blockHeight,12),this.ctx.stroke();const d=this.ctx.createLinearGradient(o,h,o,h+this.blockHeight);d.addColorStop(0,"rgba(255, 255, 255, 0.3)"),d.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=d,this.roundRect(o+2,h+2,this.blockWidth-4,this.blockHeight/3,10),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.textAlign="left";const x=n.isGenesis?"Genesis":`Block #${n.index}`;if(this.ctx.font="bold 20px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=2,this.ctx.fillText(x,o+12,h+28),this.ctx.shadowBlur=0,this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`📦 ${n.transactions.length} tx`,o+12,h+48),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillText(`Nonce: ${n.nonce.toLocaleString()}`,o+12,h+65),n.isGenesis||(this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText(`💰 ${n.blockReward} | 💸 ${n.totalFees.toFixed(1)}`,o+12,h+82)),this.showHashes&&(this.ctx.font='11px "JetBrains Mono", "Fira Code", monospace',this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.ctx.fillText(`🔗 ${n.hash.substring(0,12)}...`,o+12,h+100)),a<i.length-1){i[a+1];let r=this.chainStartX+(a+1)*(this.blockWidth+this.blockSpacing);if(t>3&&a===1){const u=o+this.blockWidth+20,f=h+this.blockHeight/2;this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 28px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.fillText("⋯",u,f+10);const m=t-3;this.ctx.fillStyle="#666666",this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.fillText(`+${m} blocks`,u+25,f+30);const p=this.chainStartX+(i.length-1)*(this.blockWidth+this.blockSpacing),y=this.ctx.createLinearGradient(u+30,h+this.blockHeight/2,p,h+this.blockHeight/2);y.addColorStop(0,"#ffffff"),y.addColorStop(.5,"#4CAF50"),y.addColorStop(1,"#ffffff"),this.ctx.strokeStyle=y,this.ctx.lineWidth=6,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(u+30,h+this.blockHeight/2),this.ctx.lineTo(p,h+this.blockHeight/2),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50",this.ctx.beginPath(),this.ctx.moveTo(p-15,h+this.blockHeight/2-8),this.ctx.lineTo(p,h+this.blockHeight/2),this.ctx.lineTo(p-15,h+this.blockHeight/2+8),this.ctx.fill()}else{const u=this.ctx.createLinearGradient(o+this.blockWidth,h+this.blockHeight/2,r,h+this.blockHeight/2);u.addColorStop(0,"#ffffff"),u.addColorStop(.5,"#4CAF50"),u.addColorStop(1,"#ffffff"),this.ctx.strokeStyle=u,this.ctx.lineWidth=6,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(o+this.blockWidth,h+this.blockHeight/2),this.ctx.lineTo(r,h+this.blockHeight/2),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50",this.ctx.beginPath(),this.ctx.moveTo(r-15,h+this.blockHeight/2-8),this.ctx.lineTo(r,h+this.blockHeight/2),this.ctx.lineTo(r-15,h+this.blockHeight/2+8),this.ctx.fill()}}}),this.miningBlock){let n=this.chainStartX+i.length*(this.blockWidth+this.blockSpacing);n+=30;const a=this.ctx.canvas.width-this.blockWidth-50;n>a&&(n=a);const o=this.chainStartY;this.miningGlow>0&&(this.ctx.shadowColor="#FF9800",this.ctx.shadowBlur=50*this.miningGlow,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0);const h=this.ctx.createLinearGradient(n,o,n+this.blockWidth,o+this.blockHeight);h.addColorStop(0,"#FFB74D"),h.addColorStop(.3,"#FF9800"),h.addColorStop(.7,"#F57C00"),h.addColorStop(1,"#E65100"),this.ctx.fillStyle=h,this.roundRect(n,o,this.blockWidth,this.blockHeight,12),this.ctx.fill();const l=this.ctx.createLinearGradient(n,o,n+this.blockWidth,o+this.blockHeight);l.addColorStop(0,"rgba(255, 255, 255, 0.9)"),l.addColorStop(.5,"rgba(255, 193, 7, 0.6)"),l.addColorStop(1,"rgba(255, 152, 0, 0.8)"),this.ctx.strokeStyle=l,this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.roundRect(n,o,this.blockWidth,this.blockHeight,12),this.ctx.stroke();const c=this.ctx.createLinearGradient(n,o,n,o+this.blockHeight);c.addColorStop(0,"rgba(255, 255, 255, 0.4)"),c.addColorStop(.5,"rgba(255, 193, 7, 0.2)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=c,this.roundRect(n+2,o+2,this.blockWidth-4,this.blockHeight/3,10),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.textAlign="left",this.ctx.font="bold 20px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=2,this.ctx.fillText("⛏️ Mining...",n+12,o+28),this.ctx.shadowBlur=0,this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`🔢 ${this.miningBlock.nonce.toLocaleString()}`,n+12,o+48),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillText(`🎯 ${this.targetHash}`,n+12,o+65),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.fillText(`💰 ${this.blockReward} | 💸 ${this.miningBlock.totalFees.toFixed(1)}`,n+12,o+82),this.showHashes&&(this.ctx.font='11px "JetBrains Mono", "Fira Code", monospace',this.ctx.fillStyle="rgba(255, 255, 255, 0.7)",this.ctx.fillText(`🔗 ${this.miningBlock.hash.substring(0,12)}...`,n+12,o+100));const d=this.miningBlock.nonce%100/100;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.roundRect(n+12,o+105,110,10,5),this.ctx.fill();const x=this.ctx.createLinearGradient(n+12,o+105,n+12+110*d,o+105);x.addColorStop(0,"#FFB74D"),x.addColorStop(.5,"#FF9800"),x.addColorStop(1,"#F57C00"),this.ctx.fillStyle=x,this.roundRect(n+12,o+105,110*d,10,5),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=1,this.roundRect(n+12,o+105,110,10,5),this.ctx.stroke()}}drawNetwork(){if(!this.showNetwork)return;const t=this.ctx.createRadialGradient(this.networkCenterX,this.networkCenterY,0,this.networkCenterX,this.networkCenterY,180);t.addColorStop(0,"rgba(33, 150, 243, 0.15)"),t.addColorStop(.7,"rgba(33, 150, 243, 0.08)"),t.addColorStop(1,"rgba(33, 150, 243, 0.03)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.networkCenterX-180,this.networkCenterY-180,360,360),this.ctx.strokeStyle=`rgba(255, 255, 255, ${.4+.3*Math.sin(this.networkPulse)})`,this.ctx.lineWidth=3,this.ctx.lineCap="round";for(let i=0;i<this.networkNodes.length;i++)for(let e=i+1;e<this.networkNodes.length;e++){const s=this.networkNodes[i],n=this.networkNodes[e],a=n.x-s.x,o=n.y-s.y;Math.sqrt(a*a+o*o)<200&&(this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(n.x,n.y),this.ctx.stroke())}this.networkNodes.forEach(i=>{i.isLeaving&&(this.ctx.globalAlpha=1-i.leaveProgress),this.nodeRadius+8*i.pulseIntensity*Math.sin(this.networkPulse*2);const e=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,this.nodeRadius);let s,n;if(i.color.startsWith("hsl")){const h=i.color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(h){const l=h[1],c=h[2],d=parseInt(h[3]);s=`hsl(${l}, ${c}%, ${d}%)`,n=`hsl(${l}, ${c}%, ${Math.max(0,d-30)}%)`}else s=i.color,n=i.color}else s=i.color,n=this.adjustColor(i.color,-30);e.addColorStop(0,s),e.addColorStop(.7,n),e.addColorStop(1,this.adjustColor(n,-20)),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius,0,2*Math.PI),this.ctx.fill();const a=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,this.nodeRadius);a.addColorStop(0,"rgba(255, 255, 255, 0.9)"),a.addColorStop(.5,"rgba(255, 255, 255, 0.6)"),a.addColorStop(1,"rgba(255, 255, 255, 0.3)"),this.ctx.strokeStyle=a,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius,0,2*Math.PI),this.ctx.stroke();const o=this.ctx.createRadialGradient(i.x-this.nodeRadius*.3,i.y-this.nodeRadius*.3,0,i.x,i.y,this.nodeRadius*.8);if(o.addColorStop(0,"rgba(255, 255, 255, 0.4)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius*.8,0,2*Math.PI),this.ctx.fill(),i===this.successfulMiner){const h=Math.sin(this.networkPulse*2)*.3+1,l=this.nodeRadius*h;this.ctx.shadowColor="#00FF88",this.ctx.shadowBlur=25*h,this.ctx.fillStyle="rgba(0, 255, 136, 0.3)",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+15,0,2*Math.PI),this.ctx.fill();const c=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l+20);c.addColorStop(0,"#00FF88"),c.addColorStop(.5,"#00E676"),c.addColorStop(1,"#00C853"),this.ctx.strokeStyle=c,this.ctx.lineWidth=4*h,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+18,0,2*Math.PI),this.ctx.stroke();const d=Math.sin(this.networkPulse*3)*.5+.5;this.ctx.strokeStyle=`rgba(0, 255, 136, ${.6+d*.4})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+25,0,2*Math.PI),this.ctx.stroke(),this.ctx.strokeStyle=`rgba(0, 255, 136, ${.4+d*.3})`,this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+32,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0;const x=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l);let r,g;if(i.color.startsWith("hsl")){const m=i.color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(m){const p=m[1],y=m[2],v=parseInt(m[3]);r=`hsl(${p}, ${y}%, ${v}%)`,g=`hsl(${p}, ${y}%, ${Math.max(0,v-30)}%)`}else r=i.color,g=i.color}else r=i.color,g=this.adjustColor(i.color,-30);x.addColorStop(0,r),x.addColorStop(.7,g),x.addColorStop(1,this.adjustColor(g,-20)),this.ctx.fillStyle=x,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l,0,2*Math.PI),this.ctx.fill();const u=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l);u.addColorStop(0,"rgba(255, 255, 255, 0.9)"),u.addColorStop(.5,"rgba(255, 255, 255, 0.6)"),u.addColorStop(1,"rgba(255, 255, 255, 0.3)"),this.ctx.strokeStyle=u,this.ctx.lineWidth=3*h,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l,0,2*Math.PI),this.ctx.stroke();const f=this.ctx.createRadialGradient(i.x-l*.3,i.y-l*.3,0,i.x,i.y,l*.8);f.addColorStop(0,"rgba(255, 255, 255, 0.4)"),f.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),f.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=f,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l*.8,0,2*Math.PI),this.ctx.fill(),this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#ffffff",this.ctx.font=`${Math.floor(11*h)}px Inter, Arial, sans-serif`,this.ctx.fillText(`Node ${i.id}`,i.x,i.y+5*h),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.globalAlpha=1;return}if(i.isMining){const h=Math.sin(this.networkPulse*3)*.5+.5;this.ctx.shadowColor="#FF9800",this.ctx.shadowBlur=15,this.ctx.strokeStyle=`rgba(255, 152, 0, ${.9+h*.1})`,this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+18,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=8,this.ctx.strokeStyle=`rgba(255, 235, 59, ${.8+h*.2})`,this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+14,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=12,this.ctx.strokeStyle=`rgba(255, 193, 7, ${.95+h*.05})`,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+10,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0;for(let l=0;l<6;l++){const c=l/6*2*Math.PI+this.networkPulse*2,d=this.nodeRadius+25+Math.sin(this.networkPulse*4+l)*5,x=i.x+Math.cos(c)*d,r=i.y+Math.sin(c)*d;this.ctx.fillStyle=`rgba(255, 152, 0, ${.7+Math.sin(this.networkPulse*3+l)*.3})`,this.ctx.beginPath(),this.ctx.arc(x,r,3,0,2*Math.PI),this.ctx.fill()}}i.isValidating&&(this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=10,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+16,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),i.isJoining&&(this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=12,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+22,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),i.isMoving&&(this.ctx.shadowColor="#2196F3",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#2196F3",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+20,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#ffffff",this.ctx.font="11px Inter, Arial, sans-serif",this.ctx.fillText(`Node ${i.id}`,i.x,i.y+5),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.globalAlpha=1})}adjustColor(t,i){if(t.startsWith("hsl"))return t;if(t.startsWith("#")){const e=t.replace("#","");if(e.length===6){const s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}}return t}roundRect(t,i,e,s,n){this.ctx.beginPath(),this.ctx.moveTo(t+n,i),this.ctx.lineTo(t+e-n,i),this.ctx.quadraticCurveTo(t+e,i,t+e,i+n),this.ctx.lineTo(t+e,i+s-n),this.ctx.quadraticCurveTo(t+e,i+s,t+e-n,i+s),this.ctx.lineTo(t+n,i+s),this.ctx.quadraticCurveTo(t,i+s,t,i+s-n),this.ctx.lineTo(t,i+n),this.ctx.quadraticCurveTo(t,i,t+n,i),this.ctx.closePath()}drawTransactions(){const n=Date.now();this.pendingTransactions.slice(0,3).forEach((a,o)=>{const h=60+o*250,l=40,c=n-a.timestamp,d=Math.floor(c/1e3),x=Math.max(.6,1-c/3e4),r=this.ctx.createLinearGradient(h,l,h+220,l+120);c>2e4?(r.addColorStop(0,"#4B5563"),r.addColorStop(.3,"#6B7280"),r.addColorStop(.7,"#374151"),r.addColorStop(1,"#1F2937")):(r.addColorStop(0,"#6A4C93"),r.addColorStop(.3,"#8B5CF6"),r.addColorStop(.7,"#7C3AED"),r.addColorStop(1,"#5B21B6")),this.ctx.fillStyle=r,this.ctx.globalAlpha=x,this.roundRect(h,l,220,120,12),this.ctx.fill();const g=c>2e4?"#9CA3AF":"#E0E7FF";this.ctx.strokeStyle=g,this.ctx.lineWidth=2,this.ctx.shadowColor=c>2e4?"#6B7280":"#8B5CF6",this.ctx.shadowBlur=8,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1,this.ctx.fillStyle="#ffffff",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.fillText(`${a.from} → ${a.to}`,h+15,l+25),this.ctx.font="12px Inter, Arial, sans-serif",this.ctx.fillText(`Amount: ${a.amount} tokens`,h+15,l+45),this.ctx.fillText(`Type: ${a.type.replace("_"," ")}`,h+15,l+60),this.ctx.fillText(`Fee: ${a.fee.toFixed(1)} tokens`,h+15,l+75);const u=d<60?`${d}s ago`:`${Math.floor(d/60)}m ago`;this.ctx.fillText(`Age: ${u}`,h+15,l+90);const f=a.fee>this.transactionFee*1.5?"#10B981":a.fee>this.transactionFee?"#F59E0B":"#EF4444";if(this.ctx.fillStyle=f,this.ctx.fillText(`Priority: ${a.fee>this.transactionFee*1.5?"High":a.fee>this.transactionFee?"Medium":"Low"}`,h+15,l+105),a.description){this.ctx.font="10px Inter, Arial, sans-serif",this.ctx.fillStyle="#E0E7FF";const m=a.description.length>25?a.description.substring(0,22)+"...":a.description;this.ctx.fillText(m,h+15,l+118)}if(c<5e3){const m=Math.sin(n*.01)*.3+.7;this.ctx.strokeStyle=`rgba(139, 92, 246, ${m})`,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.roundRect(h,l,220,120,12),this.ctx.stroke()}}),this.ctx.globalAlpha=1}drawParticles(){this.miningParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.networkParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.contractExecutionParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.blockCreationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.validationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.consensusParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.finalizationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.rewardParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.nodeJoinParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.nodeLeaveParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.rejectionParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1}drawPropagationArrows(){this.propagationArrows.forEach(t=>{const i=t.startX+(t.endX-t.startX)*t.progress,e=t.startY+(t.endY-t.startY)*t.progress;this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(i,e),this.ctx.stroke();const s=Math.atan2(t.endY-t.startY,t.endX-t.startX),n=12,a=Math.PI/6;this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i-n*Math.cos(s-a),e-n*Math.sin(s-a)),this.ctx.moveTo(i,e),this.ctx.lineTo(i-n*Math.cos(s+a),e-n*Math.sin(s+a)),this.ctx.stroke(),this.ctx.shadowBlur=0})}drawUnifiedInfoPanel(){const i=this.ctx.canvas.height-200,e=340,s=180,n=this.ctx.createLinearGradient(60,i,60,i+s);n.addColorStop(0,"rgba(0, 0, 0, 0.75)"),n.addColorStop(.7,"rgba(0, 0, 0, 0.65)"),n.addColorStop(1,"rgba(0, 0, 0, 0.55)"),this.ctx.fillStyle=n,this.ctx.fillRect(60,i,e,s),this.ctx.strokeStyle="rgba(33, 150, 243, 0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(60,i,e,s),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillText("Blockchain Network Status",75,i+25);const a=this.animationPhase.charAt(0).toUpperCase()+this.animationPhase.slice(1).replace("_"," ");if(this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.fillText(`Current Phase: ${a}`,75,i+45),this.ctx.font="12px Inter, Arial, sans-serif",this.ctx.fillText(`Total Blocks: ${this.totalBlocks}`,75,i+65),this.ctx.fillText(`Total Transactions: ${this.totalTransactions}`,75,i+80),this.ctx.fillText(`Pending Transactions: ${this.pendingTransactions.length}`,75,i+95),this.ctx.fillText(`Current Difficulty: ${this.difficulty}`,75,i+110),this.miningBlock?(this.ctx.fillText(`Current Nonce: ${this.miningBlock.nonce.toLocaleString()}`,230,i+65),this.ctx.fillText(`Target Hash: ${this.targetHash}`,230,i+80),this.ctx.fillText(`Network Hashrate: ${this.networkHashrate.toLocaleString()} H/s`,230,i+95),this.ctx.fillText(`Active Miners: ${this.miners.length}`,230,i+110)):this.guidedMode&&this.guidedBlock&&(this.ctx.fillText(`Process Step: ${this.currentStep+1}/${this.phaseSteps.length}`,230,i+65),this.ctx.fillText(`Block #${this.guidedBlock.index}`,230,i+80),this.ctx.fillText(`Phase Time: ${this.phaseTime.toFixed(1)}s`,230,i+95),this.ctx.fillText(`Total Rewards: ${this.totalRewards.toFixed(1)}`,230,i+110)),this.ctx.fillText(`Average Block Time: ${(this.averageBlockTime/1e3).toFixed(1)}s`,75,i+130),this.ctx.fillText(`Network Nodes: ${this.networkNodes.length}`,230,i+130),this.guidedMode&&this.guidedBlock){const h=(this.networkNodes.filter(l=>l.consensusReached).length/this.networkNodes.length*100).toFixed(0);this.ctx.fillText(`Consensus: ${h}%`,75,i+150)}if(this.guidedMode&&this.guidedBlock){const o=(this.currentStep+1)/this.phaseSteps.length;this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.fillRect(75,i+150,310,6),this.ctx.fillStyle="#4CAF50",this.ctx.fillRect(75,i+150,310*o,6)}this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0}render(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBlockchain(),this.drawNetwork(),this.drawTransactions(),this.drawParticles(),this.drawMinerRewardDisplay(),this.drawUnifiedInfoPanel(),this.guidedPhaseIndicator&&this.drawGuidedPhaseIndicator(),this.minerRewardDisplay&&this.drawMinerRewardDisplay()}drawGuidedPhaseIndicator(){if(!this.guidedPhaseIndicator)return;const t=this.ctx.canvas.width/2,i=this.guidedPhaseIndicator.y||350,e=this.guidedPhaseIndicator.color||"#00FF88";this.ctx.font="bold 22px Inter, Arial, sans-serif",this.ctx.textAlign="center";const s=this.ctx.measureText(this.guidedPhaseIndicator.text).width,n=Math.max(s+80,300),a=60,o=t-n/2,h=i-a/2,l=t+n/2,c=i+a/2;if(isFinite(o)&&isFinite(h)&&isFinite(l)&&isFinite(c)){const d=this.ctx.createLinearGradient(o,h,l,c);d.addColorStop(0,"rgba(0, 0, 0, 0.9)"),d.addColorStop(.5,"rgba(20, 20, 20, 0.95)"),d.addColorStop(1,"rgba(0, 0, 0, 0.9)"),this.ctx.fillStyle=d,this.roundRect(t-n/2,i-a/2,n,a,15),this.ctx.fill(),this.ctx.strokeStyle=e,this.ctx.lineWidth=4,this.ctx.shadowColor=e,this.ctx.shadowBlur=15,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=1,this.roundRect(t-n/2+2,i-a/2+2,n-4,a-4,13),this.ctx.stroke(),this.ctx.fillStyle=e,this.ctx.font="bold 22px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillText(this.guidedPhaseIndicator.text,t,i+8),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.guidedPhaseIndicator.alpha=.8+.2*Math.sin(Date.now()*.005),this.ctx.globalAlpha=this.guidedPhaseIndicator.alpha,this.ctx.globalAlpha=1}}getStats(){const t=this.difficulty,i=this.blocks.length,e=Math.min(8,t+Math.floor(i/5)),s=this.networkNodes.filter(o=>o.consensusReached),n=this.networkNodes.length*.6,a=this.networkNodes.length>0?Math.round(s.length/this.networkNodes.length*100):0;return{blocks:this.totalBlocks,transactions:this.totalTransactions,pending:this.pendingTransactions.length,difficulty:e,hashrate:this.networkHashrate,miners:this.miners.length,nodes:this.networkNodes.length,phase:this.animationPhase,isMining:this.isMining,totalRewards:this.totalRewards,averageBlockTime:this.averageBlockTime/1e3,consensusPercentage:a,consensusThreshold:Math.round(n*100/this.networkNodes.length),consensusReached:s.length>=n}}reset(){this.blocks=[],this.pendingTransactions=[],this.miningBlock=null,this.isMining=!1,this.animationPhase="idle",this.phaseTime=0,this.miningParticles=[],this.validationParticles=[],this.networkParticles=[],this.propagationArrows=[],this.contractExecutionParticles=[],this.blockCreationParticles=[],this.consensusParticles=[],this.finalizationParticles=[],this.rewardParticles=[],this.rejectionParticles=[],this.nodeJoinParticles=[],this.nodeLeaveParticles=[],this.guidedBlock=null,this.currentStep=0,this.totalBlocks=0,this.totalTransactions=0,this.guidedPhaseIndicator=null,this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.lastNodeJoin=0,this.lastNodeLeave=0,this.nodeRedistributionTimer=0,this.nextNodeId=1,this.blockTimes=[],this.lastDifficultyAdjustment=0,this.lastBlockTime=0,this.difficulty=4,this.targetHash="0".repeat(this.difficulty),this.speed=1,this.showHashes=!0,this.showNetwork=!0,this.autoMine=!0,this.resetControls(),this.initializeBlockchain(),this.initializeNetwork(),this.startGenesisBlock()}resetControls(){const t=document.getElementById("blockchainDifficulty"),i=document.getElementById("blockchainDifficultyValue");t&&i&&(t.value=this.difficulty,i.textContent=this.difficulty);const e=document.getElementById("blockchainSpeed"),s=document.getElementById("blockchainSpeedValue");e&&s&&(e.value=this.speed,s.textContent=this.speed+"x")}drawMinerBlockConnection(){if(!this.minerBlockConnection)return;const t=this.minerBlockConnection;t.progress+=t.speed,t.progress>1&&(t.progress=1);const i=t.startX+(t.endX-t.startX)*t.progress,e=t.startY+(t.endY-t.startY)*t.progress;this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width,this.ctx.globalAlpha=t.alpha,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(i,e),this.ctx.stroke();const s=Math.atan2(t.endY-t.startY,t.endX-t.startX),n=15,a=Math.PI/6;this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i-n*Math.cos(s-a),e-n*Math.sin(s-a)),this.ctx.moveTo(i,e),this.ctx.lineTo(i-n*Math.cos(s+a),e-n*Math.sin(s+a)),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1,t.pulseIntensity=.8+.2*Math.sin(Date.now()*.01)}drawMinerRewardDisplay(){if(!this.minerRewardDisplay)return;const t=this.minerRewardDisplay;if(t.life-=.016,t.y+=t.velocity*.016,t.alpha=t.life/t.maxLife,t.life<=0){this.minerRewardDisplay=null;return}this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.alpha,this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.fillText(t.text,t.x,t.y),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.fillText(t.text,t.x,t.y),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}createRejectionParticles(){const t=this.blocks.length;let i;if(t<=4){const s=t;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],...this.blocks.slice(-2)].length;i=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<20;s++)this.rejectionParticles.push({x:i,y:e,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:2.5,maxLife:2.5,color:"#FF5722",size:5})}}class St{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.currentAnimation="brownian",this.isRunning=!0,this.lastTime=0,this.brownianMotion=new st(this.ctx),this.pendulum=new ot(this.ctx),this.diffusion=new nt(this.ctx),this.waves=new ct(this.ctx),this.orbital=new ht(this.ctx),this.electricFields=new xt(this.ctx),this.gasLaws=new at(this.ctx),this.collisions=new rt(this.ctx),this.friction=new lt(this.ctx),this.magneticFields=new gt(this.ctx),this.waveParticleDuality=new ft(this.ctx),this.nuclearReactions=new pt(this.ctx),this.fluidFlow=new mt(this.ctx),this.bernoulli=new yt(this.ctx),this.soundWaves=new dt(this.ctx),this.diodeTransistor=new ut(this.ctx),this.neuralNetwork=new wt(this.ctx),this.memoryManagement=new vt(this.ctx),this.blockchain=new bt(this.ctx),this.setupEventListeners(),this.resizeCanvas(),setTimeout(()=>{this.initializeWaveControls(),this.initializeSoundWavesControls(),this.initializeDiodeTransistorControls()},100),this.animate()}setupEventListeners(){document.querySelectorAll(".category-header").forEach(r=>{r.addEventListener("click",g=>{const u=g.currentTarget.closest(".category-item");u.dataset.category;const f=document.querySelector(".side-navigation"),m=document.querySelector(".main-content");if(f.classList.contains("collapsed")){f.classList.remove("collapsed"),m.classList.remove("nav-collapsed");return}if(document.querySelectorAll(".category-item").forEach(p=>{p!==u&&p.classList.remove("active")}),u.classList.toggle("active"),u.classList.contains("active")){const p=u.querySelector(".submenu-item");p&&!p.classList.contains("active")&&this.switchAnimation(p.dataset.animation)}})}),document.querySelectorAll(".submenu-item").forEach(r=>{r.addEventListener("click",g=>{const u=g.currentTarget.dataset.animation;document.querySelectorAll(".submenu-item").forEach(f=>{f.classList.remove("active")}),g.currentTarget.classList.add("active"),this.switchAnimation(u)})});const t=document.querySelector(".nav-toggle-btn"),i=document.querySelector(".side-navigation"),e=document.querySelector(".main-content");t&&t.addEventListener("click",()=>{i.classList.toggle("collapsed"),e.classList.toggle("nav-collapsed")});const s=document.getElementById("mobileNavToggle");s&&i&&s.addEventListener("click",()=>{s.classList.toggle("open"),i.classList.toggle("open")}),document.addEventListener("click",r=>{window.innerWidth<=768&&!r.target.closest(".side-navigation")&&!r.target.closest(".mobile-nav-toggle")&&s&&i&&(s.classList.remove("open"),i.classList.remove("open"))}),document.getElementById("playPauseBtn").addEventListener("click",()=>{this.togglePlayPause()}),document.getElementById("resetBtn").addEventListener("click",()=>{this.resetAnimation()}),document.getElementById("learnMoreBtn").addEventListener("click",()=>{this.showScienceExplanation()}),document.getElementById("closeModal").addEventListener("click",()=>{this.closeModal()}),document.getElementById("scienceModal").addEventListener("click",r=>{r.target.id==="scienceModal"&&this.closeModal()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.closeModal()}),this.setupSliderControl("particleCount","particleCountValue",r=>{this.brownianMotion.setParticleCount(parseInt(r))}),this.setupSliderControl("speed","speedValue",r=>{this.brownianMotion.setSpeed(parseFloat(r))}),this.setupSliderControl("temperature","temperatureValue",r=>{this.brownianMotion.setTemperature(parseFloat(r))}),this.setupSliderControl("brownianParticleSize","brownianParticleSizeValue",r=>{this.brownianMotion.setParticleSize(parseInt(r))}),document.getElementById("brownianVisualizationMode").addEventListener("change",r=>{this.updateBrownianVisualization(r.target.value)}),this.updateBrownianVisualization("basic"),this.setupSliderControl("pendulumLength","pendulumLengthValue",r=>{this.pendulum.setLength(parseInt(r))}),this.setupSliderControl("pendulumSpeed","pendulumSpeedValue",r=>{this.pendulum.setSpeed(parseFloat(r))}),this.setupSliderControl("initialAngle","initialAngleValue",r=>{this.pendulum.setInitialAngle(parseFloat(r))}),this.setupSliderControl("gravity","gravityValue",r=>{this.pendulum.setGravity(parseFloat(r))}),this.setupSliderControl("damping","dampingValue",r=>{this.pendulum.setDamping(parseFloat(r))}),document.getElementById("pendulumVisualizationMode").addEventListener("change",r=>{this.updatePendulumVisualization(r.target.value)}),this.updatePendulumVisualization("basic"),this.setupSliderControl("diffusionParticles","diffusionParticlesValue",r=>{this.diffusion.setParticleCount(parseInt(r))}),this.setupSliderControl("diffusionSpeed","diffusionSpeedValue",r=>{this.diffusion.setSpeed(parseFloat(r))}),this.setupSliderControl("diffusionRate","diffusionRateValue",r=>{this.diffusion.setDiffusionRate(parseFloat(r))}),this.setupSliderControl("concentrationGradient","concentrationGradientValue",r=>{this.diffusion.setConcentrationGradient(parseFloat(r))}),this.setupSliderControl("diffusionParticleSize","diffusionParticleSizeValue",r=>{this.diffusion.setParticleSize(parseInt(r))}),document.getElementById("diffusionVisualizationMode").addEventListener("change",r=>{this.updateDiffusionVisualization(r.target.value)}),this.updateDiffusionVisualization("basic");const n=document.getElementById("waveType");n&&n.addEventListener("change",r=>{r.stopPropagation(),r.preventDefault(),this.waves.setWaveType(r.target.value)}),this.setupSliderControl("waveSpeed","waveSpeedValue",r=>{this.waves.setSpeed(parseFloat(r))}),this.setupSliderControl("waveFrequency","waveFrequencyValue",r=>{this.waves.setFrequency(parseFloat(r))}),this.setupSliderControl("waveAmplitude","waveAmplitudeValue",r=>{this.waves.setAmplitude(parseFloat(r))});const a=document.getElementById("waveShowAnalytics");a&&a.addEventListener("change",r=>{this.waves.setShowAnalytics(r.target.checked)}),this.setupSliderControl("soundFrequency","soundFrequencyValue",r=>{this.soundWaves.setFrequency(parseInt(r))}),this.setupSliderControl("soundAmplitude","soundAmplitudeValue",r=>{this.soundWaves.setAmplitude(parseInt(r))}),this.setupSliderControl("soundSpeed","soundSpeedValue",r=>{this.soundWaves.setWaveSpeed(parseInt(r))}),this.setupSliderControl("soundParticles","soundParticlesValue",r=>{this.soundWaves.setParticleCount(parseInt(r))}),this.setupSliderControl("soundAnimationSpeed","soundAnimationSpeedValue",r=>{this.soundWaves.setAnimationSpeed(parseFloat(r))});const o=document.getElementById("soundWaveType");o&&o.addEventListener("change",r=>{this.soundWaves.setWaveType(r.target.value)}),this.setupSliderControl("orbitalSpeed","orbitalSpeedValue",r=>{this.orbital.setSpeed(parseFloat(r))}),this.setupSliderControl("eccentricity","eccentricityValue",r=>{this.orbital.setEccentricity(parseFloat(r))}),this.setupSliderControl("semiMajorAxis","semiMajorAxisValue",r=>{this.orbital.setSemiMajorAxis(parseInt(r))}),this.setupSliderControl("centralMass","centralMassValue",r=>{this.orbital.setCentralMass(parseFloat(r))}),document.getElementById("orbitalVisualizationMode").addEventListener("change",r=>{this.updateOrbitalVisualization(r.target.value)}),this.updateOrbitalVisualization("basic"),this.setupSliderControl("efSpeed","efSpeedValue",r=>{this.electricFields.setSpeed(parseFloat(r))}),this.setupSliderControl("efFieldStrength","efFieldStrengthValue",r=>{this.electricFields.setFieldStrength(parseFloat(r))}),this.setupSliderControl("efParticleCount","efParticleCountValue",r=>{this.electricFields.setParticleCount(parseInt(r))}),this.setupSliderControl("magneticSpeed","magneticSpeedValue",r=>{this.magneticFields.setSpeed(parseFloat(r))}),this.setupSliderControl("magneticFieldStrength","magneticFieldStrengthValue",r=>{this.magneticFields.setFieldStrength(parseFloat(r))}),this.setupSliderControl("magneticParticleCount","magneticParticleCountValue",r=>{this.magneticFields.setParticleCount(parseInt(r))}),document.getElementById("magneticShowFieldLines").addEventListener("change",r=>{this.magneticFields.setShowFieldLines(r.target.checked)}),document.getElementById("magneticShowForceArrows").addEventListener("change",r=>{this.magneticFields.setShowForceArrows(r.target.checked)}),this.canvas.addEventListener("click",r=>{const g=this.canvas.getBoundingClientRect(),u=r.clientX-g.left,f=r.clientY-g.top;if(this.currentAnimation==="electric-fields"){const m=document.getElementById("efChargeType").value;this.electricFields.addChargeAtPosition(m,u,f)}else if(this.currentAnimation==="magnetic-fields")this.magneticFields.addMagnetAtPosition(u,f);else if(this.currentAnimation==="diffusion"&&!this.diffusion.diffusionStarted)this.diffusion.startDiffusion();else if(this.currentAnimation==="sound-waves"){const m=this.soundWaves.sourceX,p=this.soundWaves.sourceY;Math.sqrt((u-m)**2+(f-p)**2)<=50&&this.soundWaves.triggerWavePulse()}else this.currentAnimation==="neural-network"?this.neuralNetwork.handleCanvasClick(u,f):this.currentAnimation==="memory-management"&&this.memoryManagement&&this.memoryManagement.handleClick(u,f)}),this.setupSliderControl("gasSpeed","gasSpeedValue",r=>{this.gasLaws.setSpeed(parseFloat(r))}),this.setupSliderControl("gasParticleCount","gasParticleCountValue",r=>{this.gasLaws.setParticleCount(parseInt(r))}),this.setupSliderControl("gasTemperature","gasTemperatureValue",r=>{this.gasLaws.setTemperature(parseInt(r))}),this.setupSliderControl("gasVolume","gasVolumeValue",r=>{this.gasLaws.setVolume(parseInt(r))}),this.setupSliderControl("gasPressure","gasPressureValue",r=>{this.gasLaws.setPressure(parseFloat(r))}),document.getElementById("gasVisualizationMode").addEventListener("change",r=>{this.updateGasVisualization(r.target.value)}),document.getElementById("lawType").addEventListener("change",r=>{this.gasLaws.setLawType(r.target.value)}),this.updateGasVisualization("basic"),this.setupSliderControl("collisionSpeed","collisionSpeedValue",r=>{this.collisions.setSpeed(parseFloat(r))}),this.setupSliderControl("ballCount","ballCountValue",r=>{this.collisions.setBallCount(parseInt(r))}),this.setupSliderControl("restitution","restitutionValue",r=>{this.collisions.setRestitution(parseFloat(r))}),this.setupSliderControl("collisionGravity","collisionGravityValue",r=>{this.collisions.setGravity(parseFloat(r))}),document.getElementById("showAnalytics").addEventListener("change",r=>{this.collisions.setShowAnalytics(r.target.checked)}),document.getElementById("collisionType").addEventListener("change",r=>{this.collisions.setCollisionType(r.target.value)}),this.setupSliderControl("frictionSpeed","frictionSpeedValue",r=>{this.friction.setSpeed(parseFloat(r))}),this.setupSliderControl("inclineAngle","inclineAngleValue",r=>{this.friction.setInclineAngle(parseFloat(r))}),this.setupSliderControl("objectMass","objectMassValue",r=>{this.friction.setObjectMass(parseInt(r))}),this.setupSliderControl("frictionGravity","frictionGravityValue",r=>{this.friction.setGravity(parseFloat(r))}),document.getElementById("showFrictionAnalytics").addEventListener("change",r=>{this.friction.setShowAnalytics(r.target.checked)}),this.setupSliderControl("frictionCoefficient","frictionCoefficientValue",r=>{this.friction.setFrictionCoefficient(parseFloat(r))}),window.addEventListener("resize",()=>{this.resizeCanvas()}),this.canvas.addEventListener("touchstart",r=>{r.preventDefault();const g=this.canvas.getBoundingClientRect(),u=r.touches[0],f=u.clientX-g.left,m=u.clientY-g.top;if(this.currentAnimation==="diffusion"&&!this.diffusion.diffusionStarted)this.diffusion.startDiffusion();else if(this.currentAnimation==="electric-fields"){const p=document.getElementById("efChargeType").value;this.electricFields.addChargeAtPosition(p,f,m)}else if(this.currentAnimation==="magnetic-fields")this.magneticFields.addMagnetAtPosition(f,m);else if(this.currentAnimation==="sound-waves"){const p=this.soundWaves.sourceX,y=this.soundWaves.sourceY;Math.sqrt((f-p)**2+(m-y)**2)<=50&&this.soundWaves.triggerWavePulse()}else this.currentAnimation==="neural-network"?this.neuralNetwork.handleCanvasClick(f,m):this.currentAnimation==="memory-management"&&this.memoryManagement?this.memoryManagement.handleClick(f,m):this.currentAnimation==="nuclear-reactions"&&this.nuclearReactions.reactingParticles.forEach(p=>{p.moving||(this.nuclearReactions.findTargetForParticle(p),p.moving=!0)})}),this.canvas.addEventListener("touchmove",r=>{r.preventDefault()}),this.canvas.addEventListener("touchend",r=>{r.preventDefault()}),document.getElementById("dualityMode").addEventListener("change",r=>{this.waveParticleDuality.setMode(r.target.value),this.updateDualityControls(r.target.value)}),this.setupSliderControl("dualitySpeed","dualitySpeedValue",r=>{this.waveParticleDuality.setSpeed(parseFloat(r))}),this.setupSliderControl("dualityEnergy","dualityEnergyValue",r=>{this.waveParticleDuality.setPhotonEnergy(parseFloat(r))}),this.setupSliderControl("dualityWavelength","dualityWavelengthValue",r=>{this.waveParticleDuality.setWavelength(parseFloat(r))}),document.getElementById("performMeasurementBtn").addEventListener("click",()=>{this.waveParticleDuality.performMeasurement()});const h=document.getElementById("dualityMode").value;this.updateDualityControls(h),this.setupSliderControl("nuclearSpeed","nuclearSpeedValue",r=>{this.nuclearReactions.setSpeed(parseFloat(r))}),this.setupSliderControl("neutronEnergy","neutronEnergyValue",r=>{this.nuclearReactions.setNeutronEnergy(parseFloat(r))}),this.setupSliderControl("nuclearTemperature","nuclearTemperatureValue",r=>{this.nuclearReactions.setTemperature(parseFloat(r))}),document.getElementById("nuclearMode").addEventListener("change",r=>{this.nuclearReactions.setMode(r.target.value)}),this.setupSliderControl("fluidSpeed","fluidSpeedValue",r=>{this.fluidFlow.setFlowRate(parseFloat(r))}),this.setupSliderControl("flowRate","flowRateValue",r=>{this.fluidFlow.setFlowRate(parseFloat(r))}),this.setupSliderControl("viscosity","viscosityValue",r=>{this.fluidFlow.setViscosity(parseFloat(r))}),this.setupSliderControl("reynoldsNumber","reynoldsNumberValue",r=>{this.fluidFlow.setReynoldsNumber(parseInt(r))}),document.getElementById("fluidVisualizationMode").addEventListener("change",r=>{this.fluidFlow.setVisualizationMode(r.target.value)}),this.setupSliderControl("bernoulliSpeed","bernoulliSpeedValue",r=>{this.bernoulli.setPressureDifference(parseFloat(r))}),this.setupSliderControl("pipeWidth","pipeWidthValue",r=>{this.bernoulli.setPipeWidth(parseInt(r))}),this.setupSliderControl("fluidDensity","fluidDensityValue",r=>{this.bernoulli.setFluidDensity(parseFloat(r))}),this.setupSliderControl("pressureDifference","pressureDifferenceValue",r=>{this.bernoulli.setPressureDifference(parseFloat(r))}),document.getElementById("bernoulliVisualizationMode").addEventListener("change",r=>{this.bernoulli.setVisualizationMode(r.target.value)}),this.setupSliderControl("soundAnimationSpeed","soundAnimationSpeedValue",r=>{this.soundWaves.setAnimationSpeed(parseFloat(r))}),this.setupSliderControl("soundFrequency","soundFrequencyValue",r=>{this.soundWaves.setFrequency(parseInt(r))}),this.setupSliderControl("soundAmplitude","soundAmplitudeValue",r=>{this.soundWaves.setAmplitude(parseInt(r))}),this.setupSliderControl("soundSpeed","soundSpeedValue",r=>{this.soundWaves.setWaveSpeed(parseInt(r))}),this.setupSliderControl("soundParticles","soundParticlesValue",r=>{this.soundWaves.setParticleCount(parseInt(r))}),document.getElementById("soundWaveType").addEventListener("change",r=>{this.soundWaves.setWaveType(r.target.value)}),this.canvas.addEventListener("click",r=>{if(this.currentAnimation==="sound-waves"){const g=this.canvas.getBoundingClientRect(),u=r.clientX-g.left,f=r.clientY-g.top,m=this.soundWaves.sourceX,p=this.soundWaves.sourceY;Math.sqrt((u-m)**2+(f-p)**2)<=50&&this.soundWaves.triggerWavePulse()}});const l=document.getElementById("diodeComponentType"),c=document.getElementById("diodeBiasType");l&&l.addEventListener("change",r=>{this.diodeTransistor&&this.diodeTransistor.setComponentType(r.target.value)}),c&&c.addEventListener("change",r=>{this.diodeTransistor&&this.diodeTransistor.setBiasType(r.target.value)}),this.setupSliderControl("diodeInputVoltage","diodeInputVoltageValue",r=>{this.diodeTransistor&&this.diodeTransistor.setInputVoltage(parseFloat(r))}),this.setupSliderControl("diodeBaseVoltage","diodeBaseVoltageValue",r=>{this.diodeTransistor&&this.diodeTransistor.setBaseVoltage(parseFloat(r))}),this.setupSliderControl("diodeAnimationSpeed","diodeAnimationSpeedValue",r=>{this.diodeTransistor&&this.diodeTransistor.setAnimationSpeed(parseFloat(r))}),this.setupSliderControl("neuralLearningRate","neuralLearningRateValue",r=>{this.neuralNetwork&&this.neuralNetwork.setLearningRate(parseFloat(r))}),this.setupSliderControl("neuralSpeed","neuralSpeedValue",r=>{this.neuralNetwork&&this.neuralNetwork.setSpeed(parseFloat(r))}),this.setupSliderControl("memorySpeed","memorySpeedValue",r=>{this.memoryManagement&&this.memoryManagement.setAnimationSpeed(parseFloat(r))});const d=document.getElementById("showOutput");d&&this.memoryManagement&&(d.checked=this.memoryManagement.showOutput,d.addEventListener("change",r=>{this.memoryManagement.setShowOutput(r.target.checked)})),this.setupSliderControl("blockchainSpeed","blockchainSpeedValue",r=>{this.blockchain&&this.blockchain.setSpeed(parseFloat(r))}),this.setupSliderControl("blockchainDifficulty","blockchainDifficultyValue",r=>{this.blockchain&&this.blockchain.setDifficulty(parseInt(r))});const x=document.getElementById("neuralMode");x&&x.addEventListener("change",r=>{if(this.neuralNetwork){const g=r.target.value==="testing";this.neuralNetwork.setTestingMode(g),g?(this.neuralNetwork.setShowWeights(!0),this.neuralNetwork.setShowGradients(!1),this.neuralNetwork.setShowLoss(!1),this.neuralNetwork.setAutoTrain(!1)):(this.neuralNetwork.setShowWeights(!0),this.neuralNetwork.setShowGradients(!1),this.neuralNetwork.setShowLoss(!0),this.neuralNetwork.setAutoTrain(!0))}})}setupSliderControl(t,i,e){const s=document.getElementById(t),n=document.getElementById(i);if(!s){console.warn(`Slider not found: ${t}`);return}if(!n){console.warn(`Value display not found: ${i}`);return}s.addEventListener("input",a=>{const o=a.target.value,h=t.includes("Speed")?"x":t.includes("Angle")?"°":t.includes("Length")?"":t.includes("Wavelength")?" px":t.includes("Frequency")?" Hz":t.includes("gasTemperature")?"K":t.includes("frictionCoefficient")?"":t.includes("Voltage")?"V":"";n.textContent=o+h,e(o)})}updateDualityControls(t){const i=document.getElementById("performMeasurementBtn");t==="superposition"||t==="measurement"?i.style.display="inline-block":i.style.display="none"}updateBrownianVisualization(t){switch(this.brownianMotion.setShowTemperatureHeatmap(!1),this.brownianMotion.setShowVelocityDistribution(!1),this.brownianMotion.setShowMeanFreePath(!1),t){case"basic":break;case"heatmap":this.brownianMotion.setShowTemperatureHeatmap(!0);break;case"advanced":this.brownianMotion.setShowTemperatureHeatmap(!0),this.brownianMotion.setShowVelocityDistribution(!0),this.brownianMotion.setShowMeanFreePath(!0);break}}updateDiffusionVisualization(t){const i=this.diffusion;switch(t){case"basic":i.setShowConcentration(!1),i.setShowConcentrationProfile(!1),i.setShowParticleTrails(!1);break;case"heatmap":i.setShowConcentration(!0),i.setShowConcentrationProfile(!1),i.setShowParticleTrails(!1);break;case"profile":i.setShowConcentration(!1),i.setShowConcentrationProfile(!0),i.setShowParticleTrails(!1);break;case"advanced":i.setShowConcentration(!0),i.setShowConcentrationProfile(!0),i.setShowParticleTrails(!0);break}}updateGasVisualization(t){const i=this.gasLaws;switch(t){case"basic":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!1),i.setShowVelocityDistribution(!1),i.setShowGasLawGraph(!1),i.setShowParticleCollisions(!1);break;case"pressure":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!0),i.setShowVelocityDistribution(!1),i.setShowGasLawGraph(!0),i.setShowParticleCollisions(!1);break;case"advanced":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!0),i.setShowVelocityDistribution(!0),i.setShowGasLawGraph(!0),i.setShowParticleCollisions(!0);break}}updatePendulumVisualization(t){const i=this.pendulum;switch(t){case"basic":i.setShowPath(!1),i.setShowVelocityVectors(!1),i.setShowForceVectors(!0),i.setShowEnergyInfo(!1),i.setShowPhaseSpace(!1);break;case"vectors":i.setShowPath(!1),i.setShowVelocityVectors(!0),i.setShowForceVectors(!0),i.setShowEnergyInfo(!1),i.setShowPhaseSpace(!1);break;case"advanced":i.setShowPath(!0),i.setShowVelocityVectors(!0),i.setShowForceVectors(!0),i.setShowEnergyInfo(!0),i.setShowPhaseSpace(!0);break}}updateOrbitalVisualization(t){switch(t){case"basic":this.orbital.setShowOrbitPath(!0),this.orbital.setShowVelocityVector(!1),this.orbital.setShowKeplerInfo(!1);break;case"advanced":this.orbital.setShowOrbitPath(!0),this.orbital.setShowVelocityVector(!0),this.orbital.setShowKeplerInfo(!0);break}}switchCategory(t){document.querySelectorAll(".category-btn").forEach(n=>{n.classList.remove("active")});const i=document.querySelector(`[data-category="${t}"]`);i&&i.classList.add("active"),document.querySelectorAll(".animation-group").forEach(n=>{n.classList.remove("active")});const e=document.getElementById(`${t}-animations`);e&&e.classList.add("active");const s=document.querySelector(`#${t}-animations .nav-btn:not(.disabled)`);s?this.switchAnimation(s.dataset.animation):console.warn("No available animations found for category:",t)}switchAnimation(t){if(t===this.currentAnimation)return;document.querySelectorAll(".submenu-item").forEach(n=>{n.classList.remove("active")});const i=document.querySelector(`[data-animation="${t}"]`);if(i){i.classList.add("active");const n=i.closest(".category-item");n&&(document.querySelectorAll(".category-item").forEach(a=>{a!==n&&a.classList.remove("active")}),n.classList.add("active"))}document.querySelectorAll(".animation-controls").forEach(n=>{n.style.display="none"});const e=document.getElementById(`${t}-controls`);e&&(e.style.display="block"),document.querySelectorAll(".animation-info").forEach(n=>{n.style.display="none"});const s=document.getElementById(`${t}-info`);s&&(s.style.display="block"),this.currentAnimation=t,this.resetAnimation(),t==="waves"&&this.initializeWaveControls(),t==="sound-waves"&&this.initializeSoundWavesControls(),t==="diode-transistor"&&setTimeout(()=>{this.initializeDiodeTransistorControls()},50),t==="memory-management"&&setTimeout(()=>{this.memoryManagement&&this.memoryManagement.startExecution()},100)}initializeWaveControls(){const t=document.getElementById("waveSpeed"),i=document.getElementById("waveFrequency"),e=document.getElementById("waveAmplitude");t&&this.waves&&(t.value=this.waves.speed,document.getElementById("waveSpeedValue").textContent=this.waves.speed+"x"),i&&this.waves&&(i.value=this.waves.frequency,document.getElementById("waveFrequencyValue").textContent=this.waves.frequency),e&&this.waves&&(e.value=this.waves.amplitude,document.getElementById("waveAmplitudeValue").textContent=this.waves.amplitude),this.waves&&this.waves.calculateWaveParameters()}initializeSoundWavesControls(){const t=document.getElementById("soundFrequency"),i=document.getElementById("soundAmplitude"),e=document.getElementById("soundSpeed"),s=document.getElementById("soundParticles"),n=document.getElementById("soundAnimationSpeed"),a=document.getElementById("soundWaveType");t&&this.soundWaves&&(t.value=this.soundWaves.frequency,document.getElementById("soundFrequencyValue").textContent=this.soundWaves.frequency+" Hz"),i&&this.soundWaves&&(i.value=this.soundWaves.amplitude,document.getElementById("soundAmplitudeValue").textContent=this.soundWaves.amplitude+"%"),e&&this.soundWaves&&(e.value=this.soundWaves.waveSpeed,document.getElementById("soundSpeedValue").textContent=this.soundWaves.waveSpeed+" m/s"),s&&this.soundWaves&&(s.value=this.soundWaves.particleCount,document.getElementById("soundParticlesValue").textContent=this.soundWaves.particleCount),n&&this.soundWaves&&(n.value=this.soundWaves.animationSpeed,document.getElementById("soundAnimationSpeedValue").textContent=this.soundWaves.animationSpeed+"x"),a&&this.soundWaves&&(a.value=this.soundWaves.waveType)}initializeDiodeTransistorControls(){const t=document.getElementById("diodeComponentType"),i=document.getElementById("diodeBiasType");t&&this.diodeTransistor&&(t.value=this.diodeTransistor.componentType,t.dispatchEvent(new Event("change"))),i&&this.diodeTransistor&&(i.value=this.diodeTransistor.biasType,i.dispatchEvent(new Event("change")))}togglePlayPause(){this.isRunning=!this.isRunning;const t=document.getElementById("playPauseBtn");t.textContent=this.isRunning?"Pause":"Play"}resetAnimation(){switch(this.currentAnimation){case"brownian":this.brownianMotion.reset();break;case"pendulum":this.pendulum.reset();break;case"diffusion":this.diffusion.reset();break;case"waves":this.waves.reset();break;case"orbital":this.orbital.reset();break;case"electric-fields":this.electricFields.reset();break;case"gas-laws":this.gasLaws.reset();break;case"collisions":this.collisions.reset();break;case"friction":this.friction.reset();break;case"magnetic-fields":this.magneticFields.reset();break;case"wave-particle-duality":this.waveParticleDuality.reset();break;case"nuclear-reactions":this.nuclearReactions.reset();break;case"fluid-flow":this.fluidFlow.reset();break;case"bernoulli":this.bernoulli.reset();break;case"sound-waves":this.soundWaves.reset();break;case"diode-transistor":this.diodeTransistor.reset();break;case"neural-network":this.neuralNetwork.reset();break;case"memory-management":this.memoryManagement.reset();break;case"blockchain":this.blockchain.reset();break}}resizeCanvas(){const i=this.canvas.parentElement.clientWidth-40,e=Math.max(i,800);this.canvas.width=e,this.canvas.height=Math.max(e/1.333,400),this.soundWaves&&(this.soundWaves.setSourcePosition(100,this.canvas.height/2),this.soundWaves.setReceiverPosition(this.canvas.width-100,this.canvas.height/2)),this.neuralNetwork&&this.neuralNetwork.resize(),this.neuralNetwork&&this.neuralNetwork.neurons.length===0&&this.neuralNetwork.initializeNetwork()}animate(t=0){if(!this.isRunning){requestAnimationFrame(e=>this.animate(e));return}this.lastTime===void 0&&(this.lastTime=t);const i=t-this.lastTime;switch(this.lastTime=t,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentAnimation){case"brownian":this.brownianMotion.update(i),this.brownianMotion.render(),this.updateBrownianStats();break;case"pendulum":this.pendulum.update(i),this.pendulum.render(),this.updatePendulumStats();break;case"diffusion":this.diffusion.update(i),this.diffusion.render(),this.updateDiffusionStats();break;case"waves":this.waves.update(i),this.waves.render(),this.updateWaveStats();break;case"orbital":this.orbital.update(i),this.orbital.render(),this.updateOrbitalStats();break;case"electric-fields":this.electricFields.update(i),this.electricFields.render(),this.updateElectricFieldsStats();break;case"gas-laws":this.gasLaws.update(i),this.gasLaws.render(),this.updateGasLawsStats();break;case"collisions":this.collisions.update(i),this.collisions.render(),this.updateCollisionStats();break;case"friction":this.friction.update(i),this.friction.render(),this.updateFrictionStats();break;case"magnetic-fields":this.magneticFields.update(i),this.magneticFields.render(),this.updateMagneticFieldsStats();break;case"wave-particle-duality":this.waveParticleDuality.update(i),this.waveParticleDuality.render(),this.updateWaveParticleDualityStats();break;case"nuclear-reactions":this.nuclearReactions.update(i),this.nuclearReactions.render();break;case"fluid-flow":this.fluidFlow&&(this.fluidFlow.update(i),this.fluidFlow.render(),this.updateFluidFlowStats());break;case"bernoulli":this.bernoulli&&(this.bernoulli.update(i),this.bernoulli.render(),this.updateBernoulliStats());break;case"sound-waves":this.soundWaves&&(this.soundWaves.update(i),this.soundWaves.render(),this.updateSoundWavesStats());break;case"diode-transistor":this.diodeTransistor&&(this.diodeTransistor.update(i),this.diodeTransistor.render(),this.updateDiodeTransistorStats());break;case"neural-network":this.neuralNetwork&&(this.neuralNetwork.update(i),this.neuralNetwork.render(),this.updateNeuralNetworkStats());break;case"memory-management":this.memoryManagement&&(this.memoryManagement.update(i),this.memoryManagement.render(),this.updateMemoryManagementStats());break;case"blockchain":this.blockchain?(this.blockchain.update(i),this.blockchain.render(),this.updateBlockchainStats()):console.error("Blockchain instance not found!");break}requestAnimationFrame(e=>this.animate(e))}updateBrownianStats(){const t=this.brownianMotion.getStats();document.getElementById("activeParticles").textContent=t.particleCount,document.getElementById("avgSpeed").textContent=t.avgSpeed.toFixed(2),document.getElementById("simTime").textContent=(t.time/1e3).toFixed(1)+"s";const i=document.getElementById("brownianCollisionCount"),e=document.getElementById("brownianMeanFreePath"),s=document.getElementById("brownianTemperature");i&&(i.textContent=t.collisionCount),e&&(e.textContent=t.meanFreePath.toFixed(1)),s&&(s.textContent=t.temperature.toFixed(1))}updatePendulumStats(){const t=this.pendulum.getStats();document.getElementById("currentAngle").textContent=t.angle.toFixed(1)+"°",document.getElementById("angularVelocity").textContent=t.angularVelocity.toFixed(2),document.getElementById("period").textContent=t.theoreticalPeriod.toFixed(2)+"s",document.getElementById("pendulumTime").textContent=(t.time/1e3).toFixed(1)+"s";const i=document.getElementById("pendulumAirResistance"),e=document.getElementById("pendulumDamping");i&&(i.textContent=t.airResistanceForce.toFixed(3)),e&&(e.textContent=t.dampingCoefficient.toFixed(3))}updateDiffusionStats(){const t=this.diffusion.getStats();document.getElementById("diffusionParticleCount").textContent=t.particleCount,document.getElementById("diffusionAvgSpeed").textContent=t.avgSpeed.toFixed(2),document.getElementById("concentrationSpread").textContent=t.concentrationSpread.toFixed(2),document.getElementById("diffusionTime").textContent=(t.time/1e3).toFixed(1)+"s"}updateWaveStats(){const t=this.waves.getStats();document.getElementById("currentWaveType").textContent=t.waveType,document.getElementById("currentFrequency").textContent=t.frequency+" Hz",document.getElementById("currentWavelength").textContent=t.wavelength+" px",document.getElementById("currentAmplitude").textContent=t.amplitude+" px",document.getElementById("currentWaveSpeed").textContent=t.waveSpeed+" px/s",document.getElementById("currentWaveEnergy").textContent=t.energy,document.getElementById("wavesTime").textContent=t.time+"s"}updateOrbitalStats(){const t=this.orbital.getStats();document.getElementById("orbitalPeriod").textContent=t.period.toFixed(2)+"s",document.getElementById("orbitalSpeed").textContent=t.speed.toFixed(2),document.getElementById("orbitalDistance").textContent=t.distance.toFixed(1),document.getElementById("orbitalTime").textContent=(t.time/1e3).toFixed(1)+"s",t.eccentricity!==void 0&&(document.getElementById("orbitalEccentricity").textContent=t.eccentricity.toFixed(2))}updateElectricFieldsStats(){const t=this.electricFields.getStats();document.getElementById("activeCharges").textContent=t.chargeCount,document.getElementById("efParticleCount").textContent=t.particleCount,document.getElementById("efFieldStrength").textContent=t.fieldStrength,document.getElementById("efTime").textContent=t.time+"s"}updateGasLawsStats(){const t=this.gasLaws.getStats();document.getElementById("gasParticleCount").textContent=t.particleCount,document.getElementById("gasTemperature").textContent=t.temperature+"K",document.getElementById("gasPressure").textContent=t.pressure.toFixed(2),document.getElementById("gasVolume").textContent=t.volume}updateCollisionStats(){const t=this.collisions.getStats();document.getElementById("collisionBallCount").textContent=t.ballCount,document.getElementById("collisionMomentum").textContent=t.totalMomentum.toFixed(1),document.getElementById("collisionEnergy").textContent=t.totalEnergy.toFixed(1),document.getElementById("collisionCount").textContent=t.collisionCount}updateFrictionStats(){const t=this.friction.getStats();document.getElementById("frictionSurface").textContent=t.surfaceType,document.getElementById("frictionAngle").textContent=t.inclineAngle+"°",document.getElementById("frictionNetForce").textContent=t.netForce.toFixed(1),document.getElementById("frictionAcceleration").textContent=t.acceleration.toFixed(2)}updateMagneticFieldsStats(){const t=this.magneticFields.getStats();document.getElementById("magneticFieldStrength").textContent=t.fieldStrength,document.getElementById("magneticParticleCount").textContent=t.particleCount,document.getElementById("magneticTime").textContent=t.time+"s"}updateWaveParticleDualityStats(){const t=this.waveParticleDuality.getStats(),i=document.getElementById("currentDualityMode"),e=document.getElementById("currentPhotonEnergy"),s=document.getElementById("currentDualityWavelength"),n=document.getElementById("waveFunctionStatus"),a=document.getElementById("interferenceStatus"),o=document.getElementById("measurementCount"),h=document.getElementById("dualityTime");i&&(i.textContent=t.mode),e&&(e.textContent=t.photonEnergy+" eV"),s&&(s.textContent=t.wavelength+" nm"),n&&(n.textContent=this.waveParticleDuality.showWaveFunction?"Active":"Hidden"),a&&(a.textContent=this.waveParticleDuality.showInterference?"Visible":"Hidden"),o&&(o.textContent=t.measurementCount),h&&(h.textContent=t.time+"s")}updateFluidFlowStats(){if(!this.fluidFlow)return;const t=this.fluidFlow.getStats(),i=document.getElementById("fluidFlowRate"),e=document.getElementById("fluidViscosity"),s=document.getElementById("reynoldsNumberValue"),n=document.getElementById("flowType"),a=document.getElementById("averageVelocity"),o=document.getElementById("fluidTime");i&&(i.textContent=t.flowRate.toFixed(1)),e&&(e.textContent=t.viscosity.toFixed(1)),s&&(s.textContent=t.reynoldsNumber),n&&(n.textContent=t.flowType),a&&(a.textContent=t.averageVelocity.toFixed(2)),o&&(o.textContent=(t.time/1e3).toFixed(1)+"s")}updateBernoulliStats(){if(!this.bernoulli)return;const t=this.bernoulli.getStats(),i=document.getElementById("bernoulliPipeWidth"),e=document.getElementById("bernoulliDensity"),s=document.getElementById("bernoulliPressureDiff"),n=document.getElementById("velocityRatio"),a=document.getElementById("energyConservation"),o=document.getElementById("bernoulliTime");i&&(i.textContent=t.pipeWidth),e&&(e.textContent=t.fluidDensity.toFixed(1)),s&&(s.textContent=t.pressureDifference.toFixed(1)),n&&(n.textContent=t.velocityRatio.toFixed(1)),a&&(a.textContent=t.energyConservation),o&&(o.textContent=(t.time/1e3).toFixed(1)+"s")}updateSoundWavesStats(){if(!this.soundWaves)return;const t=this.soundWaves.getStats(),i=document.getElementById("soundWaveTypeDisplay"),e=document.getElementById("soundFrequency"),s=document.getElementById("soundWavelength"),n=document.getElementById("soundWaveSpeed"),a=document.getElementById("soundAmplitude"),o=document.getElementById("soundParticleCount"),h=document.getElementById("soundTime");i&&(i.textContent=t.waveType.charAt(0).toUpperCase()+t.waveType.slice(1)),e&&(e.textContent=t.frequency+" Hz"),s&&(s.textContent=t.wavelength.toFixed(2)+" m"),n&&(n.textContent=t.waveSpeed+" m/s"),a&&(a.textContent=t.amplitude+"%"),o&&(o.textContent=t.particleCount),h&&(h.textContent=(t.time/1e3).toFixed(1)+"s")}updateDiodeTransistorStats(){if(!this.diodeTransistor)return;const t=this.diodeTransistor.getStats(),i=document.getElementById("diodeComponentTypeDisplay"),e=document.getElementById("diodeBiasTypeDisplay"),s=document.getElementById("diodeInputVoltageDisplay"),n=document.getElementById("diodeBaseVoltageDisplay"),a=document.getElementById("diodeCurrent"),o=document.getElementById("diodePower"),h=document.getElementById("diodeStatus"),l=document.getElementById("diodeTemperature"),c=document.getElementById("diodeTime");i&&(i.textContent=t.componentType.toUpperCase()),e&&(e.textContent=t.biasType.toUpperCase()),s&&(s.textContent=t.inputVoltage+"V"),n&&(n.textContent=t.baseVoltage+"V"),a&&(a.textContent=t.current.toFixed(1)+"mA"),o&&(o.textContent=t.power.toFixed(1)+"mW"),h&&(h.textContent=t.isActive?"ACTIVE":"INACTIVE"),l&&(l.textContent=t.temperature+"°C"),c&&(c.textContent=(t.time/1e3).toFixed(1)+"s");const d=document.getElementById("baseVoltageStat");d&&(d.style.display=t.componentType==="npn"||t.componentType==="pnp"?"block":"none")}updateNeuralNetworkStats(){if(!this.neuralNetwork)return;const t=this.neuralNetwork.getStats(),i=document.getElementById("neuralEpoch"),e=document.getElementById("neuralLoss"),s=document.getElementById("neuralAccuracy"),n=document.getElementById("neuralLearningRate"),a=document.getElementById("neuralSpeed"),o=document.getElementById("neuralPhase"),h=document.getElementById("neuralDataIndex");i&&(i.textContent=t.epoch),e&&(e.textContent=t.currentLoss.toFixed(4)),s&&(s.textContent=(t.currentAccuracy*100).toFixed(1)+"%"),n&&(n.textContent=t.learningRate),a&&(a.textContent=t.speed.toFixed(1)+"x"),o&&(o.textContent=t.animationPhase),h&&(h.textContent=t.trainingDataIndex)}showScienceExplanation(){const t=document.getElementById("scienceModal"),i=document.getElementById("modalTitle"),e=document.getElementById("modalContent"),s=this.getScienceContent();i.textContent=s.title,e.innerHTML=s.html,t.style.display="block"}closeModal(){const t=document.getElementById("scienceModal");t.style.display="none"}getCurrentAnimationState(){var i,e,s,n,a,o,h,l,c,d,x,r,g,u,f,m,p,y,v,b,S,P,C,M,k,T,F,I,E,B,A,L,R,W,D,z,X,V,Y,$,N,H,O,G,j,q,U,_,K,J,Q,Z,tt,it,et;const t={animation:this.currentAnimation,controls:{},stats:{}};switch(this.currentAnimation){case"brownian":t.controls={particleCount:((i=document.getElementById("brownianParticleCount"))==null?void 0:i.value)||"15",temperature:((e=document.getElementById("brownianTemperature"))==null?void 0:e.value)||"1.0",speed:((s=document.getElementById("brownianSpeed"))==null?void 0:s.value)||"1.0"},t.stats=((n=this.brownianMotion)==null?void 0:n.getStats())||{};break;case"pendulum":t.controls={length:((a=document.getElementById("pendulumLength"))==null?void 0:a.value)||"100",gravity:((o=document.getElementById("pendulumGravity"))==null?void 0:o.value)||"9.8",damping:((h=document.getElementById("pendulumDamping"))==null?void 0:h.value)||"0.01"},t.stats=((l=this.pendulum)==null?void 0:l.getStats())||{};break;case"waves":t.controls={waveType:((c=document.getElementById("waveType"))==null?void 0:c.value)||"transverse",frequency:((d=document.getElementById("waveFrequency"))==null?void 0:d.value)||"1.0",amplitude:((x=document.getElementById("waveAmplitude"))==null?void 0:x.value)||"50"},t.stats=((r=this.wavePropagation)==null?void 0:r.getStats())||{};break;case"electric-fields":t.controls={fieldStrength:((g=document.getElementById("efFieldStrength"))==null?void 0:g.value)||"1.0",particleCount:((u=document.getElementById("efParticleCount"))==null?void 0:u.value)||"20"},t.stats=((f=this.electricFields)==null?void 0:f.getStats())||{};break;case"magnetic-fields":t.controls={fieldStrength:((m=document.getElementById("magneticFieldStrength"))==null?void 0:m.value)||"1.0",particleCount:((p=document.getElementById("magneticParticleCount"))==null?void 0:p.value)||"15"},t.stats=((y=this.magneticFields)==null?void 0:y.getStats())||{};break;case"gas-laws":t.controls={temperature:((v=document.getElementById("gasTemperature"))==null?void 0:v.value)||"300",pressure:((b=document.getElementById("gasPressure"))==null?void 0:b.value)||"1.0",volume:((S=document.getElementById("gasVolume"))==null?void 0:S.value)||"300"},t.stats=((P=this.gasLaws)==null?void 0:P.getStats())||{};break;case"collisions":t.controls={ballCount:((C=document.getElementById("ballCount"))==null?void 0:C.value)||"5",restitution:((M=document.getElementById("restitution"))==null?void 0:M.value)||"0.8",gravity:((k=document.getElementById("collisionGravity"))==null?void 0:k.value)||"9.8"},t.stats=((T=this.collisions)==null?void 0:T.getStats())||{};break;case"friction":t.controls={angle:((F=document.getElementById("inclineAngle"))==null?void 0:F.value)||"20",frictionCoefficient:((I=document.getElementById("frictionCoefficient"))==null?void 0:I.value)||"0.3",mass:((E=document.getElementById("objectMass"))==null?void 0:E.value)||"1"},t.stats=((B=this.friction)==null?void 0:B.getStats())||{};break;case"wave-particle-duality":t.controls={mode:((A=document.getElementById("dualityMode"))==null?void 0:A.value)||"wave",energy:((L=document.getElementById("dualityEnergy"))==null?void 0:L.value)||"5.0",wavelength:((R=document.getElementById("dualityWavelength"))==null?void 0:R.value)||"150"},t.stats=((W=this.waveParticleDuality)==null?void 0:W.getStats())||{};break;case"sound-waves":t.controls={waveType:((D=document.getElementById("soundWaveType"))==null?void 0:D.value)||"transverse",frequency:((z=document.getElementById("soundFrequency"))==null?void 0:z.value)||"5",amplitude:((X=document.getElementById("soundAmplitude"))==null?void 0:X.value)||"50",waveSpeed:((V=document.getElementById("soundSpeed"))==null?void 0:V.value)||"343",particleCount:((Y=document.getElementById("soundParticles"))==null?void 0:Y.value)||"15",animationSpeed:(($=document.getElementById("soundAnimationSpeed"))==null?void 0:$.value)||"1.0"},t.stats=((N=this.soundWaves)==null?void 0:N.getStats())||{};break;case"diode-transistor":t.controls={componentType:((H=document.getElementById("diodeComponentType"))==null?void 0:H.value)||"diode",biasType:((O=document.getElementById("diodeBiasType"))==null?void 0:O.value)||"forward",inputVoltage:((G=document.getElementById("diodeInputVoltage"))==null?void 0:G.value)||"5",baseVoltage:((j=document.getElementById("diodeBaseVoltage"))==null?void 0:j.value)||"0.7",animationSpeed:((q=document.getElementById("diodeAnimationSpeed"))==null?void 0:q.value)||"1.0"},t.stats=((U=this.diodeTransistor)==null?void 0:U.getStats())||{};break;case"neural-network":t.controls={learningRate:((_=document.getElementById("neuralLearningRate"))==null?void 0:_.value)||"0.1",speed:((K=document.getElementById("neuralSpeed"))==null?void 0:K.value)||"1.0",mode:((J=document.getElementById("neuralMode"))==null?void 0:J.value)||"training"},t.stats=((Q=this.neuralNetwork)==null?void 0:Q.getStats())||{};break;case"memory-management":t.controls={mode:((Z=document.getElementById("memoryMode"))==null?void 0:Z.value)||"random",retentionRate:((tt=document.getElementById("retentionRate"))==null?void 0:tt.value)||"0.5",decayRate:((it=document.getElementById("decayRate"))==null?void 0:it.value)||"0.1"},t.stats=((et=this.memoryManagement)==null?void 0:et.getStats())||{};break}return t}getScienceContent(){switch(this.currentAnimation){case"brownian":return{title:"Brownian Motion - Random Particle Movement",html:`
                        <div class="science-content">
                            <h3>What is Brownian Motion?</h3>
                            <p>Brownian motion is the random, erratic movement of particles suspended in a fluid (liquid or gas) caused by collisions with fast-moving molecules in the surrounding medium. This phenomenon was first observed by botanist Robert Brown in 1827 when studying pollen grains in water.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Molecular Motion:</strong> All particles are in constant motion due to thermal energy</li>
                                <li><strong>Random Walk:</strong> Each collision changes the particle's direction randomly</li>
                                <li><strong>Temperature Dependence:</strong> Higher temperature = faster molecular motion = more vigorous Brownian motion</li>
                                <li><strong>Particle Size Effect:</strong> Smaller particles show more dramatic Brownian motion</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles moving in seemingly random directions</li>
                                <li>No predictable path - each particle follows a "random walk"</li>
                                <li>Particles occasionally changing direction due to collisions</li>
                                <li>Faster movement at higher temperatures</li>
                                <li>Different colored particles for easy tracking</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Diffusion of molecules in cells</li>
                                <li>Particle movement in air pollution</li>
                                <li>Understanding molecular motion in chemistry</li>
                                <li>Brownian motion in financial markets</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>The mean squared displacement (MSD) of a Brownian particle follows: <strong>MSD = 6Dt</strong>, where D is the diffusion coefficient and t is time. This relationship shows that the average distance a particle travels increases with the square root of time.</p>
                        </div>
                    `};case"sound-waves":return{title:"Sound Waves - Wave Propagation",html:`
                        <div class="science-content">
                            <h3>What are Sound Waves?</h3>
                            <p>Sound waves are mechanical waves that propagate through a medium (like air, water, or solids) by causing particles to vibrate. They are longitudinal waves, meaning the particles move back and forth in the same direction as the wave travels.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Longitudinal Waves:</strong> Particles oscillate parallel to wave direction</li>
                                <li><strong>Transverse Waves:</strong> Particles oscillate perpendicular to wave direction</li>
                                <li><strong>Compression & Rarefaction:</strong> High and low pressure regions in the medium</li>
                                <li><strong>Wave Speed:</strong> v = fλ, where f is frequency and λ is wavelength</li>
                                <li><strong>Amplitude:</strong> Maximum displacement of particles from equilibrium</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Wave pulse traveling from source to receiver</li>
                                <li>Particles moving as the wave passes through</li>
                                <li>Compression zones (orange) and rarefaction zones (cyan)</li>
                                <li>Different wave types: transverse, longitudinal, and combined</li>
                                <li>Wave speed and frequency effects on propagation</li>
                            </ul>
                            
                            <h3>Wave Types Explained</h3>
                            <ul>
                                <li><strong>Transverse:</strong> Like waves on a string - particles move up and down</li>
                                <li><strong>Longitudinal:</strong> Like sound in air - particles move back and forth</li>
                                <li><strong>Combined:</strong> Shows both transverse and longitudinal components</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Musical instruments and sound production</li>
                                <li>Ultrasound imaging in medicine</li>
                                <li>Seismic waves in earthquake detection</li>
                                <li>Sonar and underwater communication</li>
                                <li>Acoustic engineering and noise control</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>For a sound wave: <strong>v = √(B/ρ)</strong>, where v is wave speed, B is bulk modulus, and ρ is density. The frequency determines pitch, while amplitude determines loudness. The relationship <strong>v = fλ</strong> connects speed, frequency, and wavelength.</p>
                        </div>
                    `};case"diode-transistor":return{title:"Diode & Transistor - Electronic Components",html:`
                        <div class="science-content">
                            <h3>What are Diodes and Transistors?</h3>
                            <p>Diodes and transistors are fundamental electronic components that control the flow of electrical current. Diodes allow current to flow in one direction only, while transistors can amplify signals and act as electronic switches.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Semiconductor Physics:</strong> Materials with conductivity between conductors and insulators</li>
                                <li><strong>P-N Junction:</strong> Boundary between P-type (holes) and N-type (electrons) materials</li>
                                <li><strong>Forward Bias:</strong> Positive voltage applied to P-side, negative to N-side</li>
                                <li><strong>Reverse Bias:</strong> Opposite voltage polarity blocks current flow</li>
                                <li><strong>Transistor Amplification:</strong> Small base current controls large collector current</li>
                                <li><strong>Particle Flow:</strong> Electrons and holes flow in opposite directions but contribute to current in the same direction</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Electrons (blue circles):</strong> Move from N-type to P-type material during forward bias</li>
                                <li><strong>Holes (red outlined circles):</strong> Move from P-type to N-type material during forward bias</li>
                                <li><strong>Current Flow:</strong> Only occurs in forward bias conditions with sufficient voltage</li>
                                <li><strong>Voltage Drop:</strong> ~0.7V across diode in forward bias</li>
                                <li><strong>Transistor Control:</strong> Base voltage controls collector current amplification</li>
                                <li><strong>Energy Visualization:</strong> Pulsating circles represent electromagnetic field and power dissipation</li>
                            </ul>
                            
                            <h3>Component Behavior</h3>
                            <ul>
                                <li><strong>Diode Forward Bias:</strong> Current flows when voltage > 0.7V, voltage drop ~0.7V</li>
                                <li><strong>Diode Reverse Bias:</strong> No current flow, acts as insulator</li>
                                <li><strong>NPN Transistor:</strong> Electron flow from emitter to collector, base controls amplification</li>
                                <li><strong>PNP Transistor:</strong> Hole flow from emitter to collector, base controls amplification</li>
                                <li><strong>Amplification Factor:</strong> β = Ic/Ib (collector current / base current) ≈ 100</li>
                            </ul>
                            
                            <h3>Particle Physics</h3>
                            <ul>
                                <li><strong>Electrons:</strong> Filled blue circles representing negative charge carriers</li>
                                <li><strong>Holes:</strong> Red outlined circles representing positive charge carriers (absence of electrons)</li>
                                <li><strong>Flow Direction:</strong> Electrons and holes move in opposite directions but both contribute to conventional current flow</li>
                                <li><strong>Energy Levels:</strong> Particles move faster and glow brighter with higher voltage</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Rectifiers in power supplies</li>
                                <li>Amplifiers in audio systems</li>
                                <li>Digital logic circuits</li>
                                <li>Voltage regulators</li>
                                <li>Radio frequency circuits</li>
                                <li>Computer processors and memory</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>For a diode: <strong>I = I₀(e^(V/Vₜ) - 1)</strong>, where I is current, V is voltage, and Vₜ is thermal voltage (~26mV at room temperature). For a transistor: <strong>Ic = β × Ib</strong>, where β is the current gain factor (typically 50-200).</p>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li>Switch between diode, NPN, and PNP transistor modes</li>
                                <li>Adjust input voltage to see current flow changes</li>
                                <li>Control base voltage for transistor amplification</li>
                                <li>Observe different bias conditions (forward, reverse, off)</li>
                                <li>Watch real-time current and power calculations</li>
                            </ul>
                        </div>
                    `};case"pendulum":return{title:"Simple Pendulum - Harmonic Oscillation",html:`
                        <div class="science-content">
                            <h3>What is a Simple Pendulum?</h3>
                            <p>A simple pendulum consists of a point mass (bob) suspended from a fixed point by a massless, inextensible string. When displaced from its equilibrium position, it oscillates back and forth under the influence of gravity.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Simple Harmonic Motion:</strong> For small angles, the motion is approximately simple harmonic</li>
                                <li><strong>Period Formula:</strong> T = 2π√(L/g), where L is length and g is gravitational acceleration</li>
                                <li><strong>Energy Conservation:</strong> Kinetic and potential energy continuously convert between each other</li>
                                <li><strong>Damping:</strong> Air resistance causes the amplitude to gradually decrease</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Regular back-and-forth oscillation</li>
                                <li>Period remains constant regardless of amplitude (for small angles)</li>
                                <li>Longer pendulum = longer period</li>
                                <li>Gradual decrease in amplitude due to air resistance</li>
                                <li>Maximum speed at the bottom, zero speed at the extremes</li>
                            </ul>
                            
                            <h3>Energy Transformations</h3>
                            <ul>
                                <li><strong>At extremes:</strong> Maximum potential energy, zero kinetic energy</li>
                                <li><strong>At bottom:</strong> Maximum kinetic energy, minimum potential energy</li>
                                <li><strong>Total energy:</strong> Gradually decreases due to air resistance</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Clock mechanisms (grandfather clocks)</li>
                                <li>Seismometers for earthquake detection</li>
                                <li>Metronomes for musical timing</li>
                                <li>Amusement park rides</li>
                            </ul>
                        </div>
                    `};case"waves":return{title:"Wave Propagation - Energy Transfer",html:`
                        <div class="science-content">
                            <h3>What are Waves?</h3>
                            <p>Waves are disturbances that transfer energy through a medium without transferring matter. They can be mechanical (requiring a medium) or electromagnetic (can travel through vacuum).</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Transverse Waves:</strong> Particles move perpendicular to wave direction (like water waves)</li>
                                <li><strong>Longitudinal Waves:</strong> Particles move parallel to wave direction (like sound waves)</li>
                                <li><strong>Wave Properties:</strong> Amplitude, frequency, wavelength, and speed</li>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Interference:</strong> Waves can add together or cancel each other out</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Regular, repeating pattern of disturbance</li>
                                <li>Waves traveling at constant speed</li>
                                <li>Different wave types (transverse vs longitudinal)</li>
                                <li>Interference patterns when waves overlap</li>
                                <li>Energy transfer without matter movement</li>
                            </ul>
                            
                            <h3>Wave Characteristics</h3>
                            <ul>
                                <li><strong>Amplitude:</strong> Maximum displacement from equilibrium</li>
                                <li><strong>Frequency:</strong> Number of complete cycles per second (Hz)</li>
                                <li><strong>Wavelength:</strong> Distance between consecutive identical points</li>
                                <li><strong>Period:</strong> Time for one complete cycle</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Sound waves in air and water</li>
                                <li>Light waves and electromagnetic radiation</li>
                                <li>Earthquake waves (seismic waves)</li>
                                <li>Radio waves for communication</li>
                                <li>Ocean waves and tides</li>
                            </ul>
                        </div>
                    `};case"diffusion":return{title:"Diffusion - Particle Spread",html:`
                        <div class="science-content">
                            <h3>What is Diffusion?</h3>
                            <p>Diffusion is the process by which particles spread from regions of high concentration to regions of low concentration, driven by random molecular motion. This is a fundamental process in nature that leads to the uniform distribution of particles.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Fick's First Law:</strong> J = -D∇C (flux is proportional to concentration gradient)</li>
                                <li><strong>Concentration Gradient:</strong> Difference in concentration between regions</li>
                                <li><strong>Diffusion Coefficient:</strong> Measure of how quickly particles diffuse</li>
                                <li><strong>Temperature Effect:</strong> Higher temperature increases diffusion rate</li>
                                <li><strong>Particle Size:</strong> Smaller particles diffuse faster</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles spreading from concentrated areas</li>
                                <li>Gradual mixing of different particle types</li>
                                <li>Faster diffusion at higher temperatures</li>
                                <li>Concentration gradient decreasing over time</li>
                                <li>Eventually uniform distribution</li>
                            </ul>
                            
                            <h3>Diffusion Process</h3>
                            <ul>
                                <li><strong>Initial State:</strong> High concentration in one region</li>
                                <li><strong>Random Motion:</strong> Particles move randomly due to thermal energy</li>
                                <li><strong>Net Movement:</strong> More particles move from high to low concentration</li>
                                <li><strong>Equilibrium:</strong> Eventually uniform concentration throughout</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Oxygen diffusion in lungs</li>
                                <li>Nutrient absorption in cells</li>
                                <li>Perfume spreading in air</li>
                                <li>Salt dissolving in water</li>
                                <li>Heat conduction in materials</li>
                            </ul>
                        </div>
                    `};case"orbital":return{title:"Orbital Motion - Gravitational Dynamics",html:`
                        <div class="science-content">
                            <h3>What is Orbital Motion?</h3>
                            <p>Orbital motion describes the path of one object around another under the influence of gravity. This fundamental concept explains planetary orbits, satellite motion, and many other celestial phenomena.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Kepler's Laws:</strong> Three laws describing planetary motion</li>
                                <li><strong>Gravitational Force:</strong> F = GMm/r² (inverse square law)</li>
                                <li><strong>Orbital Velocity:</strong> v = √(GM/r) for circular orbits</li>
                                <li><strong>Eccentricity:</strong> Measure of how elliptical an orbit is (0 = circular, 1 = parabolic)</li>
                                <li><strong>Conservation of Angular Momentum:</strong> Orbital angular momentum remains constant</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Elliptical or circular paths around central mass</li>
                                <li>Faster motion when closer to the center (Kepler's Second Law)</li>
                                <li>Slower motion when farther from the center</li>
                                <li>Different orbital shapes based on eccentricity</li>
                                <li>Consistent orbital period for same central mass</li>
                            </ul>
                            
                            <h3>Kepler's Three Laws</h3>
                            <ol>
                                <li><strong>First Law:</strong> Orbits are ellipses with the central mass at one focus</li>
                                <li><strong>Second Law:</strong> Equal areas are swept in equal times (faster when closer)</li>
                                <li><strong>Third Law:</strong> Orbital period squared is proportional to semi-major axis cubed</li>
                            </ol>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Planetary orbits around the Sun</li>
                                <li>Satellite orbits around Earth</li>
                                <li>Electron orbits in atoms (Bohr model)</li>
                                <li>Binary star systems</li>
                                <li>Spacecraft trajectories</li>
                            </ul>
                        </div>
                    `};case"electric-fields":return{title:"Electric Fields - Charged Particle Interactions",html:`
                        <div class="science-content">
                            <h3>What are Electric Fields?</h3>
                            <p>Electric fields are regions of space around charged particles where other charges experience forces. They are invisible but can be visualized through their effects on test charges and field lines.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Coulomb's Law:</strong> F = kq₁q₂/r² (force between charges)</li>
                                <li><strong>Electric Field:</strong> E = F/q (force per unit charge)</li>
                                <li><strong>Field Lines:</strong> Imaginary lines showing field direction</li>
                                <li><strong>Superposition:</strong> Total field is sum of individual fields</li>
                                <li><strong>Conservation of Charge:</strong> Net charge remains constant</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Test particles moving along field lines</li>
                                <li>Positive particles repelled by positive charges</li>
                                <li>Negative particles attracted to positive charges</li>
                                <li>Field strength decreases with distance</li>
                                <li>Complex field patterns with multiple charges</li>
                            </ul>
                            
                            <h3>Field Properties</h3>
                            <ul>
                                <li><strong>Direction:</strong> Field lines point away from positive, toward negative</li>
                                <li><strong>Strength:</strong> Closer lines indicate stronger fields</li>
                                <li><strong>Superposition:</strong> Fields add vectorially</li>
                                <li><strong>Conservative:</strong> Work done is path-independent</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electrostatic precipitators</li>
                                <li>Capacitors and electronic circuits</li>
                                <li>Lightning and atmospheric electricity</li>
                                <li>Particle accelerators</li>
                                <li>Electron microscopes</li>
                            </ul>
                        </div>
                    `};case"gas-laws":return{title:"Gas Laws - Pressure, Volume, Temperature Relationships",html:`
                        <div class="science-content">
                            <h3>What are Gas Laws?</h3>
                            <p>Gas laws describe the relationships between pressure, volume, temperature, and amount of gas. These fundamental laws help us understand how gases behave under different conditions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Boyle's Law:</strong> P₁V₁ = P₂V₂ (inverse relationship between pressure and volume)</li>
                                <li><strong>Charles's Law:</strong> V₁/T₁ = V₂/T₂ (direct relationship between volume and temperature)</li>
                                <li><strong>Gay-Lussac's Law:</strong> P₁/T₁ = P₂/T₂ (direct relationship between pressure and temperature)</li>
                                <li><strong>Combined Gas Law:</strong> P₁V₁/T₁ = P₂V₂/T₂</li>
                                <li><strong>Ideal Gas Law:</strong> PV = nRT (universal gas law)</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles moving faster at higher temperatures</li>
                                <li>More frequent collisions at higher pressure</li>
                                <li>Particles spreading out in larger volumes</li>
                                <li>Pressure changes with volume and temperature</li>
                                <li>Random motion of gas particles</li>
                            </ul>
                            
                            <h3>Gas Law Relationships</h3>
                            <ul>
                                <li><strong>Boyle's Law:</strong> Decrease volume → increase pressure</li>
                                <li><strong>Charles's Law:</strong> Increase temperature → increase volume</li>
                                <li><strong>Gay-Lussac's Law:</strong> Increase temperature → increase pressure</li>
                                <li><strong>Avogadro's Law:</strong> More particles → larger volume</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Internal combustion engines</li>
                                <li>Refrigeration and air conditioning</li>
                                <li>Weather and atmospheric pressure</li>
                                <li>Scuba diving and pressure changes</li>
                                <li>Hot air balloons</li>
                            </ul>
                        </div>
                    `};case"collisions":return{title:"Collision Physics - Momentum and Energy Conservation",html:`
                        <div class="science-content">
                            <h3>What are Collisions?</h3>
                            <p>Collisions are interactions between objects that result in changes in their motion. Understanding collisions involves principles of momentum conservation and energy transfer.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Momentum Conservation:</strong> Total momentum before = total momentum after</li>
                                <li><strong>Elastic Collisions:</strong> Kinetic energy is conserved</li>
                                <li><strong>Inelastic Collisions:</strong> Some kinetic energy is lost</li>
                                <li><strong>Impulse:</strong> Change in momentum = force × time</li>
                                <li><strong>Coefficient of Restitution:</strong> Measure of collision elasticity</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Objects changing direction after collision</li>
                                <li>Speed changes based on collision type</li>
                                <li>Energy transfer between objects</li>
                                <li>Momentum conservation in all collisions</li>
                                <li>Different outcomes for elastic vs inelastic collisions</li>
                            </ul>
                            
                            <h3>Collision Types</h3>
                            <ul>
                                <li><strong>Elastic:</strong> Perfect bounce, energy conserved</li>
                                <li><strong>Inelastic:</strong> Objects stick together, energy lost</li>
                                <li><strong>Partially Elastic:</strong> Some energy lost, some bounce</li>
                                <li><strong>Explosive:</strong> Energy added, objects separate</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Car crash safety design</li>
                                <li>Sports equipment design</li>
                                <li>Particle physics experiments</li>
                                <li>Billiards and pool</li>
                                <li>Rocket propulsion</li>
                            </ul>
                        </div>
                    `};case"friction":return{title:"Friction & Inclined Planes - Force Analysis",html:`
                        <div class="science-content">
                            <h3>What is Friction?</h3>
                            <p>Friction is a force that opposes the relative motion of objects in contact. On inclined planes, friction plays a crucial role in determining whether objects slide or remain stationary.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Static Friction:</strong> Prevents motion when object is at rest</li>
                                <li><strong>Kinetic Friction:</strong> Opposes motion when object is sliding</li>
                                <li><strong>Friction Force:</strong> f = μN (coefficient × normal force)</li>
                                <li><strong>Normal Force:</strong> Component of weight perpendicular to surface</li>
                                <li><strong>Net Force:</strong> Determines acceleration down the incline</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Objects sliding down inclined surfaces</li>
                                <li>Different sliding speeds based on friction</li>
                                <li>Objects stopping when friction is high</li>
                                <li>Force vectors showing gravity and friction</li>
                                <li>Acceleration changes with angle and friction</li>
                            </ul>
                            
                            <h3>Force Analysis</h3>
                            <ul>
                                <li><strong>Gravity Component:</strong> mg sin(θ) down the incline</li>
                                <li><strong>Normal Force:</strong> mg cos(θ) perpendicular to surface</li>
                                <li><strong>Friction Force:</strong> μmg cos(θ) opposing motion</li>
                                <li><strong>Net Force:</strong> mg sin(θ) - μmg cos(θ)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Vehicle braking systems</li>
                                <li>Walking and running mechanics</li>
                                <li>Rock climbing and mountaineering</li>
                                <li>Industrial conveyor systems</li>
                                <li>Sports equipment design</li>
                            </ul>
                        </div>
                    `};case"magnetic-fields":return{title:"Magnetic Fields - Magnetic Force Interactions",html:`
                        <div class="science-content">
                            <h3>What are Magnetic Fields?</h3>
                            <p>Magnetic fields are regions of space around magnets where magnetic materials and moving charges experience forces. They are fundamental to electromagnetism and many modern technologies.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Magnetic Force:</strong> F = qvB sin(θ) on moving charges</li>
                                <li><strong>Field Lines:</strong> Imaginary lines showing field direction</li>
                                <li><strong>Right-Hand Rule:</strong> Determines force direction on moving charges</li>
                                <li><strong>Field Strength:</strong> Measured in Tesla (T) or Gauss</li>
                                <li><strong>Superposition:</strong> Total field is sum of individual fields</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Charged particles moving in curved paths</li>
                                <li>Different motion for positive vs negative charges</li>
                                <li>Circular motion in uniform magnetic fields</li>
                                <li>Field lines showing magnetic field direction</li>
                                <li>Force perpendicular to both velocity and field</li>
                            </ul>
                            
                            <h3>Magnetic Field Properties</h3>
                            <ul>
                                <li><strong>Direction:</strong> Field lines point from north to south pole</li>
                                <li><strong>Strength:</strong> Decreases with distance from magnet</li>
                                <li><strong>Force Direction:</strong> Perpendicular to both velocity and field</li>
                                <li><strong>No Work:</strong> Magnetic force does no work on charges</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electric motors and generators</li>
                                <li>Magnetic resonance imaging (MRI)</li>
                                <li>Particle accelerators</li>
                                <li>Magnetic levitation trains</li>
                                <li>Compass navigation</li>
                            </ul>
                        </div>
                    `};case"wave-particle-duality":return{title:"Wave-Particle Duality - Quantum Mechanics",html:`
                        <div class="science-content">
                            <h3>What is Wave-Particle Duality?</h3>
                            <p>Wave-particle duality is a fundamental concept in quantum mechanics where particles exhibit both wave-like and particle-like properties depending on how we observe them. This challenges our classical understanding of matter.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>De Broglie Wavelength:</strong> λ = h/p (wavelength = Planck's constant/momentum)</li>
                                <li><strong>Wave Function:</strong> Mathematical description of quantum state</li>
                                <li><strong>Superposition:</strong> Particles can exist in multiple states simultaneously</li>
                                <li><strong>Measurement Effect:</strong> Observation affects the system</li>
                                <li><strong>Interference:</strong> Wave-like behavior in experiments</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Wave-like interference patterns</li>
                                <li>Particle-like discrete measurements</li>
                                <li>Superposition of states</li>
                                <li>Measurement affecting the system</li>
                                <li>Dual behavior depending on observation method</li>
                            </ul>
                            
                            <h3>Quantum Phenomena</h3>
                            <ul>
                                <li><strong>Double-Slit Experiment:</strong> Shows both wave and particle behavior</li>
                                <li><strong>Uncertainty Principle:</strong> Can't know position and momentum precisely</li>
                                <li><strong>Quantum Tunneling:</strong> Particles can pass through barriers</li>
                                <li><strong>Entanglement:</strong> Particles can be correlated across distance</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electron microscopes</li>
                                <li>Quantum computing</li>
                                <li>Quantum cryptography</li>
                                <li>Semiconductor technology</li>
                                <li>Quantum sensors</li>
                            </ul>
                        </div>
                    `};case"nuclear-reactions":return{title:"Nuclear Reactions - Fission and Fusion",html:`
                        <div class="science-content">
                            <h3>What are Nuclear Reactions?</h3>
                            <p>Nuclear reactions involve changes in the nucleus of atoms, releasing or absorbing tremendous amounts of energy. Fission (splitting) and fusion (combining) are the two main types of nuclear reactions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Nuclear Fission:</strong> Heavy nucleus splits into lighter nuclei + energy</li>
                                <li><strong>Nuclear Fusion:</strong> Light nuclei combine to form heavier nucleus + energy</li>
                                <li><strong>Mass-Energy Equivalence:</strong> E = mc² (Einstein's equation)</li>
                                <li><strong>Chain Reaction:</strong> Neutrons from one fission trigger more fissions</li>
                                <li><strong>Critical Mass:</strong> Minimum mass needed for sustained chain reaction</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Nuclei splitting or combining</li>
                                <li>Energy release in the form of particles</li>
                                <li>Neutrons triggering additional reactions</li>
                                <li>Chain reactions spreading through material</li>
                                <li>Different reaction rates based on conditions</li>
                            </ul>
                            
                            <h3>Nuclear Processes</h3>
                            <ul>
                                <li><strong>Fission:</strong> Uranium-235 + neutron → lighter nuclei + 2-3 neutrons + energy</li>
                                <li><strong>Fusion:</strong> Hydrogen nuclei → Helium + energy (like in stars)</li>
                                <li><strong>Radioactive Decay:</strong> Unstable nuclei emit particles</li>
                                <li><strong>Neutron Capture:</strong> Nuclei absorb neutrons</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Nuclear power plants</li>
                                <li>Nuclear weapons</li>
                                <li>Medical radiation therapy</li>
                                <li>Radioactive dating</li>
                                <li>Fusion power research</li>
                            </ul>
                        </div>
                    `};case"fluid-flow":return{title:"Fluid Flow - Laminar and Turbulent Dynamics",html:`
                        <div class="science-content">
                            <h3>What is Fluid Flow?</h3>
                            <p>Fluid flow describes how liquids and gases move through space. Understanding flow patterns is crucial for engineering applications, from blood flow in arteries to air flow over airplane wings.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Laminar Flow:</strong> Smooth, parallel streamlines with no mixing between layers</li>
                                <li><strong>Turbulent Flow:</strong> Chaotic, swirling motion with rapid mixing</li>
                                <li><strong>Reynolds Number:</strong> Re = ρvL/μ (determines flow type)</li>
                                <li><strong>Viscosity:</strong> Internal friction that resists flow</li>
                                <li><strong>Boundary Layer:</strong> Region near surfaces where flow is affected by friction</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Smooth, parallel streamlines in laminar flow</li>
                                <li>Chaotic, swirling patterns in turbulent flow</li>
                                <li>Flow separation around obstacles</li>
                                <li>Velocity changes with viscosity</li>
                                <li>Reynolds number transitions</li>
                            </ul>
                            
                            <h3>Flow Regimes</h3>
                            <ul>
                                <li><strong>Re < 2300:</strong> Laminar flow (smooth, predictable)</li>
                                <li><strong>2300 < Re < 4000:</strong> Transitional flow (unstable)</li>
                                <li><strong>Re > 4000:</strong> Turbulent flow (chaotic, mixing)</li>
                                <li><strong>High Re:</strong> Inertia dominates over viscosity</li>
                                <li><strong>Low Re:</strong> Viscosity dominates over inertia</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Blood flow in cardiovascular system</li>
                                <li>Air flow over aircraft wings</li>
                                <li>Water flow in pipes and channels</li>
                                <li>Weather patterns and atmospheric flow</li>
                                <li>Industrial mixing and processing</li>
                            </ul>
                        </div>
                    `};case"bernoulli":return{title:"Bernoulli's Principle - Energy Conservation in Fluids",html:`
                        <div class="science-content">
                            <h3>What is Bernoulli's Principle?</h3>
                            <p>Bernoulli's principle states that in a flowing fluid, an increase in velocity is accompanied by a decrease in pressure. This is a consequence of energy conservation in fluid flow.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Bernoulli's Equation:</strong> P + ½ρv² + ρgh = constant</li>
                                <li><strong>Energy Conservation:</strong> Total energy remains constant along a streamline</li>
                                <li><strong>Pressure-Velocity Trade-off:</strong> Higher velocity = lower pressure</li>
                                <li><strong>Continuity Equation:</strong> A₁v₁ = A₂v₂ (mass conservation)</li>
                                <li><strong>Venturi Effect:</strong> Pressure drop in constricted flow</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Fluid speeding up in narrow sections</li>
                                <li>Pressure decreasing in constricted areas</li>
                                <li>Energy conservation maintained</li>
                                <li>Velocity and pressure inversely related</li>
                                <li>Flow rate remains constant</li>
                            </ul>
                            
                            <h3>Energy Components</h3>
                            <ul>
                                <li><strong>Pressure Energy:</strong> P (work done by pressure)</li>
                                <li><strong>Kinetic Energy:</strong> ½ρv² (energy of motion)</li>
                                <li><strong>Potential Energy:</strong> ρgh (gravitational energy)</li>
                                <li><strong>Total Energy:</strong> Sum remains constant</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Airplane wing lift generation</li>
                                <li>Carburetor fuel mixing</li>
                                <li>Venturi meters for flow measurement</li>
                                <li>Spray bottles and atomizers</li>
                                <li>Blood flow in arteries</li>
                            </ul>
                        </div>
                    `};case"neural-network":return{title:"Neural Network Training - Object Recognition",html:`
                        <div class="science-content">
                            <h3>What are Neural Networks?</h3>
                            <p>Neural networks are computational models inspired by biological neurons in the brain. They consist of interconnected nodes (neurons) organized in layers that process information and learn patterns from data. This animation demonstrates how neural networks learn to recognize and classify different geometric objects.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Artificial Neurons:</strong> Mathematical functions that receive inputs, apply weights, and produce outputs. Each neuron computes: output = σ(Σ(inputs × weights) + bias)</li>
                                <li><strong>Network Architecture:</strong> Input layer (2 neurons) → Hidden layer 1 (4 neurons) → Hidden layer 2 (3 neurons) → Output layer (1 neuron)</li>
                            </ul>
                            
                            <h3>Why This Architecture?</h3>
                            <ul>
                                <li><strong>2 Input Neurons:</strong> Perfect for our 2-feature problem (symmetry, edges)</li>
                                <li><strong>4 Hidden Neurons:</strong> Provides enough capacity to learn non-linear patterns without overfitting</li>
                                <li><strong>3 Hidden Neurons:</strong> Allows further feature refinement and abstraction</li>
                                <li><strong>1 Output Neuron:</strong> Binary classification (simple vs complex objects)</li>
                            </ul>
                            
                            <h3>Layer Size Effects</h3>
                            <ul>
                                <li><strong>Too Few Neurons:</strong> Network can't learn complex patterns (underfitting)</li>
                                <li><strong>Too Many Neurons:</strong> Network memorizes training data (overfitting)</li>
                                <li><strong>Optimal Size:</strong> Balances learning capacity with generalization</li>
                                <li><strong>Our Choice:</strong> 4→3 hidden layers provide sufficient complexity for this task</li>
                            </ul>
                                <li><strong>Weights & Biases:</strong> Numerical values that determine connection strength and neuron activation thresholds</li>
                                <li><strong>Sigmoid Activation:</strong> σ(x) = 1/(1 + e^(-x)) - transforms any input to a value between 0 and 1</li>
                                <li><strong>Backpropagation:</strong> Algorithm that calculates how much each weight should change to reduce prediction errors</li>
                                <li><strong>Learning Rate:</strong> Controls how big weight updates are during training</li>
                            </ul>
                            
                            <h3>Training Process Explained</h3>
                            <ol>
                                <li><strong>Forward Propagation:</strong> Input features flow through the network, each neuron computes its output using weights and activation function</li>
                                <li><strong>Loss Calculation:</strong> Compare network output with target value using Mean Squared Error: Loss = (target - output)²</li>
                                <li><strong>Backward Propagation:</strong> Calculate error gradients for each weight using chain rule of calculus</li>
                                <li><strong>Weight Updates:</strong> Adjust weights using gradient descent: Δw = learning_rate × gradient</li>
                            </ol>
                            
                            <h3>Object Recognition Task</h3>
                            <p>This network learns to classify geometric objects based on their complexity using 2 features:</p>
                            <ul>
                                <li><strong>Feature 1 - Symmetry Score (0-1):</strong> How symmetrical the object is (high = simple)</li>
                                <li><strong>Feature 2 - Edge Complexity (0-1):</strong> How many edges/corners the object has (high = complex)</li>
                                <li><strong>Simple Objects:</strong> Circle [0.9,0.1], Square [0.8,0.3] → Output: 0 (classified as simple)</li>
                                <li><strong>Complex Objects:</strong> Triangle [0.6,0.5], Star [0.3,0.9] → Output: 1 (classified as complex)</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch data flow forward (blue particles), errors flow backward (red particles), and weights update (flashing connections)</li>
                                <li><strong>Testing Mode:</strong> See how the trained network processes new inputs and makes predictions with confidence scores</li>
                                <li><strong>Visual Indicators:</strong> Active neurons pulse, weight changes are highlighted, and prediction accuracy improves over time</li>
                                <li><strong>Object Context:</strong> Each training example shows the actual geometric object being learned</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Neuron Output:</strong> y = σ(w₁x₁ + w₂x₂ + ... + wₙxₙ + b)</li>
                                <li><strong>Loss Function:</strong> L = (y_target - y_predicted)²</li>
                                <li><strong>Weight Update:</strong> w_new = w_old - α × ∂L/∂w</li>
                                <li><strong>Gradient Calculation:</strong> ∂L/∂w = ∂L/∂y × ∂y/∂w (chain rule)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Computer Vision:</strong> Image classification, object detection, facial recognition</li>
                                <li><strong>Natural Language Processing:</strong> Text classification, language translation, chatbots</li>
                                <li><strong>Speech Recognition:</strong> Voice assistants, transcription services</li>
                                <li><strong>Autonomous Systems:</strong> Self-driving cars, robotics, drones</li>
                                <li><strong>Medical Diagnosis:</strong> Disease detection, medical image analysis</li>
                                <li><strong>Financial Analysis:</strong> Fraud detection, stock prediction, risk assessment</li>
                            </ul>
                            
                            <h3>Educational Insights</h3>
                            <ul>
                                <li><strong>Learning Process:</strong> Neural networks learn by adjusting weights to minimize prediction errors</li>
                                <li><strong>Feature Learning:</strong> Hidden layers automatically learn useful features from raw input data</li>
                                <li><strong>Generalization:</strong> Well-trained networks can make accurate predictions on unseen data</li>
                                <li><strong>Overfitting:</strong> Networks can memorize training data instead of learning general patterns</li>
                                <li><strong>Hyperparameters:</strong> Learning rate, network architecture, and activation functions affect training success</li>
                            </ul>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch the network learn through forward/backward propagation cycles</li>
                                <li><strong>Testing Mode:</strong> Test the trained network on different objects and see predictions</li>
                                <li><strong>Parameter Control:</strong> Adjust learning rate and animation speed to observe different training behaviors</li>
                                <li><strong>Visual Feedback:</strong> See real-time loss, accuracy, and confidence metrics</li>
                            </ul>
                            
                            <h3>Advanced Concepts</h3>
                            <ul>
                                <li><strong>Gradient Descent:</strong> Optimization algorithm that finds the best weights by following the steepest descent</li>
                                <li><strong>Vanishing Gradients:</strong> Problem where gradients become very small in deep networks</li>
                                <li><strong>Regularization:</strong> Techniques to prevent overfitting (dropout, weight decay)</li>
                                <li><strong>Batch Processing:</strong> Training on multiple examples simultaneously for better gradient estimates</li>
                                <li><strong>Transfer Learning:</strong> Using pre-trained networks for new tasks</li>
                            </ul>
                        </div>
                    `};case"sound-waves":return{title:"Sound Waves - Wave Propagation in Air",html:`
                        <div class="science-content">
                            <h3>What are Sound Waves?</h3>
                            <p>Sound waves are longitudinal mechanical waves that travel through a medium (like air, water, or solids) by compressing and rarefying the particles of the medium. These waves carry energy and information, allowing us to hear sounds.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Longitudinal Waves:</strong> Particles oscillate parallel to wave direction (compression and rarefaction)</li>
                                <li><strong>Transverse Waves:</strong> Particles oscillate perpendicular to wave direction (like guitar strings)</li>
                                <li><strong>Wave Properties:</strong> Frequency (pitch), amplitude (loudness), wavelength, and speed</li>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Pressure Variations:</strong> High pressure (compression) and low pressure (rarefaction) zones</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Transverse Mode:</strong> Particles moving up and down like a guitar string</li>
                                <li><strong>Longitudinal Mode:</strong> Particles moving back and forth in the direction of wave travel</li>
                                <li><strong>Pressure Zones:</strong> Red areas (compression) and blue areas (rarefaction) in longitudinal waves</li>
                                <li><strong>Wave Speed:</strong> How fast the wave pattern travels through the medium</li>
                                <li><strong>Frequency Effect:</strong> Higher frequency = shorter wavelength = higher pitch</li>
                            </ul>
                            
                            <h3>Wave Characteristics</h3>
                            <ul>
                                <li><strong>Frequency (f):</strong> Number of complete cycles per second (Hz) - determines pitch</li>
                                <li><strong>Amplitude (A):</strong> Maximum displacement from equilibrium - determines loudness</li>
                                <li><strong>Wavelength (λ):</strong> Distance between consecutive identical points</li>
                                <li><strong>Wave Speed (v):</strong> How fast the wave travels through the medium</li>
                                <li><strong>Period (T):</strong> Time for one complete cycle (T = 1/f)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Musical instruments (guitar strings, air columns)</li>
                                <li>Human speech and hearing</li>
                <li>Ultrasound imaging in medicine</li>
                                <li>Sonar for underwater detection</li>
                                <li>Acoustic engineering and sound design</li>
                                <li>Earthquake detection (seismic waves)</li>
                            </ul>
                            
                            <h3>Mathematical Relationships</h3>
                            <ul>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Period and Frequency:</strong> T = 1/f (period = 1/frequency)</li>
                                <li><strong>Energy:</strong> E ∝ A²f² (energy proportional to amplitude² × frequency²)</li>
                                <li><strong>Intensity:</strong> I ∝ A² (intensity proportional to amplitude squared)</li>
                            </ul>
                            
                            <h3>Wave Types Comparison</h3>
                            <ul>
                                <li><strong>Transverse Waves:</strong> Guitar strings, water waves, light waves</li>
                                <li><strong>Longitudinal Waves:</strong> Sound waves in air, seismic P-waves</li>
                                <li><strong>Combined Waves:</strong> Complex wave patterns with both components</li>
                            </ul>
                        </div>
                    `};case"neural-network":return{title:"Neural Network Training - Object Recognition",html:`
                        <div class="science-content">
                            <h3>What are Neural Networks?</h3>
                            <p>Neural networks are computational models inspired by biological neurons in the brain. They consist of interconnected nodes (neurons) organized in layers that process information and learn patterns from data. This animation demonstrates how neural networks learn to recognize and classify different geometric objects.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Artificial Neurons:</strong> Mathematical functions that receive inputs, apply weights, and produce outputs. Each neuron computes: output = σ(Σ(inputs × weights) + bias)</li>
                                <li><strong>Network Architecture:</strong> Input layer (2 neurons) → Hidden layer 1 (4 neurons) → Hidden layer 2 (3 neurons) → Output layer (1 neuron)</li>
                            </ul>
                            
                            <h3>Why This Architecture?</h3>
                            <ul>
                                <li><strong>2 Input Neurons:</strong> Perfect for our 2-feature problem (symmetry, edges)</li>
                                <li><strong>4 Hidden Neurons:</strong> Provides enough capacity to learn non-linear patterns without overfitting</li>
                                <li><strong>3 Hidden Neurons:</strong> Allows further feature refinement and abstraction</li>
                                <li><strong>1 Output Neuron:</strong> Binary classification (simple vs complex objects)</li>
                            </ul>
                            
                            <h3>Layer Size Effects</h3>
                            <ul>
                                <li><strong>Too Few Neurons:</strong> Network can't learn complex patterns (underfitting)</li>
                                <li><strong>Too Many Neurons:</strong> Network memorizes training data (overfitting)</li>
                                <li><strong>Optimal Size:</strong> Balances learning capacity with generalization</li>
                                <li><strong>Our Choice:</strong> 4→3 hidden layers provide sufficient complexity for this task</li>
                            </ul>
                                <li><strong>Weights & Biases:</strong> Numerical values that determine connection strength and neuron activation thresholds</li>
                                <li><strong>Sigmoid Activation:</strong> σ(x) = 1/(1 + e^(-x)) - transforms any input to a value between 0 and 1</li>
                                <li><strong>Backpropagation:</strong> Algorithm that calculates how much each weight should change to reduce prediction errors</li>
                                <li><strong>Learning Rate:</strong> Controls how big weight updates are during training</li>
                            </ul>
                            
                            <h3>Training Process Explained</h3>
                            <ol>
                                <li><strong>Forward Propagation:</strong> Input features flow through the network, each neuron computes its output using weights and activation function</li>
                                <li><strong>Loss Calculation:</strong> Compare network output with target value using Mean Squared Error: Loss = (target - output)²</li>
                                <li><strong>Backward Propagation:</strong> Calculate error gradients for each weight using chain rule of calculus</li>
                                <li><strong>Weight Updates:</strong> Adjust weights using gradient descent: Δw = learning_rate × gradient</li>
                            </ol>
                            
                            <h3>Object Recognition Task</h3>
                            <p>This network learns to classify geometric objects based on their complexity using 2 features:</p>
                            <ul>
                                <li><strong>Feature 1 - Symmetry Score (0-1):</strong> How symmetrical the object is (high = simple)</li>
                                <li><strong>Feature 2 - Edge Complexity (0-1):</strong> How many edges/corners the object has (high = complex)</li>
                                <li><strong>Simple Objects:</strong> Circle [0.9,0.1], Square [0.8,0.3] → Output: 0 (classified as simple)</li>
                                <li><strong>Complex Objects:</strong> Triangle [0.6,0.5], Star [0.3,0.9] → Output: 1 (classified as complex)</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch data flow forward (blue particles), errors flow backward (red particles), and weights update (flashing connections)</li>
                                <li><strong>Testing Mode:</strong> See how the trained network processes new inputs and makes predictions with confidence scores</li>
                                <li><strong>Visual Indicators:</strong> Active neurons pulse, weight changes are highlighted, and prediction accuracy improves over time</li>
                                <li><strong>Object Context:</strong> Each training example shows the actual geometric object being learned</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Neuron Output:</strong> y = σ(w₁x₁ + w₂x₂ + ... + wₙxₙ + b)</li>
                                <li><strong>Loss Function:</strong> L = (y_target - y_predicted)²</li>
                                <li><strong>Weight Update:</strong> w_new = w_old - α × ∂L/∂w</li>
                                <li><strong>Gradient Calculation:</strong> ∂L/∂w = ∂L/∂y × ∂y/∂w (chain rule)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Computer Vision:</strong> Image classification, object detection, facial recognition</li>
                                <li><strong>Natural Language Processing:</strong> Text classification, language translation, chatbots</li>
                                <li><strong>Speech Recognition:</strong> Voice assistants, transcription services</li>
                                <li><strong>Autonomous Systems:</strong> Self-driving cars, robotics, drones</li>
                                <li><strong>Medical Diagnosis:</strong> Disease detection, medical image analysis</li>
                                <li><strong>Financial Analysis:</strong> Fraud detection, stock prediction, risk assessment</li>
                            </ul>
                            
                            <h3>Educational Insights</h3>
                            <ul>
                                <li><strong>Learning Process:</strong> Neural networks learn by adjusting weights to minimize prediction errors</li>
                                <li><strong>Feature Learning:</strong> Hidden layers automatically learn useful features from raw input data</li>
                                <li><strong>Generalization:</strong> Well-trained networks can make accurate predictions on unseen data</li>
                                <li><strong>Overfitting:</strong> Networks can memorize training data instead of learning general patterns</li>
                                <li><strong>Hyperparameters:</strong> Learning rate, network architecture, and activation functions affect training success</li>
                            </ul>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch the network learn through forward/backward propagation cycles</li>
                                <li><strong>Testing Mode:</strong> Test the trained network on different objects and see predictions</li>
                                <li><strong>Parameter Control:</strong> Adjust learning rate and animation speed to observe different training behaviors</li>
                                <li><strong>Visual Feedback:</strong> See real-time loss, accuracy, and confidence metrics</li>
                            </ul>
                            
                            <h3>Advanced Concepts</h3>
                            <ul>
                                <li><strong>Gradient Descent:</strong> Optimization algorithm that finds the best weights by following the steepest descent</li>
                                <li><strong>Vanishing Gradients:</strong> Problem where gradients become very small in deep networks</li>
                                <li><strong>Regularization:</strong> Techniques to prevent overfitting (dropout, weight decay)</li>
                                <li><strong>Batch Processing:</strong> Training on multiple examples simultaneously for better gradient estimates</li>
                                <li><strong>Transfer Learning:</strong> Using pre-trained networks for new tasks</li>
                            </ul>
                        </div>
                    `};case"memory-management":return{title:"Program Execution - Code, Memory, and Data Flow",html:`
                        <div class="science-content">
                            <h3>What is Program Execution?</h3>
                            <p>Program execution is the process by which a computer runs code, manages memory, and processes data. This animation visualizes how a real program is executed, showing the flow of control, function calls, memory allocation and deallocation, and the movement of data between stack and heap. It provides a unique window into what happens "under the hood" when a computer runs software.</p>
                            <h3>Key Concepts Demonstrated</h3>
                            <ul>
                                <li><strong>Code Execution:</strong> Step-by-step execution of a real program, including function calls and returns</li>
                                <li><strong>Call Stack Visualization:</strong> See how function calls create stack frames and how the stack grows and shrinks</li>
                                <li><strong>Heap Memory Management:</strong> Watch memory blocks being allocated (malloc) and freed (free), and observe fragmentation and memory usage</li>
                                <li><strong>Data Flow:</strong> Visualize how data moves between functions, stack, and heap during program execution</li>
                                <li><strong>Garbage Collection:</strong> Observe how unreachable memory is detected and cleaned up (if enabled)</li>
                                <li><strong>Performance Metrics:</strong> Track memory usage, allocation/deallocation counts, fragmentation, and efficiency</li>
                            </ul>
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>How function calls and returns affect the call stack</li>
                                <li>How memory is allocated and deallocated on the heap</li>
                                <li>How data is passed between functions and stored in memory</li>
                                <li>How memory fragmentation and leaks can occur</li>
                                <li>How the program completes its execution and cleans up resources</li>
                            </ul>
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Understanding how operating systems and programming languages manage memory</li>
                                <li>Debugging and optimizing software for performance and reliability</li>
                                <li>Learning about stack overflows, memory leaks, and efficient resource management</li>
                                <li>Building better software by understanding what happens at runtime</li>
                            </ul>
                            <h3>Interactive Features</h3>
                            <ul>
                                <li>Step through program execution or watch it run automatically</li>
                                <li>View real-time statistics and performance metrics</li>
                                <li>Observe visual effects for memory allocation, deallocation, and data flow</li>
                                <li>Toggle output and statistics panels for deeper insights</li>
                            </ul>
                        </div>
                    `};case"blockchain":return{title:"Blockchain - Distributed Ledger Technology",html:`
                        <div class="science-content">
                            <h3>What is Blockchain?</h3>
                            <p>Blockchain is a distributed ledger technology that enables secure, transparent, and tamper-resistant record-keeping across a network of computers. Each block contains a list of transactions, and blocks are linked together in a chain using cryptographic hashes, creating an immutable record of all transactions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Cryptographic Hashing:</strong> Mathematical function that converts data into a fixed-size string (hash) - any change in data produces a completely different hash</li>
                                <li><strong>Proof of Work:</strong> Consensus mechanism where miners solve complex mathematical puzzles to validate transactions and create new blocks</li>
                                <li><strong>Distributed Network:</strong> Multiple nodes maintain identical copies of the blockchain, ensuring redundancy and security</li>
                                <li><strong>Merkle Trees:</strong> Data structure that efficiently verifies transaction integrity by creating a single hash from multiple transactions</li>
                                <li><strong>Difficulty Adjustment:</strong> Network automatically adjusts mining difficulty to maintain consistent block creation rate</li>
                            </ul>
                            
                            <h3>Block Structure</h3>
                            <ul>
                                <li><strong>Block Header:</strong> Contains metadata including previous block hash, timestamp, nonce, and Merkle root</li>
                                <li><strong>Transactions:</strong> List of validated transactions waiting to be included in the block</li>
                                <li><strong>Nonce:</strong> Number that miners change to find a hash meeting the difficulty requirement</li>
                                <li><strong>Hash:</strong> Unique fingerprint of the block's content - any change invalidates the hash</li>
                                <li><strong>Previous Hash:</strong> Links each block to its predecessor, creating the chain</li>
                            </ul>
                            
                            <h3>Mining Process Explained</h3>
                            <ol>
                                <li><strong>Transaction Collection:</strong> Network collects pending transactions into a candidate block</li>
                                <li><strong>Hash Calculation:</strong> Block header is hashed using SHA-256 algorithm</li>
                                <li><strong>Difficulty Check:</strong> Hash must start with a specific number of zeros (target)</li>
                                <li><strong>Nonce Increment:</strong> If hash doesn't meet target, nonce is incremented and process repeats</li>
                                <li><strong>Block Discovery:</strong> When valid hash is found, block is broadcast to network</li>
                                <li><strong>Network Validation:</strong> Other nodes verify the block and add it to their chain</li>
                            </ol>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Modern Block Design:</strong> Rounded blocks with gradients, inner highlights, and modern typography</li>
                                <li><strong>Enhanced Mining Process:</strong> Watch miners (orange nodes with pulsing rings) working to find valid hashes</li>
                                <li><strong>Successful Miner Zoom:</strong> The successful miner node pulses and zooms to draw attention</li>
                                <li><strong>Dynamic Transaction Blocks:</strong> Transactions fade over time, show age indicators, and have priority colors</li>
                                <li><strong>Block Creation:</strong> See new blocks being added to the chain with celebration particles</li>
                                <li><strong>Network Propagation:</strong> Observe animated arrows showing blocks spreading through the network</li>
                                <li><strong>Transaction Flow:</strong> Watch pending transactions being included in blocks with real-time updates</li>
                                <li><strong>Difficulty Effects:</strong> Lower difficulty = faster mining, higher difficulty = slower mining</li>
                                <li><strong>Dynamic Network:</strong> Nodes join and leave the network automatically with enhanced visual effects</li>
                                <li><strong>Block Hashes:</strong> Always visible with modern monospace font (truncated for readability)</li>
                                <li><strong>Consensus Process:</strong> Watch network nodes reach agreement during guided mode</li>
                                <li><strong>Block Rejection:</strong> See blocks rejected with red particles when consensus fails (60% threshold)</li>
                                <li><strong>Transparent Info Panel:</strong> Network status panel with reduced opacity for better integration</li>
                            </ul>
                            
                            <h3>Block Rejection & Consensus</h3>
                            <p>In guided mode (difficulty 2+), the network implements a realistic consensus mechanism:</p>
                            <ul>
                                <li><strong>Consensus Threshold:</strong> 60% of network nodes must agree to accept a block</li>
                                <li><strong>Rejection Process:</strong> If consensus fails, the block is rejected with visual feedback</li>
                                <li><strong>Red Particles:</strong> Rejection particles appear around the mining block position</li>
                                <li><strong>Automatic Recovery:</strong> Mining automatically restarts after rejection</li>
                                <li><strong>Network Reset:</strong> All nodes return to default state after rejection</li>
                                <li><strong>Statistics Update:</strong> Phase indicator shows consensus percentage and rejection status</li>
                            </ul>
                            
                            <h3>Guided Mode (Difficulty 2+)</h3>
                            <p>When mining difficulty is set to 2 or higher, the simulation automatically activates a step-by-step guided mode that walks you through the entire block addition process:</p>
                            <ol>
                                <li><strong>Mining Success:</strong> Block is successfully mined with valid hash</li>
                                <li><strong>Validation:</strong> Network nodes validate the block's transactions and hash</li>
                                <li><strong>Propagation:</strong> Block spreads through the network via peer-to-peer communication</li>
                                <li><strong>Consensus:</strong> Network reaches agreement on block validity (requires 60% of nodes)</li>
                                <li><strong>Finalization:</strong> Block is permanently added to the blockchain OR rejected if consensus fails</li>
                            </ol>
                            <p><strong>Consensus Mechanism:</strong> The network requires 60% of nodes to reach consensus. If consensus fails, the block is rejected and mining restarts automatically.</p>
                            <p><strong>Note:</strong> For difficulty levels 1, blocks are added directly without guided mode for faster simulation.</p>
                            
                            <h3>Cryptographic Security</h3>
                            <ul>
                                <li><strong>Hash Function:</strong> SHA-256 produces 256-bit hashes - practically impossible to reverse</li>
                                <li><strong>Chain Integrity:</strong> Changing any block invalidates all subsequent blocks</li>
                                <li><strong>Immutability:</strong> Once added, blocks cannot be modified without detection</li>
                                <li><strong>Digital Signatures:</strong> Transactions are cryptographically signed to prevent forgery</li>
                                <li><strong>51% Attack Resistance:</strong> Network security depends on honest majority of computing power</li>
                            </ul>
                            
                            <h3>Network Architecture</h3>
                            <ul>
                                <li><strong>Full Nodes:</strong> Store complete blockchain and validate all transactions</li>
                                <li><strong>Mining Nodes:</strong> Specialized nodes that create new blocks through proof of work</li>
                                <li><strong>Light Nodes:</strong> Store only block headers for efficiency</li>
                                <li><strong>Peer-to-Peer:</strong> Direct communication between nodes without central authority</li>
                                <li><strong>Fork Resolution:</strong> Network automatically chooses the longest valid chain</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Hash Function:</strong> H(x) = SHA-256(block_header) - deterministic and collision-resistant</li>
                                <li><strong>Difficulty Target:</strong> T = 2^(256-D) where D is difficulty level</li>
                                <li><strong>Mining Probability:</strong> P = T/2^256 - probability of finding valid hash in one attempt</li>
                                <li><strong>Expected Time:</strong> E[T] = 1/P attempts to find valid block</li>
                                <li><strong>Hashrate:</strong> H = attempts_per_second × network_size</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Cryptocurrencies:</strong> Bitcoin, Ethereum, and other digital currencies</li>
                                <li><strong>Smart Contracts:</strong> Self-executing contracts with predefined conditions</li>
                                <li><strong>Supply Chain:</strong> Transparent tracking of goods from source to consumer</li>
                                <li><strong>Digital Identity:</strong> Secure, decentralized identity management</li>
                                <li><strong>Voting Systems:</strong> Tamper-resistant electronic voting</li>
                                <li><strong>Decentralized Finance (DeFi):</strong> Financial services without intermediaries</li>
                                <li><strong>NFTs:</strong> Non-fungible tokens for digital asset ownership</li>
                            </ul>
                            
                            <h3>Visual Enhancements</h3>
                            <ul>
                                <li><strong>Modern Block Design:</strong> Rounded corners, gradient backgrounds, inner highlights, and enhanced typography</li>
                                <li><strong>Golden Genesis Block:</strong> Special golden gradient to distinguish the first block</li>
                                <li><strong>Enhanced Node Design:</strong> Multi-stop gradients, gradient borders, and inner highlights for depth</li>
                                <li><strong>Successful Miner Zoom:</strong> Pulsing zoom effect (0.7x-1.3x) with additional rings for emphasis</li>
                                <li><strong>Dynamic Transaction Display:</strong> Age-based fading, priority indicators, and real-time updates</li>
                                <li><strong>Transaction Priority Colors:</strong> Green (High), Orange (Medium), Red (Low) based on fees</li>
                                <li><strong>Pulsing New Transactions:</strong> Fresh transactions have animated borders for 5 seconds</li>
                                <li><strong>Transparent Info Panel:</strong> Reduced opacity (75%-55%) with text shadows for readability</li>
                                <li><strong>Enhanced Typography:</strong> Modern fonts, better spacing, and improved readability</li>
                                <li><strong>Realistic Transaction Aging:</strong> Transactions expire after 30 seconds with visual feedback</li>
                            </ul>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li><strong>Mining Difficulty (1-8):</strong> Control how hard it is to mine blocks - affects block creation speed and guided mode activation</li>
                                <li><strong>Simulation Speed (0.1x-3x):</strong> Control how fast the entire simulation runs</li>
                                <li><strong>Auto Mining:</strong> Always enabled - simulation continuously mines new blocks</li>
                                <li><strong>Network Visualization:</strong> Always visible - watch nodes join, leave, and validate blocks</li>
                                <li><strong>Block Hashes:</strong> Always visible with modern monospace font (truncated for readability)</li>
                                <li><strong>Real-time Statistics:</strong> Monitor blocks, transactions, hashrate, network status, and current phase</li>
                                <li><strong>Guided Mode:</strong> Automatically activates for difficulty 2+ with step-by-step process visualization</li>
                            </ul>
                            
                            <h3>Dynamic Transaction System</h3>
                            <ul>
                                <li><strong>Real-time Generation:</strong> 1-4 new transactions every 1.5-3.5 seconds</li>
                                <li><strong>Transaction Types:</strong> Transfer, Smart Contract, Token Mint, Stake, Swap, Liquidity</li>
                                <li><strong>Dynamic Fees:</strong> Fees vary based on transaction type and complexity</li>
                                <li><strong>Age-based Fading:</strong> Transactions fade over 30 seconds with visual feedback</li>
                                <li><strong>Priority System:</strong> High/Medium/Low priority based on fee amounts</li>
                                <li><strong>Automatic Expiration:</strong> Transactions older than 30 seconds are removed</li>
                                <li><strong>Random Failures:</strong> 10% chance of low-fee transactions being rejected</li>
                                <li><strong>Mempool Management:</strong> Maximum 100 transactions with fee-based replacement</li>
                                <li><strong>Realistic Descriptions:</strong> Dynamic transaction descriptions for each type</li>
                                <li><strong>Visual Age Indicators:</strong> "Xs ago" display instead of absolute timestamps</li>
                            </ul>
                            
                            <h3>Advanced Concepts</h3>
                            <ul>
                                <li><strong>Consensus Mechanisms:</strong> Proof of Work, Proof of Stake, Delegated Proof of Stake</li>
                                <li><strong>Forking:</strong> Temporary chain splits that resolve through consensus</li>
                                <li><strong>Mempool:</strong> Pool of unconfirmed transactions waiting to be mined</li>
                                <li><strong>Block Rewards:</strong> Incentive system for miners to secure the network</li>
                                <li><strong>Transaction Fees:</strong> Additional incentive for miners to prioritize transactions</li>
                                <li><strong>Lightning Network:</strong> Layer 2 scaling solution for faster, cheaper transactions</li>
                            </ul>
                            
                            <h3>Security Considerations</h3>
                            <ul>
                                <li><strong>Double Spending:</strong> Prevented through consensus and transaction ordering</li>
                                <li><strong>Sybil Attacks:</strong> Mitigated through proof of work cost</li>
                                <li><strong>51% Attacks:</strong> Theoretical but economically unfeasible for large networks</li>
                                <li><strong>Quantum Resistance:</strong> Future consideration for post-quantum cryptography</li>
                                <li><strong>Privacy:</strong> Techniques like zero-knowledge proofs for transaction privacy</li>
                            </ul>
                            
                            <h3>Current Control Panel</h3>
                            <ul>
                                <li><strong>Mining Difficulty:</strong> Set to 1-8 (default: 4) - controls mining speed and guided mode activation</li>
                                <li><strong>Simulation Speed:</strong> Set to 0.1x-3x (default: 1.0x) - controls overall animation speed</li>
                                <li><strong>Reset Button:</strong> Resets the entire simulation to initial state</li>
                            </ul>
                            
                            <h3>Always Active Features</h3>
                            <ul>
                                <li><strong>Auto Mining:</strong> Continuously mines new blocks</li>
                                <li><strong>Network Visualization:</strong> Shows all nodes and their activities</li>
                                <li><strong>Block Hashes:</strong> Always visible in blocks (truncated for readability)</li>
                                <li><strong>Real-time Statistics:</strong> Live updates of all blockchain metrics</li>
                            </ul>
                            
                            <h3>Educational Insights</h3>
                            <ul>
                                <li><strong>Decentralization:</strong> No single point of failure or control</li>
                                <li><strong>Transparency:</strong> All transactions are publicly verifiable</li>
                                <li><strong>Immutability:</strong> Historical record cannot be altered</li>
                                <li><strong>Trustlessness:</strong> Participants don't need to trust each other, only the protocol</li>
                                <li><strong>Incentive Alignment:</strong> Economic incentives ensure network security and participation</li>
                            </ul>
                        </div>
                    `};default:return{title:"Animation Information",html:"<p>Select an animation to learn more about the physics concepts it demonstrates.</p>"}}}updateMemoryManagementStats(){if(!this.memoryManagement)return;const t=this.memoryManagement.getStats(),i=document.getElementById("memoryBuildings"),e=document.getElementById("memoryAllocated"),s=document.getElementById("memoryGCCycles"),n=document.getElementById("memoryEfficiency");if(i&&(i.textContent=t.totalHeapUsed||0),e&&(e.textContent=t.totalHeapUsed||0),s&&(s.textContent=t.gcCycles||0),n){const a=t.fragmentation?100-t.fragmentation:100;n.textContent=a.toFixed(1)+"%"}}updateBlockchainStats(){if(!this.blockchain)return;const t=this.blockchain.getStats(),i=document.getElementById("blockchainBlocks"),e=document.getElementById("blockchainTransactions"),s=document.getElementById("blockchainPending"),n=document.getElementById("blockchainDifficulty"),a=document.getElementById("blockchainHashrate"),o=document.getElementById("blockchainMiners"),h=document.getElementById("blockchainNodes"),l=document.getElementById("blockchainPhase"),c=document.getElementById("blockchainMining");if(i&&(i.textContent=t.blocks||0),e&&(e.textContent=t.transactions||0),s&&(s.textContent=t.pending||0),n&&(n.textContent=t.difficulty||0),a&&(a.textContent=(t.hashrate||0)+" H/s"),o&&(o.textContent=t.miners||0),h&&(h.textContent=t.nodes||0),l){let d=t.phase||"idle";t.phase==="finalization"&&t.consensusPercentage!==void 0&&(t.consensusReached?d=`Finalization (${t.consensusPercentage}% consensus)`:d=`Rejection (${t.consensusPercentage}% < ${t.consensusThreshold}%)`),l.textContent=d}c&&(c.textContent=t.isMining?"Yes":"No")}}document.addEventListener("DOMContentLoaded",()=>{const w=document.getElementById("animationCanvas");new St(w),Pt()});function Pt(){const w=document.querySelector(".controls-panel"),t=document.querySelector(".controls-toggle");if(!w||!t)return;localStorage.getItem("controlsCollapsed")==="true"&&w.classList.add("collapsed"),t.addEventListener("click",()=>{w.classList.contains("collapsed")?(w.classList.remove("collapsed"),localStorage.setItem("controlsCollapsed","false")):(w.classList.add("collapsed"),localStorage.setItem("controlsCollapsed","true"))}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="t"&&(e.preventDefault(),t.click())})}
//# sourceMappingURL=index-BFupBme1.js.map
