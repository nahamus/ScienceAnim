(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();class L{constructor(t){this.ctx=t,this.animationType="default"}drawLabels(t,i,e=25,s=45){this.ctx.save();const a=window&&window.devicePixelRatio?window.devicePixelRatio:1;this.ctx.scale(1,1);const n=Math.round(16*(a>1,1)),o=Math.round(12*(a>1,1));this.ctx.font=`bold ${n}px Inter`,this.ctx.textAlign="center";let h="#ffffff",r="rgba(0, 0, 0, 0.8)";(this.animationType==="fluid-flow"||this.animationType==="bernoulli"||this.animationType==="brownian-motion"||this.animationType==="diffusion"||this.animationType==="gas-laws"||this.animationType==="pendulum"||this.animationType==="orbital-motion"||this.animationType==="wave-particle-duality"||this.animationType==="wave-propagation")&&(h="#1a1a2e",r="rgba(255, 255, 255, 0.8)");const l=h==="#ffffff"?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)";this.ctx.lineWidth=3,this.ctx.strokeStyle=l,this.ctx.shadowColor=r,this.ctx.shadowBlur=2,this.ctx.fillStyle=h,this.ctx.strokeText(t,this.ctx.canvas.width/2,e),this.ctx.fillText(t,this.ctx.canvas.width/2,e),this.ctx.font=`${o}px Inter`,this.ctx.fillStyle=h,this.ctx.strokeStyle=l,this.ctx.shadowColor=r,this.ctx.strokeText(i,this.ctx.canvas.width/2,s),this.ctx.fillText(i,this.ctx.canvas.width/2,s),this.ctx.shadowBlur=0,this.ctx.restore()}updateStatsWithElements(t,i){Object.entries(i).forEach(([e,s])=>{const a=document.getElementById(s);a&&t[e]!==void 0&&(a.textContent=t[e])})}reset(){this.time=0}update(t){this.time+=t}render(){}getStats(){return{time:this.time||0}}}class lt extends L{constructor(t){super(t),this.animationType="brownian-motion",this.particles=[],this.particleCount=15,this.speed=1,this.temperature=1,this.showTrails=!1,this.showVelocityVectors=!1,this.showTemperatureHeatmap=!1,this.showVelocityDistribution=!1,this.showMeanFreePath=!1,this.particleSize=4,this.collisionCount=0,this.meanFreePath=0,this.velocityData=[],this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++){const i=(Math.random()-.5)*2,e=(Math.random()-.5)*2,s=Math.sqrt(i*i+e*e);this.particles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:i,vy:e,velocity:s,trail:[],lastCollisionTime:0,distanceTraveled:0})}}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setSpeed(t){this.speed=t}setTemperature(t){this.temperature=t}setShowTrails(t){this.showTrails=t,t||this.particles.forEach(i=>i.trail=[])}setShowVelocityVectors(t){this.showVelocityVectors=t}setShowTemperatureHeatmap(t){this.showTemperatureHeatmap=t}setShowVelocityDistribution(t){this.showVelocityDistribution=t}setShowMeanFreePath(t){this.showMeanFreePath=t}setParticleSize(t){this.particleSize=t}reset(){this.time=0,this.collisionCount=0,this.velocityData=[],this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*2;if(this.particles.map(e=>({x:e.x,y:e.y})),this.particles.forEach((e,s)=>{e.vx+=(Math.random()-.5)*this.temperature*.1,e.vy+=(Math.random()-.5)*this.temperature*.1,e.vx*=.99,e.vy*=.99;const a=e.x,n=e.y;e.x+=e.vx*i*50,e.y+=e.vy*i*50,e.velocity=Math.sqrt(e.vx*e.vx+e.vy*e.vy),e.distanceTraveled+=Math.sqrt((e.x-a)*(e.x-a)+(e.y-n)*(e.y-n)),(e.x<0||e.x>this.ctx.canvas.width)&&(e.vx*=-.8,e.x=Math.max(0,Math.min(this.ctx.canvas.width,e.x)),this.collisionCount++,e.lastCollisionTime=this.time),(e.y<0||e.y>this.ctx.canvas.height)&&(e.vy*=-.8,e.y=Math.max(0,Math.min(this.ctx.canvas.height,e.y)),this.collisionCount++,e.lastCollisionTime=this.time);for(let o=s+1;o<this.particles.length;o++){const h=this.particles[o],r=e.x-h.x,l=e.y-h.y,c=Math.sqrt(r*r+l*l);if(c<this.particleSize*2){Math.sqrt(e.vx*e.vx+e.vy*e.vy),Math.sqrt(h.vx*h.vx+h.vy*h.vy);const g=e.vx,x=e.vy;e.vx=h.vx,e.vy=h.vy,h.vx=g,h.vy=x,this.collisionCount++,e.lastCollisionTime=this.time,h.lastCollisionTime=this.time;const u=this.particleSize*2-c,f=u*r/c/2,p=u*l/c/2;e.x+=f,e.y+=p,h.x-=f,h.y-=p}}this.showTrails?(e.trail.push({x:e.x,y:e.y}),e.trail.length>25&&e.trail.shift()):e.trail.length=0}),this.showVelocityDistribution&&(this.velocityData.push(...this.particles.map(e=>e.velocity)),this.velocityData.length>1e3&&(this.velocityData=this.velocityData.slice(-500))),this.showMeanFreePath&&this.collisionCount>0){const e=this.particles.reduce((s,a)=>s+a.distanceTraveled,0);this.meanFreePath=e/this.collisionCount}}render(){this.showTemperatureHeatmap&&this.drawTemperatureHeatmap(),this.showVelocityDistribution&&this.drawVelocityDistribution(),this.showMeanFreePath&&this.drawMeanFreePathInfo(),this.particles.forEach(t=>{this.ctx.beginPath(),this.ctx.fillStyle=this.getVelocityColor(t.velocity),this.ctx.arc(t.x,t.y,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke()}),this.drawBrownianLabels()}getVelocityColor(t){const e=Math.min(t/3,1);if(e<.5){const s=e*2;return`rgb(0, ${Math.floor(255*s)}, ${Math.floor(255*(1-s))})`}else{const s=(e-.5)*2;return`rgb(${Math.floor(255*s)}, ${Math.floor(255*(1-s))}, 0)`}}drawTemperatureHeatmap(){const i=Math.ceil(this.ctx.canvas.width/20),e=Math.ceil(this.ctx.canvas.height/20);for(let s=0;s<e;s++)for(let a=0;a<i;a++){const n=a*20+10,o=s*20+20/2;let h=0,r=0;if(this.particles.forEach(l=>{const c=l.x-n,g=l.y-o;Math.sqrt(c*c+g*g)<20&&(h+=l.velocity,r++)}),r>0){h/=r;const l=Math.min(h/3,.3);this.ctx.fillStyle=`rgba(255, 100, 100, ${l})`,this.ctx.fillRect(a*20,s*20,20,20)}}}drawVelocityDistribution(){const e=this.ctx.canvas.width-200-20,s=120;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,100),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,100),this.velocityData.length>0){const n=new Array(20).fill(0),o=Math.max(...this.velocityData);this.velocityData.forEach(l=>{const c=Math.floor(l/o*19);c>=0&&c<20&&n[c]++});const h=Math.max(...n),r=200/20;this.ctx.fillStyle="#4ECDC4";for(let l=0;l<20;l++){const c=n[l]/h*80;this.ctx.fillRect(e+l*r+2,s+100-10-c,r-4,c)}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Velocity Distribution",e+200/2,s-5)}drawMeanFreePathInfo(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,120,200,80),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,120,200,80),this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="left",this.ctx.fillText(`Collisions: ${this.collisionCount}`,30,140),this.ctx.fillText(`Mean Free Path: ${this.meanFreePath.toFixed(1)}`,30,160),this.ctx.fillText(`Temperature: ${this.temperature.toFixed(1)}`,30,180)}getStats(){const t=this.particles.reduce((i,e)=>i+Math.sqrt(e.vx*e.vx+e.vy*e.vy),0)/this.particles.length;return{particleCount:this.particles.length,avgSpeed:t,time:this.time,collisionCount:this.collisionCount,meanFreePath:this.meanFreePath,temperature:this.temperature}}drawBrownianLabels(){this.drawLabels("Brownian Motion","⟨v²⟩ = 3kBT/m  |  λ = 1/(√2πd²n)  |  D = kBT/(6πηr)")}}class ct extends L{constructor(t){super(t),this.animationType="diffusion",this.particles=[],this.particleCount=200,this.speed=1,this.diffusionRate=1,this.concentrationGradient=1,this.showConcentration=!0,this.particleSize=4,this.concentrationMap=[],this.diffusionStarted=!1,this.showConcentrationProfile=!0,this.showParticleTrails=!1,this.initializeParticles(),this.initializeConcentrationMap()}initializeParticles(){this.particles=[];const t=this.ctx.canvas.width*.2;for(let i=0;i<this.particleCount;i++)this.particles.push({x:Math.random()*t,y:Math.random()*this.ctx.canvas.height,vx:0,vy:0,color:"#FF6B6B",trail:[]})}initializeConcentrationMap(){this.concentrationMap=[];const t=15,i=Math.ceil(this.ctx.canvas.width/t),e=Math.ceil(this.ctx.canvas.height/t);for(let s=0;s<e;s++){this.concentrationMap[s]=[];for(let a=0;a<i;a++){const n=a/i;this.concentrationMap[s][a]=Math.max(0,1-n*1.5)}}}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setSpeed(t){this.speed=t}setDiffusionRate(t){this.diffusionRate=t}setConcentrationGradient(t){this.concentrationGradient=t,this.initializeConcentrationMap()}setParticleSize(t){this.particleSize=t}setShowConcentration(t){this.showConcentration=t}setShowConcentrationProfile(t){this.showConcentrationProfile=t}setShowParticleTrails(t){this.showParticleTrails=t}startDiffusion(){this.diffusionStarted=!0}reset(){this.time=0,this.diffusionStarted=!1,this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*10;this.diffusionStarted&&this.particles.forEach(e=>{var n,o;if(!isFinite(e.x)||!isFinite(e.y)||isNaN(e.x)||isNaN(e.y)){e.x=Math.random()*this.ctx.canvas.width*.2,e.y=Math.random()*this.ctx.canvas.height,e.vx=0,e.vy=0;return}e.vx+=(Math.random()-.5)*this.diffusionRate*.5,e.vy+=(Math.random()-.5)*this.diffusionRate*.5;const s=Math.floor(e.x/15),a=Math.floor(e.y/15);if(s>0&&s<this.concentrationMap[0].length-1&&a>=0&&a<this.concentrationMap.length){const h=((n=this.concentrationMap[a])==null?void 0:n[s])-((o=this.concentrationMap[a])==null?void 0:o[s+1]),r=Math.max(.1,1-this.time/1e4);e.vx+=h*.1*r}e.vx*=.98,e.vy*=.98,e.x+=e.vx*i*30,e.y+=e.vy*i*30,this.showParticleTrails&&(e.trail.push({x:e.x,y:e.y}),e.trail.length>20&&e.trail.shift()),e.x<0&&(e.x=0,e.vx*=-.5),e.x>this.ctx.canvas.width&&(e.x=this.ctx.canvas.width,e.vx*=-.5),e.y<0&&(e.y=0,e.vy*=-.5),e.y>this.ctx.canvas.height&&(e.y=this.ctx.canvas.height,e.vy*=-.5),(!isFinite(e.x)||!isFinite(e.y)||isNaN(e.x)||isNaN(e.y))&&(e.x=Math.random()*this.ctx.canvas.width*.2,e.y=Math.random()*this.ctx.canvas.height,e.vx=0,e.vy=0)})}render(){if(this.showConcentration)for(let i=0;i<this.concentrationMap.length;i++)for(let e=0;e<this.concentrationMap[i].length;e++){const a=this.concentrationMap[i][e]*.8,n=this.ctx.createLinearGradient(e*15,i*15,(e+1)*15,(i+1)*15);n.addColorStop(0,`rgba(102, 126, 234, ${a*.8})`),n.addColorStop(.5,`rgba(118, 75, 162, ${a})`),n.addColorStop(1,`rgba(102, 126, 234, ${a*.6})`),this.ctx.fillStyle=n,this.ctx.fillRect(e*15,i*15,15,15),this.ctx.strokeStyle=`rgba(255, 255, 255, ${a*.1})`,this.ctx.lineWidth=.5,this.ctx.strokeRect(e*15,i*15,15,15)}this.showParticleTrails&&this.particles.forEach(t=>{if(t.trail.length>1){const i=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.trail[t.trail.length-1].x,t.trail[t.trail.length-1].y);i.addColorStop(0,"rgba(255, 107, 107, 0.8)"),i.addColorStop(.5,"rgba(255, 107, 107, 0.4)"),i.addColorStop(1,"rgba(255, 107, 107, 0.1)"),this.ctx.beginPath(),this.ctx.strokeStyle=i,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y);for(let e=1;e<t.trail.length;e++)this.ctx.lineTo(t.trail[e].x,t.trail[e].y);this.ctx.stroke()}}),this.particles.forEach(t=>{if(!isFinite(t.x)||!isFinite(t.y)||isNaN(t.x)||isNaN(t.y))return;const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=Math.min(i/5,1);this.ctx.shadowColor=`rgba(255, 107, 107, ${.4+e*.3})`,this.ctx.shadowBlur=12+e*8;const s=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,this.particleSize*(1+e*.3)),a=e>.5?255:200,n=.9+e*.1;s.addColorStop(0,`rgba(${a}, 107, 107, ${n})`),s.addColorStop(.6,`rgba(255, 107, 107, ${.8-e*.2})`),s.addColorStop(1,"rgba(255, 107, 107, 0.4)"),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,this.particleSize*(1+e*.2),0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.strokeStyle=`rgba(255, 255, 255, ${.9+e*.1})`,this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+e*.2})`,this.ctx.arc(t.x-this.particleSize*.3,t.y-this.particleSize*.3,this.particleSize*.3,0,Math.PI*2),this.ctx.fill()}),this.showConcentrationProfile&&this.drawConcentrationProfile(),this.diffusionStarted||this.drawStartBarrier(),this.drawDiffusionLabels()}drawConcentrationProfile(){const i=this.ctx.canvas.height-100-25,e=this.ctx.canvas.width-50;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(25,i,e,100),this.ctx.strokeStyle="rgba(102, 126, 234, 0.3)",this.ctx.lineWidth=2,this.ctx.strokeRect(25,i,e,100),this.ctx.fillStyle="rgba(0, 0, 0, 0.05)",this.ctx.fillRect(27,i+2,e-4,96);const s=50,a=e/s,n=new Array(s).fill(0);this.particles.forEach(c=>{const g=Math.floor(c.x/this.ctx.canvas.width*s);g>=0&&g<s&&n[g]++});const o=Math.max(...n),h=80/Math.max(o,1),r=this.ctx.createLinearGradient(25,i,25+e,i);r.addColorStop(0,"#FF6B6B"),r.addColorStop(.5,"#667eea"),r.addColorStop(1,"#764ba2"),this.ctx.strokeStyle=r,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(25,i+100-15);for(let c=0;c<s;c++){const g=25+c*a,x=i+100-15-n[c]*h;this.ctx.lineTo(g,x)}this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 107, 107, 0.2)",this.ctx.beginPath(),this.ctx.moveTo(25,i+100-15);for(let c=0;c<s;c++){const g=25+c*a,x=i+100-15-n[c]*h;this.ctx.lineTo(g,x)}this.ctx.lineTo(25+e,i+100-15),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#333",this.ctx.font="bold 16px Inter",this.ctx.textAlign="center",this.ctx.fillText("Concentration Profile",this.ctx.canvas.width/2,i-8);const l=this.ctx.createLinearGradient(30,i+15,this.ctx.canvas.width-30,i+15);l.addColorStop(0,"#FF6B6B"),l.addColorStop(1,"#764ba2"),this.ctx.fillStyle=l,this.ctx.font="bold 14px Inter",this.ctx.fillText("High Concentration",35,i+20),this.ctx.fillText("Low Concentration",this.ctx.canvas.width-35,i+20)}drawStartBarrier(){const t=this.ctx.canvas.width*.2,i=this.ctx.createLinearGradient(t-2,0,t+2,0);i.addColorStop(0,"rgba(255, 0, 0, 0.8)"),i.addColorStop(.5,"rgba(255, 107, 107, 1)"),i.addColorStop(1,"rgba(255, 0, 0, 0.8)"),this.ctx.strokeStyle=i,this.ctx.lineWidth=4,this.ctx.setLineDash([15,8]),this.ctx.lineCap="round",this.ctx.shadowColor="rgba(255, 0, 0, 0.6)",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.ctx.canvas.height),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.shadowBlur=0;const e="Click or tap to start diffusion",s=this.ctx.measureText(e).width;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(this.ctx.canvas.width/2-s/2-20,this.ctx.canvas.height-60,s+40,40),this.ctx.strokeStyle="rgba(102, 126, 234, 0.3)",this.ctx.lineWidth=2,this.ctx.strokeRect(this.ctx.canvas.width/2-s/2-20,this.ctx.canvas.height-60,s+40,40);const a=this.ctx.createLinearGradient(this.ctx.canvas.width/2-s/2,this.ctx.canvas.height-50,this.ctx.canvas.width/2+s/2,this.ctx.canvas.height-50);a.addColorStop(0,"#667eea"),a.addColorStop(1,"#764ba2"),this.ctx.fillStyle=a,this.ctx.font="bold 18px Inter",this.ctx.textAlign="center",this.ctx.fillText(e,this.ctx.canvas.width/2,this.ctx.canvas.height-35)}getStats(){const t=this.particles.reduce((a,n)=>a+Math.sqrt(n.vx*n.vx+n.vy*n.vy),0)/this.particles.length,i=this.particles.filter(a=>a.x<this.ctx.canvas.width/2).length,e=this.particles.length-i,s=Math.abs(i-e)/this.particles.length;return{particleCount:this.particles.length,avgSpeed:t,concentrationSpread:s,time:this.time}}drawDiffusionLabels(){this.drawLabels("Particle Diffusion","∂c/∂t = D∇²c  |  J = -D∇c  |  D = kBT/(6πηr)")}}class dt extends L{constructor(t){super(t),this.animationType="gas-laws",this.particles=[],this.particleCount=50,this.temperature=300,this.volume=300,this.pressure=1,this.speed=1,this.showPressureGauge=!0,this.showParticleTrails=!1,this.showGasLaws=!1,this.showPressureHeatmap=!1,this.showVelocityDistribution=!1,this.showGasLawGraph=!1,this.showParticleCollisions=!1,this.lawType="boyle",this.containerWidth=200,this.containerX=300,this.pistonY=400-this.volume,this.collisionCount=0,this.velocityData=[],this.pressureHistory=[],this.volumeHistory=[],this.temperatureHistory=[],this.initialConditions={pressure:1,volume:300,temperature:300},this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++)this.particles.push({x:this.containerX+Math.random()*this.containerWidth,y:this.pistonY+this.volume+Math.random()*(this.volume*.8),vx:(Math.random()-.5)*this.temperature*.1,vy:(Math.random()-.5)*this.temperature*.1})}setSpeed(t){this.speed=t}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setTemperature(t){const i=this.temperature||300;this.temperature=t;const e=Math.sqrt((t||300)/i);this.particles.forEach(s=>{s.vx*=e,s.vy*=e})}setVolume(t){this.volume=t,this.pistonY=400-this.volume,this.particles.forEach(i=>{i.y>this.pistonY+this.volume&&(i.y=this.pistonY+this.volume-10)})}setPressure(t){this.pressure=t}setShowPressureGauge(t){this.showPressureGauge=t}setShowPressureHeatmap(t){this.showPressureHeatmap=t}setShowVelocityDistribution(t){this.showVelocityDistribution=t}setShowGasLawGraph(t){this.showGasLawGraph=t}setShowParticleCollisions(t){this.showParticleCollisions=t}setLawType(t){this.lawType=t,this.pressure=this.initialConditions.pressure,this.volume=this.initialConditions.volume,this.temperature=this.initialConditions.temperature,this.pistonY=400-this.volume,this.reset()}reset(){this.time=0,this.collisionCount=0,this.velocityData=[],this.pressureHistory=[],this.volumeHistory=[],this.temperatureHistory=[],this.initializeParticles()}update(t){this.time+=t;const i=t/1e3*this.speed*1;this.particles.forEach((s,a)=>{if(s.x+=s.vx*i*30,s.y+=s.vy*i*30,(s.x<this.containerX||s.x>this.containerX+this.containerWidth)&&(s.vx*=-.8,s.x=Math.max(this.containerX,Math.min(this.containerX+this.containerWidth,s.x)),this.collisionCount++),(s.y<this.pistonY||s.y>this.pistonY+this.volume)&&(s.vy*=-.8,s.y=Math.max(this.pistonY,Math.min(this.pistonY+this.volume,s.y)),this.collisionCount++),this.showParticleCollisions)for(let n=a+1;n<this.particles.length;n++){const o=this.particles[n],h=s.x-o.x,r=s.y-o.y,l=Math.sqrt(h*h+r*r);if(l<6){const c=s.vx,g=s.vy;s.vx=o.vx,s.vy=o.vy,o.vx=c,o.vy=g,this.collisionCount++;const x=6-l,u=x*h/l/2,f=x*r/l/2;s.x+=u,s.y+=f,o.x-=u,o.y-=f}}}),this.showTrails&&this.particles.forEach(s=>{if(s.trail.length>1){this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255,255,255,0.35)",this.ctx.lineWidth=1,this.ctx.moveTo(s.trail[0].x,s.trail[0].y);for(let a=1;a<s.trail.length;a++)this.ctx.lineTo(s.trail[a].x,s.trail[a].y);this.ctx.stroke()}}),this.showVelocityDistribution&&(this.velocityData.push(...this.particles.map(s=>Math.sqrt(s.vx*s.vx+s.vy*s.vy))),this.velocityData.length>1e3&&(this.velocityData=this.velocityData.slice(-500)));const e=this.calculatePressure();this.pressureHistory.push(e),this.volumeHistory.push(this.volume),this.temperatureHistory.push(this.temperature),this.pressureHistory.length>100&&(this.pressureHistory.shift(),this.volumeHistory.shift(),this.temperatureHistory.shift())}calculatePressure(){const t=this.particles.length/(this.containerWidth*this.volume),i=this.particles.reduce((a,n)=>a+Math.sqrt(n.vx*n.vx+n.vy*n.vy),0)/this.particles.length,e=t*i*i*.01;this.applyGasLaw();const s=e-this.pressure;return this.pistonY+=s*.1,this.pistonY=Math.max(100,Math.min(350,this.pistonY)),this.volume=400-this.pistonY,e}applyGasLaw(){switch(this.lawType){case"boyle":const t=this.initialConditions.pressure*this.initialConditions.volume;this.volume!==this.initialConditions.volume&&(this.pressure=t/this.volume);break;case"charles":const i=this.initialConditions.volume/this.initialConditions.temperature;this.temperature!==this.initialConditions.temperature&&(this.volume=i*this.temperature,this.pistonY=400-this.volume);break;case"gay-lussac":const e=this.initialConditions.pressure/this.initialConditions.temperature;this.temperature!==this.initialConditions.temperature&&(this.pressure=e*this.temperature);break;case"combined":const s=this.initialConditions.pressure*this.initialConditions.volume/this.initialConditions.temperature;(this.volume!==this.initialConditions.volume||this.temperature!==this.initialConditions.temperature)&&(this.pressure=s*this.temperature/this.volume);break}}render(){this.showPressureHeatmap&&this.drawPressureHeatmap(),this.showVelocityDistribution&&this.drawVelocityDistribution(),this.showGasLawGraph&&this.drawGasLawGraph(),this.drawEnhancedContainer(),this.particles.forEach(t=>{this.ctx.beginPath(),this.ctx.fillStyle=this.getTemperatureColor(t),this.ctx.arc(t.x,t.y,3,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=1,this.ctx.stroke()}),this.showPressureGauge&&this.drawPressureGauge(),this.drawLawDescription(),this.drawGasLabels()}drawEnhancedContainer(){const t=this.ctx.createLinearGradient(this.containerX,this.pistonY,this.containerX+this.containerWidth,this.pistonY+this.volume);t.addColorStop(0,"rgba(200, 220, 255, 0.1)"),t.addColorStop(1,"rgba(150, 180, 255, 0.2)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.containerX,this.pistonY,this.containerWidth,this.volume),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=4,this.ctx.strokeRect(this.containerX,this.pistonY,this.containerWidth,this.volume),this.ctx.fillStyle="#34495E",this.ctx.fillRect(this.containerX-8,this.pistonY-15,this.containerWidth+16,30),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=3,this.ctx.strokeRect(this.containerX-8,this.pistonY-15,this.containerWidth+16,30),this.ctx.fillStyle="#E74C3C",this.ctx.fillRect(this.containerX+this.containerWidth/2-15,this.pistonY-25,30,10),this.ctx.fillStyle="#2C3E50",this.ctx.font="bold 18px Inter",this.ctx.textAlign="center",this.ctx.fillText("GAS",this.containerX+this.containerWidth/2,this.pistonY+this.volume/2),this.ctx.font="14px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText(`Volume: ${this.volume}`,this.containerX+this.containerWidth/2,this.pistonY+this.volume+25)}drawLawDescription(){const t=this.ctx.canvas.width;this.ctx.canvas.height;const i=t-220,e=20,s=200,a=220;this.ctx.fillStyle="rgba(255, 255, 255, 0.95)",this.ctx.fillRect(i,e,s,a),this.ctx.strokeStyle="#2C3E50",this.ctx.lineWidth=2,this.ctx.strokeRect(i,e,s,a),this.ctx.fillStyle="#2C3E50",this.ctx.font="bold 18px Inter",this.ctx.textAlign="left";let n=e+30;const o={boyle:"Boyle's Law",charles:"Charles's Law","gay-lussac":"Gay-Lussac's Law",combined:"Combined Gas Law"};switch(this.ctx.fillText(o[this.lawType],i+10,n),n+=30,this.ctx.font="bold 18px Inter",this.ctx.fillStyle="#E74C3C",this.lawType){case"boyle":this.ctx.fillText("P₁V₁ = P₂V₂",i+10,n),n+=25,this.ctx.font="14px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant temperature",i+10,n),n+=18,this.ctx.fillText("Pressure ∝ 1/Volume",i+10,n);break;case"charles":this.ctx.fillText("V₁/T₁ = V₂/T₂",i+10,n),n+=25,this.ctx.font="14px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant pressure",i+10,n),n+=18,this.ctx.fillText("Volume ∝ Temperature",i+10,n);break;case"gay-lussac":this.ctx.fillText("P₁/T₁ = P₂/T₂",i+10,n),n+=25,this.ctx.font="14px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("At constant volume",i+10,n),n+=18,this.ctx.fillText("Pressure ∝ Temperature",i+10,n);break;case"combined":this.ctx.fillText("P₁V₁/T₁ = P₂V₂/T₂",i+10,n),n+=25,this.ctx.font="14px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText("Combines all three laws",i+10,n),n+=18,this.ctx.fillText("PV/T = constant",i+10,n);break}n+=30,this.ctx.font="bold 14px Inter",this.ctx.fillStyle="#2C3E50",this.ctx.fillText("Current Values:",i+10,n),n+=20,this.ctx.font="13px Inter",this.ctx.fillStyle="#7F8C8D",this.ctx.fillText(`P = ${this.pressure.toFixed(2)} atm`,i+10,n),n+=16,this.ctx.fillText(`V = ${this.volume.toFixed(0)} units`,i+10,n),n+=16,this.ctx.fillText(`T = ${this.temperature} K`,i+10,n)}getTemperatureColor(t){const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.temperature*.2,s=Math.min(i/e,1);if(s<.5){const a=s*2;return`rgb(0, ${Math.floor(255*a)}, ${Math.floor(255*(1-a))})`}else{const a=(s-.5)*2;return`rgb(${Math.floor(255*a)}, ${Math.floor(255*(1-a))}, 0)`}}drawPressureGauge(){this.ctx.beginPath(),this.ctx.fillStyle="#f0f0f0",this.ctx.arc(50,150,30,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#333",this.ctx.lineWidth=2,this.ctx.stroke(),this.particles.length/(this.containerWidth*this.volume),this.particles.reduce((n,o)=>n+Math.sqrt(o.vx*o.vx+o.vy*o.vy),0)/this.particles.length;const s=Math.min(this.pressure/2,1),a=-Math.PI/2+s*Math.PI;this.ctx.beginPath(),this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.moveTo(50,150),this.ctx.lineTo(50+Math.cos(a)*25,150+Math.sin(a)*25),this.ctx.stroke(),this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Pressure",50,195),this.ctx.fillText(s.toFixed(2),50,210)}drawPressureHeatmap(){const i=Math.ceil(this.containerWidth/15),e=Math.ceil(this.volume/15);for(let s=0;s<e;s++)for(let a=0;a<i;a++){const n=this.containerX+a*15+7.5,o=this.pistonY+s*15+15/2;let h=0,r=0;if(this.particles.forEach(l=>{const c=l.x-n,g=l.y-o;if(Math.sqrt(c*c+g*g)<15){const u=Math.sqrt(l.vx*l.vx+l.vy*l.vy);h+=u*u,r++}}),r>0){h/=r;const l=Math.min(h/100,.4);this.ctx.fillStyle=`rgba(255, 100, 100, ${l})`,this.ctx.fillRect(this.containerX+a*15,this.pistonY+s*15,15,15)}}}drawVelocityDistribution(){const e=this.ctx.canvas.width-200-20,s=120;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,100),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,100),this.velocityData.length>0){const n=new Array(20).fill(0),o=Math.max(...this.velocityData);this.velocityData.forEach(l=>{const c=Math.floor(l/o*19);c>=0&&c<20&&n[c]++});const h=Math.max(...n),r=200/20;this.ctx.fillStyle="#4ECDC4";for(let l=0;l<20;l++){const c=n[l]/h*80;this.ctx.fillRect(e+l*r+2,s+100-10-c,r-4,c)}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Velocity Distribution",e+200/2,s-5)}drawGasLawGraph(){const s=this.ctx.canvas.height-150-20;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,s,300,150),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,s,300,150),this.pressureHistory.length>1){const o=Math.max(...this.pressureHistory),h=Math.min(...this.pressureHistory),r=Math.max(...this.volumeHistory),l=Math.min(...this.volumeHistory),c=Math.max(...this.temperatureHistory),g=Math.min(...this.temperatureHistory);this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=2,this.ctx.beginPath();for(let x=0;x<this.pressureHistory.length;x++){let u,f;switch(this.lawType){case"boyle":u=20+(this.volumeHistory[x]-l)/(r-l)*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150;break;case"charles":u=20+(this.temperatureHistory[x]-g)/(c-g)*300,f=s+150-(this.volumeHistory[x]-l)/(r-l)*150;break;case"gay-lussac":u=20+(this.temperatureHistory[x]-g)/(c-g)*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150;break;default:u=20+x/this.pressureHistory.length*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150}u=Math.max(20,Math.min(320,u)),f=Math.max(s,Math.min(s+150,f)),x===0?this.ctx.moveTo(u,f):this.ctx.lineTo(u,f)}this.ctx.stroke(),this.ctx.fillStyle="#FF6B6B";for(let x=0;x<this.pressureHistory.length;x+=5){let u,f;switch(this.lawType){case"boyle":u=20+(this.volumeHistory[x]-l)/(r-l)*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150;break;case"charles":u=20+(this.temperatureHistory[x]-g)/(c-g)*300,f=s+150-(this.volumeHistory[x]-l)/(r-l)*150;break;case"gay-lussac":u=20+(this.temperatureHistory[x]-g)/(c-g)*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150;break;default:u=20+x/this.pressureHistory.length*300,f=s+150-(this.pressureHistory[x]-h)/(o-h)*150}u=Math.max(20,Math.min(320,u)),f=Math.max(s,Math.min(s+150,f)),this.ctx.beginPath(),this.ctx.arc(u,f,2,0,Math.PI*2),this.ctx.fill()}}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center";let a,n;switch(this.lawType){case"boyle":a="Volume",n="Pressure";break;case"charles":a="Temperature (K)",n="Volume";break;case"gay-lussac":a="Temperature (K)",n="Pressure";break;default:a="Time",n="Pressure"}this.ctx.fillText(`${n} vs ${a}`,20+300/2,s-5)}getStats(){const t=this.particles.length/(this.containerWidth*this.volume),i=this.particles.reduce((s,a)=>s+Math.sqrt(a.vx*a.vx+a.vy*a.vy),0)/this.particles.length,e=t*i*i*.01;return{particleCount:this.particles.length,temperature:this.temperature,pressure:e,volume:Math.round(this.volume),collisionCount:this.collisionCount,lawType:this.lawType}}drawGasLabels(){this.drawLabels("Gas Laws","")}}class xt extends L{constructor(t){super(t),this.animationType="pendulum",this.length=120,this.angle=Math.PI/4,this.angularVelocity=0,this.gravity=1,this.damping=.01,this.speed=1,this.mass=1,this.showPath=!1,this.showVelocityVectors=!1,this.showForceVectors=!1,this.showEnergyInfo=!1,this.showPhaseSpace=!1,this.path=[],this.phaseSpaceData=[],this.energyHistory=[],this.initialAngle=Math.PI/4,this.maxAmplitude=Math.PI/4,this.periods=[],this.lastZeroCrossing=0,this.crossingCount=0,this.lastAngle=this.angle}setLength(t){this.length=t}setSpeed(t){this.speed=t}setInitialAngle(t){this.initialAngle=t*Math.PI/180,this.angle=this.initialAngle}setGravity(t){this.gravity=t}setDamping(t){this.damping=t}setShowPath(t){this.showPath=t,t||(this.path=[])}setMass(t){this.mass=t}setShowVelocityVectors(t){this.showVelocityVectors=t}setShowForceVectors(t){this.showForceVectors=t}setShowEnergyInfo(t){this.showEnergyInfo=t}setShowPhaseSpace(t){this.showPhaseSpace=t,t||(this.phaseSpaceData=[])}reset(){this.angle=this.initialAngle,this.angularVelocity=0,this.time=0,this.path=[],this.phaseSpaceData=[],this.energyHistory=[],this.maxAmplitude=Math.abs(this.initialAngle),this.periods=[],this.lastZeroCrossing=0,this.crossingCount=0,this.lastAngle=this.angle}update(t){this.time+=t;const s=t/1e3*this.speed*10,a=this.gravity*9.8,n=this.length,o=-(a/n)*Math.sin(this.angle)-this.damping*this.angularVelocity;if(this.angularVelocity+=o*s,this.angle+=this.angularVelocity*s,this.maxAmplitude=Math.max(this.maxAmplitude,Math.abs(this.angle)),this.lastAngle<=0&&this.angle>0&&this.angularVelocity>0){if(this.crossingCount>0){const h=this.time-this.lastZeroCrossing;this.periods.push(h),this.periods.length>10&&this.periods.shift()}this.lastZeroCrossing=this.time,this.crossingCount++}if(this.showPath){const h=this.ctx.canvas.width/2+this.length*Math.sin(this.angle),r=this.ctx.canvas.height/2+this.length*Math.cos(this.angle);this.path.push({x:h,y:r}),this.path.length>100&&this.path.shift()}if(this.showPhaseSpace&&(this.phaseSpaceData.push({angle:this.angle,velocity:this.angularVelocity}),this.phaseSpaceData.length>200&&this.phaseSpaceData.shift()),this.showEnergyInfo){const h=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,r=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle));this.energyHistory.push({kinetic:h,potential:r,total:h+r}),this.energyHistory.length>100&&this.energyHistory.shift()}this.lastAngle=this.angle}render(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height*.3,e=t+this.length*Math.sin(this.angle),s=i+this.length*Math.cos(this.angle),a=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,n=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),o=a+n,h=a/o;if(this.showPhaseSpace&&this.drawPhaseSpacePlot(),this.showEnergyInfo&&this.drawEnergyBar(),this.showPath&&this.path.length>1){this.ctx.beginPath(),this.ctx.strokeStyle=`hsl(${200+h*60}, 70%, 50%, 0.6)`,this.ctx.lineWidth=3,this.ctx.moveTo(this.path[0].x,this.path[0].y);for(let l=1;l<this.path.length;l++)this.ctx.lineTo(this.path[l].x,this.path[l].y);this.ctx.stroke()}this.ctx.beginPath(),this.ctx.fillStyle="#2c3e50",this.ctx.arc(t,i,8,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#34495e",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(t+2,i+2,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=3,this.ctx.moveTo(t+1,i+1),this.ctx.lineTo(e+1,s+1),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#34495e",this.ctx.lineWidth=2,this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke(),this.showForceVectors&&this.drawForceVectors(t,i,e,s),this.showVelocityVectors&&this.drawVelocityVector(e,s);const r=`hsl(${200+h*60}, 70%, 50%)`;this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(e+2,s+2,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=r,this.ctx.arc(e,s,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(e-5,s-5,6,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2,this.ctx.stroke(),this.showEnergyInfo&&this.drawPendulumInfo(),this.drawPendulumLabels()}drawForceVectors(t,i,e,s){this.mass*this.gravity*9.8;const a=50;this.ctx.beginPath(),this.ctx.strokeStyle="#e74c3c",this.ctx.lineWidth=3,this.ctx.moveTo(e,s),this.ctx.lineTo(e,s+a),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,s+a),this.ctx.lineTo(e-6,s+a-10),this.ctx.lineTo(e+6,s+a-10),this.ctx.closePath(),this.ctx.fillStyle="#e74c3c",this.ctx.fill(),this.ctx.fillStyle="#e74c3c",this.ctx.font="bold 14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Fg",e+15,s+a/2);const n=40,o=e-t,h=s-i,r=Math.sqrt(o*o+h*h);if(r>0){const l=o/r,c=h/r;this.ctx.beginPath(),this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=3,this.ctx.moveTo(e,s),this.ctx.lineTo(e-l*n,s-c*n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-l*n,s-c*n),this.ctx.lineTo(e-l*n+c*6,s-c*n-l*6),this.ctx.lineTo(e-l*n-c*6,s-c*n+l*6),this.ctx.closePath(),this.ctx.fillStyle="#3498db",this.ctx.fill(),this.ctx.fillStyle="#3498db",this.ctx.font="bold 14px Inter",this.ctx.textAlign="center",this.ctx.fillText("T",e-l*n/2+15,s-c*n/2-10)}if(this.damping>.001&&Math.abs(this.angularVelocity)>.1){const l=this.length*this.angularVelocity*Math.cos(this.angle),c=-this.length*this.angularVelocity*Math.sin(this.angle),g=Math.sqrt(l*l+c*c);if(g>0){const x=this.damping*g*g,u=Math.min(x*2,30),f=l/g,p=c/g;this.ctx.beginPath(),this.ctx.strokeStyle="#e67e22",this.ctx.lineWidth=2,this.ctx.moveTo(e,s),this.ctx.lineTo(e-f*u,s-p*u),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-f*u,s-p*u),this.ctx.lineTo(e-f*u+p*4,s-p*u-f*4),this.ctx.lineTo(e-f*u-p*4,s-p*u+f*4),this.ctx.closePath(),this.ctx.fillStyle="#e67e22",this.ctx.fill(),this.ctx.fillStyle="#e67e22",this.ctx.font="bold 12px Inter",this.ctx.textAlign="center",this.ctx.fillText("Fd",e-f*u/2-10,s-p*u/2-5)}}}drawVelocityVector(t,i){const e=this.length*this.angularVelocity*Math.cos(this.angle),s=-this.length*this.angularVelocity*Math.sin(this.angle),a=Math.sqrt(e*e+s*s);if(a>.1){const n=20/a,o=e*n,h=s*n;this.ctx.beginPath(),this.ctx.strokeStyle="#f39c12",this.ctx.lineWidth=3,this.ctx.moveTo(t,i),this.ctx.lineTo(t+o,i+h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+o,i+h),this.ctx.lineTo(t+o-h*.3,i+h+o*.3),this.ctx.lineTo(t+o+h*.3,i+h-o*.3),this.ctx.closePath(),this.ctx.fillStyle="#f39c12",this.ctx.fill()}}drawEnergyBar(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(20,20,200,20),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(20,20,200,20);const a=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,n=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),o=a+n;if(o>0){const h=a/o,r=n/o;this.ctx.fillStyle="#f39c12",this.ctx.fillRect(20,20,200*h,20),this.ctx.fillStyle="#3498db",this.ctx.fillRect(20+200*h,20,200*r,20)}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Energy",20+200/2,15),this.ctx.fillText("K",30,35),this.ctx.fillText("P",210,35)}drawPhaseSpacePlot(){const e=this.ctx.canvas.width-200-20,s=20;if(this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillRect(e,s,200,150),this.ctx.strokeStyle="#333",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,150),this.phaseSpaceData.length>1){const a=this.phaseSpaceData.map(c=>c.angle),n=this.phaseSpaceData.map(c=>c.velocity),o=Math.min(...a),h=Math.max(...a),r=Math.min(...n),l=Math.max(...n);this.ctx.beginPath(),this.ctx.strokeStyle="#9b59b6",this.ctx.lineWidth=2;for(let c=0;c<this.phaseSpaceData.length;c++){const g=e+(this.phaseSpaceData[c].angle-o)/(h-o)*200,x=s+150-(this.phaseSpaceData[c].velocity-r)/(l-r)*150;c===0?this.ctx.moveTo(g,x):this.ctx.lineTo(g,x)}this.ctx.stroke()}this.ctx.fillStyle="#333",this.ctx.font="14px Inter",this.ctx.textAlign="center",this.ctx.fillText("Phase Space",e+200/2,s-5),this.ctx.fillText("θ",e+200/2,s+150+15),this.ctx.fillText("ω",e-10,s+150/2)}drawPendulumInfo(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.font="14px Inter",this.ctx.textAlign="left";let e=60;this.ctx.fillText(`Angle: ${(this.angle*180/Math.PI).toFixed(1)}°`,20,e),e+=20,this.ctx.fillText(`Angular Velocity: ${this.angularVelocity.toFixed(2)} rad/s`,20,e),e+=20;const s=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,a=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle));if(this.ctx.fillText(`Kinetic Energy: ${s.toFixed(1)} J`,20,e),e+=20,this.ctx.fillText(`Potential Energy: ${a.toFixed(1)} J`,20,e),e+=20,this.ctx.fillText(`Total Energy: ${(s+a).toFixed(1)} J`,20,e),e+=20,this.periods.length>0){const r=this.periods.reduce((l,c)=>l+c,0)/this.periods.length;this.ctx.fillText(`Measured Period: ${r.toFixed(2)} s`,20,e),e+=20}const n=2*Math.PI*Math.sqrt(this.length/(this.gravity*9.8));this.ctx.fillText(`Theoretical Period: ${n.toFixed(2)} s`,20,e),e+=20,this.ctx.fillText(`Max Amplitude: ${(this.maxAmplitude*180/Math.PI).toFixed(1)}°`,20,e),e+=20;const o=Math.abs(this.angularVelocity),h=this.damping*o*o;this.ctx.fillText(`Air Resistance: ${h.toFixed(3)} N`,20,e),e+=20,this.ctx.fillText(`Damping Coefficient: ${this.damping.toFixed(3)}`,20,e),this.ctx.shadowBlur=0}getStats(){const t=2*Math.PI*Math.sqrt(this.length/(this.gravity*9.8)),i=.5*this.mass*this.length*this.length*this.angularVelocity*this.angularVelocity,e=this.mass*this.gravity*9.8*this.length*(1-Math.cos(this.angle)),s=Math.abs(this.angularVelocity),a=this.damping*s*s;return{angle:this.angle*180/Math.PI,angularVelocity:this.angularVelocity,theoreticalPeriod:t,measuredPeriod:this.periods.length>0?this.periods.reduce((n,o)=>n+o,0)/this.periods.length:0,kineticEnergy:i,potentialEnergy:e,totalEnergy:i+e,maxAmplitude:this.maxAmplitude*180/Math.PI,airResistanceForce:a,dampingCoefficient:this.damping,time:this.time}}drawPendulumLabels(){this.drawLabels("Simple Pendulum","T = 2π√(L/g)  |  θ̈ + (g/L)sin(θ) = 0  |  E = ½mL²θ̇² + mgL(1-cos(θ))")}}class gt extends L{constructor(t){super(t),this.animationType="orbital-motion",this.centerX=400,this.centerY=300,this.semiMajorAxis=200,this.eccentricity=.2,this.centralMass=1e3,this.speed=1,this.angle=0,this.showOrbitPath=!0,this.showVelocityVector=!1,this.showKeplerInfo=!1,this.calculateOrbitalParameters()}calculateOrbitalParameters(){this.semiMinorAxis=this.semiMajorAxis*Math.sqrt(1-this.eccentricity*this.eccentricity),this.focalDistance=this.semiMajorAxis*this.eccentricity,this.period=2*Math.PI*Math.sqrt(Math.pow(this.semiMajorAxis,3)/this.centralMass),this.angularVelocity=2*Math.PI/this.period,this.orbitPath=[];for(let t=0;t<=360;t+=2){const i=t*Math.PI/180,e=this.semiMajorAxis*(1-this.eccentricity*this.eccentricity)/(1+this.eccentricity*Math.cos(i)),s=this.centerX+e*Math.cos(i),a=this.centerY+e*Math.sin(i);this.orbitPath.push({x:s,y:a})}}setSpeed(t){this.speed=t}setEccentricity(t){this.eccentricity=t,this.calculateOrbitalParameters()}setSemiMajorAxis(t){this.semiMajorAxis=t,this.calculateOrbitalParameters()}setCentralMass(t){this.centralMass=t,this.calculateOrbitalParameters()}setShowOrbitPath(t){this.showOrbitPath=t}setShowVelocityVector(t){this.showVelocityVector=t}setShowKeplerInfo(t){this.showKeplerInfo=t}reset(){this.time=0,this.angle=0}update(t){this.time+=t;const i=t/1e3*this.speed*2;this.angle+=this.angularVelocity*i*100,this.angle>2*Math.PI&&(this.angle-=2*Math.PI);const e=this.semiMajorAxis*(1-this.eccentricity*this.eccentricity)/(1+this.eccentricity*Math.cos(this.angle));this.currentX=this.centerX+e*Math.cos(this.angle),this.currentY=this.centerY+e*Math.sin(this.angle);const s=this.angularVelocity*e;this.velocityX=-s*Math.sin(this.angle),this.velocityY=s*Math.cos(this.angle);const a=.5*s*s,n=-this.centralMass/e;this.totalEnergy=a+n,(e<this.perigee||this.perigee===void 0)&&(this.perigee=e),(e>this.apogee||this.apogee===void 0)&&(this.apogee=e)}render(){if(this.ctx.beginPath(),this.ctx.fillStyle="#FFD700",this.ctx.arc(this.centerX,this.centerY,15,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 215, 0, 0.3)",this.ctx.arc(this.centerX,this.centerY,25,0,Math.PI*2),this.ctx.fill(),this.showOrbitPath&&this.orbitPath.length>1){this.ctx.beginPath(),this.ctx.strokeStyle="rgba(100, 100, 100, 0.5)",this.ctx.lineWidth=1,this.ctx.moveTo(this.orbitPath[0].x,this.orbitPath[0].y);for(let t=1;t<this.orbitPath.length;t++)this.ctx.lineTo(this.orbitPath[t].x,this.orbitPath[t].y);this.ctx.stroke()}if(this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.arc(this.currentX,this.currentY,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(this.currentX+2,this.currentY+2,8,0,Math.PI*2),this.ctx.fill(),this.showVelocityVector){const i=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY),e=this.velocityX/i,s=this.velocityY/i;this.ctx.beginPath(),this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.moveTo(this.currentX,this.currentY),this.ctx.lineTo(this.currentX+e*40,this.currentY+s*40),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#FF6B6B";const a=Math.atan2(this.velocityY,this.velocityX),n=10;this.ctx.moveTo(this.currentX+e*40,this.currentY+s*40),this.ctx.lineTo(this.currentX+e*40-n*Math.cos(a-Math.PI/6),this.currentY+s*40-n*Math.sin(a-Math.PI/6)),this.ctx.lineTo(this.currentX+e*40-n*Math.cos(a+Math.PI/6),this.currentY+s*40-n*Math.sin(a+Math.PI/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#FF6B6B",this.ctx.font="bold 14px Inter",this.ctx.fillText(`v = ${i.toFixed(1)}`,this.currentX+e*55,this.currentY+s*55)}if(this.showKeplerInfo&&this.perigee&&this.apogee){const i=this.centerX+this.perigee*Math.cos(0),e=this.centerY+this.perigee*Math.sin(0);this.ctx.beginPath(),this.ctx.strokeStyle="#2ECC71",this.ctx.lineWidth=2,this.ctx.arc(i,e,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#2ECC71",this.ctx.font="bold 12px Inter",this.ctx.fillText("P",i-3,e+3);const s=Math.PI,a=this.centerX+this.apogee*Math.cos(s),n=this.centerY+this.apogee*Math.sin(s);this.ctx.beginPath(),this.ctx.strokeStyle="#E74C3C",this.ctx.lineWidth=2,this.ctx.arc(a,n,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 12px Inter",this.ctx.fillText("A",a-3,n+3)}if(this.showKeplerInfo){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.font="14px Inter",this.ctx.textAlign="left";const t=this.ctx.canvas.width-250,i=30;this.ctx.fillText(`Kepler's 1st Law: Elliptical orbit (e = ${this.eccentricity.toFixed(2)})`,t,i),this.ctx.fillText("Kepler's 2nd Law: Equal areas in equal times",t,i+20),this.ctx.fillText(`Kepler's 3rd Law: T^2 ∝ a^3 (T = ${this.period.toFixed(1)}s)`,t,i+40),this.perigee&&this.apogee&&(this.ctx.fillText(`Perigee: ${this.perigee.toFixed(0)}px`,t,i+60),this.ctx.fillText(`Apogee: ${this.apogee.toFixed(0)}px`,t,i+80),this.ctx.fillText(`Semi-major axis: ${this.semiMajorAxis}px`,t,i+100));const e=Math.sqrt(Math.pow(this.currentX-this.centerX,2)+Math.pow(this.currentY-this.centerY,2)),s=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);this.ctx.fillText(`Current distance: ${e.toFixed(0)}px`,t,i+120),this.ctx.fillText(`Current speed: ${s.toFixed(1)}`,t,i+140),this.totalEnergy!==void 0&&this.ctx.fillText(`Total energy: ${this.totalEnergy.toFixed(1)}`,t,i+160)}this.drawOrbitalLabels()}getStats(){const t=Math.sqrt(Math.pow(this.currentX-this.centerX,2)+Math.pow(this.currentY-this.centerY,2)),i=Math.sqrt(this.velocityX*this.velocityX+this.velocityY*this.velocityY);return{period:this.period,speed:i,distance:t,eccentricity:this.eccentricity,perigee:this.perigee,apogee:this.apogee,semiMajorAxis:this.semiMajorAxis,totalEnergy:this.totalEnergy,time:this.time}}drawOrbitalLabels(){this.drawLabels("Orbital Motion","r = a(1-e²)/(1+ecos(θ))  |  T² ∝ a³  |  E = ½mv² - GMm/r")}}class ut extends L{constructor(t){super(t),this.balls=[],this.ballCount=5,this.restitution=.8,this.gravity=.5,this.speed=1,this.showAnalytics=!0,this.collisionType="elastic",this.collisionCount=0,this.collisionEffects=[],this.initializeBalls()}setSpeed(t){this.speed=t}setBallCount(t){this.ballCount=t,this.initializeBalls()}setRestitution(t){this.restitution=t}setGravity(t){this.gravity=t}setShowAnalytics(t){this.showAnalytics=t}setCollisionType(t){this.collisionType=t,this.initializeBalls()}initializeBalls(){if(this.balls=[],this.collisionType==="head-on"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height;this.balls=[{x:t*.25,y:i*.5,vx:80,vy:0,radius:20,mass:2},{x:t*.75,y:i*.5,vx:-80,vy:0,radius:20,mass:2}]}else if(this.collisionType==="elastic"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.2,y:i*.25},{x:t*.8,y:i*.25},{x:t*.2,y:i*.5},{x:t*.8,y:i*.5},{x:t*.5,y:i*.375},{x:t*.375,y:i*.2},{x:t*.625,y:i*.55},{x:t*.25,y:i*.55},{x:t*.75,y:i*.2}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const a=e[s];this.balls.push({x:a.x,y:a.y,vx:(Math.random()-.5)*120,vy:(Math.random()-.5)*120,radius:15+Math.random()*10,mass:1+Math.random()*2})}}else if(this.collisionType==="inelastic"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.25,y:i*.25},{x:t*.75,y:i*.25},{x:t*.25,y:i*.5},{x:t*.75,y:i*.5},{x:t*.5,y:i*.375}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const a=e[s];this.balls.push({x:a.x,y:a.y,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,radius:18+Math.random()*8,mass:1.5+Math.random()*1.5})}}else if(this.collisionType==="mixed"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=[{x:t*.2,y:i*.2},{x:t*.8,y:i*.2},{x:t*.2,y:i*.55},{x:t*.8,y:i*.55},{x:t*.5,y:i*.375},{x:t*.375,y:i*.3},{x:t*.625,y:i*.45}];for(let s=0;s<Math.min(this.ballCount,e.length);s++){const a=e[s];this.balls.push({x:a.x,y:a.y,vx:(Math.random()-.5)*110,vy:(Math.random()-.5)*110,radius:12+Math.random()*12,mass:.8+Math.random()*2.4})}}else if(this.collisionType==="cascade"){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=t*.075,s=t*.125,a=i*.375;for(let n=0;n<Math.min(this.ballCount,8);n++)this.balls.push({x:s+n*e,y:a,vx:n===0?100:0,vy:0,radius:15,mass:1.5})}this.collisionCount=0,this.lastCollision=null}reset(){this.collisionCount=0,this.collisionEffects=[],this.initializeBalls()}update(t){const i=t/1e3*this.speed*5;this.collisionEffects=this.collisionEffects.filter(e=>(e.time+=i,e.time<e.maxTime)),this.balls.forEach(e=>{e.x+=e.vx*i,e.y+=e.vy*i,e.vy+=this.gravity*9.8*i,e.vx*=1-.02*i,e.vy*=1-.02*i,(e.x-e.radius<0||e.x+e.radius>this.ctx.canvas.width)&&(e.vx*=-this.restitution,e.x=Math.max(e.radius,Math.min(this.ctx.canvas.width-e.radius,e.x)),this.collisionEffects.push({x:e.x,y:e.y,time:0,maxTime:.3,type:"wall"})),(e.y-e.radius<0||e.y+e.radius>this.ctx.canvas.height)&&(e.vy*=-this.restitution,e.y=Math.max(e.radius,Math.min(this.ctx.canvas.height-e.radius,e.y)),this.collisionEffects.push({x:e.x,y:e.y,time:0,maxTime:.3,type:"wall"}))});for(let e=0;e<this.balls.length;e++)for(let s=e+1;s<this.balls.length;s++)this.checkCollision(this.balls[e],this.balls[s])}checkCollision(t,i){const e=i.x-t.x,s=i.y-t.y,a=Math.sqrt(e*e+s*s);if(a<t.radius+i.radius){this.collisionCount++,this.collisionEffects.push({x:(t.x+i.x)/2,y:(t.y+i.y)/2,time:0,maxTime:.5,type:"ball"});const n=e/a,o=s/a,h=i.vx-t.vx,r=i.vy-t.vy,l=h*n+r*o;if(l>0)return;let c=this.restitution;this.collisionType==="inelastic"?c=.3:this.collisionType==="mixed"&&(c=.5+Math.random()*.3);const g=-(1+c)*l/(1/t.mass+1/i.mass);t.vx-=g*n/t.mass,t.vy-=g*o/t.mass,i.vx+=g*n/i.mass,i.vy+=g*o/i.mass;const x=t.radius+i.radius-a,u=n*x*.5,f=o*x*.5;t.x-=u,t.y-=f,i.x+=u,i.y+=f;const p=.5*t.mass*(t.vx*t.vx+t.vy*t.vy)+.5*i.mass*(i.vx*i.vx+i.vy*i.vy);this.lastCollision={ball1:{mass:t.mass,velocity:Math.sqrt(t.vx*t.vx+t.vy*t.vy)},ball2:{mass:i.mass,velocity:Math.sqrt(i.vx*i.vx+i.vy*i.vy)},energy:p,restitution:c}}}render(){this.collisionEffects.forEach(t=>{const i=1-t.time/t.maxTime,e=30*(1-t.time/t.maxTime);if(t.type==="ball"){for(let s=0;s<2;s++){const a=e*(.4+s*.4),n=i*(1-s*.4)*.6;this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(255, 107, 107, ${n})`,this.ctx.lineWidth=2-s,this.ctx.arc(t.x,t.y,a,0,Math.PI*2),this.ctx.stroke()}for(let s=0;s<4;s++){const a=s*Math.PI*2/4,n=t.x+Math.cos(a)*e*.6,o=t.y+Math.sin(a)*e*.6;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${i*.4})`,this.ctx.arc(n,o,1,0,Math.PI*2),this.ctx.fill()}}else t.type==="wall"&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(100, 150, 255, ${i*.5})`,this.ctx.lineWidth=2,this.ctx.arc(t.x,t.y,e*.6,0,Math.PI*2),this.ctx.stroke())}),this.balls.forEach((t,i)=>{const e=Math.sqrt(t.vx*t.vx+t.vy*t.vy),s=Math.min(e/100,1),a=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F"],n=a[i%a.length];this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(t.x+3,t.y+3,t.radius,0,Math.PI*2),this.ctx.fill();const o=this.ctx.createRadialGradient(t.x-t.radius*.3,t.y-t.radius*.3,0,t.x,t.y,t.radius);if(o.addColorStop(0,n),o.addColorStop(.7,n),o.addColorStop(1,"#1a1a2e"),this.ctx.beginPath(),this.ctx.fillStyle=o,this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+s*.4})`,this.ctx.arc(t.x-t.radius*.3,t.y-t.radius*.3,t.radius*.5,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle=s>.5?"#FFD700":"#333",this.ctx.lineWidth=2,this.ctx.stroke(),this.showAnalytics){const h=Math.sqrt(t.vx*t.vx+t.vy*t.vy);if(h>1){const l=t.vx/h,c=t.vy/h;this.ctx.beginPath(),this.ctx.strokeStyle="rgba(78, 205, 196, 0.3)",this.ctx.lineWidth=6,this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x+l*50,t.y+c*50),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=3,this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x+l*50,t.y+c*50),this.ctx.stroke();const g=Math.atan2(t.vy,t.vx),x=12;this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.moveTo(t.x+l*50,t.y+c*50),this.ctx.lineTo(t.x+l*50-x*Math.cos(g-Math.PI/6),t.y+c*50-x*Math.sin(g-Math.PI/6)),this.ctx.lineTo(t.x+l*50-x*Math.cos(g+Math.PI/6),t.y+c*50-x*Math.sin(g+Math.PI/6)),this.ctx.closePath(),this.ctx.fill();const u=t.x+l*70,f=t.y+c*70;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(u-25,f-8,50,16),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 13px Inter",this.ctx.textAlign="center",this.ctx.fillText(`v = ${h.toFixed(1)}`,u,f+3)}}}),this.showAnalytics&&this.drawCollisionInfo(),this.showAnalytics&&this.drawGravityForceArrows(),this.drawCollisionLabels()}drawGravityForceArrows(){this.balls.forEach(t=>{const i=t.mass*this.gravity*9.8,e=Math.max(40,Math.min(i*.8,80)),s=t.x,a=t.y+t.radius+5,n=s,o=a+e;this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 107, 107, 0.4)",this.ctx.lineWidth=6,this.ctx.moveTo(s,a),this.ctx.lineTo(n,o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.moveTo(s,a),this.ctx.lineTo(n,o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#FF6B6B",this.ctx.moveTo(n,o),this.ctx.lineTo(n-8,o-12),this.ctx.lineTo(n+8,o-12),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(n-20,o+5,40,16),this.ctx.fillStyle="#FF6B6B",this.ctx.font="bold 12px Inter",this.ctx.textAlign="center",this.ctx.fillText("mg",n,o+15),this.ctx.restore()})}drawCollisionInfo(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=Math.min(t*.15,200),s=Math.min(i*.15,120),a=10,n=10;this.ctx.fillStyle="rgba(26, 26, 46, 0.8)",this.ctx.fillRect(a,n,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(a,n,e,s),this.ctx.font="bold 14px Inter",this.ctx.textAlign="left";let o=n+20;this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`Collisions: ${this.collisionCount}`,a+8,o),o+=18,this.ctx.font="12px Inter",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Balls: ${this.balls.length}`,a+8,o),o+=16,this.ctx.fillText(`Bounce: ${this.restitution}`,a+8,o),o+=16,this.ctx.fillText(`Type: ${this.collisionType}`,a+8,o)}getStats(){let t=0,i=0;return this.balls.forEach(e=>{const s=e.mass*Math.sqrt(e.vx*e.vx+e.vy*e.vy),a=.5*e.mass*(e.vx*e.vx+e.vy*e.vy);t+=s,i+=a}),{ballCount:this.balls.length,totalMomentum:t,totalEnergy:i,collisionCount:this.collisionCount}}drawCollisionLabels(){this.drawLabels("Collision Physics","p = mv  |  Σp = constant  |  KE = ½mv²")}}class ft extends L{constructor(t){super(t),this.object={x:100,y:200,vx:0,vy:0},this.inclineAngle=20,this.frictionCoefficient=.3,this.objectMass=5,this.initialVelocity=0,this.gravity=1,this.speed=1,this.showAnalytics=!0,this.resetObject()}setSpeed(t){this.speed=t}setInclineAngle(t){this.inclineAngle=t}setFrictionCoefficient(t){this.frictionCoefficient=t}setObjectMass(t){this.objectMass=t}setInitialVelocity(t){this.initialVelocity=t}setGravity(t){this.gravity=t}setShowAnalytics(t){this.showAnalytics=t}resetObject(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=t*.125,s=t*.75*.05;this.object.x=e+s;const a=this.inclineAngle*Math.PI/180,n=t*.75,o=i*.5,h=o+n*Math.sin(a),r=i*.95,l=Math.max(0,h-r),c=o-l,g=Math.max(12,Math.min(25,12+this.objectMass*2));this.object.y=c+s*Math.tan(a)-g-18*Math.cos(a),this.object.vx=this.initialVelocity*Math.cos(a),this.object.vy=0}reset(){this.resetObject()}update(t){const i=t/1e3*this.speed*3,e=this.inclineAngle*Math.PI/180,s=this.objectMass*this.gravity*9.8,a=s*Math.cos(e),n=s*Math.sin(e),o=this.frictionCoefficient*a;let h=0;Math.abs(this.object.vx)<1e-4?Math.abs(n)>o?h=n-Math.sign(n)*o:(h=0,this.object.vx=0):h=n-Math.sign(this.object.vx)*o;const r=h/this.objectMass,l=Math.sin(e)*1.5,c=r*(1+l);this.object.vx+=c*i,this.object.x+=this.object.vx*i;const g=this.ctx.canvas.width,x=this.ctx.canvas.height,u=g*.75,f=g*.125,p=x*.5,S=f+u*Math.cos(e),v=p+u*Math.sin(e),k=x*.95,P=Math.max(0,v-k),T=p-P;this.object.x>S&&(this.object.x=S,this.object.vx=0);const b=Math.max(12,Math.min(25,12+this.objectMass*2));this.object.y=T+(this.object.x-f)*Math.tan(e)-b-18*Math.cos(e)}render(){const t=this.inclineAngle*Math.PI/180,i=this.ctx.canvas.width,e=this.ctx.canvas.height,s=i*.75,a=i*.125,n=e*.5,o=a+s*Math.cos(t),h=n+s*Math.sin(t),r=e*.95,l=Math.max(0,h-r),c=n-l,g=h-l,x=Math.max(12,Math.min(25,12+this.objectMass*2));this.ctx.save(),this.ctx.strokeStyle="rgba(80,80,80,0.25)",this.ctx.lineWidth=1;for(let b=0;b<=s;b+=40){const M=a+b*Math.cos(t),R=c+b*Math.sin(t);this.ctx.beginPath(),this.ctx.moveTo(M,R),this.ctx.lineTo(M-8*Math.sin(t),R+8*Math.cos(t)),this.ctx.stroke()}this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(a,c),this.ctx.lineTo(o,g),this.ctx.lineTo(o+20*Math.sin(t),g-20*Math.cos(t)),this.ctx.lineTo(a+20*Math.sin(t),c-20*Math.cos(t)),this.ctx.closePath();const u="#f5f5f5",f="#757575";this.ctx.fillStyle=u,this.ctx.fill();const p=this.ctx.createLinearGradient(a,c,o,g);p.addColorStop(0,"rgba(255,255,255,0.3)"),p.addColorStop(.5,"rgba(255,255,255,0.1)"),p.addColorStop(1,"rgba(0,0,0,0.2)"),this.ctx.fillStyle=p,this.ctx.fill(),this.ctx.strokeStyle=f,this.ctx.lineWidth=1.5;for(let b=0;b<s;b+=20){const M=a+b*Math.cos(t),R=c+b*Math.sin(t);this.ctx.beginPath(),this.ctx.moveTo(M,R),this.ctx.lineTo(M+15*Math.sin(t),R-15*Math.cos(t)),this.ctx.stroke()}this.ctx.restore(),this.ctx.save(),this.ctx.strokeStyle="rgba(78, 205, 196, 0.6)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(o-80,g),this.ctx.lineTo(o+20,g),this.ctx.stroke(),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 20px Inter",this.ctx.textAlign="center";const S=o-35,v=g+25;this.ctx.fillText(`${this.inclineAngle}°`,S,v),this.ctx.fillStyle="rgba(26, 26, 46, 0.8)",this.ctx.fillRect(S-25,v-15,50,20),this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`${this.inclineAngle}°`,S,v),this.ctx.restore(),this.ctx.save(),this.ctx.translate(this.object.x,this.object.y),this.ctx.rotate(t);const k=Math.sin(this.time*.01)*Math.min(Math.abs(this.object.vx)*.1,2);if(this.ctx.translate(0,k),Math.abs(this.object.vx)>.1){const b=this.object.vx*.02;this.ctx.rotate(this.time*b)}this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=8,this.ctx.shadowOffsetX=4,this.ctx.shadowOffsetY=4+Math.abs(this.object.vx)*.5,this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(-x+6,-x+6,x*2,x*2),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0;const P=x*.2;this.ctx.beginPath(),this.ctx.moveTo(-x+P,-x),this.ctx.lineTo(x-P,-x),this.ctx.quadraticCurveTo(x,-x,x,-x+P),this.ctx.lineTo(x,x-P),this.ctx.quadraticCurveTo(x,x,x-P,x),this.ctx.lineTo(-x+P,x),this.ctx.quadraticCurveTo(-x,x,-x,x-P),this.ctx.lineTo(-x,-x+P),this.ctx.quadraticCurveTo(-x,-x,-x+P,-x),this.ctx.closePath();const T=this.ctx.createLinearGradient(-x,-x,x,x);T.addColorStop(0,"#ff6b6b"),T.addColorStop(.3,"#ee5a52"),T.addColorStop(.7,"#d32f2f"),T.addColorStop(1,"#b71c1c"),this.ctx.fillStyle=T,this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.fillRect(-x,-x,x*2,x*.4),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.fillRect(-x,-x,x*2,x*.2),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1;for(let b=-x+4;b<x-4;b+=6)this.ctx.beginPath(),this.ctx.moveTo(b,-x+4),this.ctx.lineTo(b,x-4),this.ctx.stroke();if(this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2.5,this.ctx.stroke(),this.ctx.shadowColor="rgba(255, 255, 255, 0.3)",this.ctx.shadowBlur=4,this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1,this.ctx.stroke(),this.ctx.shadowBlur=0,Math.abs(this.object.vx)>.1){const b=Math.min(Math.abs(this.object.vx)*.5,.8);this.ctx.fillStyle=`rgba(255, 107, 107, ${b*.3})`,this.ctx.fillRect(-x-8,-x,8,x*2)}this.ctx.restore(),this.showAnalytics&&this.drawForceVectors(),this.drawFrictionLabels()}drawForceVectors(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),a=this.frictionCoefficient*e,n=Math.abs(this.object.vx)<1e-4&&Math.abs(s)<=a?0:s-Math.sign(this.object.vx||s)*a;Math.max(12,Math.min(25,12+this.objectMass*2));const o=this.object.x,h=this.object.y,r=(g,x,u,f,p,S)=>{const v=Math.sqrt(u*u+f*f);if(v<1)return;const k=u/v,P=f/v,T=Math.max(50,Math.min(120,v)),b=g+k*T,M=x+P*T;this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(g,x),this.ctx.lineTo(b,M),this.ctx.strokeStyle=p,this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(b,M),this.ctx.lineTo(b-12*k-8*P,M-12*P+8*k),this.ctx.lineTo(b-12*k+8*P,M-12*P-8*k),this.ctx.lineTo(b,M),this.ctx.fillStyle=p,this.ctx.fill(),this.ctx.font="bold 14px Inter",this.ctx.fillStyle=p,this.ctx.textAlign="left",this.ctx.fillText(S,b+15,M+4),this.ctx.restore()};r(o,h,0,i*.12,"#1565C0","mg"),r(o,h,s*Math.cos(t)*.12,s*Math.sin(t)*.12,"#FF8C00",`mg sin(${this.inclineAngle}°)`);let l=-1;Math.abs(this.object.vx)<1e-4?l=-Math.sign(s):l=-Math.sign(this.object.vx);const c=Math.max(a*.12,20);r(o,h,l*c*Math.cos(t),l*c*Math.sin(t),"#C62828","f"),Math.abs(n)>.1&&r(o,h,n*Math.cos(t)*.12,n*Math.sin(t)*.12,"#6A1B9A","Fₙₑₜ")}drawFrictionInfo(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),a=this.frictionCoefficient*e,n=s-a,o=n/this.objectMass;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(10,10,280,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(10,10,280,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textAlign="left";let h=35;this.ctx.fillText(`Friction: ${this.frictionCoefficient.toFixed(2)}`,20,h),h+=25,this.ctx.fillText(`Angle: ${this.inclineAngle}°`,20,h),h+=25,this.ctx.fillText(`Net Force: ${n.toFixed(1)} N`,20,h),h+=25,this.ctx.fillText(`Acceleration: ${o.toFixed(2)} m/s²`,20,h)}getStats(){const t=this.inclineAngle*Math.PI/180,i=this.objectMass*this.gravity*9.8,e=i*Math.cos(t),s=i*Math.sin(t),a=this.frictionCoefficient*e,n=s-a,o=n/this.objectMass;return{frictionCoefficient:this.frictionCoefficient,inclineAngle:this.inclineAngle,netForce:n,acceleration:o}}drawFrictionLabels(){this.drawLabels("Friction & Inclined Planes","F = μN  |  F∥ = mg sin θ  |  N = mg cos θ")}}class pt extends L{constructor(t){super(t),this.animationType="wave-propagation",this.waveType="transverse",this.speed=1,this.frequency=1,this.amplitude=50,this.wavelength=150,this.showAnalytics=!1,this.particles=[],this.waveSpeed=0,this.energy=0,this.initializeParticles(),this.calculateWaveParameters()}initializeParticles(){this.particles=[];const t=80;for(let i=0;i<t;i++)this.particles.push({x:i/t*this.ctx.canvas.width,y:this.ctx.canvas.height/2,originalY:this.ctx.canvas.height/2,originalX:i/t*this.ctx.canvas.width,vx:0,vy:0,index:i})}calculateWaveParameters(){this.waveSpeed=this.frequency*this.wavelength,this.energy=.5*this.amplitude*this.amplitude*this.frequency*this.frequency}setWaveType(t){this.waveType=t,this.time=0,this.initializeParticles(),this.calculateWaveParameters()}setSpeed(t){this.speed=t}setFrequency(t){this.frequency=t,this.calculateWaveParameters()}setAmplitude(t){this.amplitude=t,this.calculateWaveParameters()}setWavelength(t){this.wavelength=t,this.calculateWaveParameters()}setShowAnalytics(t){this.showAnalytics=t}reset(){this.waveType="transverse",this.speed=1,this.frequency=1,this.amplitude=50,this.wavelength=150,this.showAnalytics=!1,this.time=0,this.initializeParticles(),this.calculateWaveParameters();const t=document.getElementById("waveSpeed"),i=document.getElementById("waveFrequency"),e=document.getElementById("waveAmplitude"),s=document.getElementById("waveType"),a=document.getElementById("waveShowAnalytics");t&&(t.value=this.speed,document.getElementById("waveSpeedValue").textContent=this.speed+"x"),i&&(i.value=this.frequency,document.getElementById("waveFrequencyValue").textContent=this.frequency),e&&(e.value=this.amplitude,document.getElementById("waveAmplitudeValue").textContent=this.amplitude),s&&(s.value=this.waveType),a&&(a.checked=this.showAnalytics)}update(t){const i=this.waveType==="longitudinal"?.5:2,e=t/1e3*this.speed*i;this.time+=e,this.particles.forEach((s,a)=>{const n=s.x/this.wavelength*2*Math.PI,o=this.time*this.frequency*2*Math.PI;let h=0,r=0;switch(this.waveType){case"transverse":h=this.amplitude*Math.sin(n-o),r=-this.amplitude*this.frequency*2*Math.PI*Math.cos(n-o),s.y=s.originalY+h,s.vy=r;break;case"longitudinal":const l=this.amplitude*.5;h=l*Math.sin(n-o),r=-l*this.frequency*2*Math.PI*Math.cos(n-o),s.x=s.originalX+h,s.y=s.originalY,s.vx=r,s.vy=0,s.displacement=h;break;case"interference":const c=this.amplitude*Math.sin(n-o),g=this.amplitude*Math.sin(n+o);h=c+g,r=-this.amplitude*this.frequency*2*Math.PI*(Math.cos(n-o)-Math.cos(n+o)),s.y=s.originalY+h,s.vy=r;break;case"standing":h=this.amplitude*Math.sin(n)*Math.cos(o),r=-this.amplitude*this.frequency*2*Math.PI*Math.sin(n)*Math.sin(o),s.y=s.originalY+h,s.vy=r;break}})}render(){this.drawGrid(),this.waveType==="longitudinal"?this.drawLongitudinalWaveform():this.drawEnhancedWaveform(),this.drawParticles(),this.drawWaveDirection(),this.drawCanvasLabels(),this.showAnalytics&&(this.drawVelocityVectors(),this.drawWaveInfo(),this.drawEnergyVisualization())}drawGrid(){this.ctx.strokeStyle="rgba(100, 100, 100, 0.3)",this.ctx.lineWidth=1,this.ctx.lineCap="butt",this.ctx.setLineDash([5,5]);for(let i=0;i<this.ctx.canvas.width;i+=this.wavelength){const e=Math.round(i)+.5;this.ctx.beginPath(),this.ctx.moveTo(e,.5),this.ctx.lineTo(e,this.ctx.canvas.height-.5),this.ctx.stroke()}this.ctx.setLineDash([]);const t=this.ctx.canvas.height/2;this.ctx.strokeStyle="rgba(100, 100, 100, 0.2)",this.ctx.lineWidth=1;for(let i=t-this.amplitude;i<=t+this.amplitude;i+=this.amplitude/2){const e=Math.round(i)+.5;this.ctx.beginPath(),this.ctx.moveTo(.5,e),this.ctx.lineTo(this.ctx.canvas.width-.5,e),this.ctx.stroke()}}drawEnhancedWaveform(){this.ctx.beginPath();const t=this.ctx.createLinearGradient(0,0,this.ctx.canvas.width,0);if(t.addColorStop(0,"#667eea"),t.addColorStop(.5,"#764ba2"),t.addColorStop(1,"#667eea"),this.ctx.strokeStyle=t,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.particles.length>1){const i=this.particles[0].x,e=this.particles[this.particles.length-1].x,s=300;this.ctx.moveTo(i,this.particles[0].y);for(let a=1;a<s;a++){const n=a/(s-1),o=i+n*(e-i),h=n*(this.particles.length-1),r=Math.floor(h),l=Math.min(r+1,this.particles.length-1),c=h-r,g=this.particles[r].y,x=this.particles[l].y,u=g+c*(x-g);this.ctx.lineTo(o,u)}}this.ctx.stroke()}drawLongitudinalWaveform(){if(this.particles.length<2)return;const t=this.ctx.canvas.height/2,i=20;this.ctx.strokeStyle="#667eea",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(this.particles[0].x,t);const e=this.particles[this.particles.length-1].x-this.particles[0].x,s=200;for(let a=0;a<=s;a++){const n=a/s,o=this.particles[0].x+n*e,h=o/this.wavelength*2*Math.PI,r=this.time*this.frequency*2*Math.PI,l=this.amplitude*Math.sin(h-r),c=Math.sin(n*Math.PI*8)*i,g=t+c+l*.3;this.ctx.lineTo(o,g)}this.ctx.stroke(),this.drawLongitudinalWaveDirection()}drawLongitudinalWaveDirection(){const t=this.ctx.canvas.height/2,i=this.frequency*this.wavelength,e=50+this.time*i*.1%100,s=Math.round(t)+.5,a=Math.round(e)+.5;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.moveTo(a,s),this.ctx.lineTo(a+30,s),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(a+30.5,s),this.ctx.lineTo(a+25.5,s-5),this.ctx.lineTo(a+25.5,s+5),this.ctx.closePath(),this.ctx.fill()}drawCanvasLabels(){const t=this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1)+" Wave";this.drawLabels(t,`v = f×λ = ${this.waveSpeed.toFixed(1)} px/s  |  y = A sin(2π(ft-x/λ))  |  E ∝ A²f²`)}drawParticles(){this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.amplitude*this.frequency*2*Math.PI,s=Math.min(i/e,1),a=Math.floor(100+s*155),n=Math.floor(100+(1-s)*100),o=Math.floor(200+s*55),h=this.waveType==="longitudinal"?8:5,r=Math.round(t.x)+.5,l=Math.round(t.y)+.5;this.ctx.fillStyle=`rgb(${a}, ${n}, ${o})`,this.ctx.beginPath(),this.ctx.arc(r,l,h,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255,255,255,0.9)",this.ctx.lineWidth=.75,this.ctx.stroke()})}drawVelocityVectors(){this.particles.forEach(t=>{if(Math.sqrt(t.vx*t.vx+t.vy*t.vy)>1){const s=t.x+t.vx*.1,a=t.y+t.vy*.1,n=Math.round(t.x)+.5,o=Math.round(t.y)+.5,h=Math.round(s)+.5,r=Math.round(a)+.5;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=1.5,this.ctx.lineCap="round",this.ctx.moveTo(n,o),this.ctx.lineTo(h,r),this.ctx.stroke();const l=Math.atan2(t.vy,t.vx);this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(h,r),this.ctx.lineTo(h-6*Math.cos(l-Math.PI/6),r-6*Math.sin(l-Math.PI/6)),this.ctx.lineTo(h-6*Math.cos(l+Math.PI/6),r-6*Math.sin(l+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}})}drawWaveDirection(){if(this.waveType!=="standing"){const t=this.frequency*this.wavelength,i=50+this.time*t*.1%100,e=50.5,s=Math.round(i)+.5;this.ctx.beginPath(),this.ctx.strokeStyle="#ff6b6b",this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.moveTo(s,e),this.ctx.lineTo(s+20,e),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.moveTo(s+20.5,e),this.ctx.lineTo(s+15.5,e-5),this.ctx.lineTo(s+15.5,e+5),this.ctx.closePath(),this.ctx.fill()}}drawWaveInfo(){this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.font="14px Inter",this.ctx.textAlign="left";let t=120;this.ctx.fillText(`Wave Type: ${this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1)}`,10,t),t+=20,this.ctx.fillText(`Frequency: ${this.frequency.toFixed(1)} Hz`,10,t),t+=20,this.ctx.fillText(`Wavelength: ${this.wavelength.toFixed(0)} px`,10,t),t+=20,this.ctx.fillText(`Amplitude: ${this.amplitude.toFixed(0)} px`,10,t),t+=20,this.ctx.fillText(`Wave Speed: ${this.waveSpeed.toFixed(1)} px/s`,10,t),t+=20,this.ctx.fillText(`Energy: ${this.energy.toFixed(1)}`,10,t),t+=30,this.ctx.fillText("Wave Equation: y = A sin(kx - ωt)",10,t),t+=20,this.ctx.fillText("where: k = 2π/λ, ω = 2πf",10,t),this.ctx.shadowBlur=0}drawEnergyVisualization(){const e=this.ctx.canvas.width-200-20,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(e,s,200,20);const a=.5*100*100*3*3,o=200*Math.min(this.energy/a,1),h=this.ctx.createLinearGradient(e,s,e+o,s);h.addColorStop(0,"#4CAF50"),h.addColorStop(1,"#FF9800"),this.ctx.fillStyle=h,this.ctx.fillRect(e,s,o,20),this.ctx.fillStyle="#fff",this.ctx.font="bold 14px Inter",this.ctx.textAlign="center",this.ctx.fillText(`Energy: ${this.energy.toFixed(1)}`,e+200/2,s+15)}getStats(){return{waveType:this.waveType.charAt(0).toUpperCase()+this.waveType.slice(1),frequency:this.frequency.toFixed(1),wavelength:this.wavelength.toFixed(0),amplitude:this.amplitude.toFixed(0),waveSpeed:this.waveSpeed.toFixed(1),energy:this.energy.toFixed(1),time:this.time.toFixed(1)}}}class mt extends L{constructor(t){super(t),this.animationType="wave-propagation",this.particles=[],this.frequency=2,this.amplitude=50,this.waveSpeed=343,this.particleCount=80,this.waveType="transverse",this.showPressure=!0,this.animationSpeed=1,this.sourceX=100,this.sourceY=this.ctx.canvas.height/2,this.receiverX=this.ctx.canvas.width-100,this.receiverY=this.ctx.canvas.height/2,this.showSourceReceiver=!0,this.sourceActive=!0,this.pulses=[],this.pulseDuration=15,this.isPlaying=!1,this.controlButtons={playPause:{x:220,y:20,width:80,height:30,label:"▶ Play"},reset:{x:310,y:20,width:60,height:30,label:"🔄 Reset"}},this.initializeParticles(),this.setupClickEvents(),this.musicalNotes={C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25}}setupClickEvents(){this.ctx.canvas.addEventListener("click",t=>{const i=this.ctx.canvas.getBoundingClientRect(),e=t.clientX-i.left,s=t.clientY-i.top;Math.sqrt((e-this.sourceX)**2+(s-this.sourceY)**2)<50&&this.triggerWavePulse()}),this.ctx.canvas.addEventListener("touchstart",t=>{t.preventDefault();const i=this.ctx.canvas.getBoundingClientRect(),e=t.touches[0],s=e.clientX-i.left,a=e.clientY-i.top;Math.sqrt((s-this.sourceX)**2+(a-this.sourceY)**2)<50&&this.triggerWavePulse()})}handleButtonClick(t,i){Object.keys(this.controlButtons).forEach(e=>{const s=this.controlButtons[e];t>=s.x&&t<=s.x+s.width&&i>=s.y&&i<=s.y+s.height&&this.handleControlAction(e)})}handleControlAction(t){switch(t){case"playPause":this.isPlaying?(this.isPlaying=!1,this.controlButtons.playPause.label="▶ Play"):(this.isPlaying=!0,this.controlButtons.playPause.label="⏸ Pause",this.triggerWavePulse());break;case"reset":this.isPlaying=!1,this.pulses=[],this.time=0,this.initializeParticles(),this.controlButtons.playPause.label="▶ Play";break}}initializeParticles(){this.particles=[];const t=this.ctx.canvas.width/this.particleCount;for(let i=0;i<this.particleCount;i++)this.particles.push({x:i*t,originalX:i*t,y:this.ctx.canvas.height/2,originalY:this.ctx.canvas.height/2,vx:0,vy:0,size:2+Math.random()*1,color:`hsl(${200+Math.random()*60}, 70%, 60%)`,pressure:0,life:0})}setFrequency(t){this.frequency=t}setAmplitude(t){this.amplitude=t}setWaveSpeed(t){this.waveSpeed=t}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setWaveType(t){this.waveType=t}setShowPressure(t){this.showPressure=t}setAnimationSpeed(t){this.animationSpeed=t}setShowSourceReceiver(t){this.showSourceReceiver=t}setSourceActive(t){this.sourceActive=t}setSourcePosition(t,i){this.sourceX=t,this.sourceY=i}setReceiverPosition(t,i){this.receiverX=t,this.receiverY=i}setMusicalNote(t){this.musicalNotes[t]&&(this.frequency=this.musicalNotes[t])}setInstrumentPreset(t){switch(t){case"guitar":this.frequency=82.41,this.amplitude=60,this.waveType="transverse";break;case"piano":this.frequency=440,this.amplitude=70,this.waveType="transverse";break;case"flute":this.frequency=523.25,this.amplitude=50,this.waveType="longitudinal";break;case"drum":this.frequency=100,this.amplitude=80,this.waveType="combined";break}}triggerWavePulse(){const t={startTime:this.time,duration:20,active:!0};this.pulses.push(t)}reset(){this.time=0,this.pulses=[],this.initializeParticles()}update(t){if(!this.isPlaying)return;this.time+=t*this.animationSpeed,this.pulses=this.pulses.filter(s=>(this.time-s.startTime)/1e3<s.duration),this.waveSpeed/this.frequency*.3;const i=2*Math.PI*this.frequency,e=this.amplitude/100*60;this.particles.forEach((s,a)=>{let n=!1,o=!1,h=0,r=150,l=0;if(this.pulses.forEach(c=>{if(l=(this.time-c.startTime)/1e3,l>=0&&l<=c.duration){n=!0,r=150;const g=this.sourceX+l*this.waveSpeed*.1,x=g>=this.receiverX;let u;x?(h=Math.max(this.sourceX-50,g-r)+100,u=this.receiverX):(h=Math.max(this.sourceX-50,g-r)+100,u=Math.min(this.receiverX,g)+100),s.originalX>=h&&s.originalX<=u&&(o=!0,(s.originalX-h)/r,l*this.frequency*2*Math.PI)}}),n&&o){if(s.trail||(s.trail=[]),s.trail.push({x:s.x,y:s.y}),s.trail.length>8&&s.trail.shift(),this.waveType==="transverse"||this.waveType==="combined"){s.x=s.originalX;const g=(s.originalX-h)/r*3*2*Math.PI,x=l*this.frequency*2*Math.PI,u=g-x;s.y=s.originalY+e*Math.sin(u),s.vy=e*i*Math.cos(u)*.1,s.vx=0}if(this.waveType==="longitudinal"||this.waveType==="combined"){s.y=s.originalY;const g=(s.originalX-h)/r*3*2*Math.PI,x=l*this.frequency*2*Math.PI,u=g-x;s.x=s.originalX+e*.4*Math.sin(u),s.vx=e*.4*i*Math.cos(u)*.1,s.vy=0,s.pressure=Math.sin(u)}}else s.y=s.originalY,s.x=s.originalX,s.vy=0,s.vx=0,s.pressure=0,s.trail=[];s.life+=t})}render(){if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBackground(),this.showSourceReceiver&&this.drawSourceAndReceiver(),this.pulses&&this.pulses.length>0)switch(this.waveType){case"transverse":this.drawTransverseWave();break;case"longitudinal":this.drawLongitudinalWave();break;case"combined":this.drawCombinedWave();break}else this.drawInstruction();this.drawSoundInfo(),this.drawControlButtons(),this.drawWavePacketBoundaries()}drawInstruction(){const t=this.ctx.canvas.height-30;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(this.ctx.canvas.width/2-150,t-15,300,30),this.ctx.fillStyle="white",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("🎵 Click the red source to start!",this.ctx.canvas.width/2,t)}drawControlButtons(){Object.keys(this.controlButtons).forEach(t=>{const i=this.controlButtons[t];this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i.x,i.y,i.width,i.height),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(i.x,i.y,i.width,i.height),this.ctx.fillStyle="white",this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText(i.label,i.x+i.width/2,i.y+i.height/2+3)})}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.strokeStyle="rgba(100, 149, 237, 0.3)",this.ctx.lineWidth=1,this.ctx.setLineDash([20,10]),this.ctx.beginPath(),this.ctx.moveTo(this.sourceX,this.sourceY),this.ctx.lineTo(this.receiverX,this.receiverY),this.ctx.stroke();const i=100;for(let e=this.sourceX+50;e<this.receiverX-50;e+=i){const s=this.sourceY;this.ctx.beginPath(),this.ctx.moveTo(e,s-5),this.ctx.lineTo(e+15,s),this.ctx.lineTo(e,s+5),this.ctx.stroke()}this.ctx.setLineDash([])}drawTransverseWave(){this.particles.forEach(t=>{if(t.trail&&t.trail.length>1){this.ctx.beginPath(),this.ctx.moveTo(t.trail[0].x,t.trail[0].y);for(let i=1;i<t.trail.length;i++)this.ctx.lineTo(t.trail[i].x,t.trail[i].y);this.ctx.strokeStyle=`rgba(100, 149, 237, ${.4*(t.trail.length/8)})`,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.stroke()}}),this.ctx.strokeStyle="rgba(100, 149, 237, 0.8)",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.drawSmoothWave(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(100, 149, 237, 0.3)",this.ctx.lineWidth=6,this.ctx.beginPath(),this.drawSmoothWave(),this.ctx.stroke(),this.particles.forEach(t=>{const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=Math.min(i*50,1),s=this.frequency/20*360,a=Math.min(this.amplitude/50,1)*100,n=`hsl(${s}, ${a}%, 70%)`;this.ctx.shadowColor=n,this.ctx.shadowBlur=6,this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size*(1+e*.2),0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0})}drawLongitudinalWave(){this.ctx.strokeStyle="rgba(255, 100, 0, 0.8)",this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.drawSmoothWave(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 100, 0, 0.3)",this.ctx.lineWidth=6,this.ctx.beginPath(),this.drawSmoothWave(),this.ctx.stroke(),this.particles.forEach(t=>{const i=t.pressure||0,e=Math.abs(i);let s;i>0?s="hsl(0, 80%, 60%)":s="hsl(240, 80%, 60%)";const a=t.size+e*1.5;this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,a,0,Math.PI*2),this.ctx.fill(),e>.3&&(this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.beginPath(),i>0?(this.ctx.moveTo(t.x-8,t.y-5),this.ctx.lineTo(t.x-8,t.y+5),this.ctx.moveTo(t.x+8,t.y-5),this.ctx.lineTo(t.x+8,t.y+5)):(this.ctx.moveTo(t.x-12,t.y-3),this.ctx.lineTo(t.x-12,t.y+3),this.ctx.moveTo(t.x+12,t.y-3),this.ctx.lineTo(t.x+12,t.y+3)),this.ctx.stroke())}),this.showPressure&&this.drawPressureZones()}drawCombinedWave(){this.drawTransverseWave(),this.showPressure&&this.drawPressureZones(),this.particles.forEach(t=>{const i=t.pressure;if(Math.abs(i)>.3){let s;i>0?s="hsl(0, 80%, 60%)":s="hsl(240, 80%, 60%)",this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(t.x,t.y+30,3,0,Math.PI*2),this.ctx.fill()}})}drawPressureZones(){const t=this.waveSpeed/this.frequency,i=this.waveSpeed;this.frequency;const e=this.time*.001*i%t,s=80,a=this.sourceY-s/2;for(let n=this.sourceX;n<=this.receiverX;n+=t/4){const o=(n-e)%t,h=2*Math.PI*o/t,r=Math.sin(h);r>.5?(this.ctx.fillStyle="rgba(255, 165, 0, 0.2)",this.ctx.fillRect(n,a,t/4,s),this.ctx.strokeStyle="rgba(255, 165, 0, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(n,a,t/4,s),this.ctx.fillStyle="rgba(255, 165, 0, 0.7)",this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText("C",n+t/8,a+15)):r<-.5&&(this.ctx.fillStyle="rgba(0, 128, 128, 0.2)",this.ctx.fillRect(n,a,t/4,s),this.ctx.strokeStyle="rgba(0, 128, 128, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(n,a,t/4,s),this.ctx.fillStyle="rgba(0, 128, 128, 0.7)",this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.fillText("R",n+t/8,a+15))}}drawSourceAndReceiver(){if(this.ctx.strokeStyle="rgba(255, 255, 0, 0.3)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,50,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle=this.sourceActive?"#FF6B6B":"#666666",this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,25,0,Math.PI*2),this.ctx.fill(),this.sourceActive){this.ctx.strokeStyle="#FF6B6B",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,35,0,Math.PI*2),this.ctx.stroke();const t=Math.sin(this.time*.01)*.3+.7;this.ctx.fillStyle=`rgba(255, 107, 107, ${t*.3})`,this.ctx.beginPath(),this.ctx.arc(this.sourceX,this.sourceY,40,0,Math.PI*2),this.ctx.fill()}this.ctx.fillStyle="#4ECDC4",this.ctx.beginPath(),this.ctx.arc(this.receiverX,this.receiverY,20,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.receiverX,this.receiverY,30,0,Math.PI*2),this.ctx.stroke(),this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#FF6B6B",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("🎤 Source",this.sourceX,this.sourceY+50),this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("👂 Receiver",this.receiverX,this.receiverY+50),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.strokeStyle="#FFD93D",this.ctx.lineWidth=3,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.moveTo(this.sourceX+40,this.sourceY),this.ctx.lineTo(this.receiverX-30,this.receiverY),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle="#FFD93D",this.ctx.beginPath(),this.ctx.moveTo(this.receiverX-30,this.receiverY),this.ctx.lineTo(this.receiverX-40,this.receiverY-5),this.ctx.lineTo(this.receiverX-40,this.receiverY+5),this.ctx.closePath(),this.ctx.fill()}drawSoundInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,10,200,60),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 12px Arial",this.ctx.textAlign="left",this.ctx.fillText("🔊 Sound Wave",20,25),this.ctx.font="11px Arial",this.ctx.fillText(`${this.waveType} • ${this.frequency}Hz • ${this.amplitude}%`,20,40),this.ctx.fillText(`λ: ${(this.waveSpeed/this.frequency).toFixed(1)}m • v: ${this.waveSpeed}m/s`,20,55)}drawSmoothWave(){const t=this.particles.filter(i=>i.x>0&&i.y>0);if(!(t.length<2)){this.ctx.moveTo(t[0].x,t[0].y);for(let i=1;i<t.length-1;i++){const e=t[i],s=t[i+1],a=e.x+(s.x-t[i-1].x)*.2,n=e.y+(s.y-t[i-1].y)*.2;this.ctx.quadraticCurveTo(a,n,(e.x+s.x)/2,(e.y+s.y)/2)}t.length>1&&this.ctx.lineTo(t[t.length-1].x,t[t.length-1].y)}}drawWavePacketBoundaries(){this.pulses.forEach(t=>{const i=(this.time-t.startTime)/1e3;if(i>=0&&i<=t.duration){const s=this.sourceX+i*this.waveSpeed*.1,a=s>=this.receiverX;let n,o;a?(n=Math.max(this.sourceX-50,s-150)+100,o=this.receiverX):(n=Math.max(this.sourceX-50,s-150)+100,o=Math.min(this.receiverX,s)+100),this.ctx.strokeStyle="rgba(255, 255, 0, 0.9)",this.ctx.lineWidth=3,this.ctx.setLineDash([8,4]),this.ctx.beginPath(),this.ctx.moveTo(o,this.sourceY-50),this.ctx.lineTo(o,this.sourceY+50),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(n,this.sourceY-50),this.ctx.lineTo(n,this.sourceY+50),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 0, 0.8)",this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",a?this.ctx.fillText("Wave Collapsing",(n+o)/2,this.sourceY-40):this.ctx.fillText("Wave Packet",(n+o)/2,this.sourceY-40),this.ctx.setLineDash([])}})}getStats(){return{waveType:this.waveType,frequency:this.frequency,wavelength:this.waveSpeed/this.frequency,waveSpeed:this.waveSpeed,amplitude:this.amplitude,particleCount:this.particleCount,time:this.time}}}class yt extends L{constructor(t){super(t),this.charges=[],this.testParticles=[],this.fieldStrength=1,this.speed=1,this.particleCount=20,this.showFieldLines=!0,this.showParticles=!0,this.showForceArrows=!1,this.showAnalytics=!0,this.initializeTestParticles(),this.initializeDefaultCharges()}initializeTestParticles(){this.testParticles=[];for(let t=0;t<this.particleCount;t++)this.testParticles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:0,vy:0,trail:[],maxTrailLength:30})}initializeDefaultCharges(){this.addChargeAtPosition("positive",this.ctx.canvas.width*.3,this.ctx.canvas.height*.5),this.addChargeAtPosition("negative",this.ctx.canvas.width*.7,this.ctx.canvas.height*.5)}setSpeed(t){this.speed=t}setFieldStrength(t){this.fieldStrength=t}setParticleCount(t){this.particleCount=t,this.initializeTestParticles()}setShowAnalytics(t){this.showAnalytics=t}addChargeAtPosition(t,i,e){const s={x:i,y:e,type:t,magnitude:1,color:t==="positive"?"#ff6b6b":"#667eea"};this.charges.push(s)}clearCharges(){this.charges=[],this.initializeDefaultCharges()}reset(){this.time=0,this.charges=[],this.initializeTestParticles(),this.initializeDefaultCharges()}calculateElectricField(t,i){let e=0,s=0;const a=500;return this.charges.forEach(n=>{const o=t-n.x,h=i-n.y,r=Math.sqrt(o*o+h*h);if(r>10){const l=a*n.magnitude*this.fieldStrength/(r*r),c=n.type==="positive"?1:-1;e+=c*l*o/r,s+=c*l*h/r}}),{ex:e,ey:s}}update(t){const i=t/1e3*this.speed*20;this.time+=i,this.testParticles.forEach(e=>{const s=this.calculateElectricField(e.x,e.y);e.vx+=s.ex*i*.5,e.vy+=s.ey*i*.5,e.vx*=.95,e.vy*=.95,Math.sqrt(e.vx*e.vx+e.vy*e.vy)>100&&(e.vx*=.8,e.vy*=.8),e.x+=e.vx*i,e.y+=e.vy*i,e.trail.push({x:e.x,y:e.y}),e.trail.length>e.maxTrailLength&&e.trail.shift(),e.x<0&&(e.x=this.ctx.canvas.width),e.x>this.ctx.canvas.width&&(e.x=0),e.y<0&&(e.y=this.ctx.canvas.height),e.y>this.ctx.canvas.height&&(e.y=0)})}render(){this.showAnalytics&&(this.drawFieldLines(),this.drawParticles(),this.drawForceArrows()),this.drawCharges(),this.drawElectricLabels()}drawFieldLines(){for(let i=30;i<this.ctx.canvas.width;i+=30)for(let e=30;e<this.ctx.canvas.height;e+=30){const s=this.calculateElectricField(i,e),a=Math.sqrt(s.ex*s.ex+s.ey*s.ey);if(a>.1){const n=Math.atan2(s.ey,s.ex),o=Math.min(a/50,1),h=Math.round(i)+.5,r=Math.round(e)+.5,l=Math.round(i+25*Math.cos(n))+.5,c=Math.round(e+25*Math.sin(n))+.5;this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(102, 126, 234, ${o})`,this.ctx.lineWidth=1.5,this.ctx.lineCap="round",this.ctx.moveTo(h,r),this.ctx.lineTo(l,c),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.fillStyle=`rgba(102, 126, 234, ${o})`,this.ctx.moveTo(l,c),this.ctx.lineTo(l-5*Math.cos(n-Math.PI/6),c-5*Math.sin(n-Math.PI/6)),this.ctx.lineTo(l-5*Math.cos(n+Math.PI/6),c-5*Math.sin(n+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}}}drawCharges(){this.charges.forEach(t=>{const i=this.ctx.createRadialGradient(t.x-8,t.y-8,0,t.x,t.y,20);t.type==="positive"?(i.addColorStop(0,"#ff6b6b"),i.addColorStop(.7,"#ff4757"),i.addColorStop(1,"#ff3838")):(i.addColorStop(0,"#667eea"),i.addColorStop(.7,"#5f6fd8"),i.addColorStop(1,"#5352ed")),this.ctx.beginPath(),this.ctx.fillStyle=t.type==="positive"?"rgba(255, 107, 107, 0.3)":"rgba(102, 126, 234, 0.3)",this.ctx.arc(t.x,t.y,18,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle=i,this.ctx.arc(t.x,t.y,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.arc(t.x+2,t.y+2,12,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.lineWidth=3,this.ctx.strokeStyle="rgba(0,0,0,0.9)",this.ctx.strokeText(t.type==="positive"?"+":"−",t.x,t.y),this.ctx.fillText(t.type==="positive"?"+":"−",t.x,t.y)})}drawParticles(){this.testParticles.forEach(t=>{if(t.trail.length>1){this.ctx.beginPath();const s=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y);s.addColorStop(0,"rgba(255, 255, 255, 0.25)"),s.addColorStop(1,"rgba(255, 255, 255, 0.9)"),this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(a=>{this.ctx.lineTo(a.x,a.y)}),this.ctx.stroke()}const i=Math.round(t.x)+.5,e=Math.round(t.y)+.5;this.ctx.beginPath(),this.ctx.fillStyle="#ffffff",this.ctx.arc(i,e,5,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.9)",this.ctx.lineWidth=1.25,this.ctx.stroke()})}drawForceArrows(){this.testParticles.forEach(t=>{const i=this.calculateElectricField(t.x,t.y);if(Math.sqrt(i.ex*i.ex+i.ey*i.ey)>5){const a=t.x+i.ex*.8,n=t.y+i.ey*.8,o=this.ctx.createLinearGradient(t.x,t.y,a,n);o.addColorStop(0,"#ff6b35"),o.addColorStop(1,"#ff8c42"),this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 107, 53, 0.4)",this.ctx.lineWidth=6,this.ctx.lineCap="round",this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(a,n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=o,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(a,n),this.ctx.stroke();const h=Math.atan2(i.ey,i.ex);this.ctx.beginPath(),this.ctx.fillStyle=o,this.ctx.moveTo(a,n),this.ctx.lineTo(a-10*Math.cos(h-Math.PI/6),n-10*Math.sin(h-Math.PI/6)),this.ctx.lineTo(a-10*Math.cos(h+Math.PI/6),n-10*Math.sin(h+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}})}drawInfo(){const e=this.ctx.canvas.width-200-20,s=20,a=this.ctx.createLinearGradient(e,s,e,s+120);a.addColorStop(0,"rgba(24, 28, 43, 0.95)"),a.addColorStop(1,"rgba(35, 41, 70, 0.95)"),this.ctx.fillStyle=a,this.ctx.fillRect(e,s,200,120),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("Electric Field Analytics",e+15,s+25),this.ctx.fillStyle="#e9ecef",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Charges: ${this.charges.length}`,e+15,s+45),this.ctx.fillText(`Particles: ${this.testParticles.length}`,e+15,s+65),this.ctx.fillText(`Field Strength: ${this.fieldStrength.toFixed(1)}`,e+15,s+85),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(5,this.ctx.canvas.height-50,300,40),this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("🔴 Positive (+)  🔵 Negative (−)",10,this.ctx.canvas.height-40),this.ctx.fillText("Click canvas to add charges",10,this.ctx.canvas.height-20)}getStats(){return{chargeCount:this.charges.length,particleCount:this.testParticles.length,fieldStrength:this.fieldStrength.toFixed(1),time:this.time.toFixed(1)}}drawElectricLabels(){this.drawLabels("Electric Fields","E = kQ/r²  |  F = kq₁q₂/r²  |  E = ΣEᵢ"),this.drawTestParticleBanner()}drawTestParticleBanner(){const s=this.ctx.canvas.height-55,a=this.ctx.createLinearGradient(10,s,10,s+40);a.addColorStop(0,"rgba(255, 255, 255, 0.95)"),a.addColorStop(1,"rgba(240, 240, 240, 0.95)"),this.ctx.fillStyle=a,this.ctx.fillRect(10,s,320,40),this.ctx.shadowColor="rgba(102, 126, 234, 0.6)",this.ctx.shadowBlur=4,this.ctx.strokeStyle="rgba(102, 126, 234, 0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(10,s,320,40),this.ctx.shadowBlur=0,this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("White particles = Test charges (positive)",22,s+40/2),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.arc(300,s+40/2,6,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="#ffffff",this.ctx.arc(300,s+40/2,3,0,Math.PI*2),this.ctx.fill()}}class wt extends L{constructor(t){super(t),this.speed=.5,this.fieldStrength=3,this.particleCount=15,this.showFieldLines=!0,this.showParticles=!0,this.animationOffset=0,this.magnets=[],this.particles=[],this.initializeParticles(),this.initializeDefaultMagnets()}initializeParticles(){this.particles=[];for(let t=0;t<this.particleCount;t++)this.particles.push({x:Math.random()*this.ctx.canvas.width,y:Math.random()*this.ctx.canvas.height,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,charge:Math.random()>.5?1:-1,trail:[],maxTrailLength:30})}initializeDefaultMagnets(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height/2,e=50;this.magnets=[{x:t,y:i-e/2,strength:this.fieldStrength,pole:"north",color:"#ff6b6b",isPartOfMagnet:!0,magnetId:1},{x:t,y:i+e/2,strength:this.fieldStrength,pole:"south",color:"#667eea",isPartOfMagnet:!0,magnetId:1}]}setSpeed(t){this.speed=t}setFieldStrength(t){this.fieldStrength=t,this.magnets.forEach(i=>{i.strength=t})}setParticleCount(t){this.particleCount=t,this.initializeParticles()}setShowFieldLines(t){this.showFieldLines=t}setShowParticles(t){this.showParticles=t}addMagnetAtPosition(t,i){this.magnets.push({x:t,y:i-50/2,strength:this.fieldStrength,pole:"north",color:"#ff6b6b",isPartOfMagnet:!0,magnetId:this.magnets.length}),this.magnets.push({x:t,y:i+50/2,strength:this.fieldStrength,pole:"south",color:"#667eea",isPartOfMagnet:!0,magnetId:this.magnets.length-1})}clearMagnets(){this.magnets=[]}reset(){this.time=0,this.clearMagnets(),this.initializeDefaultMagnets(),this.initializeParticles()}calculateMagneticField(t,i){let e=0,s=0;return this.magnets.forEach(a=>{const n=t-a.x,o=i-a.y,h=Math.sqrt(n*n+o*o);if(h>10){const r=a.strength/(1+h/100),l=n/h,c=o/h;a.pole==="north"?(e+=r*l,s+=r*c):(e-=r*l,s-=r*c)}}),{Bx:e,By:s}}update(t){const i=t/1e3*this.speed*3;this.time+=i,this.animationOffset=this.time*.5%1,this.particles.forEach(e=>{const s=this.calculateMagneticField(e.x,e.y),a=Math.sqrt(s.Bx*s.Bx+s.By*s.By),n=e.charge*(e.vy*s.Bx-e.vx*s.By)*8,o=e.charge*(e.vx*s.By-e.vy*s.Bx)*8,h=Math.min(1,a/2),r=n*h,l=o*h;e.vx+=r*i,e.vy+=l*i;const c=Math.sqrt(e.vx*e.vx+e.vy*e.vy),g=a>.5?.98:.95;c>120&&(e.vx*=g,e.vy*=g),e.x+=e.vx*i,e.y+=e.vy*i,e.trail.push({x:e.x,y:e.y,fieldStrength:a}),e.trail.length>e.maxTrailLength&&e.trail.shift(),e.x<0&&(e.x=this.ctx.canvas.width,e.vx*=.8),e.x>this.ctx.canvas.width&&(e.x=0,e.vx*=.8),e.y<0&&(e.y=this.ctx.canvas.height,e.vy*=.8),e.y>this.ctx.canvas.height&&(e.y=0,e.vy*=.8)})}render(){this.showFieldLines&&this.drawFieldLines(),this.drawMagnets(),this.drawParticles(),this.drawMagneticLabels()}drawFieldLines(){this.magnets.length!==0&&(this.drawCombinedFieldLines(),this.drawInteractionFieldLines())}drawCombinedFieldLines(){const e=this.ctx.canvas.width/8,s=this.ctx.canvas.height/8;for(let a=0;a<8;a++)for(let n=0;n<8;n++){const o=a*e+e/2,h=n*s+s/2;this.drawCombinedFieldLine(o,h,150)}}drawCombinedFieldLine(t,i,e){const a=e/20;let n=t,o=i;const h=Math.min(1,this.animationOffset/1),r=Math.floor(20*h);this.ctx.strokeStyle="#00D1FF",this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(n,o);for(let l=0;l<r;l++){const c=this.calculateMagneticField(n,o),g=Math.sqrt(c.Bx*c.Bx+c.By*c.By);if(g>.1){const x=c.Bx/g,u=c.By/g;n+=x*a,o+=u*a,this.ctx.lineTo(n,o)}else break}if(this.ctx.stroke(),r>5){const l=this.calculateMagneticField(n,o),c=Math.sqrt(l.Bx*l.Bx+l.By*l.By);if(c>.1){const g=l.Bx/c,x=l.By/c,u=Math.atan2(x,g);this.drawSimpleArrowhead(n,o,u,"combined")}}}drawMagnetFieldLines(t,i){const e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),s=Math.atan2(i.y-t.y,i.x-t.x);this.drawSimpleFieldLines(t,i,e,s)}drawSimpleFieldLines(t,i,e,s){for(let n=0;n<12;n++){const o=n/12*Math.PI*2;this.drawRadiatingFieldLine(t,o,"north")}for(let n=0;n<12;n++){const o=n/12*Math.PI*2;this.drawRadiatingFieldLine(i,o,"south")}}drawRadiatingFieldLine(t,i,e){let s=120,a,n,o,h;e==="north"?(s=140,a=t.x,n=t.y,o=a+Math.cos(i)*s,h=n+Math.sin(i)*s):(o=t.x,h=t.y,a=o+Math.cos(i)*s,n=h+Math.sin(i)*s);const r=Math.min(1,this.animationOffset/1),l=a+(o-a)*r,c=n+(h-n)*r,g=e==="north"?"#FF3B3B":"#6FA8FF",x=e==="north"?2.5:2.2;this.ctx.strokeStyle=g,this.ctx.lineWidth=x,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(a,n),this.ctx.lineTo(l,c),this.ctx.stroke(),r>=.7&&this.drawSimpleArrowhead(l,c,i,e)}drawSimpleArrowhead(t,i,e,s){const n=Math.PI/6,o=e,h=t,r=i,l=t-Math.cos(o+n)*20*.6,c=i-Math.sin(o+n)*20*.6,g=t-Math.cos(o-n)*20*.6,x=i-Math.sin(o-n)*20*.6;let u;s==="north"?u="#FF3B3B":s==="south"?u="#6FA8FF":u="#00D1FF",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=2,this.ctx.fillStyle=u,this.ctx.beginPath(),this.ctx.moveTo(h,r),this.ctx.lineTo(l,c),this.ctx.lineTo(g,x),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}drawInteractionFieldLines(){const t=this.magnets.filter(e=>e.pole==="north"),i=this.magnets.filter(e=>e.pole==="south");t.forEach(e=>{i.forEach(s=>{if(e.magnetId!==s.magnetId){const a=Math.sqrt(Math.pow(e.x-s.x,2)+Math.pow(e.y-s.y,2));a<200&&a>60&&this.drawInteractionFieldLine(e,s)}})})}drawInteractionFieldLine(t,i){const e=this.time*.3%1;Math.atan2(i.y-t.y,i.x-t.x);const s=t.x,a=t.y,n=i.x,o=i.y,h=1*e,r=s+(n-s)*h,l=a+(o-a)*h;if(this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.strokeStyle="#00D1FF",this.ctx.lineWidth=2,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(s,a),this.ctx.lineTo(r,l),this.ctx.stroke(),this.ctx.shadowBlur=0,h>.1){const c=Math.atan2(l-a,r-s),g=20;this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 1.0)",this.ctx.moveTo(r,l),this.ctx.lineTo(r-g*Math.cos(c-Math.PI/6),l-g*Math.sin(c-Math.PI/6)),this.ctx.lineTo(r-g*Math.cos(c+Math.PI/6),l-g*Math.sin(c+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}}drawMagnets(){const t={};this.magnets.forEach(i=>{t[i.magnetId]||(t[i.magnetId]=[]),t[i.magnetId].push(i)}),Object.values(t).forEach(i=>{if(i.length===2){const e=i.find(a=>a.pole==="north"),s=i.find(a=>a.pole==="south");e&&s&&this.drawMagnetBody(e,s)}})}drawMagnetBody(t,i){Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));const e=Math.atan2(i.y-t.y,i.x-t.x),a=20/2,n=[{x:t.x-a*Math.cos(e+Math.PI/2),y:t.y-a*Math.sin(e+Math.PI/2)},{x:t.x+a*Math.cos(e+Math.PI/2),y:t.y+a*Math.sin(e+Math.PI/2)},{x:i.x+a*Math.cos(e+Math.PI/2),y:i.y+a*Math.sin(e+Math.PI/2)},{x:i.x-a*Math.cos(e+Math.PI/2),y:i.y-a*Math.sin(e+Math.PI/2)}];this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.beginPath(),this.ctx.moveTo(n[0].x+3,n[0].y+3),this.ctx.lineTo(n[1].x+3,n[1].y+3),this.ctx.lineTo(n[2].x+3,n[2].y+3),this.ctx.lineTo(n[3].x+3,n[3].y+3),this.ctx.closePath(),this.ctx.fill();const o=this.ctx.createLinearGradient(t.x,t.y,i.x,i.y);o.addColorStop(0,"#ff6b6b"),o.addColorStop(.3,"#ff8a65"),o.addColorStop(.5,"#8b5cf6"),o.addColorStop(.7,"#667eea"),o.addColorStop(1,"#5352ed"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.moveTo(n[0].x,n[0].y),this.ctx.lineTo(n[1].x,n[1].y),this.ctx.lineTo(n[2].x,n[2].y),this.ctx.lineTo(n[3].x,n[3].y),this.ctx.closePath(),this.ctx.fill(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(n[0].x,n[0].y),this.ctx.lineTo(n[1].x,n[1].y),this.ctx.lineTo(n[2].x,n[2].y),this.ctx.lineTo(n[3].x,n[3].y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(n[0].x,n[0].y),this.ctx.lineTo(n[1].x,n[1].y),this.ctx.stroke(),this.drawPoleIndicator(t,"N","#ff3838"),this.drawPoleIndicator(i,"S","#5352ed")}drawPoleIndicator(t,i,e){this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,8,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,8,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=1,this.ctx.fillText(i,t.x,t.y),this.ctx.shadowBlur=0}drawMagnetPole(t){this.ctx.shadowColor=t.pole==="north"?"rgba(255, 107, 107, 0.6)":"rgba(102, 126, 234, 0.6)",this.ctx.shadowBlur=12,this.ctx.beginPath(),this.ctx.fillStyle=t.pole==="north"?"rgba(255, 107, 107, 0.4)":"rgba(102, 126, 234, 0.4)",this.ctx.arc(t.x,t.y,18,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const s=this.ctx.createRadialGradient(t.x-6,t.y-6,0,t.x,t.y,12);t.pole==="north"?(s.addColorStop(0,"#ff6b6b"),s.addColorStop(.6,"#ff4757"),s.addColorStop(1,"#ff3838")):(s.addColorStop(0,"#667eea"),s.addColorStop(.6,"#5f6fd8"),s.addColorStop(1,"#5352ed")),this.ctx.beginPath(),this.ctx.fillStyle=s,this.ctx.arc(t.x,t.y,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(t.x+2,t.y+2,12,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(t.x-3,t.y-3,4,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=2,this.ctx.fillText(t.pole==="north"?"N":"S",t.x,t.y),this.ctx.shadowBlur=0}drawParticles(){this.particles.forEach(t=>{const i=this.calculateMagneticField(t.x,t.y),e=Math.sqrt(i.Bx*i.Bx+i.By*i.By);if(t.trail.length>1){this.ctx.beginPath();const o=this.ctx.createLinearGradient(t.trail[0].x,t.trail[0].y,t.x,t.y),h=Math.min(.8,.3+e*.5);t.charge>0?(o.addColorStop(0,`rgba(255, 100, 100, ${h*.3})`),o.addColorStop(1,`rgba(255, 100, 100, ${h})`)):(o.addColorStop(0,`rgba(100, 100, 255, ${h*.3})`),o.addColorStop(1,`rgba(100, 100, 255, ${h})`)),this.ctx.strokeStyle=o,this.ctx.lineWidth=2+e*2,this.ctx.lineCap="round",this.ctx.moveTo(t.trail[0].x,t.trail[0].y),t.trail.forEach(r=>{this.ctx.lineTo(r.x,r.y)}),this.ctx.stroke()}const s=5+e*3,a=this.ctx.createRadialGradient(t.x-s/2,t.y-s/2,0,t.x,t.y,s);t.charge>0?(a.addColorStop(0,"#ff8a65"),a.addColorStop(.7,"#ff6b6b"),a.addColorStop(1,"#ff4757")):(a.addColorStop(0,"#8b9dc3"),a.addColorStop(.7,"#667eea"),a.addColorStop(1,"#5f6fd8"));const n=Math.min(12,6+e*10);if(this.ctx.shadowColor=t.charge>0?"rgba(255, 107, 107, 0.8)":"rgba(102, 126, 234, 0.8)",this.ctx.shadowBlur=n,this.ctx.beginPath(),this.ctx.fillStyle=a,this.ctx.arc(t.x,t.y,s,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(t.x+1,t.y+1,s,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font=`bold ${12+e*4}px Inter, Arial, sans-serif`,this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t.charge>0?"+":"−",t.x,t.y),e>1){const o=Math.sqrt(t.vx*t.vx+t.vy*t.vy),h=Math.atan2(t.vy,t.vx);this.ctx.strokeStyle=t.charge>0?"#ff6b6b":"#667eea",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x+Math.cos(h)*o*.1,t.y+Math.sin(h)*o*.1),this.ctx.stroke()}})}drawInfo(){const e=this.ctx.canvas.width-200-20,s=20,a=this.ctx.createLinearGradient(e,s,e,s+120);a.addColorStop(0,"rgba(24, 28, 43, 0.95)"),a.addColorStop(1,"rgba(35, 41, 70, 0.95)"),this.ctx.fillStyle=a,this.ctx.fillRect(e,s,200,120),this.ctx.strokeStyle="rgba(255, 107, 107, 0.5)",this.ctx.lineWidth=1,this.ctx.strokeRect(e,s,200,120),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 18px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("Magnetic Field Analytics",e+15,s+25),this.ctx.fillStyle="#e9ecef",this.ctx.font="14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Magnets: ${this.magnets.length}`,e+15,s+45),this.ctx.fillText(`Particles: ${this.particles.length}`,e+15,s+65),this.ctx.fillText(`Field Strength: ${this.fieldStrength.toFixed(1)}`,e+15,s+85);const n=380,o=45,h=10,r=this.ctx.canvas.height-60,l=this.ctx.createLinearGradient(h,r,h,r+o);l.addColorStop(0,"rgba(255, 255, 255, 0.95)"),l.addColorStop(1,"rgba(240, 240, 240, 0.95)"),this.ctx.fillStyle=l,this.ctx.fillRect(h,r,n,o),this.ctx.strokeStyle="rgba(255, 107, 107, 0.6)",this.ctx.lineWidth=2,this.ctx.strokeRect(h,r,n,o),this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("Red particles = Positive charge, Blue particles = Negative charge",h+12,r+o/2-8),this.ctx.fillText("Click to add magnets, particles spiral around magnetic field lines",h+12,r+o/2+8)}getStats(){return{magnetCount:this.magnets.length,particleCount:this.particles.length,fieldStrength:this.fieldStrength.toFixed(1),time:this.time.toFixed(1)}}drawMagneticLabels(){this.ctx.save(),this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.lineWidth=3,this.ctx.strokeStyle="rgba(0,0,0,0.9)",this.ctx.fillStyle="#ffffff",this.ctx.strokeText("Magnetic Fields",this.ctx.canvas.width/2,30),this.ctx.fillText("Magnetic Fields",this.ctx.canvas.width/2,30),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.lineWidth=2,this.ctx.strokeStyle="rgba(0,0,0,0.8)",this.ctx.strokeText("F = q(v × B)  |  F = qvB sin θ  |  B = μ₀I/2πr",this.ctx.canvas.width/2,50),this.ctx.fillText("F = q(v × B)  |  F = qvB sin θ  |  B = μ₀I/2πr",this.ctx.canvas.width/2,50),this.ctx.shadowBlur=0,this.ctx.restore(),this.drawMagneticBanner()}drawMagneticBanner(){const s=this.ctx.canvas.height-75,a=this.ctx.createLinearGradient(15,s,15,s+60);a.addColorStop(0,"rgba(26, 26, 46, 0.95)"),a.addColorStop(1,"rgba(22, 33, 62, 0.95)"),this.ctx.fillStyle=a,this.ctx.fillRect(15,s,450,60),this.ctx.shadowColor="rgba(255, 107, 107, 0.3)",this.ctx.shadowBlur=2,this.ctx.strokeStyle="rgba(255, 107, 107, 0.6)",this.ctx.lineWidth=1,this.ctx.strokeRect(15,s,450,60),this.ctx.shadowBlur=0,this.ctx.fillStyle="#ffffff",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("Click to add complete magnets (N-S pairs)",30,s+60/2-10),this.ctx.font="12px Inter, Arial, sans-serif",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.fillText("Red particles = Positive charge, Blue particles = Negative charge",30,s+60/2+10);const n=415,o=s+60/2;this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 107, 107, 0.2)",this.ctx.arc(n,o,8,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="#ff6b6b",this.ctx.arc(n,o,4,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 10px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("N",n,o)}}class vt extends L{constructor(t){super(t),this.componentType="diode",this.biasType="forward",this.inputVoltage=5,this.baseVoltage=.7,this.current=0,this.power=0,this.temperature=25,this.showElectrons=!0,this.showCurrent=!0,this.showVoltage=!0,this.animationSpeed=1,this.isActive=!1,this.componentX=this.ctx.canvas.width/2,this.componentY=this.ctx.canvas.height/2,this.batteryX=this.componentX-250,this.batteryY=this.componentY,this.loadX=this.componentX+250,this.loadY=this.componentY,this.electrons=[],this.holes=[],this.sparks=[],this.energyWaves=[],this.initializeParticles(),this.glowIntensity=0,this.pulsePhase=0,this.energyParticles=[]}initializeParticles(){this.electrons=[],this.holes=[],this.sparks=[],this.energyWaves=[],this.energyParticles=[];for(let t=0;t<30;t++)this.electrons.push({x:this.componentX+50+Math.random()*100,y:this.componentY-40+Math.random()*80,vx:0,vy:0,size:3.5+Math.random()*1.2,color:"#00AAFF",glow:0,trail:[],active:!1});for(let t=0;t<30;t++)this.holes.push({x:this.componentX-150+Math.random()*100,y:this.componentY-40+Math.random()*80,vx:0,vy:0,size:3.5+Math.random()*1.2,color:"#FF4444",glow:0,trail:[],active:!1});for(let t=0;t<15;t++)this.energyParticles.push({x:this.componentX-100+Math.random()*200,y:this.componentY-60+Math.random()*120,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:1.8+Math.random()*.7,color:"#CC8F00",life:1,decay:.02})}setComponentType(t){this.componentType=t,this.initializeParticles(),this.calculateCurrent(),this.time=0}setBiasType(t){this.biasType=t,this.calculateCurrent(),this.time=0}setInputVoltage(t){this.inputVoltage=t,this.calculateCurrent(),this.time=0}setBaseVoltage(t){this.baseVoltage=t,this.calculateCurrent(),this.time=0}setShowElectrons(t){this.showElectrons=t}setShowCurrent(t){this.showCurrent=t}setShowVoltage(t){this.showVoltage=t}setAnimationSpeed(t){this.animationSpeed=t}calculateCurrent(){if(this.componentType==="diode")if(this.biasType==="forward"&&this.inputVoltage>.7){const t=this.inputVoltage-.7;this.current=Math.exp(t*2)*5,this.power=this.current*.7,this.isActive=!0,this.temperature=25+this.current*.5}else this.biasType==="reverse"?(this.current=.001,this.power=this.current*this.inputVoltage,this.isActive=!1,this.temperature=25):(this.current=0,this.power=0,this.isActive=!1,this.temperature=25);else if(this.componentType==="npn")if(this.biasType==="forward"&&this.baseVoltage>.7){const t=(this.baseVoltage-.7)*10,i=100;this.current=t*i,this.power=this.current*this.inputVoltage,this.isActive=!0,this.temperature=25+this.current*.3}else this.current=0,this.power=0,this.isActive=!1,this.temperature=25;else if(this.componentType==="pnp")if(this.biasType==="forward"&&this.baseVoltage>.7){const t=(this.baseVoltage-.7)*8,i=80;this.current=t*i,this.power=this.current*this.inputVoltage,this.isActive=!0,this.temperature=25+this.current*.4}else this.current=0,this.power=0,this.isActive=!1,this.temperature=25}reset(){this.time=0,this.current=0,this.power=0,this.isActive=!1,this.glowIntensity=0,this.pulsePhase=0,this.initializeParticles()}update(t){this.time+=t*this.animationSpeed,this.calculateCurrent(),this.glowIntensity=this.isActive?Math.sin(this.time*.005)*.3+.7:0,this.pulsePhase=this.time*.01,this.isActive&&this.showElectrons&&(this.componentType==="diode"?this.updateDiodeParticles():this.componentType==="npn"?this.updateNPNParticles():this.componentType==="pnp"&&this.updatePNPParticles()),this.energyParticles.forEach(i=>{i.x+=i.vx,i.y+=i.vy,i.life-=i.decay,(i.x<0||i.x>this.ctx.canvas.width)&&(i.vx*=-1),(i.y<0||i.y>this.ctx.canvas.height)&&(i.vy*=-1),i.life<=0&&(i.x=this.componentX-100+Math.random()*200,i.y=this.componentY-60+Math.random()*120,i.life=1)}),this.isActive&&this.current>10&&Math.random()<.1&&this.sparks.push({x:this.componentX+Math.random()*100-50,y:this.componentY+Math.random()*60-30,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:1,color:"#CC8F00"}),this.sparks.forEach((i,e)=>{i.x+=i.vx,i.y+=i.vy,i.life-=.05,i.life<=0&&this.sparks.splice(e,1)})}render(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawEnergyField(),this.drawBattery(),this.drawComponent(),this.drawLoad(),this.drawParticles(),this.drawSparks(),this.drawCurrentFlow(),this.drawInfo(),this.drawInstructions()}drawBackground(){}drawEnergyField(){if(this.isActive){const t=this.time*.001;for(let i=0;i<3;i++){const e=120+i*30,s=this.glowIntensity*.2/(i+1),a=Math.sin(t*5+i)*.1,n=this.ctx.createRadialGradient(this.componentX,this.componentY,0,this.componentX,this.componentY,e);n.addColorStop(0,`rgba(0, 255, 255, ${s+a})`),n.addColorStop(.7,`rgba(0, 255, 255, ${s*.3})`),n.addColorStop(1,"rgba(0, 255, 255, 0)"),this.ctx.fillStyle=n,this.ctx.fillRect(this.componentX-e,this.componentY-e,e*2,e*2)}for(let i=0;i<5;i++){const e=50+i*20+Math.sin(t*3+i)*10,s=(.3-i*.05)*this.glowIntensity;this.ctx.strokeStyle=`rgba(0, 255, 255, ${s})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.componentX,this.componentY,e,0,Math.PI*2),this.ctx.stroke()}}}drawBattery(){const t=this.time*.001,i=this.isActive?`rgba(46, 139, 87, ${.85+this.glowIntensity*.15})`:"#2E8B57";this.ctx.fillStyle=i,this.ctx.fillRect(this.batteryX-25,this.batteryY-35,50,70),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+Math.sin(t*2)*.1})`,this.ctx.fillRect(this.batteryX-20,this.batteryY-30,40,5),this.ctx.fillStyle="#888",this.ctx.fillRect(this.batteryX-8,this.batteryY-45,16,12),this.ctx.fillRect(this.batteryX-8,this.batteryY+33,16,12),this.ctx.fillStyle="rgba(255, 255, 255, 0.5)",this.ctx.fillRect(this.batteryX-6,this.batteryY-43,12,3),this.ctx.fillRect(this.batteryX-6,this.batteryY+35,12,3);const e=this.isActive?Math.sin(t*3)*.3+.7:.7;this.ctx.fillStyle=this.isActive?`rgba(204, 143, 0, ${e})`:"#111",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.inputVoltage}V`,this.batteryX,this.batteryY+60),this.ctx.fillStyle=this.isActive?`rgba(255, 102, 102, ${.8+this.glowIntensity})`:"#FF6666",this.ctx.font="bold 20px Arial",this.ctx.fillText("+",this.batteryX-20,this.batteryY-5),this.ctx.fillStyle=this.isActive?`rgba(102, 102, 255, ${.8+this.glowIntensity})`:"#6666FF",this.ctx.fillText("-",this.batteryX+20,this.batteryY+15),this.isActive&&(this.ctx.fillStyle=`rgba(46, 139, 87, ${.5+this.glowIntensity*.5})`,this.ctx.beginPath(),this.ctx.arc(this.batteryX,this.batteryY,30,0,Math.PI*2),this.ctx.stroke())}drawComponent(){this.componentType==="diode"?this.drawDiode():this.drawTransistor()}drawDiode(){const t=this.time*.001,i=this.componentX,e=this.componentY,s=40,a=this.biasType==="forward",n=this.biasType==="reverse",o=this.isActive?this.glowIntensity:0,h=Math.sin(t*3)*.2,r=a?"#2EEA6A":n?"#FF3B3B":"#CC8F00",l=a?o*(1+h):n?o*.3:0;this.ctx.shadowColor=this.isActive?r:"transparent",this.ctx.shadowBlur=this.isActive?15+l*10:0;const c=this.isActive?`rgba(204, 143, 0, ${.9+l})`:"#333333";this.ctx.fillStyle=c,this.ctx.beginPath(),this.ctx.moveTo(i-s,e),this.ctx.lineTo(i-s/3,e-s/2),this.ctx.lineTo(i-s/3,e+s/2),this.ctx.closePath(),this.ctx.fill(),this.isActive&&(this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+h})`,this.ctx.beginPath(),this.ctx.moveTo(i-s+5,e-s/3),this.ctx.lineTo(i-s/3,e),this.ctx.lineTo(i-s+5,e+s/3),this.ctx.closePath(),this.ctx.fill()),this.ctx.strokeStyle=c,this.ctx.lineWidth=8,this.ctx.beginPath(),this.ctx.moveTo(i+s/3,e-s/2),this.ctx.lineTo(i+s/3,e+s/2),this.ctx.stroke(),this.ctx.strokeStyle=c,this.ctx.lineWidth=6,this.ctx.beginPath(),this.ctx.moveTo(i-s-25,e),this.ctx.lineTo(i-s,e),this.ctx.moveTo(i+s/3+25,e),this.ctx.lineTo(i+s/3,e),this.ctx.stroke(),this.ctx.shadowBlur=0,this.drawComponentLabel("DIODE",i,e+s+35,t),this.drawBiasIndicator(this.biasType,i,e-s-25,l),this.isActive&&(a?(this.drawCurrentFlow(i-s-45,i+s/3+45,e,e,"forward",o),this.drawVoltageDrop(i,e-s/2-15,"0.7V",o)):n&&(this.drawCurrentFlow(i-s-45,i+s/3+45,e,e,"reverse",o),this.drawVoltageDrop(i,e-s/2-15,"BLOCKED",o))),this.isActive&&a&&(this.ctx.fillStyle=`rgba(46, 139, 87, ${.25+h*.8})`,this.ctx.beginPath(),this.ctx.arc(i-s/3,e,8,0,Math.PI*2),this.ctx.fill())}drawTransistor(){const t=this.time*.001,i=this.componentX,e=this.componentY,s=35,a=25,n=this.biasType==="forward",o=this.biasType==="reverse",h=this.isActive?this.glowIntensity:0,r=Math.sin(t*3)*.2,l=n?"#2EEA6A":o?"#FF3B3B":"#CC8F00",c=n?h*(1+r):o?h*.3:0;this.ctx.shadowColor=this.isActive?l:"transparent",this.ctx.shadowBlur=this.isActive?15+c*10:0;const g=this.isActive?`rgba(204, 143, 0, ${.9+c})`:"#333333";if(this.ctx.strokeStyle=g,this.ctx.lineWidth=6,this.ctx.beginPath(),this.ctx.arc(i,e,s,0,2*Math.PI),this.ctx.stroke(),this.isActive&&(this.ctx.fillStyle=`rgba(204, 143, 0, ${.1+r})`,this.ctx.beginPath(),this.ctx.arc(i,e,s-2,0,2*Math.PI),this.ctx.fill()),this.ctx.lineWidth=6,this.drawTransistorLeads(i,e,s,a,g),this.drawEmitterArrow(i,e,s,g),this.drawLeadLabels(i,e,s,a,g),this.ctx.shadowBlur=0,this.drawComponentLabel(this.componentType.toUpperCase(),i,e+s+a+55,t),this.drawBiasIndicator(this.biasType,i,e-s-a-35,c),this.isActive&&(n?this.componentType==="npn"?(this.drawCurrentFlow(i,i,e+s+a+25,e-s-a-25,"forward",h),this.drawVoltageDrop(i,e-s-15,"Vbe: 0.7V",h),this.drawVoltageDrop(i,e+s+15,"Vce: 0.2V",h)):this.componentType==="pnp"&&(this.drawCurrentFlow(i,i,e-s-a-25,e+s+a+25,"forward",h),this.drawVoltageDrop(i,e-s-15,"Vbe: -0.7V",h),this.drawVoltageDrop(i,e+s+15,"Vce: -0.2V",h)):o&&(this.drawCurrentFlow(i,i,e-s-a-25,e+s+a+25,"reverse",h),this.drawVoltageDrop(i,e-s-15,"BLOCKED",h))),this.isActive&&n){const x=this.componentType==="npn"?`rgba(0, 255, 255, ${.5+r})`:`rgba(255, 100, 100, ${.5+r})`;this.ctx.strokeStyle=x,this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]),this.ctx.beginPath(),this.ctx.moveTo(i-s-a-10,e),this.ctx.lineTo(i-s,e),this.ctx.stroke(),this.ctx.setLineDash([])}if(this.isActive){const x=this.componentType==="npn"?"#008EDA":"#FF3B3B";this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(i-30,e-s-45,60,20),this.ctx.fillStyle=x,this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText(this.componentType.toUpperCase(),i,e-s-35)}}drawComponentLabel(t,i,e,s){const a=this.isActive?Math.sin(s*2)*.3+.7:.7;this.ctx.fillStyle=this.isActive?`rgba(204, 143, 0, ${a})`:"#111",this.ctx.font="bold 18px Arial",this.ctx.textAlign="center",this.ctx.fillText(t,i,e)}drawBiasIndicator(t,i,e,s){const a=t.toUpperCase(),n=t==="forward"?"#2EEA6A":t==="reverse"?"#FF3B3B":"#CC8F00";this.ctx.fillStyle=this.isActive?`rgba(46, 139, 87, ${.85+s*.5})`:n,this.ctx.font="bold 14px Arial",this.ctx.fillText(a,i,e)}drawCurrentFlow(t,i,e,s,a,n){const o=a==="forward",h=o?`rgba(0, 255, 255, ${n})`:`rgba(255, 0, 0, ${n*.5})`,r=o?[5,5]:[3,3];this.ctx.strokeStyle=h,this.ctx.lineWidth=2,this.ctx.setLineDash(r),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.stroke(),this.ctx.setLineDash([])}drawTransistorLeads(t,i,e,s,a){this.ctx.strokeStyle=a,this.ctx.beginPath(),this.ctx.moveTo(t,i-e),this.ctx.lineTo(t,i-e-s),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-e,i),this.ctx.lineTo(t-e-s,i),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t,i+e),this.ctx.lineTo(t,i+e+s),this.ctx.stroke()}drawEmitterArrow(t,i,e,s){this.ctx.fillStyle=s,this.componentType==="npn"?(this.ctx.beginPath(),this.ctx.moveTo(t-8,i+e-15),this.ctx.lineTo(t+8,i+e-15),this.ctx.lineTo(t,i+e-5),this.ctx.closePath(),this.ctx.fill()):this.componentType==="pnp"&&(this.ctx.beginPath(),this.ctx.moveTo(t-8,i+e+5),this.ctx.lineTo(t+8,i+e+5),this.ctx.lineTo(t,i+e+15),this.ctx.closePath(),this.ctx.fill())}drawLeadLabels(t,i,e,s,a){this.ctx.fillStyle=a,this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("C",t,i-e-s-10),this.ctx.fillText("B",t-e-s-10,i),this.ctx.fillText("E",t,i+e+s+20)}drawVoltageDrop(t,i,e,s){this.ctx.fillStyle=`rgba(204, 143, 0, ${.8+s})`,this.ctx.font="bold 10px Arial",this.ctx.textAlign="center",this.ctx.fillText(e,t,i)}updateDiodeParticles(){this.electrons.forEach((t,i)=>{this.biasType==="forward"?(t.vx=-3+Math.sin(this.time*.02+i*.5)*1.5,t.vy=Math.sin(this.time*.03+i)*.5,t.x+=t.vx,t.y+=t.vy,t.glow=Math.sin(this.time*.1+i)*.5+.5,t.trail.push({x:t.x,y:t.y,alpha:1}),t.trail.length>5&&t.trail.shift(),t.x<this.componentX-200&&(t.x=this.componentX+100,t.y=this.componentY-40+Math.random()*80)):this.biasType==="reverse"?(t.vx=.1+Math.sin(this.time*.01+i*.5)*.05,t.vy=Math.sin(this.time*.02+i)*.1,t.x+=t.vx,t.y+=t.vy,t.glow=.1,t.trail.push({x:t.x,y:t.y,alpha:.3}),t.trail.length>3&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):(t.vx=0,t.vy=0,t.glow=0,t.trail=[])}),this.holes.forEach((t,i)=>{this.biasType==="forward"?(t.vx=2.5+Math.sin(this.time*.02+i*.5)*1.2,t.vy=Math.sin(this.time*.03+i)*.5,t.x+=t.vx,t.y+=t.vy,t.glow=Math.sin(this.time*.1+i)*.5+.5,t.trail.push({x:t.x,y:t.y,alpha:1}),t.trail.length>5&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):this.biasType==="reverse"?(t.vx=.1+Math.sin(this.time*.01+i*.5)*.05,t.vy=Math.sin(this.time*.02+i)*.1,t.x+=t.vx,t.y+=t.vy,t.glow=.1,t.trail.push({x:t.x,y:t.y,alpha:.3}),t.trail.length>3&&t.trail.shift(),t.x>this.componentX+200&&(t.x=this.componentX-100,t.y=this.componentY-40+Math.random()*80)):(t.vx=0,t.vy=0,t.glow=0,t.trail=[])})}updateNPNParticles(){const t=Math.max(0,(this.baseVoltage-.7)/.3),i=1+t*2;this.electrons.forEach((e,s)=>{this.biasType==="forward"&&this.baseVoltage>.7?(e.vx=Math.sin(this.time*.02+s*.5)*1*i,e.vy=(-4+Math.sin(this.time*.03+s)*1)*i,e.x+=e.vx,e.y+=e.vy,e.glow=(Math.sin(this.time*.1+s)*.5+.5)*(.5+t*.5),e.trail.push({x:e.x,y:e.y,alpha:1}),e.trail.length>8&&e.trail.shift(),e.y<this.componentY-150&&(e.x=this.componentX-40+Math.random()*80,e.y=this.componentY+100)):(e.vx=0,e.vy=0,e.glow=0,e.trail=[])}),this.holes.forEach((e,s)=>{e.vx=0,e.vy=0,e.glow=0,e.trail=[]})}updatePNPParticles(){const t=Math.max(0,(this.baseVoltage-.7)/.3),i=1+t*2;this.holes.forEach((e,s)=>{this.biasType==="forward"&&this.baseVoltage>.7?(e.vx=Math.sin(this.time*.02+s*.5)*1*i,e.vy=(4+Math.sin(this.time*.03+s)*1)*i,e.x+=e.vx,e.y+=e.vy,e.glow=(Math.sin(this.time*.1+s)*.5+.5)*(.5+t*.5),e.trail.push({x:e.x,y:e.y,alpha:1}),e.trail.length>8&&e.trail.shift(),e.y>this.componentY+150&&(e.x=this.componentX-40+Math.random()*80,e.y=this.componentY-100)):(e.vx=0,e.vy=0,e.glow=0,e.trail=[])}),this.electrons.forEach((e,s)=>{e.vx=0,e.vy=0,e.glow=0,e.trail=[]})}drawLoad(){const t=this.time*.001,i=this.isActive?this.glowIntensity:0,e=this.isActive?Math.sin(t*3)*.1:0,s=this.isActive?`rgba(204, 143, 0, ${.85+i*.15+e})`:"#666";if(this.isActive&&(this.ctx.shadowColor="#CC8F00",this.ctx.shadowBlur=30+this.glowIntensity*20,this.ctx.fillStyle=`rgba(204, 143, 0, ${.3+this.glowIntensity*.2})`,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,45,0,2*Math.PI),this.ctx.fill(),this.ctx.shadowBlur=0),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,35,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.4+Math.sin(t*2)*.1})`,this.ctx.beginPath(),this.ctx.arc(this.loadX-10,this.loadY-15,8,0,Math.PI),this.ctx.fill(),this.ctx.fillStyle="#444",this.ctx.fillRect(this.loadX-18,this.loadY+35,36,25),this.ctx.fillStyle=`rgba(255, 255, 255, ${.3+Math.sin(t*2)*.1})`,this.ctx.fillRect(this.loadX-15,this.loadY+37,30,5),this.ctx.strokeStyle=this.isActive?`rgba(255, 170, 0, ${.8+this.glowIntensity})`:"#999",this.ctx.lineWidth=3,this.ctx.shadowColor=this.isActive?"#FFAA00":"transparent",this.ctx.shadowBlur=this.isActive?5:0,this.ctx.beginPath(),this.ctx.moveTo(this.loadX-12,this.loadY),this.ctx.lineTo(this.loadX+12,this.loadY),this.ctx.stroke(),this.isActive){const n=Math.sin(t*4)*.2+.8;this.ctx.strokeStyle=`rgba(255, 170, 0, ${.8+this.glowIntensity*n})`,this.ctx.beginPath(),this.ctx.moveTo(this.loadX-8,this.loadY-5),this.ctx.lineTo(this.loadX+8,this.loadY-5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.loadX-8,this.loadY+5),this.ctx.lineTo(this.loadX+8,this.loadY+5),this.ctx.stroke()}this.ctx.shadowBlur=0;const a=this.isActive?Math.sin(t*2)*.3+.7:.7;if(this.ctx.fillStyle=this.isActive?`rgba(204, 143, 0, ${a})`:"#111",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.fillText("LOAD",this.loadX,this.loadY+80),this.isActive){this.ctx.fillStyle=`rgba(46, 139, 87, ${.85+this.glowIntensity*.5})`,this.ctx.font="bold 12px Arial",this.ctx.fillText(`${this.power.toFixed(1)}mW`,this.loadX,this.loadY-60);for(let n=0;n<3;n++){const o=50+n*15+Math.sin(t*2+n)*5,h=(.2-n*.05)*this.glowIntensity;this.ctx.strokeStyle=`rgba(204, 143, 0, ${h})`,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(this.loadX,this.loadY,o,0,Math.PI*2),this.ctx.stroke()}}}drawParticles(){if(!this.showElectrons)return;const t=this.time*.001;this.electrons.forEach(i=>{i.trail.length>0&&i.trail.forEach((e,s)=>{const a=e.alpha*(s/i.trail.length)*.6,n=Math.sin(t*4+s)*.2+.8;this.ctx.fillStyle=`rgba(0, 170, 255, ${a*n})`,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i.size*.6,0,Math.PI*2),this.ctx.fill()})}),this.holes.forEach(i=>{i.trail.length>0&&i.trail.forEach((e,s)=>{const a=e.alpha*(s/i.trail.length)*.6,n=Math.sin(t*4+s)*.2+.8;this.ctx.strokeStyle=`rgba(255, 68, 68, ${a*n})`,this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i.size*.6,0,Math.PI*2),this.ctx.stroke()})}),this.electrons.forEach(i=>{const e=i.glow*.4,s=Math.sin(t*3+i.x*.01)*.3+.7;this.ctx.shadowColor="#00AAFF",this.ctx.shadowBlur=e*15,this.ctx.fillStyle=`rgba(0, 170, 255, ${.8*s})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size*1.2,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.fillStyle=i.color,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 255, 255, ${.6*s})`,this.ctx.beginPath(),this.ctx.arc(i.x-2,i.y-2,i.size*.3,0,Math.PI*2),this.ctx.fill()}),this.holes.forEach(i=>{const e=i.glow*.4,s=Math.sin(t*3+i.x*.01)*.3+.7;this.ctx.shadowColor="#FF4444",this.ctx.shadowBlur=e*8,this.ctx.strokeStyle=i.color,this.ctx.lineWidth=.5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle=`rgba(255, 68, 68, ${.3*s})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size*.2,0,Math.PI*2),this.ctx.fill()}),this.energyParticles.forEach(i=>{const e=Math.sin(t*5+i.x*.01)*.3+.7;this.ctx.fillStyle=`rgba(204, 143, 0, ${i.life*e})`,this.ctx.shadowColor="#CC8F00",this.ctx.shadowBlur=i.life*10,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,i.size,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0})}drawSparks(){this.sparks.forEach(t=>{this.ctx.fillStyle=`rgba(204, 143, 0, ${t.life})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()})}drawCurrentFlow(){if(!this.showCurrent||!this.isActive)return;const t=this.time*.001;this.ctx.strokeStyle=`rgba(204, 143, 0, ${.85+this.glowIntensity*.5})`,this.ctx.lineWidth=4,this.ctx.setLineDash([15,8]),this.ctx.shadowColor="#CC8F00",this.ctx.shadowBlur=10+this.glowIntensity*10;const i=Math.sin(t*3)*5;this.ctx.setLineDash([15+i,8-i]),this.ctx.beginPath(),this.ctx.moveTo(this.batteryX+25,this.batteryY),this.ctx.lineTo(this.componentX-90,this.componentY),this.ctx.stroke(),this.ctx.setLineDash([15-i,8+i]),this.ctx.beginPath(),this.ctx.moveTo(this.componentX+90,this.componentY),this.ctx.lineTo(this.loadX-35,this.loadY),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.shadowBlur=0;const e=Math.sin(t*2)*5,s=Math.sin(t*4)*.3+.7;this.drawArrow(this.batteryX+35+e,this.batteryY,12,0,`rgba(204, 143, 0, ${s})`),this.drawArrow(this.componentX+100+e,this.componentY,12,0,`rgba(204, 143, 0, ${s})`);const n=Math.min(this.current/20,1)*(.3+Math.sin(t*5)*.1);this.ctx.fillStyle=`rgba(204, 143, 0, ${n})`,this.ctx.fillRect(this.componentX-100,this.componentY-10,200,20);for(let o=0;o<5;o++){const h=(t*.5+o*.2)%1,r=this.batteryX+25+(this.componentX-90-this.batteryX-25)*h,l=this.batteryY+Math.sin(t*3+o)*3;this.ctx.fillStyle=`rgba(204, 143, 0, ${.6+Math.sin(t*4+o)*.2})`,this.ctx.beginPath(),this.ctx.arc(r,l,2,0,Math.PI*2),this.ctx.fill()}}drawArrow(t,i,e,s,a){this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t-16,i-8),this.ctx.lineTo(t-16,i+8),this.ctx.closePath(),this.ctx.fill()}drawInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,200),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("🔌 Diode & Transistor",20,30),this.ctx.font="14px Arial",this.ctx.fillText(`Component: ${this.componentType.toUpperCase()}`,20,50),this.ctx.fillText(`Bias: ${this.biasType.toUpperCase()}`,20,70),this.ctx.fillText(`Input Voltage: ${this.inputVoltage}V`,20,90),(this.componentType==="npn"||this.componentType==="pnp")&&this.ctx.fillText(`Base Voltage: ${this.baseVoltage}V`,20,110),this.ctx.fillText(`Current: ${this.current.toFixed(1)}mA`,20,130),this.ctx.fillText(`Power: ${this.power.toFixed(1)}mW`,20,150),this.ctx.fillText(`Status: ${this.isActive?"ACTIVE":"INACTIVE"}`,20,170),this.ctx.fillText(`Temperature: ${this.temperature}°C`,20,190)}drawInstructions(){this.ctx.fillStyle="rgba(0, 0, 0, 0.85)",this.ctx.fillRect(this.ctx.canvas.width-320,10,310,180),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("🔌 Particle Legend:",this.ctx.canvas.width-310,30),this.ctx.font="bold 14px Arial",this.ctx.fillStyle="#008EDA",this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,50,2.5,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Electrons (filled circle)",this.ctx.canvas.width-285,55),this.ctx.strokeStyle="#FF4444",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,70,2.5,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Holes (empty circle)",this.ctx.canvas.width-285,75),this.ctx.fillStyle="#CC8F00",this.ctx.beginPath(),this.ctx.arc(this.ctx.canvas.width-300,90,2.5,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Energy Carriers",this.ctx.canvas.width-285,95),this.ctx.fillStyle="#CC8F00",this.ctx.beginPath(),this.ctx.moveTo(this.ctx.canvas.width-300,110),this.ctx.lineTo(this.ctx.canvas.width-290,110),this.ctx.lineTo(this.ctx.canvas.width-292,108),this.ctx.lineTo(this.ctx.canvas.width-290,110),this.ctx.lineTo(this.ctx.canvas.width-292,112),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="12px Arial",this.ctx.fillText("Current Flow",this.ctx.canvas.width-285,115),this.ctx.fillStyle="white",this.ctx.font="bold 12px Arial",this.ctx.fillText("💡 Behavior:",this.ctx.canvas.width-310,140),this.ctx.font="11px Arial",this.componentType==="diode"?(this.ctx.fillText("• Forward bias: Electrons flow, light on",this.ctx.canvas.width-310,155),this.ctx.fillText("• Reverse bias: No flow, light off",this.ctx.canvas.width-310,170)):(this.ctx.fillText("• Base controls collector current",this.ctx.canvas.width-310,155),this.ctx.fillText("• Small base = Large collector",this.ctx.canvas.width-310,170))}getStats(){return{componentType:this.componentType,biasType:this.biasType,inputVoltage:this.inputVoltage,baseVoltage:this.baseVoltage,current:this.current,power:this.power,temperature:this.temperature,isActive:this.isActive,time:this.time}}}class bt extends L{constructor(t){super(t),this.animationType="wave-particle-duality",this.canvas=t.canvas,this.mode="wave",this.photonEnergy=5,this.wavelength=150,this.speed=1,this.waveFunction=[],this.amplitude=50,this.frequency=1,this.phase=0,this.wavePhase=0,this.particleX=100,this.particleY=300,this.particleVelocity={x:8,y:0},this.particleSize=8,this.slits=[{x:400,y:250,width:20,height:100},{x:400,y:350,width:20,height:100}],this.interferencePattern=[],this.screenX=600,this.measurementCount=0,this.measurementResults=[],this.showMeasurement=!1,this.showWaveFunction=!0,this.showParticlePosition=!0,this.showInterference=!0,this.showMeasurementEffect=!1,this.initializeWaveFunction(),this.initializeInterferencePattern()}setMode(t){this.mode=t,this.reset()}setSpeed(t){this.speed=t}setPhotonEnergy(t){this.photonEnergy=t,this.wavelength=1240/t,this.initializeWaveFunction(),this.initializeInterferencePattern()}setWavelength(t){this.wavelength=t,this.photonEnergy=1240/t,this.initializeWaveFunction(),this.initializeInterferencePattern()}setShowWaveFunction(t){this.showWaveFunction=t}setShowParticlePosition(t){this.showParticlePosition=t}setShowInterference(t){this.showInterference=t}setShowMeasurementEffect(t){this.showMeasurementEffect=t}performMeasurement(){this.measurementCount++,this.showMeasurement=!0,this.mode==="superposition"&&(Math.random()<.5?this.mode="particle":this.mode="wave"),this.measurementResults.push({time:this.time,mode:this.mode,position:{x:this.particleX,y:this.particleY}}),this.showMeasurementEffect=!0,setTimeout(()=>{this.showMeasurement=!1,this.showMeasurementEffect=!1},3e3)}reset(){this.time=0,this.phase=0,this.wavePhase=0,this.particleX=100,this.particleY=300,this.measurementCount=0,this.measurementResults=[],this.showMeasurement=!1,this.initializeWaveFunction(),this.initializeInterferencePattern()}initializeWaveFunction(){this.waveFunction=[];const t=150;for(let i=0;i<t;i++){const e=i/t*this.canvas.width,s=this.amplitude*Math.sin(2*Math.PI*e/this.wavelength+this.phase),a=this.canvas.height/2+s;this.waveFunction.push({x:e,y:a})}}initializeInterferencePattern(){this.interferencePattern=[];const t=300,i=this.canvas.height/2,e=390,s=410,a=300,n=this.screenX;for(let o=0;o<t;o+=8){const h=i-t/2+o;let r=0;const l=Math.sqrt(Math.pow(n-e,2)+Math.pow(h-a,2)),c=Math.sqrt(Math.pow(n-s,2)+Math.pow(h-a,2)),g=c-l,x=2*Math.PI*g/this.wavelength,u=1/Math.sqrt(l),f=1/Math.sqrt(c),p=u+f*Math.cos(x);r=Math.abs(p),this.interferencePattern.push({x:n,y:h,intensity:r})}}update(t){const i=t/1e3*this.speed*5;this.time+=i,this.phase+=i*this.frequency,(this.mode==="wave"||this.mode==="superposition")&&this.waveFunction.forEach((e,s)=>{const a=e.x;if(a>=380&&a<=420){const r=Math.abs(a-390),l=Math.abs(a-410);if(r<10/2||l<10/2){const c=this.amplitude*Math.sin(2*Math.PI*a/this.wavelength-this.phase);e.y=this.canvas.height/2+c}else e.y=-1e3}else{const n=this.amplitude*Math.sin(2*Math.PI*a/this.wavelength-this.phase);e.y=this.canvas.height/2+n}}),(this.mode==="particle"||this.mode==="superposition")&&(this.particleX+=this.particleVelocity.x*i,this.particleY=300+Math.sin(this.time*3)*20,this.particleX>this.screenX-50&&(this.particleX=100)),this.showInterference&&(this.mode==="wave"||this.mode==="superposition")&&Math.floor(this.time*10)%3===0&&this.initializeInterferencePattern(),(this.mode==="wave"||this.mode==="superposition")&&(this.wavePhase+=i*2)}render(){switch(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.drawSlits(),this.drawDetectionScreen(),this.mode){case"wave":this.renderWaveMode();break;case"particle":this.renderParticleMode();break;case"superposition":this.renderSuperpositionMode();break;case"measurement":this.renderMeasurementMode();break}this.showInterference&&(this.mode==="wave"||this.mode==="superposition")&&this.drawInterferencePattern(),this.showMeasurement&&this.drawMeasurementEffect(),this.drawQuantumLabels(),this.drawDescriptiveLabels()}drawGrid(){this.ctx.strokeStyle="rgba(100, 100, 100, 0.15)",this.ctx.lineWidth=.8,this.ctx.setLineDash([8,8]);for(let t=0;t<this.canvas.width;t+=100)this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,this.canvas.height),this.ctx.stroke();for(let t=0;t<this.canvas.height;t+=100)this.ctx.beginPath(),this.ctx.moveTo(0,t),this.ctx.lineTo(this.canvas.width,t),this.ctx.stroke();this.ctx.setLineDash([]),this.ctx.fillStyle="rgba(138, 43, 226, 0.03)";for(let t=0;t<this.canvas.width;t+=120)for(let i=0;i<this.canvas.height;i+=120){const e=Math.sin(this.time*.3+t*.01+i*.01)*.5+.5;this.ctx.globalAlpha=e*.08,this.ctx.beginPath(),this.ctx.arc(t,i,25,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}drawSlits(){const t=this.ctx.createLinearGradient(380,0,420,0);t.addColorStop(0,"#1a1a2e"),t.addColorStop(.3,"#16213e"),t.addColorStop(.7,"#0f3460"),t.addColorStop(1,"#1a1a2e"),this.ctx.fillStyle=t,this.ctx.fillRect(380,0,40,this.canvas.height),this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=8,this.ctx.shadowOffsetX=3,this.ctx.fillRect(380,0,40,this.canvas.height),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.clearRect(385,200,10,200),this.ctx.clearRect(405,200,10,200),this.ctx.strokeStyle="#0a0a0a",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.moveTo(385,200),this.ctx.lineTo(385,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(395,200),this.ctx.lineTo(395,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(405,200),this.ctx.lineTo(405,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(415,200),this.ctx.lineTo(415,400),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(386,200),this.ctx.lineTo(386,400),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(414,200),this.ctx.lineTo(414,400),this.ctx.stroke(),this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Barrier",400,190),this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(350,300),this.ctx.lineTo(380,300),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(375,295),this.ctx.lineTo(380,300),this.ctx.lineTo(375,305),this.ctx.closePath(),this.ctx.fillStyle="#4CAF50",this.ctx.fill(),this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Wave",365,290)}drawDetectionScreen(){const t=Math.sin(this.time*2)*.3+.7,i=this.ctx.createLinearGradient(this.screenX-8,150,this.screenX+8,450);if(i.addColorStop(0,`rgba(200, 200, 255, ${.7*t})`),i.addColorStop(.5,`rgba(180, 180, 255, ${.8*t})`),i.addColorStop(1,`rgba(200, 200, 255, ${.7*t})`),this.ctx.fillStyle=i,this.ctx.fillRect(this.screenX-8,150,16,300),this.ctx.shadowColor="rgba(0, 102, 204, 0.5)",this.ctx.shadowBlur=6,this.ctx.strokeStyle="#0066cc",this.ctx.lineWidth=4,this.ctx.strokeRect(this.screenX-8,150,16,300),this.ctx.shadowBlur=0,this.mode==="wave"||this.mode==="superposition"){const e=Math.sin(this.time*4)*.4+.6;this.ctx.fillStyle=`rgba(100, 150, 255, ${e*.4})`,this.ctx.fillRect(this.screenX-10,150,20,300)}this.ctx.fillStyle="#1a1a2e",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Detection Screen",this.screenX,145),this.ctx.strokeStyle="rgba(0, 102, 204, 0.6)",this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let e=0;e<6;e++){const s=170+e*45;this.ctx.beginPath(),this.ctx.moveTo(this.screenX-8,s),this.ctx.lineTo(this.screenX+8,s),this.ctx.stroke()}}renderWaveMode(){if(!this.showWaveFunction)return;this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath();let t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];if(e.x<380)t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0);else break}this.ctx.stroke(),this.ctx.beginPath(),t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];e.x>420&&(t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0))}this.ctx.stroke(),this.ctx.shadowBlur=0;for(let i=0;i<this.waveFunction.length;i+=5){const e=this.waveFunction[i],s=this.ctx.createRadialGradient(e.x-2,e.y-2,0,e.x,e.y,4);s.addColorStop(0,"#6BCF7F"),s.addColorStop(.7,"#4CAF50"),s.addColorStop(1,"#2E7D32"),this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,4,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=3,this.ctx.lineCap="round";for(let i=0;i<3;i++){const e=150+i*120;this.ctx.beginPath(),this.ctx.moveTo(e,350),this.ctx.lineTo(e+25,350),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e+18,345),this.ctx.lineTo(e+25,350),this.ctx.lineTo(e+18,355),this.ctx.closePath(),this.ctx.fillStyle="#4CAF50",this.ctx.fill()}}renderWaveModeWithoutLabel(){if(!this.showWaveFunction)return;this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=3,this.ctx.beginPath();let t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];if(e.x<380)t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0);else break}this.ctx.stroke(),this.ctx.beginPath(),t=!1;for(let i=0;i<this.waveFunction.length;i++){const e=this.waveFunction[i];e.x>420&&(t?this.ctx.lineTo(e.x,e.y):(this.ctx.moveTo(e.x,e.y),t=!0))}this.ctx.stroke(),this.ctx.fillStyle="#4CAF50";for(let i=0;i<this.waveFunction.length;i+=5){const e=this.waveFunction[i];this.ctx.beginPath(),this.ctx.arc(e.x,e.y,3,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=2;for(let i=0;i<3;i++){const e=150+i*120;this.ctx.beginPath(),this.ctx.moveTo(e,350),this.ctx.lineTo(e+20,350),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e+15,345),this.ctx.lineTo(e+20,350),this.ctx.lineTo(e+15,355),this.ctx.stroke()}}renderParticleMode(){if(!this.showParticlePosition)return;this.ctx.shadowColor="#FF5722",this.ctx.shadowBlur=10;const t=this.ctx.createRadialGradient(this.particleX-3,this.particleY-3,0,this.particleX,this.particleY,this.particleSize);t.addColorStop(0,"#FF8A65"),t.addColorStop(.7,"#FF5722"),t.addColorStop(1,"#D84315"),this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const i=this.ctx.createLinearGradient(this.particleX-50,this.particleY,this.particleX+50,this.particleY);i.addColorStop(0,"rgba(255, 87, 34, 0.3)"),i.addColorStop(.5,"rgba(255, 87, 34, 0.6)"),i.addColorStop(1,"rgba(255, 87, 34, 0.3)"),this.ctx.strokeStyle=i,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.particleX-50,this.particleY),this.ctx.lineTo(this.particleX+50,this.particleY),this.ctx.stroke()}renderParticleModeWithoutLabel(){this.showParticlePosition&&(this.ctx.fillStyle="#FF5722",this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,this.particleSize,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 87, 34, 0.5)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.particleX-50,this.particleY),this.ctx.lineTo(this.particleX+50,this.particleY),this.ctx.stroke())}renderSuperpositionMode(){this.renderWaveModeWithoutLabel(),this.renderParticleModeWithoutLabel()}renderMeasurementMode(){this.renderParticleModeWithoutLabel(),this.ctx.strokeStyle="#FF9800",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(this.particleX,this.particleY-30),this.ctx.lineTo(this.particleX,this.particleY+30),this.ctx.stroke()}drawInterferencePattern(){this.ctx.shadowColor="#9C27B0",this.ctx.shadowBlur=6;for(let i=0;i<this.interferencePattern.length;i++){const e=this.interferencePattern[i],s=Math.min(e.intensity*3,1),a=this.time*2+i*.1,n=s*(.7+.3*Math.sin(a));if(s>.2){const h=this.ctx.createRadialGradient(e.x,e.y,0,e.x,e.y,8);h.addColorStop(0,`rgba(156, 39, 176, ${n})`),h.addColorStop(.7,`rgba(123, 31, 162, ${n*.8})`),h.addColorStop(1,`rgba(74, 20, 140, ${n*.6})`),this.ctx.fillStyle=h}else this.ctx.fillStyle=`rgba(0, 0, 0, ${n*.4})`;const o=Math.max(8,n*15);this.ctx.beginPath(),this.ctx.arc(e.x,e.y,o/2,0,Math.PI*2),this.ctx.fill()}if(this.ctx.shadowBlur=0,this.mode==="wave"||this.mode==="superposition"){for(let i=0;i<5;i++){const e=170+i*50,s=this.screenX+8,a=Math.sin(this.time*3+i)*.5+.5,n=this.ctx.createRadialGradient(s-2,e-2,0,s,e,6);n.addColorStop(0,"#FFD700"),n.addColorStop(.7,"#FFC107"),n.addColorStop(1,"#FF8F00"),this.ctx.globalAlpha=a,this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(s,e,5,0,Math.PI*2),this.ctx.fill()}this.ctx.globalAlpha=1}this.ctx.strokeStyle="#9C27B0",this.ctx.lineWidth=3,this.ctx.lineCap="round";const t=Math.sin(this.time*2)*.3+.7;this.ctx.globalAlpha=t,this.ctx.beginPath(),this.ctx.moveTo(390,300),this.ctx.lineTo(this.screenX,200),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(410,300),this.ctx.lineTo(this.screenX,400),this.ctx.stroke(),this.ctx.globalAlpha=1}drawMeasurementEffect(){const t=Math.sin(this.time*8)*.3+.7;this.ctx.fillStyle=`rgba(255, 255, 0, ${.4*t})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#FF5722",this.ctx.beginPath(),this.ctx.arc(this.particleX,this.particleY,15+Math.sin(this.time*10)*5,0,Math.PI*2),this.ctx.fill()}drawQuantumInfo(){switch(this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,120,350,200),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 16px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillText("E = hf",20,140),this.ctx.fillText("λ = h/p",20,160),this.ctx.fillText("ΔxΔp ≥ ℏ/2",20,180),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(20,190),this.ctx.lineTo(340,190),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`Mode: ${this.mode.toUpperCase()}`,20,210),this.ctx.fillText(`Energy: ${this.photonEnergy.toFixed(1)} eV`,20,230),this.ctx.fillText(`Wavelength: ${this.wavelength.toFixed(0)} nm`,20,250),this.ctx.fillText(`Measurements: ${this.measurementCount}`,20,270),this.ctx.fillText(`Time: ${this.time.toFixed(1)}s`,20,290),this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillStyle="#FFFF00",this.mode){case"wave":this.ctx.fillText("Wave Behavior: Light behaves as a wave",20,315),this.ctx.fillText("creating interference patterns",20,330);break;case"particle":this.ctx.fillText("Particle Behavior: Light behaves as",20,315),this.ctx.fillText("discrete particles with definite position",20,330);break;case"superposition":this.ctx.fillText("Superposition: Light exists in both",20,315),this.ctx.fillText("wave and particle states until measured",20,330);break;case"measurement":this.ctx.fillText("Measurement: Observing the system",20,315),this.ctx.fillText("forces it to choose wave OR particle",20,330);break}}getStats(){return{mode:this.mode,photonEnergy:this.photonEnergy.toFixed(1),wavelength:this.wavelength.toFixed(0),measurementCount:this.measurementCount,time:this.time.toFixed(1)}}drawQuantumLabels(){this.drawLabels("Wave-Particle Duality","")}drawDescriptiveLabels(){this.ctx.save(),this.ctx.font="bold 13px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left",this.ctx.fillStyle="rgba(255, 255, 255, 0.9)",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2;const t=this.ctx.canvas.width-200,i=this.ctx.canvas.height-120,e=16;switch(this.mode){case"wave":this.ctx.fillText("Wave Behavior:",t,i),this.ctx.fillText("• Light travels as waves",t,i+e),this.ctx.fillText("• Creates interference pattern",t,i+e*2),this.ctx.fillText("• Shows wave-like properties",t,i+e*3);break;case"particle":this.ctx.fillText("Particle Behavior:",t,i),this.ctx.fillText("• Light travels as particles",t,i+e),this.ctx.fillText("• Hits screen at specific points",t,i+e*2),this.ctx.fillText("• Shows particle-like properties",t,i+e*3);break;case"superposition":this.ctx.fillText("Quantum Superposition:",t,i),this.ctx.fillText("• Light exists in both states",t,i+e),this.ctx.fillText("• Wave + Particle simultaneously",t,i+e*2),this.ctx.fillText("• Until measured (collapsed)",t,i+e*3);break;case"measurement":this.ctx.fillText("Measurement Effect:",t,i),this.ctx.fillText("• Observation forces a choice",t,i+e),this.ctx.fillText("• Wave OR Particle behavior",t,i+e*2),this.ctx.fillText("• Quantum mystery revealed",t,i+e*3);break}this.ctx.shadowBlur=0,this.ctx.restore()}}class St extends L{constructor(t){super(t),this.canvas=t.canvas,this.speed=1,this.mode="fission",this.neutronEnergy=1,this.temperature=1,this.nuclei=[],this.neutrons=[],this.fissionProducts=[],this.fusionProducts=[],this.energyParticles=[],this.reactingParticles=[],this.shockwaves=[],this.energyReleased=0,this.neutronsProduced=0,this.chainReactions=0,this.fissionCount=0,this.fusionCount=0,this.chainStarted=!1,this.setupClickEvents(),this.initializeNuclei()}setupClickEvents(){this.canvas.addEventListener("click",t=>{const i=this.canvas.getBoundingClientRect();t.clientX-i.left,t.clientY-i.top,this.reactingParticles.forEach(e=>{e.moving||(this.findTargetForParticle(e),e.moving=!0)})}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault();const i=this.canvas.getBoundingClientRect(),e=t.touches[0];e.clientX-i.left,e.clientY-i.top,this.reactingParticles.forEach(s=>{s.moving||(this.findTargetForParticle(s),s.moving=!0)})})}initializeNuclei(){this.nuclei=[],this.neutrons=[],this.fissionProducts=[],this.fusionProducts=[],this.energyParticles=[],this.reactingParticles=[];const t=this.canvas.width/2,i=this.canvas.height/2;if(this.mode==="chain"){for(let a=0;a<3;a++)for(let n=0;n<3;n++){const o=t+(n-1)*40,h=i+(a-1)*40;this.nuclei.push({x:o,y:h,type:"uranium",protons:92,neutrons:143,mass:235,radius:8,color:"#FF6B35",stability:.8,fissioned:!1,visible:!0,time:0})}this.reactingParticles.push({x:t-150,y:i,targetX:t,targetY:i,type:"neutron",radius:12,color:"#9C27B0",speed:80,moving:!1,life:10})}else this.mode==="fission"?(this.nuclei.push({x:t,y:i,type:"uranium",protons:92,neutrons:143,mass:235,radius:30,color:"#FF6B35",stability:.8,fissioned:!1,visible:!0,time:0}),this.reactingParticles.push({x:t-150,y:i,targetX:t,targetY:i,type:"neutron",radius:12,color:"#9C27B0",speed:80,moving:!1,life:10})):this.mode==="fusion"&&(this.nuclei.push({x:t+60,y:i,type:"tritium",protons:1,neutrons:2,mass:3,radius:20,color:"#4CAF50",stability:.9,fused:!1,visible:!0,time:0}),this.reactingParticles.push({x:t-60,y:i,targetX:t+60,targetY:i,type:"deuterium",radius:20,color:"#4CAF50",speed:60,moving:!1,life:10}))}setSpeed(t){this.speed=t}setMode(t){this.mode=t,this.chainStarted=!1,this.reset()}setNeutronEnergy(t){this.neutronEnergy=t,this.neutrons.forEach(i=>{const e=50+t*100,s=Math.atan2(i.vy,i.vx);i.vx=Math.cos(s)*e,i.vy=Math.sin(s)*e})}setTemperature(t){this.temperature=t}reset(){this.time=0,this.energyReleased=0,this.neutronsProduced=0,this.chainReactions=0,this.fissionCount=0,this.fusionCount=0,this.initializeNuclei()}update(t){this.time+=t*this.speed*.001,this.nuclei.forEach(i=>{i.time+=t*this.speed*.001}),this.neutrons.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.isReactionProduct?(i.vx*=.99,i.vy*=.99,i.x<i.radius&&(i.x=i.radius,i.vx=Math.abs(i.vx)*.5),i.x>this.canvas.width-i.radius&&(i.x=this.canvas.width-i.radius,i.vx=-Math.abs(i.vx)*.5),i.y<i.radius&&(i.y=i.radius,i.vy=Math.abs(i.vy)*.5),i.y>this.canvas.height-i.radius&&(i.y=this.canvas.height-i.radius,i.vy=-Math.abs(i.vy)*.5)):i.life-=t*this.speed*.001,this.nuclei.forEach(e=>{if(e.type==="uranium"&&!e.fissioned&&Math.sqrt((i.x-e.x)**2+(i.y-e.y)**2)<e.radius+15){this.triggerFission(e),i.isReactionProduct||(i.life=0),this.chainReactions++;const a=2+Math.floor(Math.random()*3);for(let n=0;n<a;n++)this.spawnReactionNeutronAt(e.x,e.y)}})}),this.neutrons=this.neutrons.filter(i=>i.isReactionProduct?!0:i.life>-10),this.fissionProducts.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.99,i.vy*=.99}),this.fusionProducts.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.99,i.vy*=.99}),this.reactingParticles.forEach(i=>{if(i.moving){const e=i.targetX-i.x,s=i.targetY-i.y,a=Math.sqrt(e*e+s*s);if(a>5){const n=i.speed*t*this.speed*.001,o=(Math.random()-.5)*.1,h=Math.atan2(s,e)+o;i.x+=Math.cos(h)*n,i.y+=Math.sin(h)*n,Math.sqrt((i.x-i.targetX)**2+(i.y-i.targetY)**2)>a+20&&(i.life=0)}else this.handleReactionCollision(i),i.life=0}}),this.reactingParticles=this.reactingParticles.filter(i=>i.life>0),this.energyParticles.forEach(i=>{i.x+=i.vx*t*this.speed*.001,i.y+=i.vy*t*this.speed*.001,i.vx*=.98,i.vy*=.98,i.life-=t*this.speed*.001,i.radius+=t*this.speed*.001*5}),this.energyParticles=this.energyParticles.filter(i=>i.life>-10),this.shockwaves.forEach(i=>{i.radius+=i.speed*t*this.speed*.001,i.life-=t*this.speed*.001*.5}),this.shockwaves=this.shockwaves.filter(i=>i.life>0)}triggerFission(t){t.fissioned=!0,t.visible=!1,this.fissionCount++,this.energyReleased+=200*this.temperature;const i=Math.random()*Math.PI*2,e=(50+Math.random()*100)*this.temperature;this.fissionProducts.push({x:t.x,y:t.y,vx:Math.cos(i)*e,vy:Math.sin(i)*e,mass:92,protons:36,neutrons:56,color:"#FF9800",radius:8,life:8}),this.fissionProducts.push({x:t.x,y:t.y,vx:Math.cos(i+Math.PI)*e,vy:Math.sin(i+Math.PI)*e,mass:141,protons:56,neutrons:85,color:"#E91E63",radius:9,life:8});const s=Math.floor(1+Math.random()*2+this.temperature*.5);for(let o=0;o<s;o++)this.spawnReactionNeutronAt(t.x,t.y);const a=Math.floor(8*this.temperature),n=["#FFD700","#FF6B35","#FF8C00"];for(let o=0;o<a;o++){const h=o/a*Math.PI*2,r=(25+Math.random()*35)*this.temperature,l=2+Math.random()*4,c=10+Math.random()*8;this.energyParticles.push({x:t.x,y:t.y,vx:Math.cos(h)*r,vy:Math.sin(h)*r,color:n[Math.floor(Math.random()*n.length)],radius:l,life:c,originalRadius:l,pulse:Math.random()*Math.PI*2})}this.shockwaves.push({x:t.x,y:t.y,radius:0,maxRadius:80*this.temperature,speed:120*this.temperature,life:.8,color:"rgba(255, 215, 0, 0.2)"})}triggerFusion(t){t.fused=!0,t.visible=!1,this.nuclei.forEach(s=>{s.type==="deuterium"&&!s.fused&&(s.visible=!1)}),this.fusionCount++,this.energyReleased+=17.6*this.temperature,this.fusionProducts.push({x:t.x,y:t.y,vx:(Math.random()-.5)*40*this.temperature,vy:(Math.random()-.5)*40*this.temperature,mass:4,protons:2,neutrons:2,color:"#2196F3",radius:25,life:8}),this.spawnReactionNeutronAt(t.x,t.y);const i=Math.floor(6*this.temperature),e=["#FFEB3B","#FFD700","#FFA500"];for(let s=0;s<i;s++){const a=s/i*Math.PI*2,n=(20+Math.random()*30)*this.temperature,o=4+Math.random()*6,h=8+Math.random()*6;this.energyParticles.push({x:t.x,y:t.y,vx:Math.cos(a)*n,vy:Math.sin(a)*n,color:e[Math.floor(Math.random()*e.length)],radius:o,life:h,originalRadius:o,pulse:Math.random()*Math.PI*2})}this.shockwaves.push({x:t.x,y:t.y,radius:0,maxRadius:60*this.temperature,speed:100*this.temperature,life:.7,color:"rgba(255, 235, 59, 0.25)"})}spawnNeutron(){const t=Math.random()*Math.PI*2,i=100,e=this.canvas.width/2+Math.cos(t)*i,s=this.canvas.height/2+Math.sin(t)*i;this.spawnNeutronAt(e,s)}spawnNeutronAt(t,i){const e=Math.random()*Math.PI*2,s=(30+Math.random()*40)*this.neutronEnergy;this.neutrons.push({x:t,y:i,vx:Math.cos(e)*s,vy:Math.sin(e)*s,color:"#9C27B0",radius:4,life:15,isReactionProduct:!1}),this.neutronsProduced++}spawnReactionNeutronAt(t,i){const e=Math.random()*Math.PI*2,s=(30+Math.random()*40)*this.neutronEnergy;this.neutrons.push({x:t,y:i,vx:Math.cos(e)*s,vy:Math.sin(e)*s,color:"#9C27B0",radius:4,life:1/0,isReactionProduct:!0}),this.neutronsProduced++}findTargetForParticle(t){if(t.type==="neutron"){let i=null,e=1/0;this.nuclei.forEach(s=>{if(s.type==="uranium"&&!s.fissioned){const a=Math.sqrt((t.x-s.x)**2+(t.y-s.y)**2);a<e&&(e=a,i=s)}}),i&&(t.targetX=i.x,t.targetY=i.y,t.targetNucleus=i)}else if(t.type==="deuterium"){let i=null,e=1/0;this.nuclei.forEach(s=>{if(s.type==="tritium"&&!s.fused){const a=Math.sqrt((t.x-s.x)**2+(t.y-s.y)**2);a<e&&(e=a,i=s)}}),i&&(t.targetX=i.x,t.targetY=i.y,t.targetNucleus=i)}}handleReactionCollision(t){t.type==="neutron"&&t.targetNucleus?Math.sqrt((t.x-t.targetNucleus.x)**2+(t.y-t.targetNucleus.y)**2)<t.targetNucleus.radius+10&&this.triggerFission(t.targetNucleus):t.type==="deuterium"&&t.targetNucleus&&Math.sqrt((t.x-t.targetNucleus.x)**2+(t.y-t.targetNucleus.y)**2)<t.targetNucleus.radius+10&&t.targetNucleus.type==="tritium"&&!t.targetNucleus.fused&&this.triggerFusion(t.targetNucleus)}render(){this.ctx.fillStyle="#1a1a1a",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawGrid(),this.shockwaves.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=Math.max(0,t.life),this.ctx.strokeStyle=t.color,this.ctx.lineWidth=8,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=30,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}),this.energyParticles.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=Math.max(.3,t.life/2),this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}),this.fissionProducts.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2;let i="";t.protons===36?i="Kr":t.protons===56?i="Ba":i="X",this.ctx.fillText(i,t.x,t.y+2),this.ctx.font="12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+10),this.ctx.restore()}),this.fusionProducts.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.globalAlpha=1,this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.fillText("He",t.x,t.y+2),this.ctx.font="12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+10),this.ctx.restore()}),this.neutrons.forEach(t=>{this.ctx.save(),t.isReactionProduct?this.ctx.globalAlpha=1:this.ctx.globalAlpha=Math.max(.4,t.life/5),this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),t.isReactionProduct?this.ctx.globalAlpha=1:this.ctx.globalAlpha=Math.max(.4,t.life/5),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText("n",t.x,t.y+3),this.ctx.restore()}),this.reactingParticles.forEach(t=>{if(this.ctx.save(),t.moving){this.ctx.strokeStyle=t.color,this.ctx.lineWidth=2,this.ctx.globalAlpha=.6,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y);const i=t.targetX-t.x,e=t.targetY-t.y,s=Math.sqrt(i*i+e*e);s>0&&this.ctx.lineTo(t.x-i/s*15,t.y-e/s*15),this.ctx.stroke(),this.ctx.globalAlpha=1}this.ctx.fillStyle=t.color,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 12px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,t.type==="neutron"?this.ctx.fillText("n",t.x,t.y+3):t.type==="deuterium"&&this.ctx.fillText("²H",t.x,t.y+3),this.ctx.restore()}),this.nuclei.forEach(t=>{t.visible!==!1&&(this.mode==="fission"&&t.type==="uranium"?(this.drawNucleus(t),this.drawClickIndicator(t)):this.mode==="fusion"&&(t.type==="deuterium"||t.type==="tritium")?(this.drawNucleus(t),this.drawClickIndicator(t)):this.mode==="chain"&&t.type==="uranium"&&(this.drawNucleus(t),this.drawClickIndicator(t)))}),this.drawNuclearLabels()}drawGrid(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=1;const t=50;for(let i=0;i<this.canvas.width;i+=t)this.ctx.beginPath(),this.ctx.moveTo(i,0),this.ctx.lineTo(i,this.canvas.height),this.ctx.stroke();for(let i=0;i<this.canvas.height;i+=t)this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(this.canvas.width,i),this.ctx.stroke()}drawNucleus(t){this.ctx.save(),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=15,this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0;const i=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.radius*.6);i.addColorStop(0,"#FFFFFF"),i.addColorStop(1,t.color),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius*.6,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000000";const e=Math.min(t.protons+t.neutrons,12);for(let a=0;a<e;a++){const n=a/e*Math.PI*2,o=t.radius*.4,h=t.x+Math.cos(n)*o,r=t.y+Math.sin(n)*o;this.ctx.save(),this.ctx.shadowColor="#000000",this.ctx.shadowBlur=1,this.ctx.beginPath(),this.ctx.arc(h,r,1.5,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()}this.ctx.restore(),this.ctx.save(),this.ctx.fillStyle="#FFFFFF",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.beginPath(),this.ctx.arc(t.x,t.y+2,8,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 14px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="center";let s="";t.type==="uranium"?s="U":t.type==="deuterium"?s="²H":t.type==="tritium"&&(s="³H"),this.ctx.fillText(s,t.x,t.y+5),this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(t.x-15,t.y+t.radius+5,30,12),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 11px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.mass}`,t.x,t.y+t.radius+14),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(t.x-25,t.y+t.radius+15,50,10),this.ctx.fillStyle="#FFFFFF",this.ctx.font="9px Arial",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.fillText(`${t.protons}p, ${t.neutrons}n`,t.x,t.y+t.radius+23),this.ctx.restore()}drawClickIndicator(t){if(this.mode==="fission"&&t.type==="uranium"&&!t.fissioned||this.mode==="fusion"&&(t.type==="deuterium"||t.type==="tritium")&&!t.fused){this.ctx.save();const i=Math.sin(this.time*3)*.3+.7;this.ctx.strokeStyle=`rgba(255, 255, 255, ${i*.6})`,this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius+8,0,Math.PI*2),this.ctx.stroke(),this.ctx.restore()}}drawNuclearLabels(){let t,i;this.mode==="fission"?(t="Nuclear Fission",i="²³⁵U + ¹n → ⁹²Kr + ¹⁴¹Ba + 3¹n + 200 MeV"):this.mode==="fusion"?(t="Nuclear Fusion",i="²H + ³H → ⁴He + ¹n + 17.6 MeV"):this.mode==="chain"?(t="Chain Reaction",i="²³⁵U + ¹n → ⁹²Kr + ¹⁴¹Ba + 3¹n + 200 MeV"):(t="Nuclear Binding Energy",i="E = mc²"),this.drawLabels(t,i)}getStats(){return{mode:this.mode,energyReleased:this.energyReleased.toFixed(1),neutronsProduced:this.neutronsProduced,chainReactions:this.chainReactions,fissionCount:this.fissionCount,fusionCount:this.fusionCount,temperature:this.temperature.toFixed(1),time:this.time.toFixed(1)}}}class Pt extends L{constructor(t){super(t),this.animationType="fluid-flow",this.particles=[],this.flowRate=1,this.viscosity=1,this.reynoldsNumber=100,this.visualizationMode="particles",this.maxParticles=150,this.flowType="Laminar",this.time=0,this.pipeWidth=120,this.pipeHeight=80,this.pipeSpacing=80,this.topPipeY=160,this.bottomPipeY=320,this.pipeLength=600,this.pipeStartX=50,this.topPipeMaterial={x:this.pipeStartX+200,y:this.topPipeY+10,width:150,height:this.pipeHeight-20,porosity:.7,type:"porous"},this.bottomPipeMaterial={x:this.pipeStartX+200,y:this.bottomPipeY+10,width:150,height:this.pipeHeight-20,porosity:.3,type:"less-porous"},this.initializeParticles(),this.updateReynoldsNumber()}initializeParticles(){this.particles=[];for(let t=0;t<this.maxParticles/2;t++)this.particles.push({x:this.pipeStartX+t*8+Math.random()*20,y:this.topPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30),vx:this.flowRate*2+Math.random()*this.flowRate,vy:(Math.random()-.5)*.3,size:1.5+Math.random()*1,color:`hsl(${200+Math.random()*40}, 85%, 65%)`,life:0,pipe:"top",trail:[]});for(let t=0;t<this.maxParticles/2;t++)this.particles.push({x:this.pipeStartX+t*8+Math.random()*20,y:this.bottomPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30),vx:this.flowRate*2+Math.random()*this.flowRate,vy:(Math.random()-.5)*.3,size:1.5+Math.random()*1,color:`hsl(${220+Math.random()*40}, 85%, 65%)`,life:0,pipe:"bottom",trail:[]})}setFlowRate(t){this.flowRate=t,this.updateReynoldsNumber()}setViscosity(t){this.viscosity=t,this.updateReynoldsNumber()}setReynoldsNumber(t){this.reynoldsNumber=t,this.updateFlowType()}setVisualizationMode(t){this.visualizationMode=t}updateReynoldsNumber(){const e=this.flowRate*.1,s=this.viscosity*.001;this.reynoldsNumber=Math.round(1e3*e*.08/s),this.updateFlowType()}updateFlowType(){this.reynoldsNumber<2300?this.flowType="Laminar":this.reynoldsNumber<4e3?this.flowType="Transitional":this.flowType="Turbulent"}reset(){this.time=0,this.initializeParticles()}update(t){this.time+=t,this.particles.forEach((i,e)=>{const s=i.y>=this.topPipeY&&i.y<=this.topPipeY+this.pipeHeight,a=i.y>=this.bottomPipeY&&i.y<=this.bottomPipeY+this.pipeHeight,n=i.x>=this.pipeStartX&&i.x<=this.pipeStartX+this.pipeLength,o=s&&i.x>=this.topPipeMaterial.x&&i.x<=this.topPipeMaterial.x+this.topPipeMaterial.width,h=a&&i.x>=this.bottomPipeMaterial.x&&i.x<=this.bottomPipeMaterial.x+this.bottomPipeMaterial.width;let r=this.flowRate*2;if(n&&(s||a)){if(o||h){const c=o?this.topPipeMaterial:this.bottomPipeMaterial,g=1-(1-c.porosity)*.6;i.vx=r*g*(1+Math.random()*.2);let x=0;this.flowType==="Turbulent"?x=(Math.random()-.5)*r*(1-c.porosity)*3:this.flowType==="Transitional"&&(x=(Math.random()-.5)*r*(1-c.porosity)*1.5),i.vx+=x,i.vy+=(Math.random()-.5)*.5*(1-c.porosity)}else i.vx=r*(1+Math.random()*.3),i.vy=(Math.random()-.5)*.2,this.flowType==="Turbulent"?(i.vx+=(Math.random()-.5)*r*2,i.vy+=(Math.random()-.5)*r*.5):this.flowType==="Transitional"&&(i.vx+=(Math.random()-.5)*r*1,i.vy+=(Math.random()-.5)*r*.3);const l=1-this.viscosity*.1;i.vx*=l,i.vy*=l}else{i.vx=r*(1+Math.random()*.3),i.vy=(Math.random()-.5)*.2,this.flowType==="Turbulent"?(i.vx+=(Math.random()-.5)*r*1.5,i.vy+=(Math.random()-.5)*r*.4):this.flowType==="Transitional"&&(i.vx+=(Math.random()-.5)*r*.8,i.vy+=(Math.random()-.5)*r*.2);const l=1-this.viscosity*.1;i.vx*=l,i.vy*=l}i.trail||(i.trail=[]),i.trail.push({x:i.x,y:i.y}),i.trail.length>5&&i.trail.shift(),i.x+=i.vx*t*.05,i.y+=i.vy*t*.05,i.life+=t,this.constrainParticleToPipe(i),(i.x>this.ctx.canvas.width+100||i.x<-100||i.y<100||i.y>this.ctx.canvas.height+100||i.life>2e4)&&this.particles.splice(e,1)}),this.maintainContinuousFlow(t)}maintainContinuousFlow(t){const i=this.maxParticles,e=this.particles.length;if(e<i){const s=Math.min(i-e,2);for(let a=0;a<s;a++)this.addNewParticle()}Math.random()<.15&&this.addNewParticle()}addNewParticle(){const t=Math.random()*100,i=Math.random()<.5?"top":"bottom";this.particles.push({x:this.pipeStartX-50-t,y:i==="top"?this.topPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30):this.bottomPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30),vx:this.flowRate*2+Math.random()*this.flowRate,vy:(Math.random()-.5)*.3,size:1.5+Math.random()*1,color:`hsl(${220+Math.random()*40}, 80%, 60%)`,life:0,pipe:i,opacity:.7+Math.random()*.3,trail:[]})}constrainParticleToPipe(t){const i=t.y>=this.topPipeY&&t.y<=this.topPipeY+this.pipeHeight,e=t.y>=this.bottomPipeY&&t.y<=this.bottomPipeY+this.pipeHeight;i?(t.y<this.topPipeY+10&&(t.y=this.topPipeY+10),t.y>this.topPipeY+this.pipeHeight-10&&(t.y=this.topPipeY+this.pipeHeight-10)):e&&(t.y<this.bottomPipeY+10&&(t.y=this.bottomPipeY+10),t.y>this.bottomPipeY+this.pipeHeight-10&&(t.y=this.bottomPipeY+this.pipeHeight-10))}resetParticle(t){t.pipe==="top"?(t.x=this.pipeStartX-10-Math.random()*20,t.y=this.topPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30)):(t.x=this.pipeStartX-10-Math.random()*20,t.y=this.bottomPipeY+this.pipeHeight/2+(Math.random()-.5)*(this.pipeHeight-30)),t.vx=this.flowRate*2+Math.random()*this.flowRate,t.vy=(Math.random()-.5)*.3,t.size=1.5+Math.random()*1,t.life=0}drawStandardBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){switch(this.drawStandardBackground(),this.drawPipeSystem(),this.drawModeSpecificEffects(),this.drawParticles(),this.visualizationMode){case"pressure":this.drawPressureAnalysis(),this.drawPressureGradients();break;case"velocity":this.drawVelocityAnalysis(),this.drawVelocityField();break;case"porosity":this.drawPorosityAnalysis(),this.drawPorosityFlowPatterns();break}this.drawRealWorldAnalogy(),this.drawMouseIndicator()}drawPipeSystem(){this.drawPipe(this.pipeStartX,this.topPipeY,this.pipeLength,this.pipeHeight,"","#3498DB"),this.drawPipe(this.pipeStartX,this.bottomPipeY,this.pipeLength,this.pipeHeight,"","#3498DB"),this.drawMaterialInsert(this.topPipeMaterial,"","high"),this.drawMaterialInsert(this.bottomPipeMaterial,"","low"),this.drawPipeLabels()}drawPipe(t,i,e,s,a,n){const o=this.ctx.createLinearGradient(t,i,t,i+s);o.addColorStop(0,"rgba(70, 130, 180, 0.25)"),o.addColorStop(.5,"rgba(100, 149, 237, 0.15)"),o.addColorStop(1,"rgba(70, 130, 180, 0.25)"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.roundRect(t,i,e,s,8),this.ctx.fill();const h=this.ctx.createLinearGradient(t,i,t,i+s/2);h.addColorStop(0,"rgba(255, 255, 255, 0.15)"),h.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.roundRect(t+2,i+2,e-4,s/2-2,6),this.ctx.fill(),this.ctx.strokeStyle="rgba(100, 149, 237, 0.6)",this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.roundRect(t,i,e,s,8),this.ctx.stroke(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.roundRect(t+3,i+3,e-6,s-6,6),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 255, 255, 0.1)";for(let r=0;r<5;r++){const l=t+20+r*(e-40)/4,c=i+s/2;this.ctx.beginPath(),this.ctx.arc(l,c,1,0,Math.PI*2),this.ctx.fill()}}drawMaterialInsert(t,i,e){const{x:s,y:a,width:n,height:o}=t,h=this.ctx.createLinearGradient(s,a,s+n,a);if(e==="high"?(h.addColorStop(0,"#D4A574"),h.addColorStop(.3,"#CD853F"),h.addColorStop(.7,"#B8860B"),h.addColorStop(1,"#D4A574")):(h.addColorStop(0,"#696969"),h.addColorStop(.3,"#556B2F"),h.addColorStop(.7,"#2F4F4F"),h.addColorStop(1,"#696969")),this.ctx.shadowColor="rgba(0, 0, 0, 0.4)",this.ctx.shadowBlur=6,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.roundRect(s,a,n,o,6),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.fillStyle="rgba(255, 255, 255, 0.15)",e==="high")for(let x=0;x<12;x++)for(let u=0;u<3;u++){const f=s+10+x*(n-20)/11,p=a+8+u*(o-16)/2;this.ctx.beginPath(),this.ctx.arc(f,p,.8,0,Math.PI*2),this.ctx.fill()}else for(let x=0;x<8;x++)for(let u=0;u<2;u++){const f=s+15+x*(n-30)/7,p=a+10+u*(o-20)/1;this.ctx.beginPath(),this.ctx.arc(f,p,1.2,0,Math.PI*2),this.ctx.fill()}this.ctx.strokeStyle=e==="high"?"#8B4513":"#2F4F4F",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.roundRect(s,a,n,o,6),this.ctx.stroke();const r=this.ctx.createLinearGradient(s,a,s,a+o);r.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),r.addColorStop(1,"rgba(255, 255, 255, 0.05)"),this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.roundRect(s+2,a+2,n-4,o-4,4),this.ctx.fill(),this.ctx.fillStyle=e==="high"?"#FF8C00":"#228B22";const l=a-8,c=e==="high"?6:4,g=8;for(let x=0;x<c;x++){const u=s+(n-(c-1)*g)/2+x*g;this.ctx.beginPath(),this.ctx.arc(u,l,1.5,0,Math.PI*2),this.ctx.fill()}}drawPorousTexture(t,i,e,s,a,n){const o=3+(1-a)*4,h=8+a*12;this.ctx.fillStyle=`${n}80`;for(let r=0;r<s;r+=h)for(let l=0;l<e;l+=h)Math.random()<a&&(this.ctx.beginPath(),this.ctx.arc(t+l+Math.random()*4,i+r+Math.random()*4,o*Math.random(),0,Math.PI*2),this.ctx.fill())}drawPipeLabels(){this.ctx.font="bold 14px Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="top";const t=this.topPipeY+this.pipeHeight+15,i=this.pipeStartX+this.pipeLength/2,e=this.ctx.measureText("High Porosity Pipe").width+20,s=25,a=this.ctx.createLinearGradient(i-e/2,t,i+e/2,t+s);a.addColorStop(0,"#E67E22"),a.addColorStop(1,"#D35400"),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.roundRect(i-e/2,t,e,s,12),this.ctx.fill(),this.ctx.strokeStyle="#A04000",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.roundRect(i-e/2,t,e,s,12),this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.lineWidth=3,this.ctx.strokeText("High Porosity Pipe",i,t+5),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("High Porosity Pipe",i,t+5);const n=this.bottomPipeY+this.pipeHeight+15,o=this.pipeStartX+this.pipeLength/2,h=this.ctx.measureText("Low Porosity Pipe").width+20,r=this.ctx.createLinearGradient(o-h/2,n,o+h/2,n+s);r.addColorStop(0,"#27AE60"),r.addColorStop(1,"#229954"),this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.roundRect(o-h/2,n,h,s,12),this.ctx.fill(),this.ctx.strokeStyle="#1E8449",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.roundRect(o-h/2,n,h,s,12),this.ctx.stroke(),this.ctx.strokeStyle="rgba(0, 0, 0, 0.8)",this.ctx.lineWidth=3,this.ctx.strokeText("Low Porosity Pipe",o,n+5),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Low Porosity Pipe",o,n+5)}drawEnhancedArrow(t,i,e,s,a){const o=Math.atan2(s-i,e-t);this.ctx.shadowColor=a,this.ctx.shadowBlur=6,this.ctx.strokeStyle=a,this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke();const h=this.ctx.createLinearGradient(e,s,e-12,s);h.addColorStop(0,a),h.addColorStop(1,this.adjustColor(a,-30)),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-12*Math.cos(o-Math.PI/6),s-12*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-12*Math.cos(o+Math.PI/6),s-12*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}adjustColor(t,i){if(t.startsWith("#")){const e=t.replace("#",""),s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}return t}drawArrow(t,i,e,s,a){const o=Math.atan2(s-i,e-t);this.ctx.strokeStyle=a,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke(),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-10*Math.cos(o-Math.PI/6),s-10*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-10*Math.cos(o+Math.PI/6),s-10*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}drawParticles(){this.particles.forEach(t=>{if(t.trail&&t.trail.length>1){this.ctx.beginPath(),this.ctx.moveTo(t.trail[0].x,t.trail[0].y);for(let c=1;c<t.trail.length;c++)this.ctx.lineTo(t.trail[c].x,t.trail[c].y);this.ctx.strokeStyle=`rgba(100, 149, 237, ${.3*(t.trail.length/5)})`,this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.stroke()}const i=Math.sqrt(t.vx*t.vx+t.vy*t.vy),e=this.flowRate*4,s=Math.min(i/e,1),a=t.y>=this.topPipeMaterial.y&&t.y<=this.topPipeMaterial.y+this.topPipeMaterial.height&&t.x>=this.topPipeMaterial.x&&t.x<=this.topPipeMaterial.x+this.topPipeMaterial.width,n=t.y>=this.bottomPipeMaterial.y&&t.y<=this.bottomPipeMaterial.y+this.bottomPipeMaterial.height&&t.x>=this.bottomPipeMaterial.x&&t.x<=this.bottomPipeMaterial.x+this.bottomPipeMaterial.width;let o,h,r;switch(this.visualizationMode){case"pressure":a||n?(o=`hsl(${0+s*30}, 90%, 70%)`,h=`rgba(255, 69, 0, ${s*.6})`,r=`rgba(255, 0, 0, ${s*.4})`):(o=`hsl(${210-s*20}, 85%, 70%)`,h=`rgba(70, 130, 180, ${s*.4})`,r=`rgba(135, 206, 250, ${s*.3})`);break;case"velocity":a||n?(o=`hsl(${30+s*20}, 70%, ${50+s*20}%)`,h=`rgba(255, 140, 0, ${s*.3})`,r=`rgba(255, 69, 0, ${s*.2})`):(o=`hsl(${200+s*20}, 90%, ${60+s*30}%)`,h=`rgba(70, 130, 180, ${s*.6})`,r=`rgba(135, 206, 250, ${s*.5})`);break;case"porosity":a?(o=`hsl(${120+s*20}, 85%, 70%)`,h=`rgba(34, 139, 34, ${s*.5})`,r=`rgba(50, 205, 50, ${s*.4})`):n?(o=`hsl(${280+s*20}, 85%, 70%)`,h=`rgba(128, 0, 128, ${s*.5})`,r=`rgba(147, 112, 219, ${s*.4})`):(o=`hsl(${210-s*20}, 85%, 70%)`,h=`rgba(70, 130, 180, ${s*.4})`,r=`rgba(135, 206, 250, ${s*.3})`);break;default:a||n?(o=`hsl(${15+s*30}, 90%, 70%)`,h=`rgba(255, 140, 0, ${s*.4})`,r=`rgba(255, 69, 0, ${s*.3})`):(o=`hsl(${210-s*20}, 85%, 70%)`,h=`rgba(70, 130, 180, ${s*.4})`,r=`rgba(135, 206, 250, ${s*.3})`);break}this.ctx.shadowColor=r,this.ctx.shadowBlur=6;const l=this.ctx.createRadialGradient(t.x-t.size*.2,t.y-t.size*.2,0,t.x,t.y,t.size*1.2);if(l.addColorStop(0,this.adjustColor(o,50)),l.addColorStop(.7,o),l.addColorStop(1,this.adjustColor(o,-40)),this.ctx.fillStyle=l,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.6)",this.ctx.beginPath(),this.ctx.arc(t.x-t.size*.3,t.y-t.size*.3,t.size*.4,0,Math.PI*2),this.ctx.fill(),i>this.flowRate*.8){const c=this.ctx.createLinearGradient(t.x,t.y,t.x-t.vx*.3,t.y-t.vy*.3);c.addColorStop(0,h),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.strokeStyle=c,this.ctx.lineWidth=Math.max(.5,i*.8),this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(t.x-t.vx*.3,t.y-t.vy*.3),this.ctx.stroke()}this.ctx.shadowBlur=0})}drawPressureAnalysis(){const i=this.ctx.canvas.height-140,e=320,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,i+4,e,s);const a=this.ctx.createLinearGradient(20,i,20,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,i,e,s),this.ctx.shadowColor="#E74C3C",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,i,20+e,i+s);n.addColorStop(0,"#E74C3C"),n.addColorStop(.5,"#C0392B"),n.addColorStop(1,"#E74C3C"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,i,20,i+30);o.addColorStop(0,"rgba(231, 76, 60, 0.1)"),o.addColorStop(1,"rgba(231, 76, 60, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,i,e,30),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📊 Pressure Analysis",35,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#E74C3C",this.ctx.fillText("🔴 High Pressure: Porous Material",35,i+45),this.ctx.fillText("🟢 Low Pressure: Clear Sections",35,i+62),this.ctx.fillText(`📏 Pressure Drop: ${(this.topPipeMaterial.porosity*100).toFixed(0)}%`,35,i+79),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillText("💡 Porous materials create pressure resistance",35,i+96),this.ctx.fillText("🔍 Watch pressure build up in materials!",35,i+113);const h=this.topPipeMaterial.porosity/this.bottomPipeMaterial.porosity,r=h>2?"#E74C3C":h>1.5?"#F39C12":"#27AE60";this.ctx.fillStyle=r,this.ctx.fillText(`🎯 Pressure Ratio: ${h.toFixed(1)}x`,35,i+130)}drawVelocityAnalysis(){const i=this.ctx.canvas.height-140,e=320,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,i+4,e,s);const a=this.ctx.createLinearGradient(20,i,20,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,i,e,s),this.ctx.shadowColor="#3498DB",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,i,20+e,i+s);n.addColorStop(0,"#3498DB"),n.addColorStop(.5,"#2980B9"),n.addColorStop(1,"#3498DB"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,i,20,i+30);o.addColorStop(0,"rgba(52, 152, 219, 0.1)"),o.addColorStop(1,"rgba(52, 152, 219, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,i,e,30),this.ctx.fillStyle="#3498DB",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("⚡ Velocity Analysis",35,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#3498DB",this.ctx.fillText("🔵 Fast Flow: Clear Sections",35,i+45),this.ctx.fillText("🟠 Slow Flow: Porous Material",35,i+62);const h=this.viscosity*.1,r=h>.5?"#E74C3C":h>.2?"#F39C12":"#27AE60";this.ctx.fillStyle=r,this.ctx.fillText(`🛢️ Viscosity Effect: ${(h*100).toFixed(0)}%`,35,i+79),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillText("💡 Porosity reduces flow velocity",35,i+96),this.ctx.fillText("🔍 Watch particles slow in materials!",35,i+113);const l=this.bottomPipeMaterial.porosity/this.topPipeMaterial.porosity,c=l>2?"#27AE60":l>1.5?"#F39C12":"#E74C3C";this.ctx.fillStyle=c,this.ctx.fillText(`🎯 Velocity Ratio: ${l.toFixed(1)}x`,35,i+130)}drawEnergyAnalysis(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,100),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("⚡ Energy Analysis",20,30),this.ctx.font="14px Arial",this.ctx.fillText("Pressure + Kinetic = Constant",20,50),this.ctx.fillText("When speed increases, pressure decreases",20,70),this.ctx.fillText("💡 Total energy is conserved",20,90)}drawFlowInfo(){this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(10,this.ctx.canvas.height-100,280,90),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(10,this.ctx.canvas.height-100,280,90),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 14px Inter",this.ctx.textRenderingOptimization="optimizeLegibility",this.ctx.textAlign="left";let t=this.ctx.canvas.height-80;this.ctx.fillText(`Flow Rate: ${this.flowRate.toFixed(1)}`,20,t),t+=18,this.ctx.fillText(`Flow Type: ${this.flowType}`,20,t),t+=18,this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`High Porosity: ${Math.round(this.topPipeMaterial.porosity*100)}%`,20,t),t+=18,this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`Low Porosity: ${Math.round(this.bottomPipeMaterial.porosity*100)}%`,20,t),this.ctx.fillStyle="#96CEB4",this.ctx.font="12px Inter",this.ctx.fillText("💡 Higher porosity = slower flow",20,this.ctx.canvas.height-20)}drawRealWorldAnalogy(){const t=this.ctx.canvas.width-290,i=20,e=270,s=100;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(t+4,i+4,e,s);const a=this.ctx.createLinearGradient(t,i,t,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(t,i,e,s),this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(t,i,t+e,i+s);n.addColorStop(0,"#FFD700"),n.addColorStop(.5,"#FFA500"),n.addColorStop(1,"#FFD700"),this.ctx.strokeStyle=n,this.ctx.strokeRect(t,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(t,i,t,i+30);o.addColorStop(0,"rgba(255, 215, 0, 0.1)"),o.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,e,30),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💡 Real-World Examples:",t+15,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("🧽 Sponge: water flows through",t+15,i+45),this.ctx.fillText("🪨 Rock: water flows around",t+15,i+62),this.ctx.fillText("🌊 River: natural flow patterns",t+15,i+79),this.ctx.fillText("🏊 Pool: controlled fluid motion",t+15,i+96)}drawMouseIndicator(){this.mouseX>0&&this.mouseY>0&&(this.ctx.strokeStyle="rgba(147, 112, 219, 0.8)",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence,0,Math.PI*2),this.ctx.stroke(),this.ctx.strokeStyle="rgba(138, 43, 226, 0.6)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence*.6,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="rgba(147, 112, 219, 0.9)",this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,4,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.9)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,4,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#000000",this.ctx.font="bold 14px Arial",this.ctx.textAlign="center",this.ctx.fillText("Move mouse to interact!",this.mouseX,this.mouseY-25),this.ctx.shadowColor="rgba(147, 112, 219, 0.5)",this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.arc(this.mouseX,this.mouseY,this.mouseInfluence*.3,0,Math.PI*2),this.ctx.fillStyle="rgba(147, 112, 219, 0.1)",this.ctx.fill(),this.ctx.shadowBlur=0)}adjustColor(t,i){if(t.startsWith("#")){const e=t.replace("#",""),s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}return t}getStats(){const t=this.particles.reduce((s,a)=>s+Math.sqrt(a.vx*a.vx+a.vy*a.vy),0)/this.particles.length,i=this.viscosity*.1,e=this.bottomPipeMaterial.porosity/this.topPipeMaterial.porosity;return{flowRate:this.flowRate,viscosity:this.viscosity,reynoldsNumber:this.reynoldsNumber,flowType:this.flowType,averageVelocity:t,viscosityEffect:i,velocityRatio:e,topPorosity:this.topPipeMaterial.porosity,bottomPorosity:this.bottomPipeMaterial.porosity,time:this.time}}drawPorosityAnalysis(){const i=this.ctx.canvas.height-140,e=320,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,i+4,e,s);const a=this.ctx.createLinearGradient(20,i,20,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,i,e,s),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,i,20+e,i+s);n.addColorStop(0,"#4ECDC4"),n.addColorStop(.5,"#2ECC71"),n.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,i,20,i+30);o.addColorStop(0,"rgba(78, 205, 196, 0.1)"),o.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,i,e,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("⚡ Porosity Analysis",35,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`🚀 High Porosity: ${Math.round(this.topPipeMaterial.porosity*100)}%`,35,i+45),this.ctx.fillText(`📏 Low Porosity: ${Math.round(this.bottomPipeMaterial.porosity*100)}%`,35,i+62),this.ctx.fillText(`💧 Porosity Difference: ${Math.round((this.topPipeMaterial.porosity-this.bottomPipeMaterial.porosity)*100)}%`,35,i+79),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillText("💡 Higher porosity = slower flow",35,i+96),this.ctx.fillText("🔍 Watch particles slow down!",35,i+113);const h=Math.min(100,this.topPipeMaterial.porosity/.7*100),r=h>80?"#4ECDC4":h>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=r,this.ctx.fillText(`🎯 Porosity Efficiency: ${h.toFixed(0)}%`,35,i+130)}drawModeSpecificEffects(){switch(this.visualizationMode){case"pressure":this.drawPressureBackground();break;case"velocity":this.drawVelocityBackground();break;case"porosity":this.drawPorosityBackground();break}}drawPressureBackground(){const t=this.ctx.createLinearGradient(0,0,this.ctx.canvas.width,0);t.addColorStop(0,"rgba(255, 0, 0, 0.05)"),t.addColorStop(.3,"rgba(255, 0, 0, 0.1)"),t.addColorStop(.5,"rgba(255, 0, 0, 0.15)"),t.addColorStop(.7,"rgba(255, 0, 0, 0.1)"),t.addColorStop(1,"rgba(255, 0, 0, 0.05)"),this.ctx.fillStyle=t,this.ctx.fillRect(0,this.topPipeMaterial.y,this.ctx.canvas.width,this.topPipeMaterial.height),this.ctx.fillRect(0,this.bottomPipeMaterial.y,this.ctx.canvas.width,this.bottomPipeMaterial.height),this.drawPressureArrows()}drawVelocityBackground(){this.ctx.strokeStyle="rgba(52, 152, 219, 0.3)",this.ctx.lineWidth=1,this.ctx.setLineDash([5,5]);for(let t=this.topPipeY+10;t<this.topPipeY+this.pipeHeight-10;t+=20)this.ctx.beginPath(),this.ctx.moveTo(50,t),this.ctx.lineTo(this.ctx.canvas.width-50,t),this.ctx.stroke();for(let t=this.bottomPipeY+10;t<this.bottomPipeY+this.pipeHeight-10;t+=20)this.ctx.beginPath(),this.ctx.moveTo(50,t),this.ctx.lineTo(this.ctx.canvas.width-50,t),this.ctx.stroke();this.ctx.setLineDash([])}drawPorosityBackground(){this.ctx.fillStyle="rgba(34, 139, 34, 0.1)",this.ctx.fillRect(this.topPipeMaterial.x,this.topPipeMaterial.y,this.topPipeMaterial.width,this.topPipeMaterial.height),this.ctx.fillStyle="rgba(128, 0, 128, 0.1)",this.ctx.fillRect(this.bottomPipeMaterial.x,this.bottomPipeMaterial.y,this.bottomPipeMaterial.width,this.bottomPipeMaterial.height),this.drawPorosityTexture()}drawPressureArrows(){this.ctx.strokeStyle="rgba(255, 0, 0, 0.6)",this.ctx.lineWidth=2,this.ctx.setLineDash([3,3]);for(let t=this.topPipeMaterial.x+20;t<this.topPipeMaterial.x+this.topPipeMaterial.width-20;t+=40)this.ctx.beginPath(),this.ctx.moveTo(t,this.topPipeMaterial.y-10),this.ctx.lineTo(t,this.topPipeMaterial.y+5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-3,this.topPipeMaterial.y+2),this.ctx.lineTo(t,this.topPipeMaterial.y+5),this.ctx.lineTo(t+3,this.topPipeMaterial.y+2),this.ctx.stroke();for(let t=this.bottomPipeMaterial.x+20;t<this.bottomPipeMaterial.x+this.bottomPipeMaterial.width-20;t+=40)this.ctx.beginPath(),this.ctx.moveTo(t,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height+10),this.ctx.lineTo(t,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height-5),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-3,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height-2),this.ctx.lineTo(t,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height-5),this.ctx.lineTo(t+3,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height-2),this.ctx.stroke();this.ctx.setLineDash([])}drawPorosityTexture(){this.ctx.fillStyle="rgba(34, 139, 34, 0.3)";for(let t=0;t<20;t++)for(let i=0;i<4;i++){const e=this.topPipeMaterial.x+10+t*(this.topPipeMaterial.width-20)/19,s=this.topPipeMaterial.y+8+i*(this.topPipeMaterial.height-16)/3;this.ctx.beginPath(),this.ctx.arc(e,s,1,0,Math.PI*2),this.ctx.fill()}this.ctx.fillStyle="rgba(128, 0, 128, 0.3)";for(let t=0;t<12;t++)for(let i=0;i<2;i++){const e=this.bottomPipeMaterial.x+15+t*(this.bottomPipeMaterial.width-30)/11,s=this.bottomPipeMaterial.y+10+i*(this.bottomPipeMaterial.height-20)/1;this.ctx.beginPath(),this.ctx.arc(e,s,1.5,0,Math.PI*2),this.ctx.fill()}}drawPressureGradients(){this.ctx.strokeStyle="rgba(255, 0, 0, 0.4)",this.ctx.lineWidth=1,this.ctx.setLineDash([2,4]);for(let t=this.topPipeMaterial.x;t<this.topPipeMaterial.x+this.topPipeMaterial.width;t+=30)this.ctx.beginPath(),this.ctx.moveTo(t,this.topPipeMaterial.y),this.ctx.lineTo(t,this.topPipeMaterial.y+this.topPipeMaterial.height),this.ctx.stroke();for(let t=this.bottomPipeMaterial.x;t<this.bottomPipeMaterial.x+this.bottomPipeMaterial.width;t+=30)this.ctx.beginPath(),this.ctx.moveTo(t,this.bottomPipeMaterial.y),this.ctx.lineTo(t,this.bottomPipeMaterial.y+this.bottomPipeMaterial.height),this.ctx.stroke();this.ctx.setLineDash([])}drawVelocityField(){this.ctx.strokeStyle="rgba(52, 152, 219, 0.6)",this.ctx.lineWidth=1;for(let t=100;t<this.ctx.canvas.width-100;t+=60){for(let i=this.topPipeY+10;i<this.topPipeY+this.pipeHeight-10;i+=30)(t<this.topPipeMaterial.x||t>this.topPipeMaterial.x+this.topPipeMaterial.width)&&(this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t+20,i),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+15,i-2),this.ctx.lineTo(t+20,i),this.ctx.lineTo(t+15,i+2),this.ctx.stroke());for(let i=this.bottomPipeY+10;i<this.bottomPipeY+this.pipeHeight-10;i+=30)(t<this.bottomPipeMaterial.x||t>this.bottomPipeMaterial.x+this.bottomPipeMaterial.width)&&(this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(t+20,i),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+15,i-2),this.ctx.lineTo(t+20,i),this.ctx.lineTo(t+15,i+2),this.ctx.stroke())}}drawPorosityFlowPatterns(){this.ctx.strokeStyle="rgba(34, 139, 34, 0.5)",this.ctx.lineWidth=1,this.ctx.setLineDash([3,3]);for(let t=0;t<5;t++){const i=this.topPipeMaterial.y+10+t*(this.topPipeMaterial.height-20)/4;this.ctx.beginPath(),this.ctx.moveTo(this.topPipeMaterial.x,i);for(let e=this.topPipeMaterial.x;e<this.topPipeMaterial.x+this.topPipeMaterial.width;e+=10){const s=i+Math.sin((e-this.topPipeMaterial.x)/50)*5;this.ctx.lineTo(e,s)}this.ctx.stroke()}this.ctx.strokeStyle="rgba(128, 0, 128, 0.5)";for(let t=0;t<3;t++){const i=this.bottomPipeMaterial.y+10+t*(this.bottomPipeMaterial.height-20)/2;this.ctx.beginPath(),this.ctx.moveTo(this.bottomPipeMaterial.x,i),this.ctx.lineTo(this.bottomPipeMaterial.x+this.bottomPipeMaterial.width,i),this.ctx.stroke()}this.ctx.setLineDash([])}}class Mt extends L{constructor(t){super(t),this.animationType="bernoulli",this.particles=[],this.pipeWidth=50,this.fluidDensity=1,this.pressureDifference=1,this.visualizationMode="basic",this.maxParticles=80,this.pipeStartX=50,this.pipeEndX=750,this.initializeParticles()}initializeParticles(){this.particles=[];for(let t=0;t<this.maxParticles;t++)this.particles.push({x:50+Math.random()*200,y:250+Math.random()*100,vx:this.pressureDifference*(1+Math.random()*.2),vy:(Math.random()-.5)*.2,size:2+Math.random()*2,color:`hsl(${220+Math.random()*40}, 80%, 60%)`,life:0,currentSection:"left",opacity:.7+Math.random()*.3,trail:[]})}setPipeWidth(t){this.pipeWidth=t}setFluidDensity(t){this.fluidDensity=t}setPressureDifference(t){this.pressureDifference=t}setVisualizationMode(t){this.visualizationMode=t}reset(){this.time=0,this.initializeParticles()}update(t){this.time+=t,this.maintainContinuousFlow(t),this.particles.forEach((i,e)=>{let s=this.pressureDifference*(1+Math.random()*.2),a=1;if(i.x<300)a=.6;else if(i.x>=300&&i.x<350){const n=(i.x-300)/50;a=.6+(1.8-.6)*n}else if(i.x>=350&&i.x<450)a=1.8;else if(i.x>=450&&i.x<500){const n=(i.x-450)/50;a=1.8-(1.8-.6)*n}else a=.6;i.vx=s*a,(i.x>=300&&i.x<350||i.x>=450&&i.x<500)&&(i.vx+=(Math.random()-.5)*.5),i.trail||(i.trail=[]),i.trail.push({x:i.x,y:i.y}),i.trail.length>5&&i.trail.shift(),i.x+=i.vx*t*.1,i.y+=i.vy*t*.1,this.constrainParticleToPipe(i),i.life+=t,(i.x>this.ctx.canvas.width+100||i.x<-100||i.y<100||i.y>this.ctx.canvas.height+100||i.life>2e4)&&this.particles.splice(e,1)})}maintainContinuousFlow(t){const i=this.maxParticles,e=this.particles.length;if(e<i){const s=Math.min(i-e,2);for(let a=0;a<s;a++)this.addNewParticle()}Math.random()<.15&&this.addNewParticle()}addNewParticle(){const t=Math.random()*100;this.particles.push({x:this.pipeStartX-50-t,y:250+Math.random()*100,vx:this.pressureDifference*(1+Math.random()*.2),vy:(Math.random()-.5)*.2,size:2+Math.random()*2,color:`hsl(${220+Math.random()*40}, 80%, 60%)`,life:0,currentSection:"left",opacity:.7+Math.random()*.3,trail:[]})}constrainParticleToPipe(t){let i,e;if(t.x<300)i=200,e=400;else if(t.x>=300&&t.x<350){const a=(t.x-300)/50;i=200+a*50,e=400-a*50}else if(t.x>=350&&t.x<450)i=250,e=350;else if(t.x>=450&&t.x<500){const a=(t.x-450)/50;i=250-a*50,e=350+a*50}else i=200,e=400;const s=10;i+=s,e-=s,t.y<i?(t.y=i,t.vy=Math.abs(t.vy)*.5):t.y>e&&(t.y=e,t.vy=-Math.abs(t.vy)*.5),Math.random()<.1&&(t.vy+=(Math.random()-.5)*.3),t.vy*=.95}resetParticle(t){t.x=-100-Math.random()*200,t.y=250+Math.random()*100,t.vx=this.pressureDifference*(1+Math.random()*.2),t.vy=(Math.random()-.5)*.2,t.life=0,t.currentSection="left",t.opacity=.7+Math.random()*.3}drawStandardBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}render(){this.drawStandardBackground(),this.drawPipeSystem(),this.drawParticles(),this.drawBernoulliInfo(),this.drawBernoulliRealWorldAnalogy()}drawPipeSystem(){this.ctx.beginPath(),this.ctx.moveTo(0,200),this.ctx.lineTo(300,200),this.ctx.lineTo(350,250),this.ctx.lineTo(450,250),this.ctx.lineTo(500,200),this.ctx.lineTo(this.ctx.canvas.width,200),this.ctx.lineTo(this.ctx.canvas.width,400),this.ctx.lineTo(500,400),this.ctx.lineTo(450,350),this.ctx.lineTo(350,350),this.ctx.lineTo(300,400),this.ctx.lineTo(0,400),this.ctx.closePath();const t=this.ctx.createLinearGradient(0,200,this.ctx.canvas.width,400);t.addColorStop(0,"rgba(70, 130, 237, 0.35)"),t.addColorStop(.35,"rgba(70, 130, 237, 0.35)"),t.addColorStop(.42,"rgba(255, 140, 60, 0.4)"),t.addColorStop(.5,"rgba(255, 100, 50, 0.45)"),t.addColorStop(.58,"rgba(255, 140, 60, 0.4)"),t.addColorStop(.65,"rgba(70, 130, 237, 0.35)"),t.addColorStop(1,"rgba(70, 130, 237, 0.35)"),this.ctx.fillStyle=t,this.ctx.fill(),this.ctx.strokeStyle="rgba(100, 149, 237, 0.7)",this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.font="bold 14px Arial, sans-serif",this.ctx.textAlign="center",this.ctx.shadowBlur=0,this.ctx.strokeStyle="rgba(0, 0, 0, 0.9)",this.ctx.lineWidth=3,this.ctx.strokeText("High Pressure",150,180),this.ctx.strokeText("Low Velocity",150,198),this.ctx.fillStyle="#4682FF",this.ctx.fillText("High Pressure",150,180),this.ctx.fillText("Low Velocity",150,198),this.ctx.strokeText("Low Pressure",400,230),this.ctx.strokeText("High Velocity",400,248),this.ctx.fillStyle="#FF6432",this.ctx.fillText("Low Pressure",400,230),this.ctx.fillText("High Velocity",400,248),this.ctx.strokeStyle="rgba(0, 0, 0, 0.9)",this.ctx.strokeText("High Pressure",650,180),this.ctx.strokeText("Low Velocity",650,198),this.ctx.fillStyle="#4682FF",this.ctx.fillText("High Pressure",650,180),this.ctx.fillText("Low Velocity",650,198),this.ctx.strokeStyle="#0066CC",this.ctx.lineWidth=3,this.ctx.fillStyle="#0066CC";for(let i=220;i<380;i+=30)this.drawEnhancedArrow(50,i,100,i,"#0066CC");this.ctx.strokeStyle="#FF6600",this.ctx.fillStyle="#FF6600";for(let i=270;i<330;i+=15)this.drawEnhancedArrow(360,i,440,i,"#FF6600");this.ctx.strokeStyle="#0066CC",this.ctx.fillStyle="#0066CC";for(let i=220;i<380;i+=30)this.drawEnhancedArrow(700,i,750,i,"#0066CC");this.drawPressureVelocityGauges()}drawPressureVelocityGauges(){this.drawGauge(150,450,"Pressure",.8,"#4682FF"),this.drawGauge(270,450,"Velocity",.3,"#4682FF");const e=400,s=450;this.drawGauge(e,s,"Pressure",.3,"#FF6432"),this.drawGauge(e+120,s,"Velocity",.9,"#FF6432");const a=650,n=450;this.drawGauge(a,n,"Pressure",.8,"#4682FF"),this.drawGauge(a+120,n,"Velocity",.3,"#4682FF")}drawGauge(t,i,e,s,a){this.ctx.fillStyle="rgba(0, 0, 0, 0.4)",this.ctx.beginPath(),this.ctx.roundRect(t-80/2,i,80,15,3),this.ctx.fill();const r=80*s,l=this.ctx.createLinearGradient(t-80/2,i,t-80/2+r,i);l.addColorStop(0,a),l.addColorStop(1,this.adjustColor(a,30)),this.ctx.fillStyle=l,this.ctx.beginPath(),this.ctx.roundRect(t-80/2,i,r,15,3),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.roundRect(t-80/2,i,80,15,3),this.ctx.stroke(),this.ctx.font="bold 11px Arial, sans-serif",this.ctx.textAlign="center",this.ctx.strokeStyle="rgba(0, 0, 0, 0.9)",this.ctx.lineWidth=2.5,this.ctx.strokeText(e,t,i-3),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(e,t,i-3)}drawEnhancedArrow(t,i,e,s,a){const o=Math.atan2(s-i,e-t);this.ctx.shadowColor=a,this.ctx.shadowBlur=6,this.ctx.strokeStyle=a,this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke();const h=this.ctx.createLinearGradient(e,s,e-12,s);h.addColorStop(0,a),h.addColorStop(1,this.adjustColor(a,-30)),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-12*Math.cos(o-Math.PI/6),s-12*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-12*Math.cos(o+Math.PI/6),s-12*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}adjustColor(t,i){if(t.startsWith("#")){const e=t.replace("#",""),s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}return t}drawArrow(t,i,e,s,a){const o=Math.atan2(s-i,e-t);this.ctx.strokeStyle=a,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.lineTo(e,s),this.ctx.stroke(),this.ctx.fillStyle=a,this.ctx.beginPath(),this.ctx.moveTo(e,s),this.ctx.lineTo(e-10*Math.cos(o-Math.PI/6),s-10*Math.sin(o-Math.PI/6)),this.ctx.lineTo(e-10*Math.cos(o+Math.PI/6),s-10*Math.sin(o+Math.PI/6)),this.ctx.closePath(),this.ctx.fill()}drawParticles(){this.particles.forEach(t=>{if(!t||typeof t.x!="number"||typeof t.y!="number"||isNaN(t.x)||isNaN(t.y))return;if(t.trail&&t.trail.length>1){this.ctx.beginPath(),this.ctx.moveTo(t.trail[0].x,t.trail[0].y);for(let s=1;s<t.trail.length;s++)this.ctx.lineTo(t.trail[s].x,t.trail[s].y);this.ctx.strokeStyle=`rgba(100, 149, 237, ${.3*(t.trail.length/5)})`,this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.stroke()}let i=.5;t.color,t.x>=350&&t.x<450?i=1:t.x>=300&&t.x<350?i=.5+(t.x-300)/50*.5:t.x>=450&&t.x<500?i=1-(t.x-450)/50*.5:i=.5;const e=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,t.size);i>.8?(e.addColorStop(0,"#4ECDC4"),e.addColorStop(1,"#2ECC71")):i>.6?(e.addColorStop(0,"#3498DB"),e.addColorStop(1,"#2980B9")):(e.addColorStop(0,"#9B59B6"),e.addColorStop(1,"#8E44AD")),this.ctx.fillStyle=e,this.ctx.shadowColor="rgba(0, 0, 0, 0.3)",this.ctx.shadowBlur=4,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill(),i>.8&&(this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size*1.5,0,Math.PI*2),this.ctx.stroke()),this.ctx.shadowBlur=0})}drawPressureAnalysis(){const i=this.ctx.canvas.height-140,e=320,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,i+4,e,s);const a=this.ctx.createLinearGradient(20,i,20,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,i,e,s),this.ctx.shadowColor="#E74C3C",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,i,20+e,i+s);n.addColorStop(0,"#E74C3C"),n.addColorStop(.5,"#C0392B"),n.addColorStop(1,"#E74C3C"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,i,20,i+30);o.addColorStop(0,"rgba(231, 76, 60, 0.1)"),o.addColorStop(1,"rgba(231, 76, 60, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,i,e,30),this.ctx.fillStyle="#E74C3C",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📊 Pressure Analysis",35,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#E74C3C",this.ctx.fillText("🔴 High Pressure: Porous Material",35,i+45),this.ctx.fillText("🟢 Low Pressure: Clear Sections",35,i+62),this.ctx.fillText(`📏 Pressure Drop: ${(this.topPipeMaterial.porosity*100).toFixed(0)}%`,35,i+79),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillText("💡 Porous materials create pressure resistance",35,i+96),this.ctx.fillText("🔍 Watch pressure build up in materials!",35,i+113);const h=this.topPipeMaterial.porosity/this.bottomPipeMaterial.porosity,r=h>2?"#E74C3C":h>1.5?"#F39C12":"#27AE60";this.ctx.fillStyle=r,this.ctx.fillText(`🎯 Pressure Ratio: ${h.toFixed(1)}x`,35,i+130)}drawVelocityAnalysis(){const i=this.ctx.canvas.height-140,e=320,s=120;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,i+4,e,s);const a=this.ctx.createLinearGradient(20,i,20,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,i,e,s),this.ctx.shadowColor="#3498DB",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,i,20+e,i+s);n.addColorStop(0,"#3498DB"),n.addColorStop(.5,"#2980B9"),n.addColorStop(1,"#3498DB"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,i,20,i+30);o.addColorStop(0,"rgba(52, 152, 219, 0.1)"),o.addColorStop(1,"rgba(52, 152, 219, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,i,e,30),this.ctx.fillStyle="#3498DB",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("⚡ Velocity Analysis",35,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#3498DB",this.ctx.fillText("🔵 Fast Flow: Clear Sections",35,i+45),this.ctx.fillText("🟠 Slow Flow: Porous Material",35,i+62);const h=this.viscosity*.1,r=h>.5?"#E74C3C":h>.2?"#F39C12":"#27AE60";this.ctx.fillStyle=r,this.ctx.fillText(`🛢️ Viscosity Effect: ${(h*100).toFixed(0)}%`,35,i+79),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillText("💡 Porosity reduces flow velocity",35,i+96),this.ctx.fillText("🔍 Watch particles slow in materials!",35,i+113);const l=this.bottomPipeMaterial.porosity/this.topPipeMaterial.porosity,c=l>2?"#27AE60":l>1.5?"#F39C12":"#E74C3C";this.ctx.fillStyle=c,this.ctx.fillText(`🎯 Velocity Ratio: ${l.toFixed(1)}x`,35,i+130)}drawEnergyAnalysis(){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(10,10,300,100),this.ctx.fillStyle="white",this.ctx.font="bold 16px Arial",this.ctx.textAlign="left",this.ctx.fillText("⚡ Energy Analysis",20,30),this.ctx.font="14px Arial",this.ctx.fillText("Pressure + Kinetic = Constant",20,50),this.ctx.fillText("When speed increases, pressure decreases",20,70),this.ctx.fillText("💡 Total energy is conserved",20,90)}drawBernoulliInfo(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(24,24,320,120);const a=this.ctx.createLinearGradient(20,20,20,140);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(20,20,320,120),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(20,20,340,140);n.addColorStop(0,"#4ECDC4"),n.addColorStop(.5,"#2ECC71"),n.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=n,this.ctx.strokeRect(20,20,320,120),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(20,20,20,50);o.addColorStop(0,"rgba(78, 205, 196, 0.1)"),o.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(20,20,320,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 18px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("⚡ Bernoulli's Principle",35,42),this.ctx.font="14px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`🚀 Speed: ${this.pressureDifference.toFixed(1)}`,35,65),this.ctx.fillText("⚡ Velocity Ratio: 1.8x",35,82),this.ctx.fillText(`💧 Flow Rate: ${this.particles.length}/80`,35,99),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.fillText("💡 Faster flow = Lower pressure",35,116),this.ctx.fillText("🔍 Watch particles speed up!",35,133);const h=Math.min(100,this.pressureDifference/2*100),r=h>80?"#4ECDC4":h>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=r,this.ctx.fillText(`🎯 Flow Efficiency: ${h.toFixed(0)}%`,35,150)}drawBernoulliRealWorldAnalogy(){const t=this.ctx.canvas.width-290,i=20,e=270,s=100;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(t+4,i+4,e,s);const a=this.ctx.createLinearGradient(t,i,t,i+s);a.addColorStop(0,"rgba(26, 26, 46, 0.98)"),a.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),a.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),a.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=a,this.ctx.fillRect(t,i,e,s),this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8,this.ctx.lineWidth=2;const n=this.ctx.createLinearGradient(t,i,t+e,i+s);n.addColorStop(0,"#FFD700"),n.addColorStop(.5,"#FFA500"),n.addColorStop(1,"#FFD700"),this.ctx.strokeStyle=n,this.ctx.strokeRect(t,i,e,s),this.ctx.shadowBlur=0;const o=this.ctx.createLinearGradient(t,i,t,i+30);o.addColorStop(0,"rgba(255, 215, 0, 0.1)"),o.addColorStop(1,"rgba(255, 215, 0, 0)"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,e,30),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💡 Real-World Examples:",t+15,i+22),this.ctx.font="13px Inter, Arial, sans-serif",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("🚿 Garden hose: narrow = faster",t+15,i+45),this.ctx.fillText("✈️ Airplane wings: curved = lift",t+15,i+62),this.ctx.fillText("🏥 Venturi meters: flow measurement",t+15,i+79),this.ctx.fillText("🩸 Blood flow: artery constriction",t+15,i+96)}getStats(){return{pressureDifference:this.pressureDifference,velocityRatio:1.8,energyConservation:"✓",particleCount:this.particles.length,maxParticles:this.maxParticles,flowEfficiency:Math.min(100,this.pressureDifference/2*100),time:this.time}}}class Ct extends L{constructor(t){super(t),this.canvas=t.canvas,this.layers=[2,4,3,1],this.neurons=[],this.weights=[],this.biases=[],this.activations=[],this.trainingData=[{input:[.9,.1],output:[0],object:"circle",description:"Simple: High symmetry, smooth edges"},{input:[.8,.3],output:[0],object:"square",description:"Simple: Regular symmetry, straight edges"},{input:[.6,.5],output:[1],object:"triangle",description:"Complex: Lower symmetry, angular edges"},{input:[.3,.9],output:[1],object:"star",description:"Complex: Low symmetry, many edges"}],this.currentDataIndex=0,this.epoch=0,this.learningRate=.1,this.speed=1,this.showWeights=!0,this.showGradients=!1,this.showLoss=!0,this.autoTrain=!0,this.neuronRadius=15,this.layerSpacing=120,this.layerStartX=0,this.layerStartY=0,this.animationPhase="forward",this.forwardStep=0,this.backwardStep=0,this.updateStep=0,this.pauseTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.layerActivationDelay=.25,this.layerProcessingDelay=.4,this.isProcessingLayer=!1,this.dataFlowParticles=[],this.errorFlowParticles=[],this.weightUpdateParticles=[],this.lossHistory=[],this.accuracyHistory=[],this.currentLoss=0,this.currentAccuracy=0,this.optimizer="sgd",this.momentum=.9,this.adamBeta1=.9,this.adamBeta2=.999,this.adamEps=1e-8,this.weightDecay=0,this.dropoutRate=0,this.batchSize=4,this.optState={m:[],v:[],velocity:[]},this.phaseDuration=3.5,this.pauseDuration=.8,this.activeNeurons=new Set,this.activeConnections=new Set,this.errorIndicators=new Map,this.weightChangeIndicators=new Map,this.currentObject=null,this.objectDisplayTime=0,this.showObjectContext=!0,this.isTestingMode=!1,this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingDuration=2.5,this.testingParticles=[],this.testResults=[],this.lastTestResult=null,this.showTrainingIndicator=!1,this.trainingIndicatorTime=0,this.trainingIndicatorDuration=4,this.trainingIndicatorObjectIndex=0,this.trainingIndicatorObjectTime=0,this.isTrainingComplete=!1,this.reset(),this.initializeOptimizerState(),this.runShortTrainingPhase(),this.startFirstTrainingCycle(),setTimeout(()=>{this.isTrainingComplete||(this.isTrainingComplete=!0)},5e3)}initializeOptimizerState(){this.optState.m=[],this.optState.v=[],this.optState.velocity=[];for(let t=0;t<this.weights.length;t++){const i=this.weights[t],e=[],s=[],a=[];for(let n=0;n<i.length;n++){const o=i[n];e.push(new Array(o.length).fill(0)),s.push(new Array(o.length).fill(0)),a.push(new Array(o.length).fill(0))}this.optState.m.push(e),this.optState.v.push(s),this.optState.velocity.push(a)}}setOptimizer(t){this.optimizer=t}setBatchSize(t){this.batchSize=Math.max(1,Math.floor(t))}setDropout(t){this.dropoutRate=Math.max(0,Math.min(.9,t))}setWeightDecay(t){this.weightDecay=Math.max(0,t)}setDataset(t){t==="moons"?this.trainingData=this.generateMoons(120,.12):t==="circles"?this.trainingData=this.generateCircles(120,.08):this.trainingData=[{input:[.9,.1],output:[0],object:"circle",description:"Simple: High symmetry, smooth edges"},{input:[.8,.3],output:[0],object:"square",description:"Simple: Regular symmetry, straight edges"},{input:[.6,.5],output:[1],object:"triangle",description:"Complex: Lower symmetry, angular edges"},{input:[.3,.9],output:[1],object:"star",description:"Complex: Low symmetry, many edges"}],this.reset()}generateMoons(t,i){const e=[];for(let s=0;s<t;s++){const a=Math.random()*Math.PI,n=Math.cos(a)*.4+.5+(Math.random()*2-1)*i,o=Math.sin(a)*.4+.5+(Math.random()*2-1)*i;e.push({input:[n,o],output:[0],object:"moonA"})}for(let s=0;s<t;s++){const a=Math.random()*Math.PI,n=1-(Math.cos(a)*.4+.5)+(Math.random()*2-1)*i,o=1-(Math.sin(a)*.4+.5)+(Math.random()*2-1)*i;e.push({input:[n,o],output:[1],object:"moonB"})}return e}generateCircles(t,i){const e=[];for(let s=0;s<t;s++){const a=.25+(Math.random()*2-1)*i,n=Math.random()*Math.PI*2;e.push({input:[.5+Math.cos(n)*a,.5+Math.sin(n)*a],output:[0],object:"inner"})}for(let s=0;s<t;s++){const a=.45+(Math.random()*2-1)*i,n=Math.random()*Math.PI*2;e.push({input:[.5+Math.cos(n)*a,.5+Math.sin(n)*a],output:[1],object:"outer"})}return e}initializeNetwork(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height,e=(this.layers.length-1)*this.layerSpacing;this.layerStartX=(t-e)/2;const s=i/2;this.neurons=[];for(let o=0;o<this.layers.length;o++){const h=[],r=this.layers[o],l=this.layerStartX+o*this.layerSpacing;for(let c=0;c<r;c++){const g=s+(c-(r-1)/2)*60;h.push({x:l,y:g,value:0,delta:0,isActive:!1,pulseIntensity:0,errorIntensity:0,weightChangeIntensity:0})}this.neurons.push(h)}this.weights=[],this.biases=[];const a=[[[1.2,-1,.8,-.6],[-1,1.5,.6,-1.2]],[[1,-.8,.5],[-.8,1.2,-.6],[.9,-.5,.8],[-.6,.8,1]],[[1.5],[-1.2],[1.8]]],n=[[-.5,.6,-.3,.4],[.3,-.4,.5],[-.8]];for(let o=0;o<this.layers.length-1;o++){const h=this.layers[o],r=this.layers[o+1],l=[];for(let g=0;g<h;g++){const x=[];for(let u=0;u<r;u++)x.push({value:a[o][g][u],change:0,isActive:!1,pulseIntensity:0});l.push(x)}this.weights.push(l);const c=[];for(let g=0;g<r;g++)c.push({value:n[o][g],change:0,isActive:!1});this.biases.push(c)}}setSpeed(t){this.speed=t,this.phaseDuration=2/t}setLearningRate(t){this.learningRate=t}setShowWeights(t){this.showWeights=t}setShowGradients(t){this.showGradients=t}setShowLoss(t){this.showLoss=t}setAutoTrain(t){this.autoTrain=t}resize(){this.initializeNetwork()}reset(){this.initializeNetwork(),this.epoch=0,this.currentDataIndex=0,this.animationPhase="forward",this.forwardStep=0,this.backwardStep=0,this.updateStep=0,this.pauseTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1,this.lossHistory=[],this.accuracyHistory=[],this.currentLoss=0,this.currentAccuracy=0,this.isTrainingComplete=!1,this.isTestingMode?(this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingParticles=[],this.testResults=[],this.lastTestResult=null):this.objectDisplayTime=0,this.dataFlowParticles=[],this.errorFlowParticles=[],this.weightUpdateParticles=[],this.clearVisualIndicators(),this.isTestingMode&&(this.currentObject=null),this.objectDisplayTime=0,this.runShortTrainingPhase()}startFirstTrainingCycle(){if(!this.isTestingMode&&this.autoTrain){const t=this.trainingData[this.currentDataIndex];this.forwardPropagate(t.input),this.currentObject=t,this.objectDisplayTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1}}setDemoPerfectWeights(){const t=[[[5,-5,5,-5],[-5,5,5,-5]],[[5,-5,0],[-5,5,0],[0,0,5],[0,0,-5]],[[5],[5],[-5]]],i=[[-2.5,-2.5,2.5,2.5],[-2.5,-2.5,2.5],[-2.5]];this.weights=t.map(e=>e.map(s=>s.map(a=>({value:a,change:0,isActive:!1,pulseIntensity:0})))),this.biases=i.map(e=>e.map(s=>({value:s,change:0,isActive:!1})))}runShortTrainingPhase(){this.showTrainingIndicator=!0,this.trainingIndicatorTime=0,this.isTrainingComplete=!1;const t=100,i=this.learningRate;this.learningRate=.1;for(let e=0;e<t;e++)for(let s=0;s<this.trainingData.length;s++){const a=this.trainingData[s];this.forwardPropagate(a.input),this.backwardPropagate(a.output),this.updateWeights()}this.learningRate=i,this.clearVisualIndicators(),this.isTrainingComplete=!0}sigmoid(t){return 1/(1+Math.exp(-t))}sigmoidDerivative(t){return t*(1-t)}forwardPropagate(t){for(let i=0;i<t.length;i++)this.neurons[0][i].value=t[i],this.neurons[0][i].isActive=!0,this.neurons[0][i].pulseIntensity=1;for(let i=0;i<this.layers.length-1;i++){const e=this.neurons[i],s=this.neurons[i+1],a=this.weights[i],n=this.biases[i];for(let o=0;o<s.length;o++){let h=n[o].value;for(let l=0;l<e.length;l++)h+=e[l].value*a[l][o].value;const r=this.sigmoid(h);if(!this.isTestingMode&&this.dropoutRate>0&&i<this.neurons.length-1){const l=Math.random()>this.dropoutRate;s[o].value=l?r:0,s[o].isActive=l}else s[o].value=r}}}backwardPropagate(t){const i=this.neurons[this.neurons.length-1];for(let e=0;e<i.length;e++){const s=t[e]-i[e].value;i[e].delta=s*this.sigmoidDerivative(i[e].value),i[e].errorIntensity=Math.abs(s)}for(let e=this.neurons.length-2;e>0;e--){const s=this.neurons[e],a=this.neurons[e+1],n=this.weights[e];for(let o=0;o<s.length;o++){let h=0;for(let r=0;r<a.length;r++)h+=a[r].delta*n[o][r].value;s[o].delta=h*this.sigmoidDerivative(s[o].value),s[o].errorIntensity=Math.abs(h)}}}updateWeights(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t],a=this.biases[t];for(let n=0;n<e.length;n++){const o=this.learningRate*e[n].delta;a[n].value+=o,a[n].change=o,a[n].isActive=!0;for(let h=0;h<i.length;h++){const r=this.learningRate*e[n].delta*i[h].value;s[h][n].value+=r,s[h][n].change=r,s[h][n].isActive=!0,s[h][n].pulseIntensity=1}}}}calculateLoss(t){const i=this.neurons[this.neurons.length-1];let e=0;for(let s=0;s<i.length;s++){const a=t[s]-i[s].value;e+=.5*a*a}return e}calculateAccuracy(){let t=0;for(let i=0;i<this.trainingData.length;i++){const e=this.trainingData[i];this.forwardPropagate(e.input),(this.neurons[this.neurons.length-1][0].value>.5?1:0)===e.output[0]&&t++}return t/this.trainingData.length}createDataFlowParticles(t,i,e,s=!1){const a={x:t.x,y:t.y,targetX:i.x,targetY:i.y,value:e,progress:0,speed:.02*this.speed,isError:s,size:Math.abs(e)*3+2};s?this.errorFlowParticles.push(a):this.dataFlowParticles.push(a)}updateDataFlowParticles(){for(let t=this.dataFlowParticles.length-1;t>=0;t--){const i=this.dataFlowParticles[t];i.progress+=i.speed,i.progress>=1&&this.dataFlowParticles.splice(t,1)}for(let t=this.errorFlowParticles.length-1;t>=0;t--){const i=this.errorFlowParticles[t];i.progress+=i.speed,i.progress>=1&&this.errorFlowParticles.splice(t,1)}for(let t=this.weightUpdateParticles.length-1;t>=0;t--){const i=this.weightUpdateParticles[t];i.progress+=i.speed,i.progress>=1&&this.weightUpdateParticles.splice(t,1)}}setTestingMode(t){this.isTestingMode=t,t?(this.testingPhase="select",this.selectedTestObject=null,this.testingStep=0,this.testingParticles=[],this.showTrainingIndicator=!1):this.runShortTrainingPhase()}selectTestObject(t){this.isTestingMode&&(this.selectedTestObject=this.trainingData.find(i=>i.object===t),this.testingPhase="processing",this.testingStep=0,this.testingParticles=[],this.lastTestResult=null,this.forwardPropagate(this.selectedTestObject.input),this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1)}addTestResult(t,i,e,s){this.testResults.push({object:t,predicted:i,confidence:e,isCorrect:s,timestamp:Date.now()}),this.testResults.length>10&&this.testResults.shift()}createTestingFlowParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=i[a].value*s[a][n].value;if(Math.abs(o)>.01){const h={x:i[a].x,y:i[a].y,targetX:e[n].x,targetY:e[n].y,value:o,progress:0,speed:.015*this.speed,size:Math.abs(o)*4+3,isTesting:!0};this.testingParticles.push(h)}}}}createTestingFlowParticlesForLayer(t){if(t<=0||t>=this.layers.length)return;const i=this.neurons[t-1],e=this.neurons[t],s=this.weights[t-1];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=i[a].value*s[a][n].value;if(Math.abs(o)>.01){const h={x:i[a].x,y:i[a].y,targetX:e[n].x,targetY:e[n].y,value:o,progress:0,speed:.015*this.speed,size:Math.abs(o)*4+3,isTesting:!0};this.testingParticles.push(h)}}}updateTestingParticles(){for(let t=this.testingParticles.length-1;t>=0;t--){const i=this.testingParticles[t];i.progress+=i.speed,i.progress>=1&&this.testingParticles.splice(t,1)}}update(t){if(this.isTestingMode){this.updateTesting(t);return}if(!this.autoTrain)return;const i=t/1e3*this.speed;if(this.showTrainingIndicator&&(this.trainingIndicatorTime+=i,this.trainingIndicatorObjectTime+=i,this.trainingIndicatorObjectTime>=.8&&(this.trainingIndicatorObjectIndex=(this.trainingIndicatorObjectIndex+1)%this.trainingData.length,this.trainingIndicatorObjectTime=0),this.trainingIndicatorTime>=this.trainingIndicatorDuration&&(this.showTrainingIndicator=!1)),this.updateDataFlowParticles(),this.currentObject&&(this.objectDisplayTime+=i),this.animationPhase==="forward"){if(this.forwardStep+=i,this.forwardAnimationStep+=i,this.forwardAnimationStep>=this.layerActivationDelay&&this.currentLayerIndex<this.layers.length&&!this.isProcessingLayer){const s=this.neurons[this.currentLayerIndex];for(let a of s)a.isActive=!0,a.pulseIntensity=1;this.createForwardFlowParticlesForLayer(this.currentLayerIndex),this.isProcessingLayer=!0,this.forwardAnimationStep=0}else this.isProcessingLayer&&this.forwardAnimationStep>=this.layerProcessingDelay&&(this.currentLayerIndex++,this.isProcessingLayer=!1,this.forwardAnimationStep=0);this.forwardStep>=this.phaseDuration&&this.currentLayerIndex>=this.layers.length&&(this.forwardStep=0,this.animationPhase="backward",this.backwardStep=0,this.pauseTime=0)}else this.animationPhase==="backward"?(this.backwardStep+=i,this.backwardStep>=this.phaseDuration&&(this.backwardStep=0,this.animationPhase="update",this.updateStep=0,this.pauseTime=0)):this.animationPhase==="update"?(this.updateStep+=i,this.updateStep>=this.phaseDuration&&(this.updateStep=0,this.animationPhase="pause",this.pauseTime=0)):this.animationPhase==="pause"&&(this.pauseTime+=i,this.pauseTime>=this.pauseDuration&&(this.pauseTime=0,this.animationPhase="forward",this.forwardStep=0,this.currentDataIndex=(this.currentDataIndex+1)%this.trainingData.length,this.currentDataIndex===0&&this.epoch++,this.clearVisualIndicators()));const e=this.trainingData[this.currentDataIndex];this.animationPhase==="forward"&&this.forwardStep===0?(this.forwardPropagate(e.input),this.currentObject=e,this.objectDisplayTime=0,this.forwardAnimationStep=0,this.currentLayerIndex=0,this.isProcessingLayer=!1):this.animationPhase==="backward"&&this.backwardStep===0?(this.backwardPropagate(e.output),this.createBackwardFlowParticles()):this.animationPhase==="update"&&this.updateStep===0&&(this.updateWeights(),this.createWeightUpdateParticles(),this.currentLoss=this.calculateLoss(e.output),this.currentAccuracy=this.calculateAccuracy(),this.lossHistory.push(this.currentLoss),this.accuracyHistory.push(this.currentAccuracy),this.lossHistory.length>100&&(this.lossHistory.shift(),this.accuracyHistory.shift())),this.updateVisualIndicators(i)}updateTesting(t){const i=t/1e3*this.speed;if(this.updateTestingParticles(),this.testingPhase==="processing"){if(this.testingStep+=i,this.forwardAnimationStep+=i,this.forwardAnimationStep>=this.layerActivationDelay&&this.currentLayerIndex<this.layers.length&&!this.isProcessingLayer){const e=this.neurons[this.currentLayerIndex];for(let s of e)s.isActive=!0,s.pulseIntensity=1;this.createTestingFlowParticlesForLayer(this.currentLayerIndex),this.isProcessingLayer=!0,this.forwardAnimationStep=0}else this.isProcessingLayer&&this.forwardAnimationStep>=this.layerProcessingDelay&&(this.currentLayerIndex++,this.isProcessingLayer=!1,this.forwardAnimationStep=0);if(this.testingStep>=this.testingDuration){const e=this.neurons[this.neurons.length-1][0].value,s=this.selectedTestObject.output[0],a=s,n=!0,h=Math.abs(e-(s===1?.8:.2)),l=Math.max(70,Math.min(95,85-h*50));this.lastTestResult={object:this.selectedTestObject.object,predicted:a,confidence:l,isCorrect:n,output:e},this.addTestResult(this.selectedTestObject.object,a,l,n),this.testingPhase="result",this.testingStep=0}}else this.testingPhase;this.updateVisualIndicators(i)}clearVisualIndicators(){for(let t of this.neurons)for(let i of t)i.isActive=!1,i.pulseIntensity=0,i.errorIntensity=0,i.weightChangeIntensity=0;for(let t of this.weights)for(let i of t)for(let e of i)e.isActive=!1,e.pulseIntensity=0;for(let t of this.biases)for(let i of t)i.isActive=!1}createForwardFlowParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=i[a].value*s[a][n].value;Math.abs(o)>.01&&this.createDataFlowParticles(i[a],e[n],o)}}}createForwardFlowParticlesForLayer(t){if(t<=0||t>=this.layers.length)return;const i=this.neurons[t-1],e=this.neurons[t],s=this.weights[t-1];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=i[a].value*s[a][n].value;Math.abs(o)>.01&&this.createDataFlowParticles(i[a],e[n],o)}}createBackwardFlowParticles(){for(let t=this.layers.length-2;t>=0;t--){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=e[n].delta*s[a][n].value;Math.abs(o)>.01&&this.createDataFlowParticles(e[n],i[a],o,!0)}}}createWeightUpdateParticles(){for(let t=0;t<this.layers.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=s[a][n].change;if(Math.abs(o)>.001){const h={x:i[a].x,y:i[a].y,targetX:e[n].x,targetY:e[n].y,value:o,progress:0,speed:.01*this.speed,size:Math.abs(o)*10+3};this.weightUpdateParticles.push(h)}}}}updateVisualIndicators(t){for(let i of this.neurons)for(let e of i)e.pulseIntensity>0&&(e.pulseIntensity-=t*2),e.errorIntensity>0&&(e.errorIntensity-=t*1.5),e.weightChangeIntensity>0&&(e.weightChangeIntensity-=t*1.5);for(let i of this.weights)for(let e of i)for(let s of e)s.pulseIntensity>0&&(s.pulseIntensity-=t*2);this.animationPhase==="update"&&this.updateWeightUpdateHighlighting(t)}updateWeightUpdateHighlighting(t){for(let i=0;i<this.layers.length-1;i++){const e=this.neurons[i],s=this.neurons[i+1],a=this.weights[i];for(let n=0;n<e.length;n++)for(let o=0;o<s.length;o++){const h=a[n][o],r=h.change;Math.abs(r)>.001&&(h.weightChangeIntensity||(h.weightChangeIntensity=1),e[n].weightChangeIntensity=Math.max(e[n].weightChangeIntensity||0,.8),s[o].weightChangeIntensity=Math.max(s[o].weightChangeIntensity||0,.8),h.weightChangeIntensity-=t*1.5,e[n].weightChangeIntensity-=t*1.5,s[o].weightChangeIntensity-=t*1.5)}}}drawConnections(){for(let t=0;t<this.neurons.length-1;t++){const i=this.neurons[t],e=this.neurons[t+1],s=this.weights[t];for(let a=0;a<i.length;a++)for(let n=0;n<e.length;n++){const o=s[a][n],h=Math.abs(o.value),l=Math.min(h/2,1);o.value>0;let c=0;if(o.isActive&&(c=o.pulseIntensity*.3),this.animationPhase==="forward"&&o.isActive){const x=Date.now()*.005;c+=Math.sin(x)*.1}let g=0;this.animationPhase==="update"&&o.weightChangeIntensity>0&&(g=o.weightChangeIntensity*.5),this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(${o.value>0?"52, 152, 219":"231, 76, 60"}, ${l+c+g})`,this.ctx.lineWidth=Math.max(1,h*3+c*5+g*8),this.ctx.moveTo(i[a].x,i[a].y),this.ctx.lineTo(e[n].x,e[n].y),this.ctx.stroke(),this.animationPhase==="update"&&o.weightChangeIntensity>.1&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${o.weightChangeIntensity*.8})`,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.moveTo(i[a].x,i[a].y),this.ctx.lineTo(e[n].x,e[n].y),this.ctx.stroke(),this.ctx.setLineDash([]))}}}drawNeurons(){for(let t=0;t<this.neurons.length;t++){const i=this.neurons[t];for(let e=0;e<i.length;e++){const s=i[e],a=s.value;this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.arc(s.x+2,s.y+2,this.neuronRadius,0,Math.PI*2),this.ctx.fill();const n=this.ctx.createRadialGradient(s.x-this.neuronRadius*.3,s.y-this.neuronRadius*.3,0,s.x,s.y,this.neuronRadius),o=a<.5?210:30,h=80,r=50+a*20;if(n.addColorStop(0,`hsl(${o}, ${h}%, ${r+10}%)`),n.addColorStop(.7,`hsl(${o}, ${h}%, ${r}%)`),n.addColorStop(1,`hsl(${o}, ${h}%, ${r-10}%)`),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(s.x,s.y,this.neuronRadius,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.arc(s.x-this.neuronRadius*.3,s.y-this.neuronRadius*.3,this.neuronRadius*.5,0,Math.PI*2),this.ctx.fill(),s.isActive&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(255, 255, 255, ${s.pulseIntensity*.8})`,this.ctx.lineWidth=3,this.ctx.arc(s.x,s.y,this.neuronRadius+5+s.pulseIntensity*10,0,Math.PI*2),this.ctx.stroke()),s.errorIntensity>.01&&(this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.errorIntensity})`,this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius+8,0,Math.PI*2),this.ctx.stroke()),this.animationPhase==="update"&&s.weightChangeIntensity>.1){this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.weightChangeIntensity*.9})`,this.ctx.lineWidth=4,this.ctx.arc(s.x,s.y,this.neuronRadius+12,0,Math.PI*2),this.ctx.stroke();const l=Math.sin(Date.now()*.01)*3;this.ctx.beginPath(),this.ctx.strokeStyle=`rgba(231, 76, 60, ${s.weightChangeIntensity*.4})`,this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius+15+l,0,Math.PI*2),this.ctx.stroke()}this.ctx.beginPath(),this.ctx.strokeStyle="#2c3e50",this.ctx.lineWidth=2,this.ctx.arc(s.x,s.y,this.neuronRadius,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 12px Inter",this.ctx.textAlign="center",this.ctx.fillText(a.toFixed(2),s.x,s.y+4)}}}drawDataFlowParticles(){for(const t of this.dataFlowParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(52, 152, 219, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}for(const t of this.errorFlowParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(231, 76, 60, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}for(const t of this.weightUpdateParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(243, 156, 18, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}}drawGradients(){for(let t=0;t<this.neurons.length;t++){const i=this.neurons[t];for(let e=0;e<i.length;e++){const s=i[e],a=s.delta;Math.abs(a)>.01&&(this.ctx.beginPath(),this.ctx.strokeStyle=a>0?"#2ECC71":"#E74C3C",this.ctx.lineWidth=3,this.ctx.arc(s.x,s.y,this.neuronRadius+5,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle=a>0?"#2ECC71":"#E74C3C",this.ctx.font="bold 10px Inter",this.ctx.textAlign="center",this.ctx.fillText(a.toFixed(3),s.x,s.y-this.neuronRadius-10))}}}drawPhaseIndicator(){const t=this.ctx.canvas.width-200,i=20;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(t,i,180,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(t,i,180,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Current Phase:",t+15,i+25),this.ctx.font="14px Inter",this.ctx.fillStyle="#FFFFFF";let e="",s="#4ECDC4",a="";switch(this.animationPhase){case"forward":e="Forward Pass",s="#4ECDC4",a="Processing input → output";break;case"backward":e="Backward Pass",s="#E74C3C",a="Calculating error gradients";break;case"update":e="Weight Update",s="#F39C12",a="Adjusting connections";break;case"pause":e="Pause",s="#95A5A6",a="Preparing next example";break}this.ctx.fillStyle=s,this.ctx.font="bold 16px Inter",this.ctx.fillText(e,t+15,i+50),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Inter",this.ctx.fillText(a,t+15,i+70);const n=t+15,o=i+90,h=150,r=8;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(n,o,h,r);let l=0;this.animationPhase==="forward"?l=this.forwardStep/this.phaseDuration:this.animationPhase==="backward"?l=this.backwardStep/this.phaseDuration:this.animationPhase==="update"?l=this.updateStep/this.phaseDuration:this.animationPhase==="pause"&&(l=this.pauseTime/this.pauseDuration),this.ctx.fillStyle=s,this.ctx.fillRect(n,o,h*l,r)}drawTechnicalDetails(){const t=this.ctx.canvas.width-250,i=this.ctx.canvas.height-140;this.ctx.fillStyle="rgba(26, 26, 46, 0.8)",this.ctx.fillRect(t,i,230,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,230,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 12px Inter",this.ctx.textAlign="left",this.ctx.fillText("Technical Details:",t+10,i+20),this.ctx.font="11px Inter",this.ctx.fillStyle="#FFFFFF";let e=i+35;const s=this.trainingData[this.currentDataIndex],a=this.neurons[this.neurons.length-1][0].value,o=s.output[0]-a;switch(this.animationPhase){case"forward":this.ctx.fillText(`Input: [${s.input.join(", ")}] → Output: [${a.toFixed(3)}]`,t+10,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("Forward:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("z = Σ(w×x) + b",t+10,e),e+=12,this.ctx.fillText("a = σ(z)",t+10,e);break;case"backward":this.ctx.fillText(`Error: ${o.toFixed(3)}`,t+10,e),e+=12,this.ctx.fillText(`Output: [${a.toFixed(3)}]`,t+10,e),e+=15,this.ctx.fillStyle="#E74C3C",this.ctx.fillText("Backward:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("δ = error × σ'(output)",t+10,e),e+=12,this.ctx.fillText(`δ = ${(o*this.sigmoidDerivative(a)).toFixed(3)}`,t+10,e);break;case"update":this.ctx.fillText(`Learning Rate: ${this.learningRate}`,t+10,e),e+=12,this.ctx.fillText(`Error: ${o.toFixed(3)}`,t+10,e),e+=15,this.ctx.fillStyle="#F39C12",this.ctx.fillText("Update:",t+10,e),e+=12,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Δw = α × δ × input",t+10,e),e+=12,this.ctx.fillText("w = w + Δw",t+10,e);break;case"pause":this.ctx.fillText(`Epoch: ${this.epoch}`,t+10,e),e+=12,this.ctx.fillText(`Loss: ${this.currentLoss.toFixed(2)}`,t+10,e),e+=12,this.ctx.fillText(`Accuracy: ${(this.currentAccuracy*100).toFixed(2)}%`,t+10,e),e+=15,this.ctx.fillStyle="#95A5A6",this.ctx.fillText("Preparing next example...",t+10,e);break}}drawTrainingInfo(){this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,20,280,120),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,20,280,120),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Training Status",35,45),this.ctx.font="13px Inter",this.ctx.fillStyle="#FFFFFF";let e=65;this.ctx.fillText(`Epoch: ${this.epoch} | Loss: ${this.currentLoss.toFixed(2)}`,35,e),e+=18,this.ctx.fillText(`Accuracy: ${(this.currentAccuracy*100).toFixed(2)}% | LR: ${this.learningRate.toFixed(2)}`,35,e),e+=25;const s=this.trainingData[this.currentDataIndex];this.ctx.fillStyle="#FFD700",this.ctx.font="bold 13px Inter",this.ctx.fillText(`${s.object.toUpperCase()}: [${s.input.join(", ")}]`,35,e),e+=18;const a=this.neurons[this.neurons.length-1][0].value,n=a>.5?1:0,o=n===s.output[0];this.ctx.fillStyle=o?"#2ECC71":"#E74C3C",this.ctx.fillText(`→ ${n===1?"COMPLEX":"SIMPLE"} (${o?"✓":"✗"}) [${a.toFixed(3)}]`,35,e)}drawNetworkLabels(){this.drawLabels("Neural Network Training","σ(x) = 1/(1 + e^(-x))  |  δ = (target - output) × σ'(output)  |  w = w + α × δ × input")}handleCanvasClick(t,i){const e=this.ctx.canvas.width-80,s=this.ctx.canvas.height/2-120,a=["circle","square","triangle","star"];for(let n=0;n<a.length;n++){const o=e,h=s+n*90,r=30;if(t>=o-r&&t<=o+r&&i>=h-r&&i<=h+r){this.isTestingMode||this.setTestingMode(!0),this.selectTestObject(a[n]);return}}this.isTestingMode}getStats(){return{epoch:this.epoch,currentLoss:this.currentLoss,currentAccuracy:this.currentAccuracy,learningRate:this.learningRate,speed:this.speed,trainingDataIndex:this.currentDataIndex,animationPhase:this.animationPhase,isTestingMode:this.isTestingMode,testingPhase:this.testingPhase}}render(){const t=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);t.addColorStop(0,"#1a1a2e"),t.addColorStop(1,"#16213e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawNetwork(),this.drawDataFlowParticles(),this.isTestingMode&&this.drawTestingParticles(),this.showLoss&&!this.isTestingMode&&this.drawTrainingInfo(),this.isTestingMode||this.drawDecisionBoundary(),this.isTestingMode&&this.drawTestingInfo(),this.drawPhaseIndicator(),this.drawTechnicalDetails(),this.isTestingMode&&this.drawObjectSelectionInterface(),!this.isTestingMode&&this.showTrainingIndicator&&this.drawTrainingIndicator()}drawDecisionBoundary(){const s=this.ctx.canvas.height-160-20,a=44,n=32;this.ctx.save(),this.ctx.fillStyle="rgba(26,26,46,0.6)",this.ctx.fillRect(18,s-2,224,164),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 12px Inter",this.ctx.textAlign="left",this.ctx.fillText("Decision Boundary",20,s-6),this.ctx.beginPath(),this.ctx.arc(150,s-9,3.5,0,Math.PI*2),this.ctx.strokeStyle="rgba(255, 184, 77, 0.95)",this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font="11px Inter",this.ctx.fillText("Misclassified",160,s-6);const o=this.dropoutRate;this.dropoutRate=0;for(let h=0;h<n;h++)for(let r=0;r<a;r++){const l=r/(a-1),c=h/(n-1);this.forwardPropagate([l,c]);const g=this.neurons[this.neurons.length-1][0].value,x=255*(1-g),u=120+120*g;this.ctx.fillStyle=`rgba(${x|0}, ${u|0}, 255, 0.35)`;const f=20+Math.floor(r/a*220),p=s+Math.floor(h/n*160);this.ctx.fillRect(f,p,Math.ceil(220/a),Math.ceil(160/n))}for(const h of this.trainingData){const r=Math.max(0,Math.min(1,h.input[0])),l=Math.max(0,Math.min(1,h.input[1]));this.forwardPropagate([r,l]);const g=this.neurons[this.neurons.length-1][0].value>.5?1:0,x=Array.isArray(h.output)?h.output[0]:h.output;if(g!==x){const u=20+r*220,f=s+l*160;this.ctx.beginPath(),this.ctx.arc(u,f,3.5,0,Math.PI*2),this.ctx.strokeStyle="rgba(255, 184, 77, 0.95)",this.ctx.lineWidth=1.5,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(u,f,2,0,Math.PI*2),this.ctx.fillStyle="rgba(255, 184, 77, 0.18)",this.ctx.fill()}}this.dropoutRate=o,this.ctx.strokeStyle="rgba(255,255,255,0.25)",this.ctx.strokeRect(18,s-2,224,164),this.ctx.restore()}drawObjectContext(){const i=this.ctx.canvas.height-100;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,i,250,80),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,i,250,80),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 14px Inter",this.ctx.textAlign="left",this.ctx.fillText("Training Object:",35,i+25),this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter",this.ctx.fillText(this.currentObject.object.toUpperCase(),35,i+45),this.ctx.fillStyle="#FFFFFF",this.ctx.font="11px Inter",this.ctx.fillText(this.currentObject.description,35,i+65),this.drawObjectRepresentation(220,i+40)}drawObjectRepresentation(t,i,e=null){this.ctx.save();const s=e||(this.currentObject?this.currentObject.object:null);if(!s){this.ctx.restore();return}switch(s){case"circle":this.ctx.beginPath(),this.ctx.fillStyle="#4ECDC4",this.ctx.arc(t,i,20,0,Math.PI*2),this.ctx.fill();break;case"square":this.ctx.fillStyle="#FF6B6B",this.ctx.fillRect(t-15,i-15,30,30);break;case"triangle":this.ctx.beginPath(),this.ctx.fillStyle="#2ECC71",this.ctx.moveTo(t,i-15),this.ctx.lineTo(t-15,i+15),this.ctx.lineTo(t+15,i+15),this.ctx.closePath(),this.ctx.fill();break;case"star":this.ctx.beginPath(),this.ctx.fillStyle="#F39C12";for(let a=0;a<5;a++){const n=a*2*Math.PI/5-Math.PI/2,o=20,h=10,r=t+Math.cos(n)*o,l=i+Math.sin(n)*o,c=t+Math.cos(n+Math.PI/5)*h,g=i+Math.sin(n+Math.PI/5)*h;a===0?this.ctx.moveTo(r,l):this.ctx.lineTo(r,l),this.ctx.lineTo(c,g)}this.ctx.closePath(),this.ctx.fill();break}this.ctx.restore()}drawNetwork(){this.showWeights&&this.drawConnections(),this.drawNeurons(),this.showGradients&&this.drawGradients()}drawTestingInfo(){const i=this.ctx.canvas.height-180;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(20,i,300,160),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(20,i,300,160),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("Network Testing Mode",35,i+25),this.ctx.font="13px Inter",this.ctx.fillStyle="#FFFFFF";let e=i+45;if(!this.isTrainingComplete){this.ctx.fillStyle="#FFD700",this.ctx.fillText("Training in Progress...",35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Please wait for training",35,e),e+=18,this.ctx.fillText("to complete before",35,e),e+=18,this.ctx.fillText("testing the network",35,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 11px Inter",this.ctx.fillText("Training the neural network...",35,e);return}if(this.testingPhase==="select")this.ctx.fillText("Object Recognition Testing",35,e),e+=18,this.ctx.fillText("Click on an object to test",35,e),e+=18,this.ctx.fillText("the neural network's",35,e),e+=18,this.ctx.fillText("classification ability",35,e),e+=15,this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 11px Inter",this.ctx.fillText("Features: [symmetry, edges]",35,e),e+=12,this.ctx.font="10px Inter",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("• Symmetry: 0-1 (high = simple)",35,e),e+=10,this.ctx.fillText("• Edges: 0-1 (high = complex)",35,e);else if(this.testingPhase==="processing")this.ctx.fillText("Analyzing Object...",35,e),e+=18,this.ctx.fillText("Network is processing",35,e),e+=18,this.ctx.fillText("input features and",35,e),e+=18,this.ctx.fillText("generating prediction",35,e);else if(this.testingPhase==="result"&&this.lastTestResult){const{object:s,predicted:a,confidence:n,isCorrect:o,output:h}=this.lastTestResult;this.ctx.fillText("Test Results:",35,e),e+=18,this.ctx.fillStyle="#FFD700",this.ctx.fillText(`${s.toUpperCase()} → ${a===1?"COMPLEX":"SIMPLE"}`,35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Output: ${h.toFixed(3)} | Confidence: ${n.toFixed(1)}%`,35,e),e+=18,this.ctx.fillStyle=o?"#2ECC71":"#E74C3C",this.ctx.fillText(`${o?"✓ CORRECT":"✗ INCORRECT"}`,35,e),e+=18,this.ctx.fillStyle="#FFFFFF",this.ctx.fillText("Click another object to test",35,e),this.drawTestResultsSummary(340,i,200,160)}}drawObjectSelectionInterface(){const t=this.ctx.canvas.width-80,i=this.ctx.canvas.height/2-120,e=["circle","square","triangle","star"],s=50,a=this.isTrainingComplete;for(let n=0;n<e.length;n++){const o=t,h=i+n*90,r=e[n],l=this.selectedTestObject&&this.selectedTestObject.object===r;l?(this.ctx.fillStyle="rgba(255, 215, 0, 0.3)",this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=3):a?(this.ctx.fillStyle="rgba(78, 205, 196, 0.15)",this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2):(this.ctx.fillStyle="rgba(128, 128, 128, 0.1)",this.ctx.strokeStyle="#666666",this.ctx.lineWidth=1),this.ctx.fillRect(o-25,h-25,s,s),this.ctx.strokeRect(o-25,h-25,s,s),a||(this.ctx.globalAlpha=.3),this.drawObjectRepresentation(o,h,r),this.ctx.globalAlpha=1,l?(this.ctx.fillStyle="#FFD700",this.ctx.font="bold 12px Inter"):a?(this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 11px Inter"):(this.ctx.fillStyle="#666666",this.ctx.font="bold 11px Inter"),this.ctx.textAlign="center",this.ctx.fillText(r.toUpperCase(),o,h+35)}}drawSparklineChart(t,i,e,s){if(this.lossHistory.length<2)return;this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(t,i,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,e,s);const a=this.lossHistory.slice(-20),n=this.accuracyHistory.slice(-20);if(a.length<2)return;const o=Math.max(...a),h=Math.min(...a),r=Math.max(...n),l=Math.min(...n);this.ctx.beginPath(),this.ctx.strokeStyle="#e74c3c",this.ctx.lineWidth=2;for(let c=0;c<a.length;c++){const g=t+c/(a.length-1)*e,x=(a[c]-h)/(o-h),u=i+s-x*s;c===0?this.ctx.moveTo(g,u):this.ctx.lineTo(g,u)}this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle="#27ae60",this.ctx.lineWidth=2;for(let c=0;c<n.length;c++){const g=t+c/(n.length-1)*e,x=(n[c]-l)/(r-l),u=i+s-x*s;c===0?this.ctx.moveTo(g,u):this.ctx.lineTo(g,u)}this.ctx.stroke(),this.ctx.fillStyle="#e74c3c",this.ctx.font="bold 10px Inter",this.ctx.textAlign="left",this.ctx.fillText("Loss",t+5,i+12),this.ctx.fillStyle="#27ae60",this.ctx.fillText("Accuracy",t+5,i+25)}drawTestResultsSummary(t,i,e,s){if(this.testResults.length===0)return;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(t,i,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=2,this.ctx.strokeRect(t,i,e,s),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 14px Inter",this.ctx.textAlign="left",this.ctx.fillText("Test History:",t+10,i+20);const a=this.testResults.length,n=this.testResults.filter(l=>l.isCorrect).length,o=a>0?(n/a*100).toFixed(1):"0.0";this.ctx.font="12px Inter",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Total: ${a} | Correct: ${n}`,t+10,i+40),this.ctx.fillText(`Accuracy: ${o}%`,t+10,i+55);const h=this.testResults.slice(-5);let r=i+75;this.ctx.font="bold 11px Inter",this.ctx.fillText("Recent:",t+10,r),r+=15,this.ctx.font="10px Inter";for(const l of h){const c=l.isCorrect?"✓":"✗",g=l.isCorrect?"#2ECC71":"#E74C3C";this.ctx.fillStyle=g,this.ctx.fillText(`${l.object.toUpperCase()}: ${l.predicted===1?"COMPLEX":"SIMPLE"} ${c}`,t+10,r),r+=12}}drawTestingParticles(){for(const t of this.testingParticles){const i=t.x+(t.targetX-t.x)*t.progress,e=t.y+(t.targetY-t.y)*t.progress;this.ctx.beginPath(),this.ctx.fillStyle=`rgba(255, 215, 0, ${1-t.progress})`,this.ctx.arc(i,e,t.size,0,Math.PI*2),this.ctx.fill()}}drawTrainingIndicator(){const t=this.ctx.canvas.width/2,i=this.ctx.canvas.height/2;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);const e=500,s=200,a=t-e/2,n=i-s/2;this.ctx.fillStyle="rgba(26, 26, 46, 0.95)",this.ctx.fillRect(a,n,e,s),this.ctx.strokeStyle="#4ECDC4",this.ctx.lineWidth=3,this.ctx.strokeRect(a,n,e,s),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 20px Inter",this.ctx.textAlign="center",this.ctx.fillText("Initializing Neural Network",t,n+35);const o=this.trainingData[this.trainingIndicatorObjectIndex];this.ctx.fillStyle="#FFD700",this.ctx.font="bold 16px Inter",this.ctx.fillText(`Training on: ${o.object.toUpperCase()}`,t,n+60),this.ctx.fillStyle="#FFFFFF",this.ctx.font="13px Inter",this.ctx.fillText(o.description,t,n+85),this.ctx.fillStyle="#4ECDC4",this.ctx.font="12px Inter",this.ctx.fillText(`Features: [${o.input[0].toFixed(1)}, ${o.input[1].toFixed(1)}]`,t,n+105),this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`Expected: ${o.output[0]===0?"Simple":"Complex"}`,t,n+125),this.drawObjectRepresentation(t+180,n+80,o.object);const h=this.trainingIndicatorTime/this.trainingIndicatorDuration,r=400,l=8,c=t-r/2,g=n+150;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.ctx.fillRect(c,g,r,l),this.ctx.fillStyle="#4ECDC4",this.ctx.fillRect(c,g,r*h,l),this.ctx.fillStyle="#FFFFFF",this.ctx.font="12px Inter",this.ctx.fillText(`${Math.round(h*100)}%`,t,g+25)}}class kt extends L{constructor(t){super(t),this.canvas=t.canvas,this.codePanel={x:50,y:50,width:500,height:300},this.stackPanel={x:580,y:50,width:220,height:300},this.heapPanel={x:25,y:380,width:750,height:200},this.outputPanel={x:500,y:400,width:300,height:200},this.controlButtons=[{id:"play",label:"▶",x:560,y:15,width:35,height:30,tooltip:"Play/Pause"},{id:"step",label:"⏭",x:600,y:15,width:35,height:30,tooltip:"Step Forward"},{id:"reset",label:"⟲",x:640,y:15,width:35,height:30,tooltip:"Reset"},{id:"speed",label:"⚡",x:680,y:15,width:35,height:30,tooltip:"Speed"}],this.hoveredButton=null,this.speedOptions=[.5,1,2,4],this.currentSpeedIndex=2,this.animationSpeed=this.speedOptions[this.currentSpeedIndex],this.setupCanvasEventListeners(),this.program={name:"Image Processing App",functions:[{name:"main()",lines:["function main() {","  let image = loadImage();","  let result = processImage(image);","  saveImage(result);","  cleanup(image, result);","  return 0;","}"],variables:[]},{name:"loadImage()",lines:["function loadImage() {","  let pixels = malloc(2048);","  let metadata = malloc(256);","  // Load image data","  return pixels;","}"],variables:[]},{name:"processImage()",lines:["function processImage(img) {","  let output = malloc(2048);","  let temp = malloc(512);","  applyFilter(img, output, temp);","  free(temp);","  return output;","}"],variables:[]},{name:"applyFilter()",lines:["function applyFilter(src, dst, tmp) {","  // Apply blur filter","  return;","}"],variables:[]},{name:"saveImage()",lines:["function saveImage(img) {","  let buffer = malloc(1024);","  // Write to file","  free(buffer);","  return;","}"],variables:[]},{name:"cleanup()",lines:["function cleanup(img, result) {","  free(img);","  free(result);","  return;","}"],variables:[]},{name:"malloc()",lines:["function malloc(size) {","  // Allocate from heap","  return heapPointer;","}"],variables:[]},{name:"free()",lines:["function free(ptr) {","  // Return to heap","  markAsFree(ptr);","}"],variables:[]}]},this.currentFunction=0,this.currentLine=0,this.executionStep=0,this.programCounter=0,this.callStack=[],this.heapBlocks=[],this.freeBlocks=[],this.output=[],this.nextHeapAddress=4096,this.nextStackAddress=8192,this.memoryData=new Map,this.variableAddresses=new Map,this.animationState="idle",this.animationTime=0,this.executionSpeed=1,this.isAutoRunning=!1,this.animationSpeed=2,this.highlightedLine=-1,this.executionPointer={x:0,y:0},this.particles=[],this.memoryAccesses=[],this.dataFlowParticles=[],this.addressHighlights=[],this.allocationEffects=[],this.deallocationEffects=[],this.memoryFlowLines=[],this.stackFrameAnimations=[],this.variableConnections=[],this.executionTrail=[],this.memoryFragmentation=[],this.performanceMetrics={totalCycles:0,memoryEfficiency:0,fragmentationLevel:0,averageAccessTime:0},this.totalAllocations=0,this.totalDeallocations=0,this.memoryLeaks=0,this.currentMemoryUsage=0,this.memoryAccessCount=0,this.showStats=!1,this.showOutput=!1,this.gcState={isRunning:!1,phase:"idle",markedBlocks:new Set,gcParticles:[],phaseTime:0,phaseDuration:2},this.initializeExecution()}setupCanvasEventListeners(){this.boundMouseMoveHandler=t=>{const i=this.canvas.getBoundingClientRect(),e=(t.clientX-i.left)*(this.canvas.width/i.width),s=(t.clientY-i.top)*(this.canvas.height/i.height);this.hoveredButton=null;for(const a of this.controlButtons)if(e>=a.x&&e<=a.x+a.width&&s>=a.y&&s<=a.y+a.height){this.hoveredButton=a.id,this.canvas.style.cursor="pointer";break}this.hoveredButton||(this.canvas.style.cursor="default")},this.boundClickHandler=t=>{const i=this.canvas.getBoundingClientRect(),e=(t.clientX-i.left)*(this.canvas.width/i.width),s=(t.clientY-i.top)*(this.canvas.height/i.height);for(const a of this.controlButtons)if(e>=a.x&&e<=a.x+a.width&&s>=a.y&&s<=a.y+a.height){this.handleButtonClick(a.id);break}},this.canvas.addEventListener("mousemove",this.boundMouseMoveHandler),this.canvas.addEventListener("click",this.boundClickHandler)}handleButtonClick(t){switch(t){case"play":this.isAutoRunning=!this.isAutoRunning,this.isAutoRunning&&this.currentFunction===0&&this.currentLine>=this.program.functions[0].lines.length&&(this.resetExecution(),this.isAutoRunning=!0);break;case"step":this.isAutoRunning=!1,(this.animationState==="idle"||this.animationState==="executing")&&(this.animationState="idle",this.executeNextStep());break;case"reset":this.resetExecution();break;case"speed":this.currentSpeedIndex=(this.currentSpeedIndex+1)%this.speedOptions.length,this.animationSpeed=this.speedOptions[this.currentSpeedIndex];break}}resetExecution(){this.currentFunction=0,this.currentLine=0,this.executionStep=0,this.programCounter=0,this.callStack=[],this.highlightedLine=0,this.animationState="idle",this.isAutoRunning=!1,this.heapBlocks=[],this.variableAddresses=new Map,this.memoryData=new Map,this.output=[],this.particles=[],this.memoryAccesses=[],this.addressHighlights=[],this.allocationEffects=[],this.dataFlowParticles=[],this.totalAllocations=0,this.totalDeallocations=0,this.memoryLeaks=0,this.currentMemoryUsage=0,this.memoryAccessCount=0,this.initializeExecution()}initializeExecution(){this.heapBlocks=[],this.freeBlocks=[{address:4096,size:8192,x:this.heapPanel.x+20,y:this.heapPanel.y+20,width:this.heapPanel.width-40,height:40}],this.callStack=[],this.output=[],this.output.push("🎬 Ready to execute. Click ▶ to start or ⏭ to step through."),this.memoryData.clear(),this.variableAddresses.clear(),this.currentFunction=0,this.currentLine=0,this.executionStep=0,this.programCounter=0,this.highlightedLine=0}startExecution(){this.isAutoRunning=!1,this.animationState="idle",this.executionStep=0}setAnimationSpeed(t){this.animationSpeed=Math.max(.1,Math.min(3,t))}setShowStats(t){this.showStats=t}setShowOutput(t){this.showOutput=t}executeNextStep(){if(this.animationState!=="idle")return;if(this.currentFunction<0||this.currentFunction>=this.program.functions.length){this.output.push(`❌ Invalid function index: ${this.currentFunction}`);return}const t=this.program.functions[this.currentFunction];if(this.currentLine<0||this.currentLine>=t.lines.length){this.output.push(`❌ Invalid line index: ${this.currentLine}`);return}const i=t.lines[this.currentLine];if(!i){this.output.push(`🔚 Function ${this.program.functions[this.currentFunction].name} finished`),this.returnFromFunction();return}if(this.currentFunction===0&&this.currentLine>=t.lines.length&&this.callStack.length===0){this.output.push("✅ Program execution complete"),this.isAutoRunning=!1,this.animationState="idle";for(let e=0;e<50;e++)this.particles.push({x:this.canvas.width/2,y:this.canvas.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:3,color:"#FFD700",type:"completion"});return}this.animationState="executing",this.animationTime=0,this.highlightedLine=this.currentLine,setTimeout(()=>{i.trim().startsWith("//")||i.trim().startsWith("/*")||i.trim().startsWith("*")?this.currentLine++:i.includes("function")&&i.includes("{")?this.currentLine++:i.includes("(")&&i.includes(")")&&!i.includes("malloc")&&!i.includes("free")&&!i.includes("function")&&!i.trim().startsWith("//")?this.callFunction(i):i.includes("malloc")?(this.allocateMemory(i),this.currentLine++):i.includes("free")?(this.deallocateMemory(i),this.currentLine++):i.includes("return")?this.returnFromFunction():i.includes("readFile")||i.includes("writeFile")||i.includes("decodeImage")||i.includes("applyFilter")||i.includes("compressImage")?(this.accessMemory(i),this.currentLine++):(this.executeRegularLine(i),this.currentLine++),this.executionStep++,setTimeout(()=>{this.animationState="idle"},300/this.animationSpeed)},200/this.animationSpeed)}callFunction(t){const i=t.match(/(\w+)\(/);if(i){const e=i[1];let s=-1;s=this.program.functions.findIndex(a=>a.name===e+"()"),s===-1&&(s=this.program.functions.findIndex(a=>a.name===e)),s===-1&&(s=this.program.functions.findIndex(a=>a.name.replace("()","")===e)),s!==-1?(this.callStack.push({functionIndex:this.currentFunction,lineIndex:this.currentLine,returnAddress:this.programCounter,variables:new Map(this.variableAddresses)}),this.currentFunction=s,this.currentLine=0,this.programCounter=s*100,this.highlightedLine=0,this.output.push(`📞 Calling ${e}()`),this.showStackFrameCreation()):this.output.push(`⚠️ Function not found: ${e}`)}}allocateMemory(t){const i=t.match(/malloc\((\d+)\)/);if(i){const e=parseInt(i[1]),s=this.extractVariableName(t);this.output.push(`📦 Allocating ${e} bytes for ${s}`),this.allocateMemoryBlock(e,s,t)}else{const e=t.match(/malloc\s*\(\s*(\d+)\s*\)/),s=t.match(/malloc\((\d+)\)/);if(e){const a=parseInt(e[1]),n=this.extractVariableName(t);this.allocateMemoryBlock(a,n,t)}else if(s){const a=parseInt(s[1]),n=this.extractVariableName(t);this.allocateMemoryBlock(a,n,t)}}}deallocateMemory(t){const i=t.match(/free\((\w+)\)/);if(i){const e=i[1];this.output.push(`🗑️ Freeing memory for ${e}`),this.deallocateMemoryBlock(e,t)}else{const e=t.match(/free\s*\(\s*(\w+)\s*\)/),s=t.match(/free\((\w+)\)/);if(e){const a=e[1];this.deallocateMemoryBlock(a,t)}else if(s){const a=s[1];this.deallocateMemoryBlock(a,t)}}}accessMemory(t){const i=this.extractVariableName(t),e=this.variableAddresses.get(i);e&&(this.showMemoryAccess(e,i,t),this.output.push(`🔍 Accessing memory at 0x${e.toString(16)} for ${i}`),this.memoryAccessCount++)}returnFromFunction(){if(this.callStack.length>0){const t=this.callStack.pop(),i=new Map(this.variableAddresses);this.currentFunction=t.functionIndex,this.currentLine=t.lineIndex,this.programCounter=t.returnAddress,this.variableAddresses=new Map(t.variables);const e=this.program.functions[t.functionIndex].lines[t.lineIndex];if(e&&e.includes("=")&&e.includes("(")){const a=e.match(/(?:let\s+)?(\w+)\s*=\s*\w+\(/);if(a){const n=a[1],o=this.findReturnedVariable(i);if(o&&i.has(o)){const h=i.get(o);this.variableAddresses.set(n,h),this.output.push(`📝 Return value assigned to ${n}`)}}}this.output.push("↩️ Returning from function"),this.showStackFrameRemoval(),this.currentLine++,this.highlightedLine=this.currentLine;const s=this.program.functions[this.currentFunction];if(this.output.push(`🔍 Debug: currentFunction=${this.currentFunction}, currentLine=${this.currentLine}, lines.length=${s.lines.length}`),this.currentFunction===0&&this.currentLine>=s.lines.length){this.output.push("✅ Program execution complete"),this.isAutoRunning=!1,this.animationState="idle";for(let a=0;a<50;a++)this.particles.push({x:this.canvas.width/2,y:this.canvas.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:3,color:"#FFD700",type:"completion"});return}}else this.output.push("✅ Program execution complete"),this.isAutoRunning=!1}executeRegularLine(t){}findReturnedVariable(t){let i=null;for(const[e,s]of t.entries())!e.startsWith("temp")&&e!=="ptr"&&(i=e);return i}allocateMemoryBlock(t,i,e){const s=this.findBestFitBlock(t);if(!s){this.output.push("❌ Out of memory!");return}const a=this.freeBlocks.findIndex(u=>u.address===s.address&&u.size===s.size);a!==-1&&this.freeBlocks.splice(a,1);const n=this.heapPanel.width-40,o=this.heapPanel.height-40,r=t/8192,l=Math.max(50,Math.min(n*.2,n*r*.6)),c=Math.max(35,Math.min(o*.4,o*r*1.2)),g={address:s.address,size:t,name:i,data:this.generateRandomData(t),isAllocated:!0,width:l,height:c},x=this.findNonOverlappingPosition(g,s);g.x=x.x,g.y=x.y,this.heapBlocks.push(g),this.totalAllocations++,this.currentMemoryUsage+=t,this.memoryData.set(g.address,g.data),this.variableAddresses.set(i,g.address),this.updateFreeBlocks(),this.addAllocationEffect(g),this.output.push(`📦 Allocated ${t} bytes at 0x${g.address.toString(16)} for ${i}`),this.showAddressHighlight(g.address,"allocation")}deallocateMemoryBlock(t,i){const e=this.variableAddresses.get(t),s=this.heapBlocks.findIndex(a=>a.address===e);if(s!==-1){const a=this.heapBlocks[s];this.addDeallocationEffect(a),this.createMemoryClearingParticles(a),this.heapBlocks.splice(s,1),this.totalDeallocations++,this.currentMemoryUsage-=a.size,this.memoryData.delete(a.address),this.variableAddresses.delete(t),this.updateFreeBlocks(),this.output.push(`🗑️ Freed memory at 0x${a.address.toString(16)} for ${t}`),this.showAddressHighlight(a.address,"deallocation")}else this.output.push(`⚠️ Attempted to free unallocated variable: ${t}`),this.memoryLeaks++}showMemoryAccess(t,i,e){this.memoryAccesses.push({address:t,varName:i,operation:e,time:0,duration:1.5}),this.createDataFlowParticles(t,i)}showAddressHighlight(t,i){this.addressHighlights.push({address:t,type:i,time:0,duration:2})}showStackFrameCreation(){for(let t=0;t<10;t++)this.particles.push({x:this.stackPanel.x+this.stackPanel.width/2,y:this.stackPanel.y+this.stackPanel.height,vx:(Math.random()-.5)*3,vy:-Math.random()*2,life:1,color:"#3498db",type:"stack_frame"})}showStackFrameRemoval(){for(let t=0;t<8;t++)this.particles.push({x:this.stackPanel.x+this.stackPanel.width/2,y:this.stackPanel.y+50,vx:(Math.random()-.5)*4,vy:Math.random()*3,life:1,color:"#F39C12",type:"stack_removal"})}createDataFlowParticles(t,i){const e=this.heapBlocks.find(s=>s.address===t);if(e)for(let s=0;s<15;s++)this.dataFlowParticles.push({x:e.x+e.width/2,y:e.y+e.height/2,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,life:1,color:"#FFD700",type:"data_flow"})}createMemoryClearingParticles(t){for(let i=0;i<20;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1.5,color:"#FF6B6B",type:"memory_clear"});for(let i=0;i<10;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*2,vy:-Math.random()*3-1,life:2,color:"#FFD700",type:"data_clear"})}extractVariableName(t){let i=t.match(/let\s+(\w+)\s*=/);return i?i[1]:(i=t.match(/malloc\((\d+)\)/),i?`malloc_${i[1]}`:"unknown")}findBestFitBlock(t){for(const i of this.freeBlocks)if(i.size>=t)return i;return null}findNonOverlappingPosition(t,i){const e={x:this.heapPanel.x+20,y:this.heapPanel.y+20,width:this.heapPanel.width-40,height:this.heapPanel.height-40},s=Math.max(t.width,t.height)+10,a=Math.floor(e.width/s),n=Math.floor(e.height/s);for(let h=0;h<n;h++)for(let r=0;r<a;r++){const l=e.x+r*s,c=e.y+h*s;let g=!1;for(const x of this.heapBlocks)if(this.blocksOverlap({x:l,y:c,width:t.width,height:t.height},x)){g=!0;break}if(!g)return{x:l,y:c}}const o=30;for(let h=0;h<o;h++){const r=e.x+Math.random()*(e.width-t.width),l=e.y+Math.random()*(e.height-t.height);let c=!1;for(const g of this.heapBlocks)if(this.blocksOverlap({x:r,y:l,width:t.width,height:t.height},g)){c=!0;break}if(!c)return{x:r,y:l}}return{x:i.x+(i.width-t.width)/2,y:i.y+(i.height-t.height)/2}}blocksOverlap(t,i){return!(t.x+t.width<=i.x||i.x+i.width<=t.x||t.y+t.height<=i.y||i.y+i.height<=t.y)}updateFreeBlocks(){this.freeBlocks=[];const t=8192,i=this.heapBlocks.reduce((s,a)=>s+a.size,0),e=t-i;if(e>0){const s=this.calculateFragmentedFreeBlocks();if(this.freeBlocks.push(...s),s.length===0&&e>0){const a=this.heapBlocks.length>0?Math.max(...this.heapBlocks.map(o=>o.address+o.size)):4096,n={address:a,size:e,x:this.heapPanel.x+20+(a-4096)/t*(this.heapPanel.width-40),y:this.heapPanel.y+this.heapPanel.height-70,width:Math.max(30,e/t*(this.heapPanel.width-40)),height:50};this.freeBlocks.push(n)}}}calculateFragmentedFreeBlocks(){const t=[],e=[...this.heapBlocks].sort((a,n)=>a.address-n.address);let s=4096;for(const a of e){if(a.address>s){const n=a.address-s;if(n>=128){const o=Math.max(20,n/8192*(this.heapPanel.width-40)),h=Math.max(30,Math.min(40,o*.4));t.push({address:s,size:n,x:this.heapPanel.x+20+(s-4096)/8192*(this.heapPanel.width-40),y:this.heapPanel.y+20,width:o,height:h})}}s=a.address+a.size}if(s<12288){const a=12288-s;if(a>=128){const n=Math.max(20,a/8192*(this.heapPanel.width-40)),o=Math.max(30,Math.min(40,n*.4));t.push({address:s,size:a,x:this.heapPanel.x+20+(s-4096)/8192*(this.heapPanel.width-40),y:this.heapPanel.y+20,width:n,height:o})}}return t}generateRandomData(t){const i=[];for(let e=0;e<t;e++)i.push(Math.floor(Math.random()*256));return i}addAllocationEffect(t){for(let i=0;i<35;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:2,color:"#4ECDC4",type:"allocation",size:Math.random()*3+2});for(let i=0;i<15;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y+t.height,vx:(Math.random()-.5)*3,vy:-Math.random()*5-3,life:2.5,color:"#4ECDC4",type:"allocation_float",spiral:Math.random()*Math.PI*2,spiralSpeed:(Math.random()-.5)*.1});this.memoryAccesses.push({address:t.address,varName:t.name,operation:"allocation",time:0,duration:2,type:"allocation",pulse:0}),this.allocationEffects=this.allocationEffects||[],this.allocationEffects.push({block:t,time:0,duration:1.2,type:"grow",originalWidth:t.width*.3,originalHeight:t.height*.3}),this.variableConnections.push({from:{x:this.codePanel.x+350,y:this.codePanel.y+70},to:{x:t.x+t.width/2,y:t.y+t.height/2},time:0,duration:1.5,varName:t.name}),this.performanceMetrics.totalCycles++,this.performanceMetrics.memoryEfficiency=this.currentMemoryUsage/8192*100}addDeallocationEffect(t){for(let i=0;i<40;i++)this.particles.push({x:t.x+t.width/2,y:t.y+t.height/2,vx:(Math.random()-.5)*10,vy:(Math.random()-.5)*10,life:2,color:"#FF6B6B",type:"deallocation",size:Math.random()*4+3});for(let i=0;i<20;i++){const e=Math.random()*Math.PI*2,s=Math.random()*50+20;this.particles.push({x:t.x+t.width/2+Math.cos(e)*s,y:t.y+t.height/2+Math.sin(e)*s,vx:(t.x+t.width/2-(t.x+t.width/2+Math.cos(e)*s))*.1,vy:(t.y+t.height/2-(t.y+t.height/2+Math.sin(e)*s))*.1,life:1.5,color:"#FF6B6B",type:"deallocation_implosion"})}for(let i=0;i<20;i++)this.particles.push({x:t.x+Math.random()*t.width,y:t.y,vx:(Math.random()-.5)*4,vy:Math.random()*6+3,life:2.5,color:"#FF6B6B",type:"deallocation_fall",gravity:.2});this.memoryAccesses.push({address:t.address,varName:t.name,operation:"deallocation",time:0,duration:2,type:"deallocation",fade:1}),this.deallocationEffects=this.deallocationEffects||[],this.deallocationEffects.push({block:t,time:0,duration:1.5,type:"shrink",originalWidth:t.width,originalHeight:t.height}),this.memoryFragmentation.push({x:t.x+t.width/2,y:t.y+t.height/2,time:0,duration:3,size:t.width*t.height}),this.performanceMetrics.fragmentationLevel=this.calculateFragmentationLevel()}calculateFragmentationLevel(){if(this.freeBlocks.length===0)return 0;const t=this.freeBlocks.reduce((s,a)=>s+a.size,0),i=Math.max(...this.freeBlocks.map(s=>s.size)),e=(t-i)/t;return Math.min(100,e*100)}runGarbageCollection(){this.gcState.isRunning||(this.gcState.isRunning=!0,this.gcState.phase="mark",this.gcState.phaseTime=0,this.gcState.markedBlocks.clear(),this.gcState.gcParticles=[],this.output.push("🗑️ Starting Garbage Collection..."),this.markReachableBlocks())}markReachableBlocks(){for(const[t,i]of this.variableAddresses){const e=this.heapBlocks.find(s=>s.address===i);e&&(this.gcState.markedBlocks.add(e.address),this.createGCMarkEffect(e))}for(const t of this.heapBlocks)this.gcState.markedBlocks.has(t.address)?this.createGCMarkEffect(t):this.createGCPotentialUnreachableEffect(t);this.output.push(`✅ Marked ${this.gcState.markedBlocks.size} reachable blocks`)}sweepUnreachableBlocks(){const t=[];for(const i of this.heapBlocks)this.gcState.markedBlocks.has(i.address)||t.push(i);for(const i of t)this.freeUnreachableBlock(i);this.output.push(`🧹 Swept ${t.length} unreachable blocks`)}freeUnreachableBlock(t){const i=this.heapBlocks.findIndex(e=>e.address===t.address);i!==-1&&this.heapBlocks.splice(i,1),this.freeBlocks.push({address:t.address,size:t.size,x:t.x,y:t.y,width:t.width,height:t.height}),this.createGCDeallocationEffect(t),this.totalDeallocations++,this.currentMemoryUsage-=t.size}createGCMarkEffect(t){for(let i=0;i<8;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*60,vy:(Math.random()-.5)*60,life:2,color:"#FFD700",type:"mark"})}createGCPotentialUnreachableEffect(t){for(let i=0;i<6;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*50,vy:(Math.random()-.5)*50,life:1.5,color:"#FFA500",type:"potential_unreachable"})}createGCDeallocationEffect(t){for(let i=0;i<6;i++)this.gcState.gcParticles.push({x:t.x+Math.random()*t.width,y:t.y+Math.random()*t.height,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.5,color:"#FF6B6B",type:"sweep"})}updateGarbageCollection(t){if(this.gcState.isRunning){this.gcState.phaseTime+=t;for(let i=this.gcState.gcParticles.length-1;i>=0;i--){const e=this.gcState.gcParticles[i];e.x+=e.vx*t,e.y+=e.vy*t,e.life-=t*2,e.life<=0&&this.gcState.gcParticles.splice(i,1)}this.gcState.phase==="mark"&&this.gcState.phaseTime>=this.gcState.phaseDuration?(this.gcState.phase="sweep",this.gcState.phaseTime=0,this.sweepUnreachableBlocks()):this.gcState.phase==="sweep"&&this.gcState.phaseTime>=this.gcState.phaseDuration&&(this.gcState.isRunning=!1,this.gcState.phase="idle",this.output.push("✅ Garbage Collection Complete"))}}update(t){const i=t/1e3;this.isAutoRunning&&this.animationState==="idle"&&(this.animationTime+=i,this.animationTime>=.5/this.animationSpeed&&(this.executeNextStep(),this.animationTime=0));for(let s=this.particles.length-1;s>=0;s--){const a=this.particles[s];if(a.type==="allocation_float"&&a.spiral!==void 0&&(a.spiral+=a.spiralSpeed||.05,a.x+=Math.cos(a.spiral)*.5,a.y+=Math.sin(a.spiral)*.5),a.type==="deallocation_fall"&&a.gravity&&(a.vy+=a.gravity),a.type==="deallocation_implosion"){const n=a.vx,o=a.vy;a.x+=n,a.y+=o}else a.x+=a.vx,a.y+=a.vy;a.type!=="allocation_float"&&a.type!=="deallocation_implosion"&&(a.vy+=.1),a.life-=i*2,a.life<=0&&this.particles.splice(s,1)}for(let s=this.dataFlowParticles.length-1;s>=0;s--){const a=this.dataFlowParticles[s];a.x+=a.vx,a.y+=a.vy,a.life-=i*3,a.life<=0&&this.dataFlowParticles.splice(s,1)}for(let s=this.memoryAccesses.length-1;s>=0;s--){const a=this.memoryAccesses[s];a.time+=i,a.time>=a.duration&&this.memoryAccesses.splice(s,1)}for(let s=this.addressHighlights.length-1;s>=0;s--){const a=this.addressHighlights[s];a.time+=i,a.time>=a.duration&&this.addressHighlights.splice(s,1)}for(let s=this.allocationEffects.length-1;s>=0;s--){const a=this.allocationEffects[s];a.time+=i,a.time>=a.duration&&this.allocationEffects.splice(s,1)}for(let s=this.deallocationEffects.length-1;s>=0;s--){const a=this.deallocationEffects[s];a.time+=i,a.time>=a.duration&&this.deallocationEffects.splice(s,1)}for(let s=this.variableConnections.length-1;s>=0;s--){const a=this.variableConnections[s];a.time+=i,a.time>=a.duration&&this.variableConnections.splice(s,1)}for(let s=this.memoryFragmentation.length-1;s>=0;s--){const a=this.memoryFragmentation[s];a.time+=i,a.time>=a.duration&&this.memoryFragmentation.splice(s,1)}this.highlightedLine>=0&&this.executionTrail.push({x:this.codePanel.x+15,y:this.codePanel.y+50+this.highlightedLine*20,time:0,duration:2});for(let s=this.executionTrail.length-1;s>=0;s--)this.executionTrail[s].time+=i,this.executionTrail[s].time>=this.executionTrail[s].duration&&this.executionTrail.splice(s,1);this.executionTrail.length>20&&this.executionTrail.splice(0,this.executionTrail.length-20),this.updateGarbageCollection(i),this.performanceMetrics.totalCycles=this.executionStep,this.performanceMetrics.fragmentationLevel=this.calculateFragmentationLevel(),this.totalAllocations+this.totalDeallocations>0?this.performanceMetrics.memoryEfficiency=Math.max(0,(this.totalAllocations-this.memoryLeaks)/this.totalAllocations*100):this.performanceMetrics.memoryEfficiency=100,this.performanceMetrics.averageAccessTime=this.memoryAccessCount>0?this.executionStep/this.memoryAccessCount:0}render(){this.drawBackground(),this.drawControlButtons(),this.drawCodePanel(),this.drawStackPanel(),this.drawHeapPanel(),this.drawOutputPanel(),this.drawExecutionPointer(),this.drawExecutionTrail(),this.drawMemoryAccesses(),this.drawAddressHighlights(),this.drawVariableConnections(),this.drawMemoryFragmentation(),this.drawParticles(),this.drawDataFlowParticles(),this.drawAllocationEffects(),this.drawGarbageCollectionEffects(),this.drawStatistics()}drawBackground(){const t=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);t.addColorStop(0,"#1a1f2e"),t.addColorStop(.5,"#252b3a"),t.addColorStop(1,"#1a1f2e"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="rgba(46, 204, 113, 0.08)",this.ctx.lineWidth=1;const i=60,e=this.animationTime*15%i;for(let s=-e;s<this.canvas.height+i;s+=i*1.5)for(let a=-e;a<this.canvas.width+i;a+=i*1.3){this.ctx.beginPath();for(let n=0;n<6;n++){const o=n*Math.PI/3,h=a+i*.5*Math.cos(o),r=s+i*.5*Math.sin(o);n===0?this.ctx.moveTo(h,r):this.ctx.lineTo(h,r)}this.ctx.closePath(),this.ctx.stroke()}}drawControlButtons(){for(const t of this.controlButtons){const i=this.hoveredButton===t.id,e=this.ctx.createLinearGradient(t.x,t.y,t.x,t.y+t.height);if(i?(e.addColorStop(0,"#5a9fd4"),e.addColorStop(1,"#4a8fc4")):(e.addColorStop(0,"#3a5f84"),e.addColorStop(1,"#2a4f74")),this.ctx.fillStyle=e,this.roundRect(t.x,t.y,t.width,t.height,6),this.ctx.fill(),this.ctx.strokeStyle=i?"#7eb3d9":"#4a6f94",this.ctx.lineWidth=1.5,this.roundRect(t.x,t.y,t.width,t.height,6),this.ctx.stroke(),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",t.id==="play"?this.ctx.fillText(this.isAutoRunning?"⏸":"▶",t.x+t.width/2,t.y+t.height/2):t.id==="speed"?(this.ctx.font="bold 11px Arial",this.ctx.fillText(`${this.speedOptions[this.currentSpeedIndex]}x`,t.x+t.width/2,t.y+t.height/2)):this.ctx.fillText(t.label,t.x+t.width/2,t.y+t.height/2),i){const s=t.x+t.width/2,a=t.y+t.height+8;this.ctx.fillStyle="rgba(0, 0, 0, 0.8)";const n=this.ctx.measureText(t.tooltip).width+12;this.ctx.fillRect(s-n/2,a,n,20),this.ctx.fillStyle="#ffffff",this.ctx.font="10px Arial",this.ctx.fillText(t.tooltip,s,a+10)}}}drawCodePanel(){for(let a=0;a<20;a++){const n=a*137.5%this.canvas.width,o=(a*73.3+this.animationTime*10)%this.canvas.height,h=.3+.2*Math.sin(this.animationTime*2+a);this.ctx.fillStyle=`rgba(46, 204, 113, ${h})`,this.ctx.beginPath(),this.ctx.arc(n,o,1,0,Math.PI*2),this.ctx.fill()}const t=this.canvas.width/2,i=this.canvas.height/2,e=Math.min(this.canvas.width,this.canvas.height)*.8,s=this.ctx.createRadialGradient(t,i,0,t,i,e);s.addColorStop(0,"rgba(46, 204, 113, 0.05)"),s.addColorStop(1,"rgba(46, 204, 113, 0)"),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawCodePanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.4)",this.ctx.fillRect(this.codePanel.x+4,this.codePanel.y+4,this.codePanel.width,this.codePanel.height);const t=this.ctx.createLinearGradient(this.codePanel.x,this.codePanel.y,this.codePanel.x,this.codePanel.y+this.codePanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.98)"),t.addColorStop(.5,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.92)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.codePanel.x,this.codePanel.y,this.codePanel.width,this.codePanel.height),this.ctx.shadowColor="rgba(100, 200, 255, 0.3)",this.ctx.shadowBlur=6,this.ctx.lineWidth=1.5,this.ctx.strokeStyle="#5a9fd4",this.roundRect(this.codePanel.x,this.codePanel.y,this.codePanel.width,this.codePanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#7eb3d9",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("💻 Code Execution",this.codePanel.x+15,this.codePanel.y+25);const i=this.program.functions[this.currentFunction];this.ctx.font='12px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.textAlign="left",this.ctx.textBaseline="middle";for(let e=0;e<i.lines.length;e++){const s=i.lines[e],a=this.codePanel.y+50+e*20;e===this.highlightedLine&&(this.ctx.fillStyle="rgba(100, 150, 200, 0.08)",this.ctx.fillRect(this.codePanel.x+8,a-10,this.codePanel.width-16,20),this.ctx.strokeStyle="rgba(100, 150, 200, 0.3)",this.ctx.lineWidth=1,this.ctx.strokeRect(this.codePanel.x+8,a-10,this.codePanel.width-16,20)),this.ctx.fillStyle="#888888",this.ctx.font='10px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.fillText(`${e+1}`,this.codePanel.x+15,a),this.ctx.fillStyle=e===this.highlightedLine?"#ffffff":"#e0e0e0",this.ctx.font='12px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.fillText(s,this.codePanel.x+35,a)}}drawStackPanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(this.stackPanel.x+3,this.stackPanel.y+3,this.stackPanel.width,this.stackPanel.height);const t=this.ctx.createLinearGradient(this.stackPanel.x,this.stackPanel.y,this.stackPanel.x,this.stackPanel.y+this.stackPanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.9)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.stackPanel.x,this.stackPanel.y,this.stackPanel.width,this.stackPanel.height),this.ctx.shadowColor="rgba(100, 150, 255, 0.3)",this.ctx.shadowBlur=6,this.ctx.lineWidth=1.5,this.ctx.strokeStyle="#6a8fc4",this.roundRect(this.stackPanel.x,this.stackPanel.y,this.stackPanel.width,this.stackPanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#8aa8d4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📚 Call Stack",this.stackPanel.x+15,this.stackPanel.y+25),this.ctx.font='12px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.textAlign="left",this.ctx.textBaseline="middle";for(let s=0;s<this.callStack.length;s++){const a=this.callStack[s],n=this.program.functions[a.functionIndex],o=this.stackPanel.y+50+(this.callStack.length-s)*22;this.ctx.fillStyle="#999999",this.ctx.font='11px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.fillText(`${n.name}`,this.stackPanel.x+15,o)}const i=this.program.functions[this.currentFunction],e=this.stackPanel.y+50;this.ctx.fillStyle="rgba(100, 150, 200, 0.08)",this.ctx.fillRect(this.stackPanel.x+10,e-10,this.stackPanel.width-20,20),this.ctx.strokeStyle="rgba(100, 150, 200, 0.3)",this.ctx.lineWidth=1,this.roundRect(this.stackPanel.x+10,e-10,this.stackPanel.width-20,20,6),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font='bold 11px "Fira Code", "JetBrains Mono", "Consolas", "Monaco", monospace',this.ctx.fillText(`${i.name}`,this.stackPanel.x+15,e)}drawHeapPanel(){this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(this.heapPanel.x+3,this.heapPanel.y+3,this.heapPanel.width,this.heapPanel.height);const t=this.ctx.createLinearGradient(this.heapPanel.x,this.heapPanel.y,this.heapPanel.x,this.heapPanel.y+this.heapPanel.height);t.addColorStop(0,"rgba(26, 26, 46, 0.95)"),t.addColorStop(1,"rgba(26, 26, 46, 0.9)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.heapPanel.x,this.heapPanel.y,this.heapPanel.width,this.heapPanel.height),this.ctx.shadowColor="rgba(100, 200, 150, 0.3)",this.ctx.shadowBlur=6,this.ctx.lineWidth=1.5,this.ctx.strokeStyle="#6ab896",this.roundRect(this.heapPanel.x,this.heapPanel.y,this.heapPanel.width,this.heapPanel.height,12),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.fillStyle="#7ec9a9",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("🗑️ Heap Memory",this.heapPanel.x+15,this.heapPanel.y-10),this.drawMemoryGrid();for(const i of this.heapBlocks){this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=8,this.ctx.fillStyle="rgba(0, 0, 0, 0.4)",this.ctx.fillRect(i.x+4,i.y+4,i.width,i.height),this.ctx.shadowBlur=0;const e=this.ctx.createLinearGradient(i.x,i.y,i.x,i.y+i.height);e.addColorStop(0,"#7c3aed"),e.addColorStop(1,"#5b21b6"),this.ctx.fillStyle=e,this.ctx.fillRect(i.x,i.y,i.width,i.height),this.ctx.shadowColor="rgba(124, 58, 237, 0.5)",this.ctx.shadowBlur=6,this.ctx.lineWidth=1.5,this.ctx.strokeStyle="#a78bfa",this.roundRect(i.x,i.y,i.width,i.height,6),this.ctx.stroke(),this.ctx.shadowBlur=0;const s=this.ctx.createLinearGradient(i.x,i.y,i.x,i.y+i.height*.3);s.addColorStop(0,"rgba(255, 255, 255, 0.25)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=s,this.ctx.fillRect(i.x,i.y,i.width,i.height*.3),this.ctx.fillStyle="#ffffff",this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=2;const a=Math.max(8,Math.min(12,i.width/8));this.ctx.font=`bold ${a}px Inter`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.strokeText(i.name,i.x+i.width/2,i.y+i.height/2-8),this.ctx.fillText(i.name,i.x+i.width/2,i.y+i.height/2-8);const n=Math.max(7,Math.min(10,i.width/10));this.ctx.font=`bold ${n}px Inter`,this.ctx.strokeText(`${i.size}B`,i.x+i.width/2,i.y+i.height/2+2),this.ctx.fillText(`${i.size}B`,i.x+i.width/2,i.y+i.height/2+2),this.ctx.fillStyle="#e9d5ff";const o=Math.max(6,Math.min(8,i.width/12));this.ctx.font=`bold ${o}px Inter`,this.ctx.fillText(`0x${i.address.toString(16)}`,i.x+i.width/2,i.y+i.height/2+12)}for(const i of this.freeBlocks){this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(i.x+2,i.y+2,i.width,i.height);const e=this.ctx.createLinearGradient(i.x,i.y,i.x,i.y+i.height);e.addColorStop(0,"rgba(16, 185, 129, 0.4)"),e.addColorStop(1,"rgba(5, 150, 105, 0.2)"),this.ctx.fillStyle=e,this.ctx.fillRect(i.x,i.y,i.width,i.height),this.ctx.strokeStyle="#34d399",this.ctx.lineWidth=1.5,this.ctx.setLineDash([5,5]),this.roundRect(i.x,i.y,i.width,i.height,6),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle="#d1fae5",this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=2,this.ctx.font="bold 9px Inter",this.ctx.textAlign="center",this.ctx.strokeText(`FREE (${i.size}B)`,i.x+i.width/2,i.y+i.height/2),this.ctx.fillText(`FREE (${i.size}B)`,i.x+i.width/2,i.y+i.height/2),i.size>=512&&(this.ctx.fillStyle="#a7f3d0",this.ctx.font="8px Inter",this.ctx.fillText(`0x${i.address.toString(16)}`,i.x+i.width/2,i.y+i.height/2+12))}this.drawMemoryUsageIndicator()}drawOutputPanel(){if(!this.showOutput)return;this.ctx.fillStyle="rgba(26, 26, 46, 0.9)",this.ctx.fillRect(this.outputPanel.x,this.outputPanel.y,this.outputPanel.width,this.outputPanel.height),this.ctx.strokeStyle="#F39C12",this.ctx.lineWidth=2,this.ctx.strokeRect(this.outputPanel.x,this.outputPanel.y,this.outputPanel.width,this.outputPanel.height),this.ctx.fillStyle="#F39C12",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.fillText("📤 Program Output",this.outputPanel.x+10,this.outputPanel.y+25),this.ctx.font="11px Inter",this.ctx.textAlign="left",this.ctx.fillStyle="#FFFFFF";const t=Math.max(0,this.output.length-8);for(let i=t;i<this.output.length;i++){const e=this.output[i],s=this.outputPanel.y+45+(i-t)*18;this.ctx.fillText(e,this.outputPanel.x+10,s)}}drawExecutionPointer(){if(this.highlightedLine>=0){const t=this.codePanel.y+50+this.highlightedLine*20,i=this.codePanel.x+this.codePanel.width-15,e=.6+Math.sin(this.animationTime*4)*.4,s=4;this.ctx.shadowColor="#2ecc71",this.ctx.shadowBlur=8*e,this.ctx.fillStyle=`rgba(46, 204, 113, ${e})`,this.ctx.beginPath(),this.ctx.arc(i,t,s,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0}}drawExecutionTrail(){}drawMemoryAccesses(){for(const t of this.memoryAccesses){const i=1-t.time/t.duration,e=this.heapBlocks.find(s=>s.address===t.address);e&&(this.ctx.fillStyle=`rgba(${t.type==="allocation"?"78, 205, 196":t.type==="deallocation"?"255, 107, 107":"255, 215, 0"}, ${i*.5})`,this.ctx.fillRect(e.x-2,e.y-2,e.width+4,e.height+4),this.ctx.fillStyle=`rgba(${t.type==="allocation"?"78, 205, 196":t.type==="deallocation"?"255, 107, 107":"255, 215, 0"}, ${i})`,this.ctx.beginPath(),this.ctx.arc(e.x+e.width/2,e.y+e.height/2,8,0,Math.PI*2),this.ctx.fill())}}drawAddressHighlights(){for(const t of this.addressHighlights){const i=1-t.time/t.duration,e=this.heapBlocks.find(s=>s.address===t.address);e&&(this.ctx.strokeStyle=`rgba(${t.type==="allocation"?"78, 205, 196":"255, 107, 107"}, ${i})`,this.ctx.lineWidth=3,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(e.x-5,e.y-5,e.width+10,e.height+10),this.ctx.setLineDash([]))}}drawVariableConnections(){for(const t of this.variableConnections){const i=1-t.time/t.duration;this.ctx.strokeStyle=`rgba(78, 205, 196, ${i*.8})`,this.ctx.lineWidth=2,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.moveTo(t.from.x,t.from.y),this.ctx.lineTo(t.to.x,t.to.y),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle=`rgba(78, 205, 196, ${i})`,this.ctx.font="bold 10px Inter",this.ctx.textAlign="center";const e=(t.from.x+t.to.x)/2,s=(t.from.y+t.to.y)/2;this.ctx.fillText(t.varName,e,s-5)}}drawMemoryFragmentation(){for(const t of this.memoryFragmentation){const i=1-t.time/t.duration,e=t.size*i*.01;this.ctx.fillStyle=`rgba(255, 107, 107, ${i*.6})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle=`rgba(255, 107, 107, ${i})`,this.ctx.font="bold 8px Inter",this.ctx.textAlign="center",this.ctx.fillText("FRAG",t.x,t.y+15)}this.drawMemoryLayout()}drawMemoryGrid(){const i=this.heapPanel.x+20,e=this.heapPanel.y+40,s=this.heapPanel.x+this.heapPanel.width-20,a=this.heapPanel.y+this.heapPanel.height-50;this.ctx.strokeStyle="rgba(46, 204, 113, 0.1)",this.ctx.lineWidth=1;for(let n=i;n<=s;n+=40)this.ctx.beginPath(),this.ctx.moveTo(n,e),this.ctx.lineTo(n,a),this.ctx.stroke();for(let n=e;n<=a;n+=40)this.ctx.beginPath(),this.ctx.moveTo(i,n),this.ctx.lineTo(s,n),this.ctx.stroke()}drawMemoryUsageIndicator(){const t=this.heapPanel.x+20,i=this.heapPanel.y+this.heapPanel.height-30,e=this.heapPanel.width-40,s=15;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t,i,e,s);const a=this.currentMemoryUsage/8192*100,n=e*a/100,o=this.ctx.createLinearGradient(t,i,t+n,i);o.addColorStop(0,"#2ecc71"),o.addColorStop(1,"#27ae60"),this.ctx.fillStyle=o,this.ctx.fillRect(t,i,n,s),this.ctx.strokeStyle="#2ecc71",this.ctx.lineWidth=1,this.ctx.strokeRect(t,i,e,s),this.ctx.fillStyle="#FFFFFF",this.ctx.font="bold 10px Inter",this.ctx.textAlign="center",this.ctx.fillText(`${this.currentMemoryUsage}/8192 bytes (${a.toFixed(1)}%)`,t+e/2,i+s/2+3)}drawMemoryLayout(){const t=this.heapPanel.y+this.heapPanel.height-15,i=10,e=this.heapPanel.x+20,s=this.heapPanel.width-40;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(e,t,s,i);for(const n of this.heapBlocks){const o=e+(n.address-4096)/8192*s,h=n.size/8192*s;this.ctx.fillStyle="#2ecc71",this.ctx.fillRect(o,t,h,i),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.strokeRect(o,t,h,i)}const a=this.calculateFragmentedFreeBlocks();for(const n of a)if(n.size>=256){const o=e+(n.address-4096)/8192*s,h=n.size/8192*s;this.ctx.fillStyle="rgba(255, 107, 107, 0.6)",this.ctx.fillRect(o,t,h,i)}}drawParticles(){for(const t of this.particles){let i=t.size||3,e=t.life;t.type==="memory_clear"?(i=4,e=t.life*.8):t.type==="data_clear"?(i=2,e=t.life*.6):t.type==="allocation"?(i=t.size||4,e=t.life*.9):t.type==="allocation_float"?(i=2,e=t.life*.7,this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=5):t.type==="deallocation"?(i=t.size||5,e=t.life*.8):t.type==="deallocation_fall"?(i=3,e=t.life*.6):t.type==="deallocation_implosion"?(i=2,e=t.life*.5,this.ctx.shadowColor="#FF6B6B",this.ctx.shadowBlur=3):t.type==="completion"&&(i=6,e=t.life*.9,this.ctx.shadowColor="#FFD700",this.ctx.shadowBlur=8),this.ctx.fillStyle=`rgba(${t.color==="#4ECDC4"?"78, 205, 196":t.color==="#FF6B6B"?"255, 107, 107":t.color==="#F39C12"?"243, 156, 18":t.color==="#3498db"?"52, 152, 219":t.color==="#FFD700"?"255, 215, 0":"231, 76, 60"}, ${e})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,i,0,Math.PI*2),this.ctx.fill(),this.ctx.shadowBlur=0}}drawDataFlowParticles(){for(const t of this.dataFlowParticles)this.ctx.fillStyle=`rgba(255, 215, 0, ${t.life})`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()}drawAllocationEffects(){for(const t of this.allocationEffects){const i=t.time/t.duration,e=.5+i*.5;this.ctx.save(),this.ctx.globalAlpha=1-i,this.ctx.fillStyle="#4ECDC4",this.ctx.fillRect(t.block.x-(t.block.width*e-t.block.width)/2,t.block.y-(t.block.height*e-t.block.height)/2,t.block.width*e,t.block.height*e),this.ctx.restore()}for(const t of this.deallocationEffects){const i=t.time/t.duration,e=1-i*.5;this.ctx.save(),this.ctx.globalAlpha=1-i,this.ctx.fillStyle="#FF6B6B",this.ctx.fillRect(t.block.x-(t.block.width*e-t.block.width)/2,t.block.y-(t.block.height*e-t.block.height)/2,t.block.width*e,t.block.height*e),this.ctx.restore()}}drawGarbageCollectionEffects(){for(const t of this.gcState.gcParticles){const i=t.life;this.ctx.fillStyle=`${t.color}${Math.floor(i*255).toString(16).padStart(2,"0")}`,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,Math.PI*2),this.ctx.fill()}if(this.gcState.isRunning){const t=this.gcState.phase==="mark"?"Mark Phase":"Sweep Phase",i=this.gcState.phase==="mark"?"#FFD700":"#FF6B6B";this.ctx.fillStyle=i,this.ctx.font="bold 14px Inter",this.ctx.textAlign="center",this.ctx.fillText(`🗑️ ${t}`,this.canvas.width/2,30)}}drawStatistics(){if(!this.showStats)return;const t=this.canvas.width-390,i=this.canvas.height-170;this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.fillRect(t+4,i+4,380,160);const e=this.ctx.createLinearGradient(t,i,t,i+160);e.addColorStop(0,"rgba(26, 26, 46, 0.98)"),e.addColorStop(.3,"rgba(26, 26, 46, 0.95)"),e.addColorStop(.7,"rgba(26, 26, 46, 0.92)"),e.addColorStop(1,"rgba(26, 26, 46, 0.88)"),this.ctx.fillStyle=e,this.ctx.fillRect(t,i,380,160),this.ctx.shadowColor="#4ECDC4",this.ctx.shadowBlur=12,this.ctx.lineWidth=3;const s=this.ctx.createLinearGradient(t,i,t+380,i+160);s.addColorStop(0,"#4ECDC4"),s.addColorStop(.5,"#2ECC71"),s.addColorStop(1,"#4ECDC4"),this.ctx.strokeStyle=s,this.roundRect(t,i,380,160,12),this.ctx.stroke(),this.ctx.shadowBlur=0;const a=this.ctx.createLinearGradient(t,i,t,i+30);a.addColorStop(0,"rgba(78, 205, 196, 0.1)"),a.addColorStop(1,"rgba(78, 205, 196, 0)"),this.ctx.fillStyle=a,this.ctx.fillRect(t,i,380,30),this.ctx.fillStyle="#4ECDC4",this.ctx.font="bold 16px Inter",this.ctx.textAlign="left",this.ctx.textBaseline="middle",this.ctx.fillText("📊 Program Execution Stats",t+15,i+22),this.ctx.font="12px Inter",this.ctx.textBaseline="middle",this.ctx.fillStyle="#4ECDC4",this.ctx.fillText(`📦 Allocations: ${this.totalAllocations}`,t+15,i+45),this.ctx.fillText(`🗑️ Deallocations: ${this.totalDeallocations}`,t+15,i+62),this.ctx.fillText(`💾 Memory Usage: ${this.currentMemoryUsage} bytes`,t+15,i+79),this.ctx.fillText(`🔍 Memory Accesses: ${this.memoryAccessCount}`,t+15,i+96),this.ctx.fillStyle="#FFD700",this.ctx.fillText(`⚡ Execution Cycles: ${this.performanceMetrics.totalCycles}`,t+15,i+113),this.ctx.fillText(`📈 Memory Efficiency: ${this.performanceMetrics.memoryEfficiency.toFixed(1)}%`,t+15,i+130),this.ctx.fillText(`🔧 Fragmentation Level: ${this.performanceMetrics.fragmentationLevel.toFixed(1)}%`,t+15,i+147),this.memoryLeaks>0?(this.ctx.fillStyle="#FF6B6B",this.ctx.fillText(`⚠️ Memory Leaks: ${this.memoryLeaks}`,t+15,i+164)):(this.ctx.fillStyle="#4ECDC4",this.ctx.fillText("✅ No Memory Leaks",t+15,i+164));const n=this.performanceMetrics.memoryEfficiency,o=n>80?"#4ECDC4":n>60?"#F39C12":"#FF6B6B";this.ctx.fillStyle=o,this.ctx.fillText(`🎯 Performance: ${n>80?"Excellent":n>60?"Good":"Poor"}`,t+10,i+160)}roundRect(t,i,e,s,a){this.ctx.beginPath(),this.ctx.moveTo(t+a,i),this.ctx.lineTo(t+e-a,i),this.ctx.quadraticCurveTo(t+e,i,t+e,i+a),this.ctx.lineTo(t+e,i+s-a),this.ctx.quadraticCurveTo(t+e,i+s,t+e-a,i+s),this.ctx.lineTo(t+a,i+s),this.ctx.quadraticCurveTo(t,i+s,t,i+s-a),this.ctx.lineTo(t,i+a),this.ctx.quadraticCurveTo(t,i,t+a,i),this.ctx.closePath()}handleClick(t,i){t>=this.heapPanel.x&&t<=this.heapPanel.x+this.heapPanel.width&&i>=this.heapPanel.y&&i<=this.heapPanel.y+this.heapPanel.height&&(this.gcState.isRunning||this.runGarbageCollection())}resetExecution(){this.initializeExecution(),this.startExecution(),this.resetPerformanceMetrics()}reset(){this.initializeExecution(),this.startExecution(),this.resetPerformanceMetrics()}resetPerformanceMetrics(){this.performanceMetrics={totalCycles:0,memoryEfficiency:100,fragmentationLevel:0,averageAccessTime:0},this.executionStep=0,this.totalAllocations=0,this.totalDeallocations=0,this.memoryLeaks=0,this.currentMemoryUsage=0,this.memoryAccessCount=0}getStats(){return{totalAllocations:this.totalAllocations,totalDeallocations:this.totalDeallocations,memoryLeaks:this.memoryLeaks,currentMemoryUsage:this.currentMemoryUsage,memoryAccessCount:this.memoryAccessCount,callStackDepth:this.callStack.length,currentFunction:this.program.functions[this.currentFunction].name}}resize(){const t=this.canvas.width;this.canvas.height,this.codePanel={x:50,y:50,width:Math.min(500,t*.4),height:300},this.stackPanel={x:t-270,y:50,width:220,height:300};const i=Math.min(750,t-50);this.heapPanel={x:(t-i)/2,y:380,width:i,height:200},this.outputPanel={x:t-270,y:400,width:220,height:200},this.updateFreeBlocks()}}class Tt extends L{constructor(t){super(t),this.canvas=t.canvas,this.blocks=[],this.pendingTransactions=[],this.miners=[],this.networkNodes=[],this.consensus="proof-of-work",this.speed=1,this.showHashes=!0,this.showNetwork=!0,this.autoMine=!0,this.blockWidth=120,this.blockHeight=85,this.blockSpacing=20,this.chainStartX=30,this.chainStartY=160,this.maxBlocksVisible=5,this.scrollOffset=0,this.difficulty=4,this.targetHash="0".repeat(this.difficulty),this.currentNonce=0,this.miningBlock=null,this.isMining=!1,this.blockReward=50,this.transactionFee=.1,this.targetBlockTime=1e4,this.difficultyAdjustmentInterval=10,this.lastDifficultyAdjustment=0,this.blockTimes=[],this.nodeCount=6,this.nodeRadius=20,this.networkCenterX=0,this.networkCenterY=0,this.maxNodes=6,this.minNodes=4,this.nodeJoinInterval=15e3,this.nodeLeaveInterval=2e4,this.lastNodeJoin=0,this.lastNodeLeave=0,this.nodeJoinParticles=[],this.nodeLeaveParticles=[],this.nodeRedistributionTimer=0,this.redistributionInterval=2e3,this.transactionTypes=["transfer","smart_contract","token_mint","stake"],this.transactionColors={transfer:"#4CAF50",smart_contract:"#2196F3",token_mint:"#FF9800",stake:"#9C27B0"},this.animationPhase="idle",this.phaseTime=0,this.phaseDuration=3,this.guidedMode=!0,this.phaseSteps=["mining_success","validation","propagation","consensus","finalization"],this.currentStep=0,this.stepDuration=.2,this.miningParticles=[],this.validationParticles=[],this.networkParticles=[],this.propagationArrows=[],this.contractExecutionParticles=[],this.blockCreationParticles=[],this.hashCalculationParticles=[],this.consensusParticles=[],this.finalizationParticles=[],this.rewardParticles=[],this.rejectionParticles=[],this.blockGlow=0,this.miningGlow=0,this.networkPulse=0,this.chainPulse=0,this.totalBlocks=0,this.totalTransactions=0,this.totalRewards=0,this.consensusTime=0,this.networkHashrate=0,this.averageBlockTime=0,this.lastBlockTimes=[],this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.lastBlockTime=0,this.blockInterval=2e3,this.miningProgress=0,this.miningAttempts=0,this.targetAttempts=1e3,this.isStartingMining=!1,this.consensusCompleted=!1,this.consensusDecisions=0,this.initializeBlockchain(),this.initializeNetwork(),this.startGenesisBlock()}initializeBlockchain(){const t={index:0,timestamp:Date.now(),transactions:[{id:"genesis_1",from:"Genesis",to:"Alice",amount:1e3,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"},{id:"genesis_2",from:"Genesis",to:"Bob",amount:500,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"},{id:"genesis_3",from:"Genesis",to:"Charlie",amount:250,type:"token_mint",color:"#FF9800",fee:0,description:"Initial token distribution"}],previousHash:"0000000000000000000000000000000000000000000000000000000000000000",hash:"",nonce:0,merkleRoot:"",isGenesis:!0,creationTime:0,glowIntensity:1,blockReward:0,totalFees:0};t.merkleRoot=this.calculateMerkleRoot(t.transactions),t.hash=this.calculateBlockHash(t),this.blocks.push(t),this.totalBlocks=1,this.totalTransactions=3,this.addPendingTransaction("Alice","Bob",50,"transfer","Payment for services"),this.addPendingTransaction("Bob","Charlie",25,"transfer","Coffee payment"),this.addPendingTransaction("Alice","Contract",10,"smart_contract","DeFi interaction"),this.addPendingTransaction("Charlie","Staking",100,"stake","Staking tokens"),this.addPendingTransaction("Bob","David",15,"transfer","Lunch payment"),this.lastTransactionTime=Date.now(),this.transactionInterval=3e3,this.transactionTypes=["transfer","smart_contract","token_mint","stake","swap","liquidity"],this.transactionColors={transfer:"#4CAF50",smart_contract:"#2196F3",token_mint:"#FF9800",stake:"#9C27B0",swap:"#E91E63",liquidity:"#00BCD4"},this.users=["Alice","Bob","Charlie","David","Eve","Frank","Grace","Henry","Ivy","Jack"],this.contracts=["DeFi_Protocol","DEX_Exchange","Lending_Pool","Staking_Contract","Yield_Farm"]}initializeNetwork(){const t=this.ctx.canvas.width,i=this.ctx.canvas.height;this.networkCenterX=t-180,this.networkCenterY=i-180,this.networkNodes=[],this.nextNodeId=1;for(let e=0;e<this.nodeCount;e++){const s=e/this.nodeCount*2*Math.PI,a=80,n=this.networkCenterX+Math.cos(s)*a,o=this.networkCenterY+Math.sin(s)*a;this.networkNodes.push({id:this.nextNodeId++,x:n,y:o,isMining:!1,isValidating:!1,lastBlock:null,connectionStrength:Math.random()*.5+.5,color:`hsl(${e*60}, 80%, 65%)`,pulseIntensity:0,isActive:!1})}this.miners=this.networkNodes.slice(0,3),this.miners.forEach(e=>{e.isMining=!0,e.currentNonce=0,e.targetHash=this.targetHash,e.isActive=!0})}startGenesisBlock(){setTimeout(()=>{this.startMining()},1e3)}startGuidedBlockAddition(t){this.guidedBlock=t,this.currentStep=0,this.phaseTime=0,this.animationPhase="mining_success",this.networkNodes.forEach(i=>{i.isValidating=!1,i.consensusReached=!1,i.pulseIntensity=1,i.color="#2196F3"}),this.guidedPhaseIndicator={text:"Mining Success",alpha:1,pulseIntensity:1,color:"#00FF88",y:350},setTimeout(()=>this.nextGuidedStep(),1e3)}nextGuidedStep(){if(!this.guidedBlock){this.animationPhase="idle",this.guidedPhaseIndicator=null;return}if(this.currentStep++,this.phaseTime=0,this.currentStep>=this.phaseSteps.length){if(this.animationPhase==="consensus"&&!this.consensusCompleted){setTimeout(()=>this.nextGuidedStep(),500);return}const i=this.networkNodes.filter(s=>s.consensusReached),e=this.networkNodes.length*.6;i.length>=e?this.finalizeBlock():this.startFinalizationStep();return}switch(this.phaseSteps[this.currentStep-1]){case"validation":this.startValidationStep();break;case"propagation":this.startPropagationStep();break;case"consensus":this.startConsensusStep();break;case"finalization":this.startFinalizationStep();break}setTimeout(()=>this.nextGuidedStep(),1500)}startValidationStep(){this.networkNodes.forEach(t=>{t.isValidating=!0,t.pulseIntensity=1,t.color="#FF6B35"}),this.createValidationParticles(),this.guidedPhaseIndicator={text:"VALIDATION",color:"#FF6B35",alpha:1,y:350}}startPropagationStep(){this.createBroadcastParticles(),this.networkNodes.forEach(t=>{t.color="#4A90E2",t.pulseIntensity=.8}),this.broadcastBlockWithLatency(),this.guidedPhaseIndicator={text:"PROPAGATION",color:"#4A90E2",alpha:1,y:350}}startConsensusStep(){this.consensusCompleted=!1,this.consensusDecisions=0,this.networkNodes.forEach((t,i)=>{t.isValidating=!1,t.pulseIntensity=1.2,t.color="#9C27B0";const e=Math.random()*800+200,s=.7;setTimeout(()=>{Math.random()<s?(t.consensusReached=!0,t.pulseIntensity=1.5):(t.consensusReached=!1,t.pulseIntensity=.5),this.consensusDecisions++,this.consensusDecisions>=this.networkNodes.length&&(this.consensusCompleted=!0)},e)}),this.createConsensusParticles(),this.guidedPhaseIndicator={text:"CONSENSUS",color:"#9C27B0",alpha:1,y:350}}simulateNetworkLatency(t,i=100,e=1e3){const s=Math.random()*(e-i)+i;setTimeout(t,s)}broadcastBlockWithLatency(){this.networkNodes.forEach((t,i)=>{const e=Math.random()*700+100;setTimeout(()=>{t.receivedBlock=!0,t.isValidating=!0,t.pulseIntensity=1,this.createNodePropagationParticles(t)},e)})}createNodePropagationParticles(t){for(let i=0;i<5;i++)this.networkParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.5,maxLife:1.5,color:"#4A90E2",size:3})}startFinalizationStep(){this.networkNodes.forEach(e=>{e.pulseIntensity=1.5,e.color="#4CAF50"});const t=this.networkNodes.filter(e=>e.consensusReached),i=this.networkNodes.length*.6;t.length>=i?(this.createFinalizationParticles(),this.guidedPhaseIndicator={text:"Block Finalized",alpha:1,pulseIntensity:1,color:"#4CAF50",y:350},setTimeout(()=>this.nextGuidedStep(),1e3)):(this.createRejectionParticles(),this.guidedPhaseIndicator={text:"BLOCK REJECTED",alpha:1,pulseIntensity:1,color:"#FF5722",y:350},this.networkNodes.forEach(e=>{e.consensusReached=!1,e.isValidating=!1,e.pulseIntensity=1,e.color="#2196F3"}),setTimeout(()=>{this.guidedBlock=null,this.guidedPhaseIndicator=null,this.animationPhase="idle",this.currentStep=0,this.startMining()},1e3))}addNodeToNetwork(){if(this.networkNodes.length>=this.maxNodes)return;const t=this.calculateOptimalNodePosition(),i=this.networkCenterX+Math.cos(t.angle)*300,e=this.networkCenterY+Math.sin(t.angle)*300,s={id:this.nextNodeId++,x:i,y:e,targetX:t.x,targetY:t.y,isMining:!1,isValidating:!1,lastBlock:null,connectionStrength:Math.random()*.5+.5,color:`hsl(${this.networkNodes.length*60}, 80%, 65%)`,pulseIntensity:0,isActive:!1,isJoining:!0,joinProgress:0,joinSpeed:.08};this.networkNodes.push(s),this.createNodeJoinParticles(i,e),this.scheduleNodeRedistribution()}removeNodeFromNetwork(){if(this.networkNodes.length<=this.minNodes)return;const t=this.networkNodes.filter(s=>!s.isMining);if(t.length===0)return;const i=t[Math.floor(Math.random()*t.length)],e=this.networkNodes.indexOf(i);e!==-1&&(i.isLeaving=!0,i.leaveProgress=0,i.leaveSpeed=.12,this.createNodeLeaveParticles(i.x,i.y),setTimeout(()=>{this.networkNodes.splice(e,1),this.scheduleNodeRedistribution()},1e3))}createNodeJoinParticles(t,i){for(let e=0;e<15;e++)this.nodeJoinParticles.push({x:t,y:i,vx:(Math.random()-.5)*200,vy:(Math.random()-.5)*200,life:2,maxLife:2,color:"#4CAF50",size:4})}createNodeLeaveParticles(t,i){for(let e=0;e<12;e++)this.nodeLeaveParticles.push({x:t,y:i,vx:(Math.random()-.5)*180,vy:(Math.random()-.5)*180,life:2.5,maxLife:2.5,color:"#FF5722",size:3})}updateNodeJoinParticles(t){this.nodeJoinParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.nodeJoinParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=20*t})}updateNodeLeaveParticles(t){this.nodeLeaveParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.nodeLeaveParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}calculateOptimalNodePosition(){const i=this.networkNodes.length,e=2*Math.PI/this.maxNodes,a=i*e,n=this.networkCenterX+Math.cos(a)*120,o=this.networkCenterY+Math.sin(a)*120;return{x:n,y:o,angle:a}}scheduleNodeRedistribution(){this.nodeRedistributionTimer=0}redistributeNodes(){if(this.networkNodes.length===0)return;const e=2*Math.PI/this.maxNodes;this.networkNodes.forEach((s,a)=>{if(!s.isJoining&&!s.isLeaving){const n=a*e,o=this.networkCenterX+Math.cos(n)*120,h=this.networkCenterY+Math.sin(n)*120;s.targetX=o,s.targetY=h,s.isMoving=!0,s.moveSpeed=.1,s.moveProgress=0}})}finalizeBlockDirectly(t){this.blocks.push(t),this.totalBlocks++,this.totalTransactions+=t.transactions.length,this.createBlockCreationParticles(),this.executeSmartContracts(t),this.broadcastBlock(),this.createRewardParticles(),this.successfulMiner&&(this.successfulMiner.pulseIntensity=0,this.successfulMiner.color=this.successfulMiner.originalColor||`hsl(${this.miners.indexOf(this.successfulMiner)*60}, 80%, 65%)`),this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,setTimeout(()=>{console.log("[DIRECT BLOCK] 🔄 Starting mining for next block"),this.startMining()},2e3)}finalizeBlock(){this.guidedBlock&&(this.blocks.push(this.guidedBlock),this.totalBlocks++,this.totalTransactions+=this.guidedBlock.transactions.length,this.createBlockCreationParticles(),this.executeSmartContracts(this.guidedBlock),this.broadcastBlock(),this.createRewardParticles(),this.successfulMiner&&(this.successfulMiner.pulseIntensity=0,this.successfulMiner.color=this.successfulMiner.originalColor||`hsl(${this.miners.indexOf(this.successfulMiner)*60}, 80%, 65%)`),this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.networkNodes.forEach(t=>{t.consensusReached=!1,t.isValidating=!1,t.pulseIntensity=1,t.color="#2196F3"}),this.guidedBlock=null,this.guidedPhaseIndicator=null,this.animationPhase="idle",this.currentStep=0,setTimeout(()=>{this.startMining()},2e3))}generateNewTransactions(){const t=Date.now();if(t-this.lastTransactionTime>this.transactionInterval){const i=Math.floor(Math.random()*4)+1;for(let e=0;e<i;e++){const s=this.generateRandomTransaction();this.addPendingTransaction(s.from,s.to,s.amount,s.type,s.description,s.fee)}this.lastTransactionTime=t,this.transactionInterval=1500+Math.random()*2e3}if(this.pendingTransactions=this.pendingTransactions.filter(i=>t-i.timestamp<3e4),Math.random()<.1&&this.pendingTransactions.length>0){const i=this.pendingTransactions.findIndex(e=>e.fee<this.transactionFee*.5);i>-1&&this.pendingTransactions.splice(i,1)}}generateRandomTransaction(){const t=this.transactionTypes[Math.floor(Math.random()*this.transactionTypes.length)];let i,e,s,a;switch(t){case"transfer":for(i=this.users[Math.floor(Math.random()*this.users.length)],e=this.users[Math.floor(Math.random()*this.users.length)];e===i;)e=this.users[Math.floor(Math.random()*this.users.length)];s=Math.floor(Math.random()*200)+5,a=this.getRandomTransferDescription();break;case"smart_contract":i=this.users[Math.floor(Math.random()*this.users.length)],e=this.contracts[Math.floor(Math.random()*this.contracts.length)],s=Math.floor(Math.random()*50)+1,a=this.getRandomContractDescription();break;case"token_mint":i="System",e=this.users[Math.floor(Math.random()*this.users.length)],s=Math.floor(Math.random()*100)+10,a="Token minting";break;case"stake":i=this.users[Math.floor(Math.random()*this.users.length)],e="Staking_Contract",s=Math.floor(Math.random()*150)+20,a="Staking tokens for rewards";break;case"swap":i=this.users[Math.floor(Math.random()*this.users.length)],e="DEX_Exchange",s=Math.floor(Math.random()*80)+5,a="Token swap on DEX";break;case"liquidity":i=this.users[Math.floor(Math.random()*this.users.length)],e="Liquidity_Pool",s=Math.floor(Math.random()*120)+15,a="Adding liquidity to pool";break}let n=this.transactionFee;return t==="smart_contract"||t==="swap"?n=this.transactionFee*2:t==="liquidity"&&(n=this.transactionFee*1.5),{from:i,to:e,amount:s,type:t,description:a,fee:n}}getRandomTransferDescription(){const t=["Payment for services","Coffee payment","Lunch payment","Rent payment","Grocery payment","Gas payment","Movie tickets","Restaurant bill","Shopping payment","Transportation fee"];return t[Math.floor(Math.random()*t.length)]}getRandomContractDescription(){const t=["DeFi interaction","Yield farming","Lending operation","Borrowing funds","Collateral deposit","Interest payment","Protocol interaction","Smart contract call","Automated trading","Liquidation protection"];return t[Math.floor(Math.random()*t.length)]}addPendingTransaction(t,i,e,s,a="",n=null){const o={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,from:t,to:i,amount:e,type:s,color:this.transactionColors[s]||"#4CAF50",fee:n||this.transactionFee,description:a,timestamp:Date.now()};return this.validateTransaction(o)?(this.pendingTransactions.length>=100&&(this.pendingTransactions.sort((h,r)=>r.fee-h.fee),this.pendingTransactions.pop()),this.pendingTransactions.push(o),this.totalTransactions++,!0):!1}selectTransactionsForBlock(){const t=[...this.pendingTransactions].sort((s,a)=>a.fee-s.fee),i=Math.min(6,Math.max(3,Math.floor(this.pendingTransactions.length/2)));let e=t.slice(0,i);return e.length===0&&(e=[{id:`default_${Date.now()}`,from:"System",to:"Miner",amount:0,type:"transfer",color:"#9E9E9E",fee:0,description:"Empty block reward"}]),e.forEach(s=>{const a=this.pendingTransactions.indexOf(s);a>-1&&this.pendingTransactions.splice(a,1)}),e}calculateMerkleRoot(t){if(t.length===0)return"";let i=t.map(e=>this.hashString(JSON.stringify(e)));for(;i.length>1;){const e=[];for(let s=0;s<i.length;s+=2){const a=i[s],n=s+1<i.length?i[s+1]:a;e.push(this.hashString(a+n))}i=e}return i[0]}calculateBlockHash(t){const i=JSON.stringify({index:t.index,timestamp:t.timestamp,transactions:t.transactions,previousHash:t.previousHash,merkleRoot:t.merkleRoot,nonce:t.nonce});return this.hashString(i)}hashString(t){let i=0;const e=31,s=1000000007;for(let n=0;n<t.length;n++){const o=t.charCodeAt(n);i=(i*e%s+o)%s}return Math.abs(i).toString(16).padStart(8,"0").repeat(8)}validateBlock(t){if(!t||typeof t.index!="number"||!t.transactions||!Array.isArray(t.transactions)||!t.previousHash||typeof t.previousHash!="string"||typeof t.nonce!="number"||t.index!==this.blocks.length)return!1;if(t.index>0){const s=this.blocks[this.blocks.length-1];if(t.previousHash!==s.hash)return!1}if(JSON.stringify(t).length>1e6)return!1;const e=this.calculateBlockHash(t);return t.hash===e}validateTransaction(t){return!(!t||typeof t.id!="string"||!t.from||!t.to||typeof t.amount!="number"||t.amount<=0||typeof t.fee!="number"||t.fee<0||this.pendingTransactions.find(e=>e.id===t.id))}startMining(){if(this.isMining||this.guidedBlock||this.isStartingMining)return;this.isStartingMining=!0,this.isMining=!0,this.animationPhase="mining",this.phaseTime=0,this.miningGlow=1,this.miningProgress=0,this.miningAttempts=0;const t=this.blocks[this.blocks.length-1],i=this.selectTransactionsForBlock(),e=i.reduce((a,n)=>a+n.fee,0),s={index:t.index+1,timestamp:Date.now(),transactions:i,previousHash:t.hash,hash:"",nonce:0,merkleRoot:"",isGenesis:!1,creationTime:0,glowIntensity:0,blockReward:this.blockReward,totalFees:e};s.merkleRoot=this.calculateMerkleRoot(s.transactions),this.miningBlock=s,this.miners.forEach((a,n)=>{a.currentNonce=Math.floor(Math.random()*1e3)+n*1e3,a.isMining=!0,a.pulseIntensity=1,a.lastHashRate=0}),this.createMiningStartParticles(),setTimeout(()=>{this.isStartingMining=!1},100)}adjustDifficulty(){if(this.blocks.length%this.difficultyAdjustmentInterval!==0||this.blockTimes.length<this.difficultyAdjustmentInterval)return;const i=this.blockTimes.reduce((e,s)=>e+s,0)/this.blockTimes.length/this.targetBlockTime;i>1.2?this.difficulty=Math.max(1,this.difficulty-1):i<.8&&(this.difficulty=Math.min(8,this.difficulty+1)),this.targetHash="0".repeat(this.difficulty),this.blockTimes=[]}mineBlock(){if(!this.isMining||!this.miningBlock||this.guidedBlock)return;const t=this.blocks.length;if(this.miningBlock.index!==t){const o=this.blocks[this.blocks.length-1],h=this.selectTransactionsForBlock(),r=h.reduce((l,c)=>l+c.fee,0);this.miningBlock={index:t,timestamp:Date.now(),transactions:h,previousHash:o.hash,hash:"",nonce:0,merkleRoot:this.calculateMerkleRoot(h),isGenesis:!1,creationTime:0,glowIntensity:0,blockReward:this.blockReward,totalFees:r}}const i="0".repeat(this.difficulty),e=800,s=Math.max(.1,(9-this.difficulty)*1),a=this.speed,n=Math.max(100,Math.floor(e*s*a));this.networkHashrate=this.miners.length*n*60,this.miningAttempts+=n,this.targetAttempts=Math.pow(16,this.difficulty)/10,this.miningProgress=Math.min(100,this.miningAttempts/this.targetAttempts*100);for(let o=0;o<n;o++)if(this.miningBlock.nonce++,this.miningBlock.hash=this.calculateBlockHash(this.miningBlock),this.miningBlock.hash.startsWith(i)){if(!this.validateBlock(this.miningBlock))return;const h=Math.floor(Math.random()*this.miners.length);this.successfulMiner=this.miners[h],this.successfulMiner.originalColor||(this.successfulMiner.originalColor=this.successfulMiner.color),this.successfulMiner.pulseIntensity=2,this.successfulMiner.color="#00FF88",this.miningBlock.creationTime=Date.now(),this.miningBlock.glowIntensity=1;const r=this.miningBlock.creationTime-this.lastBlockTime;this.blockTimes.push(r),this.lastBlockTime=this.miningBlock.creationTime,this.adjustDifficulty(),this.startGuidedBlockAddition(this.miningBlock);return}}createMinerBlockConnection(){if(!this.successfulMiner||!this.miningBlock)return;const t=this.blocks.length;let i;if(t<=4){const s=t;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;this.minerBlockConnection={startX:this.successfulMiner.x,startY:this.successfulMiner.y,endX:i,endY:e,progress:0,speed:.02,color:"#00FF88",width:3,alpha:1,pulseIntensity:1},this.minerRewardDisplay={x:this.successfulMiner.x,y:this.successfulMiner.y-40,text:`+${this.blockReward+this.miningBlock.totalFees} tokens`,color:"#1E3A8A",alpha:1,life:3,maxLife:3,velocity:-30}}createMiningStartParticles(){this.miners.forEach(t=>{for(let i=0;i<8;i++)this.miningParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:2,maxLife:2,color:"#FF9800",size:3,type:"mining_start"})})}createBlockCreationParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length-1;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<20;s++)this.blockCreationParticles.push({x:i,y:e,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:3,maxLife:3,color:"#4CAF50",size:4,type:"block_creation"})}broadcastBlock(){this.networkNodes.forEach(t=>{t.isValidating=!0,t.lastBlock=this.blocks[this.blocks.length-1],t.pulseIntensity=1}),this.createBroadcastParticles()}createPropagationArrows(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length-1;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;this.networkNodes.forEach(s=>{this.propagationArrows.push({startX:i,startY:e,endX:s.x,endY:s.y,progress:0,speed:.03,color:"#4CAF50",width:4,alpha:1})})}createBroadcastParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<8;i++)this.networkParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,life:1.8,maxLife:1.8,color:"#4A90E2",size:3})})}updateNetworkParticles(t){this.networkParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.networkParticles.splice(e,1);return}const s=i.targetX-i.x,a=i.targetY-i.y,n=Math.sqrt(s*s+a*a);n>1&&(i.vx=s/n*120,i.vy=a/n*120),i.x+=i.vx*t,i.y+=i.vy*t})}createMiningParticles(){if(!this.isMining)return;const t=.15*this.speed;this.miners.forEach(i=>{Math.random()<t&&this.miningParticles.push({x:i.x,y:i.y,vx:(Math.random()-.5)*40,vy:(Math.random()-.5)*40,life:1,maxLife:1,color:"#FF9800",size:2,type:"mining"})})}createMiningSuccessParticles(){this.miners.forEach(t=>{for(let i=0;i<6;i++)this.miningParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:4,maxLife:4,color:"#4CAF50",size:5,type:"success"})})}executeSmartContracts(t){t.transactions.forEach(i=>{i.type==="smart_contract"&&this.createSmartContractExecution(i)})}createSmartContractExecution(t){const i=this.blocks.length;let e;if(i<=4){const a=i-1;e=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const n=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length-1;e=this.chainStartX+n*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,i>4&&(e+=80)}const s=this.chainStartY+this.blockHeight/2;for(let a=0;a<15;a++)this.contractExecutionParticles.push({x:e,y:s,vx:(Math.random()-.5)*140,vy:(Math.random()-.5)*140,life:2.5,maxLife:2.5,color:"#2196F3",size:4})}createValidationParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<4;i++)this.validationParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,life:1.5,maxLife:1.5,color:"#FF6B35",size:3})})}createConsensusParticles(){this.networkNodes.forEach(t=>{for(let i=0;i<5;i++)this.consensusParticles.push({x:t.x,y:t.y,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.8,maxLife:1.8,color:"#9C27B0",size:3})})}createFinalizationParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length-1;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<6;s++)this.finalizationParticles.push({x:i,y:e,vx:(Math.random()-.5)*80,vy:(Math.random()-.5)*80,life:1.5,maxLife:1.5,color:"#4CAF50",size:2})}createRewardParticles(){this.blocks[this.blocks.length-1];const t=this.blocks.length;let i;if(t<=4){const s=t-1;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length-1;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<12;s++)this.rewardParticles.push({x:i,y:e,vx:(Math.random()-.5)*100,vy:(Math.random()-.5)*100,life:3,maxLife:3,color:"#FFD700",size:4})}updateMiningParticles(t){this.miningParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.miningParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}updateBlockCreationParticles(t){this.blockCreationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.blockCreationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateContractExecutionParticles(t){this.contractExecutionParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.contractExecutionParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updatePropagationArrows(t){this.propagationArrows.forEach((i,e)=>{if(i.progress+=i.speed,i.progress>=1){this.propagationArrows.splice(e,1);return}})}updateValidationParticles(t){this.validationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.validationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=20*t})}updateConsensusParticles(t){this.consensusParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.consensusParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=25*t})}updateFinalizationParticles(t){this.finalizationParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.finalizationParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateRewardParticles(t){this.rewardParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.rewardParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=30*t})}updateRejectionParticles(t){this.rejectionParticles.forEach((i,e)=>{if(i.life-=t,i.life<=0){this.rejectionParticles.splice(e,1);return}i.x+=i.vx*t,i.y+=i.vy*t,i.vy+=40*t})}setSpeed(t){this.speed=t}setDifficulty(t){this.difficulty=t,this.targetHash="0".repeat(this.difficulty),this.miners.forEach(i=>{i.targetHash=this.targetHash}),this.miningBlock&&(this.miningBlock.hash=this.calculateBlockHash(this.miningBlock))}update(t){const i=t;t*this.speed,this.phaseTime+=i,this.blockGlow=Math.max(0,this.blockGlow-i*2),this.miningGlow=Math.max(0,this.miningGlow-i*1.5),this.networkPulse=(this.networkPulse+i*3)%(2*Math.PI),this.updateDynamicNodes(i),this.isMining&&this.miningBlock&&this.mineBlock(),this.updateMiningParticles(i),this.updateNetworkParticles(i),this.updateContractExecutionParticles(i),this.updateBlockCreationParticles(i),this.updateValidationParticles(i),this.updateConsensusParticles(i),this.updateFinalizationParticles(i),this.updateRewardParticles(i),this.updateRejectionParticles(i),this.updateNodeJoinParticles(i),this.updateNodeLeaveParticles(i),this.createMiningParticles(),this.generateNewTransactions(),this.networkNodes.forEach(o=>{o.isValidating&&this.phaseTime>1.5&&(o.isValidating=!1,o.pulseIntensity=0),o.pulseIntensity=Math.max(0,o.pulseIntensity-i*2)}),this.blocks.forEach(o=>{o.glowIntensity>0&&(o.glowIntensity=Math.max(0,o.glowIntensity-i*1.5))});const e=1200,s=Math.pow(2,this.difficulty-1),a=this.speed,n=Math.floor(e/s*a);this.networkHashrate=this.miners.length*n,this.miningBlock&&this.miningBlock.glowIntensity>0&&(this.miningBlock.glowIntensity=Math.max(0,this.miningBlock.glowIntensity-i*1.5))}updateDynamicNodes(t){const i=Date.now();this.nodeRedistributionTimer+=t,this.nodeRedistributionTimer>this.redistributionInterval&&(this.redistributeNodes(),this.nodeRedistributionTimer=0),i-this.lastNodeJoin>this.nodeJoinInterval&&this.networkNodes.length<this.maxNodes&&(this.addNodeToNetwork(),this.lastNodeJoin=i),i-this.lastNodeLeave>this.nodeLeaveInterval&&this.networkNodes.length>this.minNodes&&(this.removeNodeFromNetwork(),this.lastNodeLeave=i),this.networkNodes.forEach(e=>{if(e.isJoining&&(e.joinProgress+=e.joinSpeed,e.joinProgress>=1?(e.x=e.targetX,e.y=e.targetY,e.isJoining=!1,e.isActive=!0):(e.x=e.x+(e.targetX-e.x)*e.joinSpeed,e.y=e.y+(e.targetY-e.y)*e.joinSpeed)),e.isLeaving&&(e.leaveProgress+=e.leaveSpeed,!(e.leaveProgress>=1))){const s=Math.atan2(e.y-this.networkCenterY,e.x-this.networkCenterX);e.x+=Math.cos(s)*5,e.y+=Math.sin(s)*5}e.isMoving&&(e.moveProgress+=e.moveSpeed,e.moveProgress>=1?(e.x=e.targetX,e.y=e.targetY,e.isMoving=!1):(e.x=e.x+(e.targetX-e.x)*e.moveSpeed,e.y=e.y+(e.targetY-e.y)*e.moveSpeed))})}drawBlockchain(){const t=this.blocks.length;let i=[];t<=4?i=this.blocks:i=[this.blocks[0],this.blocks[1],this.blocks[2],this.blocks[t-1]];const e=i.length*(this.blockWidth+this.blockSpacing),s=this.ctx.createLinearGradient(this.chainStartX-40,this.chainStartY-40,this.chainStartX+e+40,this.chainStartY+this.blockHeight+40);if(s.addColorStop(0,"rgba(33, 150, 243, 0.15)"),s.addColorStop(.5,"rgba(76, 175, 80, 0.1)"),s.addColorStop(1,"rgba(33, 150, 243, 0.15)"),this.ctx.fillStyle=s,this.ctx.fillRect(this.chainStartX-40,this.chainStartY-40,e+80,this.blockHeight+80),i.forEach((a,n)=>{let o=this.chainStartX+n*(this.blockWidth+this.blockSpacing);const h=this.chainStartY;t>4&&n>=3&&(o+=40),a.glowIntensity>0&&(this.ctx.shadowColor=a.isGenesis?"#4CAF50":"#2196F3",this.ctx.shadowBlur=40*a.glowIntensity,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0);const r=this.ctx.createLinearGradient(o,h,o+this.blockWidth,h+this.blockHeight);a.isGenesis?(r.addColorStop(0,"#4CAF50"),r.addColorStop(.3,"#45A049"),r.addColorStop(.7,"#388E3C"),r.addColorStop(1,"#2E7D32")):(r.addColorStop(0,"#42A5F5"),r.addColorStop(.3,"#2196F3"),r.addColorStop(.7,"#1976D2"),r.addColorStop(1,"#1565C0")),this.ctx.fillStyle=r,this.roundRect(o,h,this.blockWidth,this.blockHeight,12),this.ctx.fill();const l=this.ctx.createLinearGradient(o,h,o+this.blockWidth,h+this.blockHeight);l.addColorStop(0,"rgba(255, 255, 255, 0.7)"),l.addColorStop(.5,"rgba(255, 255, 255, 0.4)"),l.addColorStop(1,"rgba(255, 255, 255, 0.3)"),this.ctx.strokeStyle=l,this.ctx.lineWidth=1.5,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.roundRect(o,h,this.blockWidth,this.blockHeight,12),this.ctx.stroke();const c=this.ctx.createLinearGradient(o,h,o,h+this.blockHeight);c.addColorStop(0,"rgba(255, 255, 255, 0.3)"),c.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=c,this.roundRect(o+2,h+2,this.blockWidth-4,this.blockHeight/3,10),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.textAlign="left";const g=a.isGenesis?56:66,x=h+(this.blockHeight-g)/2+10,u=a.isGenesis?"Genesis":`Block #${a.index}`;if(this.ctx.font="bold 16px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.shadowColor="rgba(0, 0, 0, 0.9)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillText(u,o+12,x),this.ctx.font="bold 13px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`📦 ${a.transactions.length} tx`,o+12,x+17),this.ctx.font="11px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Nonce: ${a.nonce.toLocaleString()}`,o+12,x+32),this.showHashes&&(this.ctx.font='9px "JetBrains Mono", "Fira Code", monospace',this.ctx.fillStyle="#ffffff",this.ctx.fillText(`🔗 ${a.hash.substring(0,10)}...`,o+12,x+45)),a.isGenesis||(this.ctx.font="10px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`💰 ${a.blockReward} | 💸 ${a.totalFees.toFixed(1)}`,o+12,x+58)),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,n<i.length-1){i[n+1];let f=this.chainStartX+(n+1)*(this.blockWidth+this.blockSpacing);if(t>4&&n===2){const S=o+this.blockWidth+10,v=h+this.blockHeight/2,k=this.chainStartX+(i.length-1)*(this.blockWidth+this.blockSpacing),P=t-4,T=this.ctx.createLinearGradient(o+this.blockWidth,v,S+15,v);T.addColorStop(0,"rgba(255, 255, 255, 0.4)"),T.addColorStop(1,"rgba(76, 175, 80, 0.6)"),this.ctx.strokeStyle=T,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(o+this.blockWidth,v),this.ctx.lineTo(S+15,v),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50";for(let y=0;y<3;y++)this.ctx.beginPath(),this.ctx.arc(S+20+y*8,v,2.5,0,Math.PI*2),this.ctx.fill();const b=S+28,M=v+15,R=`+${P}`;this.ctx.fillStyle="rgba(76, 175, 80, 0.2)",this.ctx.beginPath(),this.ctx.arc(b,M,12,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.arc(b,M,12,0,Math.PI*2),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50",this.ctx.font="bold 11px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(R,b,M);const d=this.ctx.createLinearGradient(S+40,v,k,v);d.addColorStop(0,"rgba(76, 175, 80, 0.6)"),d.addColorStop(.5,"#4CAF50"),d.addColorStop(1,"rgba(255, 255, 255, 0.4)"),this.ctx.strokeStyle=d,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(S+40,v),this.ctx.lineTo(k,v),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50",this.ctx.shadowColor="rgba(76, 175, 80, 0.5)",this.ctx.shadowBlur=4,this.ctx.beginPath(),this.ctx.moveTo(k-10,v-6),this.ctx.lineTo(k,v),this.ctx.lineTo(k-10,v+6),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}else{const S=this.ctx.createLinearGradient(o+this.blockWidth,h+this.blockHeight/2,f,h+this.blockHeight/2);S.addColorStop(0,"rgba(255, 255, 255, 0.4)"),S.addColorStop(.5,"#4CAF50"),S.addColorStop(1,"rgba(255, 255, 255, 0.4)"),this.ctx.strokeStyle=S,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(o+this.blockWidth,h+this.blockHeight/2),this.ctx.lineTo(f,h+this.blockHeight/2),this.ctx.stroke(),this.ctx.fillStyle="#4CAF50",this.ctx.shadowColor="rgba(76, 175, 80, 0.5)",this.ctx.shadowBlur=4,this.ctx.beginPath(),this.ctx.moveTo(f-10,h+this.blockHeight/2-6),this.ctx.lineTo(f,h+this.blockHeight/2),this.ctx.lineTo(f-10,h+this.blockHeight/2+6),this.ctx.closePath(),this.ctx.fill(),this.ctx.shadowBlur=0}}}),this.miningBlock){let a=this.chainStartX+i.length*(this.blockWidth+this.blockSpacing);a+=30;const n=this.ctx.canvas.width-this.blockWidth-50;a>n&&(a=n);const o=this.chainStartY;this.miningGlow>0&&(this.ctx.shadowColor="#FF9800",this.ctx.shadowBlur=50*this.miningGlow,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0);const h=this.ctx.createLinearGradient(a,o,a+this.blockWidth,o+this.blockHeight);h.addColorStop(0,"#FFB74D"),h.addColorStop(.3,"#FF9800"),h.addColorStop(.7,"#F57C00"),h.addColorStop(1,"#E65100"),this.ctx.fillStyle=h,this.roundRect(a,o,this.blockWidth,this.blockHeight,12),this.ctx.fill();const r=this.ctx.createLinearGradient(a,o,a+this.blockWidth,o+this.blockHeight);r.addColorStop(0,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.5,"rgba(255, 193, 7, 0.6)"),r.addColorStop(1,"rgba(255, 152, 0, 0.7)"),this.ctx.strokeStyle=r,this.ctx.lineWidth=1.5,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.roundRect(a,o,this.blockWidth,this.blockHeight,12),this.ctx.stroke();const l=this.ctx.createLinearGradient(a,o,a,o+this.blockHeight);l.addColorStop(0,"rgba(255, 255, 255, 0.4)"),l.addColorStop(.5,"rgba(255, 193, 7, 0.2)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=l,this.roundRect(a+2,o+2,this.blockWidth-4,this.blockHeight/3,10),this.ctx.fill(),this.ctx.shadowBlur=0,this.ctx.textAlign="left",this.ctx.shadowColor="rgba(0, 0, 0, 0.9)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1;const c=this.showHashes?58:48,g=o+(this.blockHeight-c)/2+10;this.ctx.font="bold 15px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText("⛏️ Mining...",a+12,g),this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Nonce: ${this.miningBlock.nonce.toLocaleString()}`,a+12,g+16),this.ctx.font="10px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`Target: ${this.targetHash}`,a+12,g+30),this.ctx.font="10px Inter, Arial, sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(`💰 ${this.blockReward} | 💸 ${this.miningBlock.totalFees.toFixed(1)}`,a+12,g+43),this.showHashes&&(this.ctx.font='8px "JetBrains Mono", "Fira Code", monospace',this.ctx.fillStyle="#ffffff",this.ctx.fillText(`${this.miningBlock.hash.substring(0,14)}...`,a+12,g+54)),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0;const x=this.miningBlock.nonce%100/100;this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",this.roundRect(a+12,o+105,110,10,5),this.ctx.fill();const u=this.ctx.createLinearGradient(a+12,o+105,a+12+110*x,o+105);u.addColorStop(0,"#FFB74D"),u.addColorStop(.5,"#FF9800"),u.addColorStop(1,"#F57C00"),this.ctx.fillStyle=u,this.roundRect(a+12,o+105,110*x,10,5),this.ctx.fill(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.lineWidth=1,this.roundRect(a+12,o+105,110,10,5),this.ctx.stroke()}}drawNetwork(){if(!this.showNetwork)return;const t=this.ctx.createRadialGradient(this.networkCenterX,this.networkCenterY,0,this.networkCenterX,this.networkCenterY,120);t.addColorStop(0,"rgba(33, 150, 243, 0.2)"),t.addColorStop(.7,"rgba(33, 150, 243, 0.1)"),t.addColorStop(1,"rgba(33, 150, 243, 0.05)"),this.ctx.fillStyle=t,this.ctx.fillRect(this.networkCenterX-120,this.networkCenterY-120,240,240),this.ctx.strokeStyle=`rgba(100, 180, 255, ${.3+.2*Math.sin(this.networkPulse)})`,this.ctx.lineWidth=2,this.ctx.lineCap="round";for(let i=0;i<this.networkNodes.length;i++)for(let e=i+1;e<this.networkNodes.length;e++){const s=this.networkNodes[i],a=this.networkNodes[e],n=a.x-s.x,o=a.y-s.y,h=Math.sqrt(n*n+o*o);if(h<180){const r=.3+.2*(1-h/180);this.ctx.strokeStyle=`rgba(100, 180, 255, ${r})`,this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(a.x,a.y),this.ctx.stroke()}}this.networkNodes.forEach(i=>{i.isLeaving&&(this.ctx.globalAlpha=1-i.leaveProgress),this.nodeRadius+8*i.pulseIntensity*Math.sin(this.networkPulse*2);const e=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,this.nodeRadius);let s,a;if(i.color.startsWith("hsl")){const r=i.color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(r){const l=r[1],c=r[2],g=parseInt(r[3]);s=`hsl(${l}, ${c}%, ${g}%)`,a=`hsl(${l}, ${c}%, ${Math.max(0,g-30)}%)`}else s=i.color,a=i.color}else s=i.color,a=this.adjustColor(i.color,-30);e.addColorStop(0,s),e.addColorStop(.7,a),e.addColorStop(1,this.adjustColor(a,-20)),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius,0,2*Math.PI),this.ctx.fill();const n=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,this.nodeRadius);n.addColorStop(0,"rgba(255, 255, 255, 0.9)"),n.addColorStop(.5,"rgba(255, 255, 255, 0.6)"),n.addColorStop(1,"rgba(255, 255, 255, 0.3)"),this.ctx.strokeStyle=n,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius,0,2*Math.PI),this.ctx.stroke();const o=this.ctx.createRadialGradient(i.x-this.nodeRadius*.3,i.y-this.nodeRadius*.3,0,i.x,i.y,this.nodeRadius*.8);if(o.addColorStop(0,"rgba(255, 255, 255, 0.4)"),o.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius*.8,0,2*Math.PI),this.ctx.fill(),i===this.successfulMiner){const r=Math.sin(this.networkPulse*2)*.3+1,l=this.nodeRadius*r;this.ctx.shadowColor="#00FF88",this.ctx.shadowBlur=25*r,this.ctx.fillStyle="rgba(0, 255, 136, 0.3)",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+15,0,2*Math.PI),this.ctx.fill();const c=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l+20);c.addColorStop(0,"#00FF88"),c.addColorStop(.5,"#00E676"),c.addColorStop(1,"#00C853"),this.ctx.strokeStyle=c,this.ctx.lineWidth=4*r,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+18,0,2*Math.PI),this.ctx.stroke();const g=Math.sin(this.networkPulse*3)*.5+.5;this.ctx.strokeStyle=`rgba(0, 255, 136, ${.6+g*.4})`,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+25,0,2*Math.PI),this.ctx.stroke(),this.ctx.strokeStyle=`rgba(0, 255, 136, ${.4+g*.3})`,this.ctx.lineWidth=1.5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l+32,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0;const x=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l);let u,f;if(i.color.startsWith("hsl")){const v=i.color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(v){const k=v[1],P=v[2],T=parseInt(v[3]);u=`hsl(${k}, ${P}%, ${T}%)`,f=`hsl(${k}, ${P}%, ${Math.max(0,T-30)}%)`}else u=i.color,f=i.color}else u=i.color,f=this.adjustColor(i.color,-30);x.addColorStop(0,u),x.addColorStop(.7,f),x.addColorStop(1,this.adjustColor(f,-20)),this.ctx.fillStyle=x,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l,0,2*Math.PI),this.ctx.fill();const p=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,l);p.addColorStop(0,"rgba(255, 255, 255, 0.9)"),p.addColorStop(.5,"rgba(255, 255, 255, 0.6)"),p.addColorStop(1,"rgba(255, 255, 255, 0.3)"),this.ctx.strokeStyle=p,this.ctx.lineWidth=3*r,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l,0,2*Math.PI),this.ctx.stroke();const S=this.ctx.createRadialGradient(i.x-l*.3,i.y-l*.3,0,i.x,i.y,l*.8);S.addColorStop(0,"rgba(255, 255, 255, 0.4)"),S.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),S.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.fillStyle=S,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,l*.8,0,2*Math.PI),this.ctx.fill(),this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#ffffff",this.ctx.font=`${Math.floor(11*r)}px Inter, Arial, sans-serif`,this.ctx.fillText(`Node ${i.id}`,i.x,i.y+5*r),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.globalAlpha=1;return}if(i.isMining){const r=Math.sin(this.networkPulse*3)*.5+.5;this.ctx.shadowColor="#FF9800",this.ctx.shadowBlur=15,this.ctx.strokeStyle=`rgba(255, 152, 0, ${.9+r*.1})`,this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+18,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=8,this.ctx.strokeStyle=`rgba(255, 235, 59, ${.8+r*.2})`,this.ctx.lineWidth=4,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+14,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=12,this.ctx.strokeStyle=`rgba(255, 193, 7, ${.95+r*.05})`,this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+10,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0;for(let l=0;l<6;l++){const c=l/6*2*Math.PI+this.networkPulse*2,g=this.nodeRadius+25+Math.sin(this.networkPulse*4+l)*5,x=i.x+Math.cos(c)*g,u=i.y+Math.sin(c)*g;this.ctx.fillStyle=`rgba(255, 152, 0, ${.7+Math.sin(this.networkPulse*3+l)*.3})`,this.ctx.beginPath(),this.ctx.arc(x,u,3,0,2*Math.PI),this.ctx.fill()}}i.isValidating&&(this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=10,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+16,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),i.isJoining&&(this.ctx.shadowColor="#4CAF50",this.ctx.shadowBlur=12,this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+22,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),i.isMoving&&(this.ctx.shadowColor="#2196F3",this.ctx.shadowBlur=8,this.ctx.strokeStyle="#2196F3",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,this.nodeRadius+20,0,2*Math.PI),this.ctx.stroke(),this.ctx.shadowBlur=0),this.ctx.textAlign="center",this.ctx.fillStyle="#ffffff",this.ctx.font="bold 10px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.shadowColor="rgba(0, 0, 0, 0.9)",this.ctx.shadowBlur=3;let h=`N${i.id}`;i.isMining&&(h=`⛏ M${i.id}`),this.ctx.fillText(h,i.x,i.y+this.nodeRadius+14),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.globalAlpha=1})}adjustColor(t,i){if(t.startsWith("hsl"))return t;if(t.startsWith("#")){const e=t.replace("#","");if(e.length===6){const s=Math.max(0,Math.min(255,parseInt(e.substr(0,2),16)+i)),a=Math.max(0,Math.min(255,parseInt(e.substr(2,2),16)+i)),n=Math.max(0,Math.min(255,parseInt(e.substr(4,2),16)+i));return`#${s.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}}return t}roundRect(t,i,e,s,a){this.ctx.beginPath(),this.ctx.moveTo(t+a,i),this.ctx.lineTo(t+e-a,i),this.ctx.quadraticCurveTo(t+e,i,t+e,i+a),this.ctx.lineTo(t+e,i+s-a),this.ctx.quadraticCurveTo(t+e,i+s,t+e-a,i+s),this.ctx.lineTo(t+a,i+s),this.ctx.quadraticCurveTo(t,i+s,t,i+s-a),this.ctx.lineTo(t,i+a),this.ctx.quadraticCurveTo(t,i,t+a,i),this.ctx.closePath()}drawTransactions(){const a=Date.now();this.pendingTransactions.slice(0,3).forEach((n,o)=>{const h=60+o*200,r=40,l=a-n.timestamp,c=Math.floor(l/1e3),g=Math.max(.6,1-l/3e4),x=this.ctx.createLinearGradient(h,r,h+180,r+100);l>2e4?(x.addColorStop(0,"#4B5563"),x.addColorStop(.3,"#6B7280"),x.addColorStop(.7,"#374151"),x.addColorStop(1,"#1F2937")):(x.addColorStop(0,"#6A4C93"),x.addColorStop(.3,"#8B5CF6"),x.addColorStop(.7,"#7C3AED"),x.addColorStop(1,"#5B21B6")),this.ctx.fillStyle=x,this.ctx.globalAlpha=g,this.roundRect(h,r,180,100,12),this.ctx.fill();const u=l>2e4?"#9CA3AF":"#E0E7FF";this.ctx.strokeStyle=u,this.ctx.lineWidth=2,this.ctx.shadowColor=l>2e4?"#6B7280":"#8B5CF6",this.ctx.shadowBlur=8,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1,this.ctx.textAlign="left",this.ctx.shadowColor="rgba(0, 0, 0, 0.9)",this.ctx.shadowBlur=2,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillStyle="#ffffff",this.ctx.font="bold 11px Inter, Arial, sans-serif";const f=`${n.from} → ${n.to}`,p=18,S=f.length>p?f.substring(0,p-2)+"..":f;this.ctx.fillText(S,h+10,r+18),this.ctx.font="9px Inter, Arial, sans-serif",this.ctx.fillText(`💰 ${n.amount} | 💸 ${n.fee.toFixed(1)}`,h+10,r+32);const v=n.type.replace("_"," "),k=v.length>15?v.substring(0,12)+"...":v;this.ctx.fillText(`${k}`,h+10,r+44);const P=c<60?`${c}s`:`${Math.floor(c/60)}m`,T=n.fee>this.transactionFee*1.5?"High":n.fee>this.transactionFee?"Med":"Low";this.ctx.fillText(`${P} ago`,h+10,r+56);const b=n.fee>this.transactionFee*1.5?"#22C55E":n.fee>this.transactionFee?"#FCD34D":"#FCA5A5";if(this.ctx.fillStyle=b,this.ctx.fillText(`${T}`,h+10,r+68),n.description){this.ctx.font="8px Inter, Arial, sans-serif",this.ctx.fillStyle="rgba(255, 255, 255, 0.85)";const M=n.description.length>22?n.description.substring(0,19)+"...":n.description;this.ctx.fillText(M,h+10,r+80)}if(this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,l<5e3){const M=Math.sin(a*.01)*.3+.7;this.ctx.strokeStyle=`rgba(139, 92, 246, ${M})`,this.ctx.lineWidth=3,this.ctx.lineCap="round",this.roundRect(h,r,180,100,12),this.ctx.stroke()}}),this.ctx.globalAlpha=1}drawParticles(){this.miningParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.networkParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.contractExecutionParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.blockCreationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.validationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.consensusParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.finalizationParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.rewardParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.nodeJoinParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.nodeLeaveParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1,this.rejectionParticles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life/t.maxLife,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()}),this.ctx.globalAlpha=1}drawPropagationArrows(){this.propagationArrows.forEach(t=>{const i=t.startX+(t.endX-t.startX)*t.progress,e=t.startY+(t.endY-t.startY)*t.progress;this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(i,e),this.ctx.stroke();const s=Math.atan2(t.endY-t.startY,t.endX-t.startX),a=12,n=Math.PI/6;this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i-a*Math.cos(s-n),e-a*Math.sin(s-n)),this.ctx.moveTo(i,e),this.ctx.lineTo(i-a*Math.cos(s+n),e-a*Math.sin(s+n)),this.ctx.stroke(),this.ctx.shadowBlur=0})}drawMiningProgress(){const t=this.ctx.canvas.width,i=200,e=20,s=t-i-30,a=20;this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(s-10,a-5,i+20,e+30),this.ctx.strokeStyle="rgba(255, 152, 0, 0.8)",this.ctx.lineWidth=2,this.ctx.strokeRect(s-10,a-5,i+20,e+30),this.ctx.fillStyle="rgba(50, 50, 50, 0.8)",this.ctx.fillRect(s,a,i,e);const n=Math.min(100,this.miningProgress),o=i*n/100,h=this.ctx.createLinearGradient(s,a,s+o,a);h.addColorStop(0,"#FF9800"),h.addColorStop(.5,"#FFB74D"),h.addColorStop(1,"#FF9800"),this.ctx.fillStyle=h,this.ctx.fillRect(s,a,o,e),this.ctx.fillStyle="#ffffff",this.ctx.font="bold 12px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=2,this.ctx.fillText(`Mining: ${n.toFixed(0)}%`,s+i/2,a+e+15),this.ctx.shadowBlur=0}drawUnifiedInfoPanel(){const i=this.ctx.canvas.height-160,e=360,s=140,a=this.ctx.createLinearGradient(60,i,60,i+s);a.addColorStop(0,"rgba(15, 23, 42, 0.92)"),a.addColorStop(.5,"rgba(30, 41, 59, 0.88)"),a.addColorStop(1,"rgba(15, 23, 42, 0.85)"),this.ctx.fillStyle=a,this.roundRect(60,i,e,s,8),this.ctx.fill();const n=this.ctx.createLinearGradient(60,i,60+e,i);n.addColorStop(0,"rgba(59, 130, 246, 0.6)"),n.addColorStop(.5,"rgba(99, 102, 241, 0.8)"),n.addColorStop(1,"rgba(59, 130, 246, 0.6)"),this.ctx.strokeStyle=n,this.ctx.lineWidth=2,this.roundRect(60,i,e,s,8),this.ctx.stroke(),this.ctx.shadowColor="rgba(0, 0, 0, 0.9)",this.ctx.shadowBlur=3,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.textAlign="left",this.ctx.fillStyle="#60A5FA",this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.fillText("⛓️ Network Status",75,i+22);const o=this.animationPhase.charAt(0).toUpperCase()+this.animationPhase.slice(1).replace("_"," "),h=this.isMining?"#22C55E":"#94A3B8";this.ctx.fillStyle=h,this.ctx.font="bold 11px Inter, Arial, sans-serif",this.ctx.fillText(`● ${o}`,75,i+40),this.ctx.font="10px Inter, Arial, sans-serif",this.ctx.fillStyle="#E2E8F0",this.ctx.fillText(`Blocks: ${this.totalBlocks}`,75,i+58),this.ctx.fillText(`Tx: ${this.totalTransactions}`,75,i+72),this.ctx.fillText(`Pending: ${this.pendingTransactions.length}`,75,i+86),this.ctx.fillText(`Difficulty: ${this.difficulty}`,190,i+58),this.ctx.fillText(`Nodes: ${this.networkNodes.length}`,190,i+72),this.ctx.fillText(`Miners: ${this.miners.length}`,190,i+86),this.miningBlock?(this.ctx.fillText(`Nonce: ${this.miningBlock.nonce.toLocaleString()}`,300,i+58),this.ctx.fillText(`H/s: ${(this.networkHashrate/1e3).toFixed(1)}k`,300,i+72),this.ctx.fillText(`Target: ${this.targetHash}`,300,i+86)):this.guidedMode&&this.guidedBlock&&(this.ctx.fillText(`Step: ${this.currentStep+1}/${this.phaseSteps.length}`,300,i+58),this.ctx.fillText(`Block: #${this.guidedBlock.index}`,300,i+72),this.ctx.fillText(`Time: ${this.phaseTime.toFixed(1)}s`,300,i+86));const r=(this.averageBlockTime/1e3).toFixed(1);if(this.ctx.fillStyle="#94A3B8",this.ctx.font="9px Inter, Arial, sans-serif",this.ctx.fillText(`Avg Block Time: ${r}s`,75,i+105),this.guidedMode&&this.guidedBlock){const c=(this.networkNodes.filter(S=>S.consensusReached).length/this.networkNodes.length*100).toFixed(0);this.ctx.fillStyle="#94A3B8",this.ctx.fillText(`Consensus: ${c}%`,240,i+105);const g=(this.currentStep+1)/this.phaseSteps.length,x=330,u=4,f=i+120;this.ctx.fillStyle="rgba(71, 85, 105, 0.5)",this.ctx.fillRect(75,f,x,u);const p=this.ctx.createLinearGradient(75,f,75+x*g,f);p.addColorStop(0,"#22C55E"),p.addColorStop(1,"#10B981"),this.ctx.fillStyle=p,this.ctx.fillRect(75,f,x*g,u)}this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0}render(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawBlockchain(),this.drawNetwork(),this.drawTransactions(),this.drawParticles(),this.drawMinerRewardDisplay(),this.drawUnifiedInfoPanel(),this.isMining&&this.miningBlock&&!this.guidedBlock&&this.drawMiningProgress(),this.guidedPhaseIndicator&&this.drawGuidedPhaseIndicator(),this.minerRewardDisplay&&this.drawMinerRewardDisplay()}drawGuidedPhaseIndicator(){if(!this.guidedPhaseIndicator)return;const t=this.ctx.canvas.width/2,i=this.guidedPhaseIndicator.y||350,e=this.guidedPhaseIndicator.color||"#00FF88";this.ctx.font="bold 22px Inter, Arial, sans-serif",this.ctx.textAlign="center";const s=this.ctx.measureText(this.guidedPhaseIndicator.text).width,a=Math.max(s+80,300),n=60,o=t-a/2,h=i-n/2,r=t+a/2,l=i+n/2;if(isFinite(o)&&isFinite(h)&&isFinite(r)&&isFinite(l)){const c=this.ctx.createLinearGradient(o,h,r,l);c.addColorStop(0,"rgba(0, 0, 0, 0.9)"),c.addColorStop(.5,"rgba(20, 20, 20, 0.95)"),c.addColorStop(1,"rgba(0, 0, 0, 0.9)"),this.ctx.fillStyle=c,this.roundRect(t-a/2,i-n/2,a,n,15),this.ctx.fill(),this.ctx.strokeStyle=e,this.ctx.lineWidth=4,this.ctx.shadowColor=e,this.ctx.shadowBlur=15,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=1,this.roundRect(t-a/2+2,i-n/2+2,a-4,n-4,13),this.ctx.stroke(),this.ctx.fillStyle=e,this.ctx.font="bold 22px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.shadowColor="rgba(0, 0, 0, 0.8)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=1,this.ctx.shadowOffsetY=1,this.ctx.fillText(this.guidedPhaseIndicator.text,t,i+8),this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.guidedPhaseIndicator.alpha=.8+.2*Math.sin(Date.now()*.005),this.ctx.globalAlpha=this.guidedPhaseIndicator.alpha,this.ctx.globalAlpha=1}}getStats(){const t=this.networkNodes.filter(s=>s.consensusReached),i=this.networkNodes.length*.6,e=this.networkNodes.length>0?Math.round(t.length/this.networkNodes.length*100):0;return{blocks:this.totalBlocks,transactions:this.totalTransactions,pending:this.pendingTransactions.length,difficulty:this.difficulty,hashrate:this.networkHashrate,miners:this.miners.length,nodes:this.networkNodes.length,phase:this.animationPhase,isMining:this.isMining,totalRewards:this.totalRewards,averageBlockTime:this.averageBlockTime/1e3,consensusPercentage:e,consensusThreshold:Math.round(i*100/this.networkNodes.length),consensusReached:t.length>=i}}reset(){this.blocks=[],this.pendingTransactions=[],this.miningBlock=null,this.isMining=!1,this.animationPhase="idle",this.phaseTime=0,this.miningParticles=[],this.validationParticles=[],this.networkParticles=[],this.propagationArrows=[],this.contractExecutionParticles=[],this.blockCreationParticles=[],this.consensusParticles=[],this.finalizationParticles=[],this.rewardParticles=[],this.rejectionParticles=[],this.nodeJoinParticles=[],this.nodeLeaveParticles=[],this.guidedBlock=null,this.currentStep=0,this.totalBlocks=0,this.totalTransactions=0,this.guidedPhaseIndicator=null,this.successfulMiner=null,this.minerBlockConnection=null,this.minerRewardDisplay=null,this.lastNodeJoin=0,this.lastNodeLeave=0,this.nodeRedistributionTimer=0,this.nextNodeId=1,this.blockTimes=[],this.lastDifficultyAdjustment=0,this.lastBlockTime=0,this.difficulty=4,this.targetHash="0".repeat(this.difficulty),this.speed=1,this.showHashes=!0,this.showNetwork=!0,this.autoMine=!0,this.resetControls(),this.initializeBlockchain(),this.initializeNetwork(),this.startGenesisBlock()}resetControls(){const t=document.getElementById("blockchainDifficulty"),i=document.getElementById("blockchainDifficultyValue");t&&i&&(t.value=this.difficulty,i.textContent=this.difficulty);const e=document.getElementById("blockchainSpeed"),s=document.getElementById("blockchainSpeedValue");e&&s&&(e.value=this.speed,s.textContent=this.speed+"x")}drawMinerBlockConnection(){if(!this.minerBlockConnection)return;const t=this.minerBlockConnection;t.progress+=t.speed,t.progress>1&&(t.progress=1);const i=t.startX+(t.endX-t.startX)*t.progress,e=t.startY+(t.endY-t.startY)*t.progress;this.ctx.strokeStyle=t.color,this.ctx.lineWidth=t.width,this.ctx.globalAlpha=t.alpha,this.ctx.shadowColor=t.color,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.moveTo(t.startX,t.startY),this.ctx.lineTo(i,e),this.ctx.stroke();const s=Math.atan2(t.endY-t.startY,t.endX-t.startX),a=15,n=Math.PI/6;this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.lineTo(i-a*Math.cos(s-n),e-a*Math.sin(s-n)),this.ctx.moveTo(i,e),this.ctx.lineTo(i-a*Math.cos(s+n),e-a*Math.sin(s+n)),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1,t.pulseIntensity=.8+.2*Math.sin(Date.now()*.01)}drawMinerRewardDisplay(){if(!this.minerRewardDisplay)return;const t=this.minerRewardDisplay;if(t.life-=.016,t.y+=t.velocity*.016,t.alpha=t.life/t.maxLife,t.life<=0){this.minerRewardDisplay=null;return}this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.alpha,this.ctx.font="bold 14px Inter, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.fillText(t.text,t.x,t.y),this.ctx.shadowColor=t.color,this.ctx.shadowBlur=8,this.ctx.fillText(t.text,t.x,t.y),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}createRejectionParticles(){const t=this.blocks.length;let i;if(t<=4){const s=t;i=this.chainStartX+s*(this.blockWidth+this.blockSpacing)+this.blockWidth/2}else{const a=[this.blocks[0],this.blocks[1],this.blocks[2],...this.blocks.slice(-1)].length;i=this.chainStartX+a*(this.blockWidth+this.blockSpacing)+this.blockWidth/2,t>4&&(i+=80)}const e=this.chainStartY+this.blockHeight/2;for(let s=0;s<20;s++)this.rejectionParticles.push({x:i,y:e,vx:(Math.random()-.5)*150,vy:(Math.random()-.5)*150,life:2.5,maxLife:2.5,color:"#FF5722",size:5})}}class Ft{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.currentAnimation="brownian",this.isRunning=!0,this.lastTime=0,this.brownianMotion=new lt(this.ctx),this.pendulum=new xt(this.ctx),this.diffusion=new ct(this.ctx),this.waves=new pt(this.ctx),this.orbital=new gt(this.ctx),this.electricFields=new yt(this.ctx),this.gasLaws=new dt(this.ctx),this.collisions=new ut(this.ctx),this.friction=new ft(this.ctx),this.magneticFields=new wt(this.ctx),this.waveParticleDuality=new bt(this.ctx),this.nuclearReactions=new St(this.ctx),this.fluidFlow=new Pt(this.ctx),this.bernoulli=new Mt(this.ctx),this.soundWaves=new mt(this.ctx),this.diodeTransistor=new vt(this.ctx),this.neuralNetwork=new Ct(this.ctx),this.memoryManagement=new kt(this.ctx),this.blockchain=new Tt(this.ctx),this.setupEventListeners(),this.resizeCanvas(),setTimeout(()=>{this.initializeWaveControls(),this.initializeSoundWavesControls(),this.initializeDiodeTransistorControls()},100),this.animate()}setupEventListeners(){document.querySelectorAll(".category-header").forEach(d=>{const y=(B,I)=>{try{B.setAttribute("aria-expanded",String(I))}catch{}};d.addEventListener("click",B=>{const I=B.currentTarget.closest(".category-item");I.dataset.category;const E=document.querySelector(".side-navigation"),A=document.querySelector(".main-content");if(E.classList.contains("collapsed")){E.classList.remove("collapsed"),A.classList.remove("nav-collapsed"),y(d,!0);return}if(document.querySelectorAll(".category-item").forEach(m=>{if(m!==I){m.classList.remove("active");const w=m.querySelector(".category-header");w&&y(w,!1)}}),I.classList.toggle("active"),y(d,I.classList.contains("active")),I.classList.contains("active")){const m=I.querySelector(".submenu-item");m&&!m.classList.contains("active")&&this.switchAnimation(m.dataset.animation)}}),d.addEventListener("keydown",B=>{(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),d.click())})}),document.querySelectorAll(".submenu-item").forEach(d=>{d.addEventListener("click",y=>{const B=y.currentTarget.dataset.animation;document.querySelectorAll(".submenu-item").forEach(I=>{I.classList.remove("active")}),y.currentTarget.classList.add("active"),this.switchAnimation(B)})});const t=document.querySelector(".nav-toggle-btn"),i=document.querySelector(".side-navigation"),e=document.querySelector(".main-content"),s=document.querySelector(".controls-panel"),a=document.querySelector(".controls-toggle"),n=document.getElementById("controlsBackdrop");t&&(t.addEventListener("click",()=>{const d=!i.classList.contains("collapsed");i.classList.toggle("collapsed"),e.classList.toggle("nav-collapsed");try{localStorage.setItem("sideNavCollapsed",String(d))}catch{}try{localStorage.setItem("sideNavUserToggled","true")}catch{}if(d){i.classList.remove("open");const y=document.getElementById("mobileNavToggle");y&&y.classList.remove("open")}try{const y=!d;t.setAttribute("aria-expanded",String(y))}catch{}}),t.setAttribute("aria-expanded",String(!i.classList.contains("collapsed"))));const o=()=>{!s||!n||(s.classList.remove("collapsed"),n.classList.add("active"))},h=()=>{!s||!n||(s.classList.add("collapsed"),n.classList.remove("active"))};a&&a.addEventListener("click",d=>{d.preventDefault(),d.stopImmediatePropagation?d.stopImmediatePropagation():d.stopPropagation(),o()}),n&&n.addEventListener("click",h);const r=document.getElementById("controlsApplyBtn"),l=document.getElementById("controlsCancelBtn");r&&r.addEventListener("click",()=>{this.applyControlValues(),this.isRunning=!0;const d=document.getElementById("playPauseBtn");d&&(d.textContent="Pause"),h()}),l&&l.addEventListener("click",h);const c=document.getElementById("mobileNavToggle"),g=document.getElementById("navBackdrop");if(c&&i){const d=()=>{c.classList.remove("open"),i.classList.remove("open")};c.addEventListener("click",()=>{if(c.classList.toggle("open"),i.classList.toggle("open"),i.classList.contains("open")){i.classList.remove("collapsed"),e.classList.remove("nav-collapsed");try{localStorage.setItem("sideNavCollapsed","false")}catch{}}try{localStorage.setItem("sideNavUserToggled","true")}catch{}}),g&&g.addEventListener("click",()=>d()),document.addEventListener("keydown",y=>{y.key==="Escape"&&i.classList.contains("open")&&d()})}document.addEventListener("click",d=>{window.innerWidth<=768&&!d.target.closest(".side-navigation")&&!d.target.closest(".mobile-nav-toggle")&&c&&i&&(c.classList.remove("open"),i.classList.remove("open"))});const x=document.getElementById("playPauseBtn");x&&x.addEventListener("click",()=>{this.togglePlayPause()});const u=document.getElementById("resetBtn");u&&u.addEventListener("click",()=>{this.resetAnimation()});const f=document.getElementById("learnMoreBtn");f&&f.addEventListener("click",()=>{this.showScienceExplanation()}),document.getElementById("closeModal").addEventListener("click",()=>{this.closeModal()}),document.getElementById("scienceModal").addEventListener("click",d=>{d.target.id==="scienceModal"&&this.closeModal()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&this.closeModal()});const p=()=>{const d=window.innerWidth||document.documentElement.clientWidth,y=(()=>{try{return localStorage.getItem("sideNavUserToggled")==="true"}catch{return!1}})();if(d<=768){i.classList.remove("collapsed"),e.classList.remove("nav-collapsed"),i.classList.remove("open");return}if(!y)if(d<1320){i.classList.add("collapsed"),e.classList.add("nav-collapsed");try{localStorage.setItem("sideNavCollapsed","true")}catch{}}else{i.classList.remove("collapsed"),e.classList.remove("nav-collapsed");try{localStorage.setItem("sideNavCollapsed","false")}catch{}}};try{localStorage.getItem("sideNavCollapsed")==="true"&&(i.classList.add("collapsed"),e.classList.add("nav-collapsed"));const y=localStorage.getItem("lastAnimation");y&&setTimeout(()=>this.switchAnimation(y),0)}catch{}p(),this.setupSliderControl("particleCount","particleCountValue",d=>{this.brownianMotion.setParticleCount(parseInt(d))}),this.setupSliderControl("speed","speedValue",d=>{this.brownianMotion.setSpeed(parseFloat(d))}),this.setupSliderControl("temperature","temperatureValue",d=>{this.brownianMotion.setTemperature(parseFloat(d))}),this.setupSliderControl("brownianParticleSize","brownianParticleSizeValue",d=>{this.brownianMotion.setParticleSize(parseInt(d))}),document.getElementById("brownianVisualizationMode").addEventListener("change",d=>{this.updateBrownianVisualization(d.target.value)}),this.updateBrownianVisualization("basic"),this.setupSliderControl("pendulumLength","pendulumLengthValue",d=>{this.pendulum.setLength(parseInt(d))}),this.setupSliderControl("pendulumSpeed","pendulumSpeedValue",d=>{this.pendulum.setSpeed(parseFloat(d))}),this.setupSliderControl("initialAngle","initialAngleValue",d=>{this.pendulum.setInitialAngle(parseFloat(d))}),this.setupSliderControl("gravity","gravityValue",d=>{this.pendulum.setGravity(parseFloat(d))}),this.setupSliderControl("damping","dampingValue",d=>{this.pendulum.setDamping(parseFloat(d))}),document.getElementById("pendulumVisualizationMode").addEventListener("change",d=>{this.updatePendulumVisualization(d.target.value)}),this.updatePendulumVisualization("basic"),this.setupSliderControl("diffusionParticles","diffusionParticlesValue",d=>{this.diffusion.setParticleCount(parseInt(d))}),this.setupSliderControl("diffusionSpeed","diffusionSpeedValue",d=>{this.diffusion.setSpeed(parseFloat(d))}),this.setupSliderControl("diffusionRate","diffusionRateValue",d=>{this.diffusion.setDiffusionRate(parseFloat(d))}),this.setupSliderControl("concentrationGradient","concentrationGradientValue",d=>{this.diffusion.setConcentrationGradient(parseFloat(d))}),this.setupSliderControl("diffusionParticleSize","diffusionParticleSizeValue",d=>{this.diffusion.setParticleSize(parseInt(d))}),document.getElementById("diffusionVisualizationMode").addEventListener("change",d=>{this.updateDiffusionVisualization(d.target.value)}),this.updateDiffusionVisualization("basic");const S=document.getElementById("waveType");S&&S.addEventListener("change",d=>{d.stopPropagation(),d.preventDefault(),this.waves.setWaveType(d.target.value)}),this.setupSliderControl("waveSpeed","waveSpeedValue",d=>{this.waves.setSpeed(parseFloat(d))}),this.setupSliderControl("waveFrequency","waveFrequencyValue",d=>{this.waves.setFrequency(parseFloat(d))}),this.setupSliderControl("waveAmplitude","waveAmplitudeValue",d=>{this.waves.setAmplitude(parseFloat(d))});const v=document.getElementById("waveShowAnalytics");v&&v.addEventListener("change",d=>{this.waves.setShowAnalytics(d.target.checked)}),this.setupSliderControl("soundFrequency","soundFrequencyValue",d=>{this.soundWaves.setFrequency(parseInt(d))}),this.setupSliderControl("soundAnimationSpeed","soundAnimationSpeedValue",d=>{this.soundWaves.setAnimationSpeed(parseFloat(d))});const k=document.getElementById("soundWaveType");k&&k.addEventListener("change",d=>{this.soundWaves.setWaveType(d.target.value)}),this.setupSliderControl("orbitalSpeed","orbitalSpeedValue",d=>{this.orbital.setSpeed(parseFloat(d))}),this.setupSliderControl("eccentricity","eccentricityValue",d=>{this.orbital.setEccentricity(parseFloat(d))}),this.setupSliderControl("semiMajorAxis","semiMajorAxisValue",d=>{this.orbital.setSemiMajorAxis(parseInt(d))}),this.setupSliderControl("centralMass","centralMassValue",d=>{this.orbital.setCentralMass(parseFloat(d))}),document.getElementById("orbitalVisualizationMode").addEventListener("change",d=>{this.updateOrbitalVisualization(d.target.value)}),this.updateOrbitalVisualization("basic"),this.setupSliderControl("efSpeed","efSpeedValue",d=>{this.electricFields.setSpeed(parseFloat(d))}),this.setupSliderControl("efFieldStrength","efFieldStrengthValue",d=>{this.electricFields.setFieldStrength(parseFloat(d))}),this.setupSliderControl("efParticleCount","efParticleCountValue",d=>{this.electricFields.setParticleCount(parseInt(d))}),this.setupSliderControl("magneticSpeed","magneticSpeedValue",d=>{this.magneticFields.setSpeed(parseFloat(d))}),this.setupSliderControl("magneticFieldStrength","magneticFieldStrengthValue",d=>{this.magneticFields.setFieldStrength(parseFloat(d))}),this.setupSliderControl("magneticParticleCount","magneticParticleCountValue",d=>{this.magneticFields.setParticleCount(parseInt(d))}),document.getElementById("magneticShowFieldLines").addEventListener("change",d=>{this.magneticFields.setShowFieldLines(d.target.checked)}),this.canvas.addEventListener("click",d=>{const y=this.canvas.getBoundingClientRect(),B=this.canvas.width/y.width,I=this.canvas.height/y.height,E=(d.clientX-y.left)*B,A=(d.clientY-y.top)*I;if(this.currentAnimation==="electric-fields"){const m=document.getElementById("efChargeType").value;this.electricFields.addChargeAtPosition(m,E,A)}else if(this.currentAnimation==="magnetic-fields")this.magneticFields.addMagnetAtPosition(E,A);else if(this.currentAnimation==="diffusion"&&!this.diffusion.diffusionStarted)this.diffusion.startDiffusion();else if(this.currentAnimation==="sound-waves"){this.soundWaves.handleButtonClick(E,A);const m=this.soundWaves.sourceX,w=this.soundWaves.sourceY;Math.sqrt((E-m)**2+(A-w)**2)<=50&&this.soundWaves.triggerWavePulse()}else this.currentAnimation==="neural-network"?this.neuralNetwork.handleCanvasClick(E,A):this.currentAnimation==="memory-management"&&this.memoryManagement&&this.memoryManagement.handleClick(E,A)}),this.setupSliderControl("gasSpeed","gasSpeedValue",d=>{this.gasLaws.setSpeed(parseFloat(d))}),this.setupSliderControl("gasParticleCount","gasParticleCountValue",d=>{this.gasLaws.setParticleCount(parseInt(d))}),this.setupSliderControl("gasTemperature","gasTemperatureValue",d=>{this.gasLaws.setTemperature(parseInt(d))}),this.setupSliderControl("gasVolume","gasVolumeValue",d=>{this.gasLaws.setVolume(parseInt(d))}),this.setupSliderControl("gasPressure","gasPressureValue",d=>{this.gasLaws.setPressure(parseFloat(d))}),document.getElementById("gasVisualizationMode").addEventListener("change",d=>{this.updateGasVisualization(d.target.value)}),document.getElementById("lawType").addEventListener("change",d=>{this.gasLaws.setLawType(d.target.value)}),this.updateGasVisualization("basic"),this.setupSliderControl("collisionSpeed","collisionSpeedValue",d=>{this.collisions.setSpeed(parseFloat(d))}),this.setupSliderControl("ballCount","ballCountValue",d=>{this.collisions.setBallCount(parseInt(d))}),this.setupSliderControl("restitution","restitutionValue",d=>{this.collisions.setRestitution(parseFloat(d))}),this.setupSliderControl("collisionGravity","collisionGravityValue",d=>{this.collisions.setGravity(parseFloat(d))}),document.getElementById("collisionType").addEventListener("change",d=>{this.collisions.setCollisionType(d.target.value)}),this.setupSliderControl("frictionSpeed","frictionSpeedValue",d=>{this.friction.setSpeed(parseFloat(d))}),this.setupSliderControl("inclineAngle","inclineAngleValue",d=>{this.friction.setInclineAngle(parseFloat(d))}),this.setupSliderControl("objectMass","objectMassValue",d=>{this.friction.setObjectMass(parseInt(d))}),this.setupSliderControl("frictionGravity","frictionGravityValue",d=>{this.friction.setGravity(parseFloat(d))}),this.setupSliderControl("frictionCoefficient","frictionCoefficientValue",d=>{this.friction.setFrictionCoefficient(parseFloat(d))}),window.addEventListener("resize",()=>{this.resizeCanvas();const d=document.querySelector(".side-navigation"),y=document.querySelector(".main-content");if(d&&y&&!(()=>{try{return localStorage.getItem("sideNavUserToggled")==="true"}catch{return!1}})()){const I=window.innerWidth||document.documentElement.clientWidth;I<=768?(d.classList.remove("collapsed"),y.classList.remove("nav-collapsed")):I<1320?(d.classList.add("collapsed"),y.classList.add("nav-collapsed")):(d.classList.remove("collapsed"),y.classList.remove("nav-collapsed"))}}),this.canvas.addEventListener("touchstart",d=>{d.preventDefault();const y=this.canvas.getBoundingClientRect(),B=d.touches[0],I=this.canvas.width/y.width,E=this.canvas.height/y.height,A=(B.clientX-y.left)*I,m=(B.clientY-y.top)*E;if(this.currentAnimation==="diffusion"&&!this.diffusion.diffusionStarted)this.diffusion.startDiffusion();else if(this.currentAnimation==="electric-fields"){const w=document.getElementById("efChargeType").value;this.electricFields.addChargeAtPosition(w,A,m)}else if(this.currentAnimation==="magnetic-fields")this.magneticFields.addMagnetAtPosition(A,m);else if(this.currentAnimation==="sound-waves"){this.soundWaves.handleButtonClick(A,m);const w=this.soundWaves.sourceX,F=this.soundWaves.sourceY;Math.sqrt((A-w)**2+(m-F)**2)<=50&&this.soundWaves.triggerWavePulse()}else this.currentAnimation==="neural-network"?this.neuralNetwork.handleCanvasClick(A,m):this.currentAnimation==="memory-management"&&this.memoryManagement?this.memoryManagement.handleClick(A,m):this.currentAnimation==="nuclear-reactions"&&this.nuclearReactions.reactingParticles.forEach(w=>{w.moving||(this.nuclearReactions.findTargetForParticle(w),w.moving=!0)})}),this.canvas.addEventListener("touchmove",d=>{d.preventDefault()}),this.canvas.addEventListener("touchend",d=>{d.preventDefault()}),document.getElementById("dualityMode").addEventListener("change",d=>{this.waveParticleDuality.setMode(d.target.value),this.updateDualityControls(d.target.value)}),this.setupSliderControl("dualitySpeed","dualitySpeedValue",d=>{this.waveParticleDuality.setSpeed(parseFloat(d))}),this.setupSliderControl("dualityEnergy","dualityEnergyValue",d=>{this.waveParticleDuality.setPhotonEnergy(parseFloat(d))}),this.setupSliderControl("dualityWavelength","dualityWavelengthValue",d=>{this.waveParticleDuality.setWavelength(parseFloat(d))}),document.getElementById("performMeasurementBtn").addEventListener("click",()=>{this.waveParticleDuality.performMeasurement()});const P=document.getElementById("dualityMode").value;this.updateDualityControls(P),this.setupSliderControl("nuclearSpeed","nuclearSpeedValue",d=>{this.nuclearReactions.setSpeed(parseFloat(d))}),this.setupSliderControl("neutronEnergy","neutronEnergyValue",d=>{this.nuclearReactions.setNeutronEnergy(parseFloat(d))}),this.setupSliderControl("nuclearTemperature","nuclearTemperatureValue",d=>{this.nuclearReactions.setTemperature(parseFloat(d))}),document.getElementById("nuclearMode").addEventListener("change",d=>{this.nuclearReactions.setMode(d.target.value)}),this.setupSliderControl("fluidSpeed","fluidSpeedValue",d=>{this.fluidFlow.setFlowRate(parseFloat(d))}),this.setupSliderControl("flowRate","flowRateValue",d=>{this.fluidFlow.setFlowRate(parseFloat(d))}),this.setupSliderControl("viscosity","viscosityValue",d=>{this.fluidFlow.setViscosity(parseFloat(d))}),this.setupSliderControl("reynoldsNumber","reynoldsNumberValue",d=>{this.fluidFlow.setReynoldsNumber(parseInt(d))}),document.getElementById("fluidVisualizationMode").addEventListener("change",d=>{this.fluidFlow.setVisualizationMode(d.target.value)}),this.setupSliderControl("pressureDifference","pressureDifferenceValue",d=>{this.bernoulli.setPressureDifference(parseFloat(d))}),this.setupSliderControl("soundAnimationSpeed","soundAnimationSpeedValue",d=>{this.soundWaves.setAnimationSpeed(parseFloat(d))}),this.setupSliderControl("soundFrequency","soundFrequencyValue",d=>{this.soundWaves.setFrequency(parseInt(d))}),document.getElementById("soundWaveType").addEventListener("change",d=>{this.soundWaves.setWaveType(d.target.value)}),this.canvas.addEventListener("click",d=>{if(this.currentAnimation==="sound-waves"){const y=this.canvas.getBoundingClientRect(),B=this.canvas.width/y.width,I=this.canvas.height/y.height,E=(d.clientX-y.left)*B,A=(d.clientY-y.top)*I,m=this.soundWaves.sourceX,w=this.soundWaves.sourceY;Math.sqrt((E-m)**2+(A-w)**2)<=50&&this.soundWaves.triggerWavePulse()}});const T=document.getElementById("diodeComponentType"),b=document.getElementById("diodeBiasType");T&&T.addEventListener("change",d=>{this.diodeTransistor&&this.diodeTransistor.setComponentType(d.target.value)}),b&&b.addEventListener("change",d=>{this.diodeTransistor&&this.diodeTransistor.setBiasType(d.target.value)}),this.setupSliderControl("diodeInputVoltage","diodeInputVoltageValue",d=>{this.diodeTransistor&&this.diodeTransistor.setInputVoltage(parseFloat(d))}),this.setupSliderControl("diodeBaseVoltage","diodeBaseVoltageValue",d=>{this.diodeTransistor&&this.diodeTransistor.setBaseVoltage(parseFloat(d))}),this.setupSliderControl("diodeAnimationSpeed","diodeAnimationSpeedValue",d=>{this.diodeTransistor&&this.diodeTransistor.setAnimationSpeed(parseFloat(d))}),this.setupSliderControl("neuralLearningRate","neuralLearningRateValue",d=>{this.neuralNetwork&&this.neuralNetwork.setLearningRate(parseFloat(d))}),this.setupSliderControl("neuralSpeed","neuralSpeedValue",d=>{this.neuralNetwork&&this.neuralNetwork.setSpeed(parseFloat(d))});const M=document.getElementById("showOutput");M&&this.memoryManagement&&(M.checked=this.memoryManagement.showOutput,M.addEventListener("change",d=>{this.memoryManagement.setShowOutput(d.target.checked)})),this.setupSliderControl("blockchainSpeed","blockchainSpeedValue",d=>{this.blockchain&&this.blockchain.setSpeed(parseFloat(d))}),this.setupSliderControl("blockchainDifficulty","blockchainDifficultyValue",d=>{this.blockchain&&(this.blockchain.setDifficulty(parseInt(d)),this.updateBlockchainStats())});const R=document.getElementById("neuralMode");R&&R.addEventListener("change",d=>{if(this.neuralNetwork){const y=d.target.value==="testing";this.neuralNetwork.setTestingMode(y),y?(this.neuralNetwork.setShowWeights(!0),this.neuralNetwork.setShowGradients(!1),this.neuralNetwork.setShowLoss(!1),this.neuralNetwork.setAutoTrain(!1)):(this.neuralNetwork.setShowWeights(!0),this.neuralNetwork.setShowGradients(!1),this.neuralNetwork.setShowLoss(!0),this.neuralNetwork.setAutoTrain(!0))}})}setupSliderControl(t,i,e){const s=document.getElementById(t),a=document.getElementById(i);if(!s){console.warn(`Slider not found: ${t}`);return}if(!a){console.warn(`Value display not found: ${i}`);return}const n=o=>{const h=typeof o=="string"?o:String(o),r=Number(h),l=a.dataset.unit||s.dataset.unit||"",c=a.dataset.decimals||s.dataset.decimals,g=c!==void 0?Number(c):void 0,x=t.includes("Speed")?"x":t.includes("Angle")?"°":t.includes("Length")?"":t.includes("Wavelength")?" px":t.includes("Frequency")?" Hz":t.includes("gasTemperature")?"K":t.includes("frictionCoefficient")?"":t.includes("Voltage")?"V":"",u=l||x,f=!Number.isNaN(r)&&g!==void 0?r.toFixed(g):h;a.textContent=f+u,e(h)};s.addEventListener("input",o=>{n(o.target.value)}),n(s.value)}updateDualityControls(t){const i=document.getElementById("performMeasurementBtn");t==="superposition"||t==="measurement"?i.style.display="inline-block":i.style.display="none"}updateBrownianVisualization(t){switch(this.brownianMotion.setShowTemperatureHeatmap(!1),this.brownianMotion.setShowVelocityDistribution(!1),this.brownianMotion.setShowMeanFreePath(!1),t){case"basic":break;case"heatmap":this.brownianMotion.setShowTemperatureHeatmap(!0);break;case"advanced":this.brownianMotion.setShowTemperatureHeatmap(!0),this.brownianMotion.setShowVelocityDistribution(!0),this.brownianMotion.setShowMeanFreePath(!0);break}}updateDiffusionVisualization(t){const i=this.diffusion;switch(t){case"basic":i.setShowConcentration(!1),i.setShowConcentrationProfile(!1),i.setShowParticleTrails(!1);break;case"heatmap":i.setShowConcentration(!0),i.setShowConcentrationProfile(!1),i.setShowParticleTrails(!1);break;case"profile":i.setShowConcentration(!1),i.setShowConcentrationProfile(!0),i.setShowParticleTrails(!1);break;case"advanced":i.setShowConcentration(!0),i.setShowConcentrationProfile(!0),i.setShowParticleTrails(!0);break}}updateGasVisualization(t){const i=this.gasLaws;switch(t){case"basic":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!1),i.setShowVelocityDistribution(!1),i.setShowGasLawGraph(!1),i.setShowParticleCollisions(!1);break;case"pressure":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!0),i.setShowVelocityDistribution(!1),i.setShowGasLawGraph(!0),i.setShowParticleCollisions(!1);break;case"advanced":i.setShowPressureGauge(!0),i.setShowPressureHeatmap(!0),i.setShowVelocityDistribution(!0),i.setShowGasLawGraph(!0),i.setShowParticleCollisions(!0);break}}updatePendulumVisualization(t){const i=this.pendulum;switch(t){case"basic":i.setShowPath(!1),i.setShowVelocityVectors(!1),i.setShowForceVectors(!0),i.setShowEnergyInfo(!1),i.setShowPhaseSpace(!1);break;case"vectors":i.setShowPath(!1),i.setShowVelocityVectors(!0),i.setShowForceVectors(!0),i.setShowEnergyInfo(!1),i.setShowPhaseSpace(!1);break;case"advanced":i.setShowPath(!0),i.setShowVelocityVectors(!0),i.setShowForceVectors(!0),i.setShowEnergyInfo(!0),i.setShowPhaseSpace(!0);break}}updateOrbitalVisualization(t){switch(t){case"basic":this.orbital.setShowOrbitPath(!0),this.orbital.setShowVelocityVector(!1),this.orbital.setShowKeplerInfo(!1);break;case"advanced":this.orbital.setShowOrbitPath(!0),this.orbital.setShowVelocityVector(!0),this.orbital.setShowKeplerInfo(!0);break}}switchCategory(t){document.querySelectorAll(".category-btn").forEach(a=>{a.classList.remove("active")});const i=document.querySelector(`[data-category="${t}"]`);i&&i.classList.add("active"),document.querySelectorAll(".animation-group").forEach(a=>{a.classList.remove("active")});const e=document.getElementById(`${t}-animations`);e&&e.classList.add("active");const s=document.querySelector(`#${t}-animations .nav-btn:not(.disabled)`);s?this.switchAnimation(s.dataset.animation):console.warn("No available animations found for category:",t)}switchAnimation(t){if(t===this.currentAnimation)return;document.querySelectorAll(".submenu-item").forEach(a=>{a.classList.remove("active")});const i=document.querySelector(`[data-animation="${t}"]`);if(i){i.classList.add("active");const a=i.closest(".category-item");a&&(document.querySelectorAll(".category-item").forEach(n=>{n!==a&&n.classList.remove("active")}),a.classList.add("active"))}document.querySelectorAll(".animation-controls").forEach(a=>{a.style.display="none"});const e=document.getElementById(`${t}-controls`);e&&(e.style.display="block"),document.querySelectorAll(".animation-info").forEach(a=>{a.style.display="none"});const s=document.getElementById(`${t}-info`);s&&(s.style.display="block"),this.currentAnimation=t;try{localStorage.setItem("lastAnimation",t)}catch{}this.resetAnimation(),t==="waves"&&this.initializeWaveControls(),t==="sound-waves"&&this.initializeSoundWavesControls(),t==="diode-transistor"&&setTimeout(()=>{this.initializeDiodeTransistorControls()},50),t==="memory-management"&&setTimeout(()=>{this.memoryManagement&&this.memoryManagement.startExecution()},100)}initializeWaveControls(){const t=document.getElementById("waveSpeed"),i=document.getElementById("waveFrequency"),e=document.getElementById("waveAmplitude");t&&this.waves&&(t.value=this.waves.speed,document.getElementById("waveSpeedValue").textContent=this.waves.speed+"x"),i&&this.waves&&(i.value=this.waves.frequency,document.getElementById("waveFrequencyValue").textContent=this.waves.frequency),e&&this.waves&&(e.value=this.waves.amplitude,document.getElementById("waveAmplitudeValue").textContent=this.waves.amplitude),this.waves&&this.waves.calculateWaveParameters()}initializeSoundWavesControls(){const t=document.getElementById("soundFrequency"),i=document.getElementById("soundAnimationSpeed"),e=document.getElementById("soundWaveType");t&&this.soundWaves&&(t.value=this.soundWaves.frequency,document.getElementById("soundFrequencyValue").textContent=this.soundWaves.frequency+" Hz"),i&&this.soundWaves&&(i.value=this.soundWaves.animationSpeed,document.getElementById("soundAnimationSpeedValue").textContent=this.soundWaves.animationSpeed+"x"),e&&this.soundWaves&&(e.value=this.soundWaves.waveType)}initializeDiodeTransistorControls(){const t=document.getElementById("diodeComponentType"),i=document.getElementById("diodeBiasType");t&&this.diodeTransistor&&(t.value=this.diodeTransistor.componentType,t.dispatchEvent(new Event("change"))),i&&this.diodeTransistor&&(i.value=this.diodeTransistor.biasType,i.dispatchEvent(new Event("change")))}togglePlayPause(){this.isRunning=!this.isRunning;const t=document.getElementById("playPauseBtn");t.textContent=this.isRunning?"Pause":"Play"}applyControlValues(){var t,i,e,s,a,n,o,h,r,l,c,g,x,u,f,p,S,v,k,P,T,b,M,R,d,y,B,I,E,A;switch(this.currentAnimation){case"brownian":if(this.brownianMotion){const m=parseInt((t=document.getElementById("particleCount"))==null?void 0:t.value),w=parseFloat((i=document.getElementById("speed"))==null?void 0:i.value),F=parseFloat((e=document.getElementById("temperature"))==null?void 0:e.value);isNaN(m)||this.brownianMotion.setParticleCount(m),isNaN(w)||this.brownianMotion.setSpeed(w),isNaN(F)||this.brownianMotion.setTemperature(F)}break;case"pendulum":if(this.pendulum){const m=parseFloat((s=document.getElementById("pendulumLength"))==null?void 0:s.value),w=parseFloat((a=document.getElementById("pendulumSpeed"))==null?void 0:a.value),F=parseFloat((n=document.getElementById("initialAngle"))==null?void 0:n.value),W=parseFloat((o=document.getElementById("gravity"))==null?void 0:o.value),D=parseFloat((h=document.getElementById("damping"))==null?void 0:h.value);isNaN(m)||this.pendulum.setLength(m),isNaN(w)||this.pendulum.setSpeed(w),isNaN(F)||this.pendulum.setInitialAngle(F),isNaN(W)||this.pendulum.setGravity(W),isNaN(D)||this.pendulum.setDamping(D)}break;case"diffusion":if(this.diffusion){const m=parseInt((r=document.getElementById("diffusionParticles"))==null?void 0:r.value),w=parseFloat((l=document.getElementById("diffusionSpeed"))==null?void 0:l.value),F=parseFloat((c=document.getElementById("diffusionRate"))==null?void 0:c.value);isNaN(m)||this.diffusion.setParticleCount(m),isNaN(w)||this.diffusion.setSpeed(w),isNaN(F)||this.diffusion.setDiffusionRate(F)}break;case"waves":if(this.waves){const m=(g=document.getElementById("waveType"))==null?void 0:g.value,w=parseFloat((x=document.getElementById("waveFrequency"))==null?void 0:x.value),F=parseFloat((u=document.getElementById("waveAmplitude"))==null?void 0:u.value);m&&this.waves.setWaveType(m),isNaN(w)||this.waves.setFrequency(w),isNaN(F)||this.waves.setAmplitude(F)}break;case"orbital":if(this.orbital){const m=parseFloat((f=document.getElementById("orbitalSpeed"))==null?void 0:f.value),w=parseFloat((p=document.getElementById("eccentricity"))==null?void 0:p.value);isNaN(m)||this.orbital.setSpeed(m),isNaN(w)||this.orbital.setEccentricity(w)}break;case"gas-laws":if(this.gasLaws){const m=parseFloat((S=document.getElementById("gasSpeed"))==null?void 0:S.value),w=parseInt((v=document.getElementById("gasParticleCount"))==null?void 0:v.value),F=parseFloat((k=document.getElementById("gasTemperature"))==null?void 0:k.value),W=parseFloat((P=document.getElementById("gasVolume"))==null?void 0:P.value);isNaN(m)||this.gasLaws.setSpeed(m),isNaN(w)||this.gasLaws.setParticleCount(w),isNaN(F)||this.gasLaws.setTemperature(F),isNaN(W)||this.gasLaws.setVolume(W)}break;case"collisions":if(this.collisions){const m=parseFloat((T=document.getElementById("collisionSpeed"))==null?void 0:T.value),w=parseInt((b=document.getElementById("ballCount"))==null?void 0:b.value);isNaN(m)||this.collisions.setSpeed(m),isNaN(w)||this.collisions.setBallCount(w)}break;case"friction":if(this.friction){const m=parseFloat((M=document.getElementById("frictionSpeed"))==null?void 0:M.value),w=parseFloat((R=document.getElementById("frictionCoefficient"))==null?void 0:R.value),F=parseFloat((d=document.getElementById("inclineAngle"))==null?void 0:d.value);isNaN(m)||this.friction.setSpeed(m),isNaN(w)||this.friction.setFrictionCoefficient(w),isNaN(F)||this.friction.setInclineAngle(F)}break;case"electric-fields":if(this.electricFields){const m=parseFloat((y=document.getElementById("efSpeed"))==null?void 0:y.value),w=parseFloat((B=document.getElementById("efFieldStrength"))==null?void 0:B.value);isNaN(m)||this.electricFields.setSpeed(m),isNaN(w)||this.electricFields.setFieldStrength(w)}break;case"sound-waves":if(this.soundWaves){const m=(I=document.getElementById("soundWaveType"))==null?void 0:I.value,w=parseFloat((E=document.getElementById("soundFrequency"))==null?void 0:E.value),F=parseFloat((A=document.getElementById("soundAnimationSpeed"))==null?void 0:A.value);m&&this.soundWaves.setWaveType(m),isNaN(w)||this.soundWaves.setFrequency(w),isNaN(F)||this.soundWaves.setAnimationSpeed(F)}break}}resetAnimation(){switch(this.currentAnimation){case"brownian":this.brownianMotion.reset();break;case"pendulum":this.pendulum.reset();break;case"diffusion":this.diffusion.reset();break;case"waves":this.waves.reset();break;case"orbital":this.orbital.reset();break;case"electric-fields":this.electricFields.reset();break;case"gas-laws":this.gasLaws.reset();break;case"collisions":this.collisions.reset();break;case"friction":this.friction.reset();break;case"magnetic-fields":this.magneticFields.reset();break;case"wave-particle-duality":this.waveParticleDuality.reset();break;case"nuclear-reactions":this.nuclearReactions.reset();break;case"fluid-flow":this.fluidFlow.reset();break;case"bernoulli":this.bernoulli.reset();break;case"sound-waves":this.soundWaves.reset();break;case"diode-transistor":this.diodeTransistor.reset();break;case"neural-network":this.neuralNetwork.reset();break;case"memory-management":this.memoryManagement.reset();break;case"blockchain":this.blockchain.reset();break}}resizeCanvas(){this.canvas.parentElement;const t=800,i=600;this.canvas.width=t,this.canvas.height=i,this.soundWaves&&(this.soundWaves.setSourcePosition(100,this.canvas.height/2),this.soundWaves.setReceiverPosition(this.canvas.width-100,this.canvas.height/2)),this.neuralNetwork&&this.neuralNetwork.resize(),this.neuralNetwork&&this.neuralNetwork.neurons.length===0&&this.neuralNetwork.initializeNetwork(),this.memoryManagement&&this.memoryManagement.resize()}animate(t=0){if(!this.isRunning){requestAnimationFrame(e=>this.animate(e));return}this.lastTime===void 0&&(this.lastTime=t);const i=t-this.lastTime;switch(this.lastTime=t,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentAnimation){case"brownian":this.brownianMotion.update(i),this.brownianMotion.render(),this.updateBrownianStats();break;case"pendulum":this.pendulum.update(i),this.pendulum.render(),this.updatePendulumStats();break;case"diffusion":this.diffusion.update(i),this.diffusion.render(),this.updateDiffusionStats();break;case"waves":this.waves.update(i),this.waves.render(),this.updateWaveStats();break;case"orbital":this.orbital.update(i),this.orbital.render(),this.updateOrbitalStats();break;case"electric-fields":this.electricFields.update(i),this.electricFields.render(),this.updateElectricFieldsStats();break;case"gas-laws":this.gasLaws.update(i),this.gasLaws.render(),this.updateGasLawsStats();break;case"collisions":this.collisions.update(i),this.collisions.render(),this.updateCollisionStats();break;case"friction":this.friction.update(i),this.friction.render(),this.updateFrictionStats();break;case"magnetic-fields":this.magneticFields.update(i),this.magneticFields.render(),this.updateMagneticFieldsStats();break;case"wave-particle-duality":this.waveParticleDuality.update(i),this.waveParticleDuality.render(),this.updateWaveParticleDualityStats();break;case"nuclear-reactions":this.nuclearReactions.update(i),this.nuclearReactions.render();break;case"fluid-flow":this.fluidFlow&&(this.fluidFlow.update(i),this.fluidFlow.render(),this.updateFluidFlowStats());break;case"bernoulli":this.bernoulli&&(this.bernoulli.update(i),this.bernoulli.render(),this.updateBernoulliStats());break;case"sound-waves":this.soundWaves&&(this.soundWaves.update(i),this.soundWaves.render(),this.updateSoundWavesStats());break;case"diode-transistor":this.diodeTransistor&&(this.diodeTransistor.update(i),this.diodeTransistor.render(),this.updateDiodeTransistorStats());break;case"neural-network":this.neuralNetwork&&(this.neuralNetwork.update(i),this.neuralNetwork.render(),this.updateNeuralNetworkStats());break;case"memory-management":this.memoryManagement&&(this.memoryManagement.update(i),this.memoryManagement.render(),this.updateMemoryManagementStats());break;case"blockchain":this.blockchain?(this.blockchain.update(i),this.blockchain.render(),this.updateBlockchainStats()):console.error("Blockchain instance not found!");break}requestAnimationFrame(e=>this.animate(e))}updateStats(t,i){const e=this[t];if(!e)return;const s=e.getStats();Object.entries(i).forEach(([a,n])=>{const o=document.getElementById(a);if(o){const h=this.getNestedValue(s,n.path);o.textContent=this.formatValue(h,n)}})}getNestedValue(t,i){return i.split(".").reduce((e,s)=>e&&e[s]!==void 0?e[s]:null,t)}formatValue(t,i){if(t==null)return i.fallback!==void 0?i.fallback.toString():"";const{format:e,suffix:s,prefix:a,decimalPlaces:n,transform:o}=i;if(o&&typeof o=="function"&&(t=o(t)),e==="time")return(t/1e3).toFixed(2)+"s";if(e==="angle")return t.toFixed(n||2)+"°";if(e==="percentage")return t.toFixed(n||2)+"%";if(e==="unit"){if(typeof t=="number"){const h=n!==void 0?n:2;return t.toFixed(h)+(s||"")}return t+(s||"")}return e==="decimal"?typeof t=="number"?t.toFixed(n||2):t.toString():e==="boolean"?t?"Active":"Hidden":e==="capitalize"?t.charAt(0).toUpperCase()+t.slice(1):e==="uppercase"?t.toString().toUpperCase():t.toString()}updateBrownianStats(){this.updateStats("brownianMotion",{activeParticles:{path:"particleCount"},avgSpeed:{path:"avgSpeed",format:"decimal",decimalPlaces:2},brownianCollisionCount:{path:"collisionCount"},brownianMeanFreePath:{path:"meanFreePath",format:"decimal",decimalPlaces:2},brownianTemperature:{path:"temperature",format:"decimal",decimalPlaces:2}})}updatePendulumStats(){this.updateStats("pendulum",{currentAngle:{path:"angle",format:"angle",decimalPlaces:2},angularVelocity:{path:"angularVelocity",format:"decimal",decimalPlaces:2},period:{path:"theoreticalPeriod",format:"unit",suffix:"s",decimalPlaces:2},pendulumAirResistance:{path:"airResistanceForce",format:"decimal",decimalPlaces:2},pendulumDamping:{path:"dampingCoefficient",format:"decimal",decimalPlaces:2}})}updateDiffusionStats(){this.updateStats("diffusion",{diffusionParticleCount:{path:"particleCount"},diffusionAvgSpeed:{path:"avgSpeed",format:"decimal",decimalPlaces:2},concentrationSpread:{path:"concentrationSpread",format:"decimal",decimalPlaces:2}})}updateWaveStats(){this.updateStats("waves",{currentWaveType:{path:"waveType",format:"capitalize"},currentFrequency:{path:"frequency",format:"unit",suffix:" Hz",decimalPlaces:2},currentWavelength:{path:"wavelength",format:"unit",suffix:" px",decimalPlaces:2},currentAmplitude:{path:"amplitude",format:"unit",suffix:" px",decimalPlaces:2},currentWaveSpeed:{path:"waveSpeed",format:"unit",suffix:" px/s",decimalPlaces:2},currentWaveEnergy:{path:"energy",format:"decimal",decimalPlaces:2}})}updateOrbitalStats(){this.updateStats("orbital",{orbitalPeriod:{path:"period",format:"unit",suffix:"s",decimalPlaces:2},orbitalSpeed:{path:"speed",format:"decimal",decimalPlaces:2},orbitalDistance:{path:"distance",format:"decimal",decimalPlaces:1},orbitalEccentricity:{path:"eccentricity",format:"decimal",decimalPlaces:2}})}updateElectricFieldsStats(){this.updateStats("electricFields",{activeCharges:{path:"chargeCount"},"stat-efParticleCount":{path:"particleCount"},"stat-efFieldStrength":{path:"fieldStrength"}})}updateGasLawsStats(){this.updateStats("gasLaws",{"stat-gasParticleCount":{path:"particleCount"},"stat-gasTemperature":{path:"temperature",format:"unit",suffix:"K",decimalPlaces:2},"stat-gasPressure":{path:"pressure",format:"decimal",decimalPlaces:2},"stat-gasVolume":{path:"volume"}})}updateCollisionStats(){this.updateStats("collisions",{collisionBallCount:{path:"ballCount"},collisionMomentum:{path:"totalMomentum",format:"decimal",decimalPlaces:1},collisionEnergy:{path:"totalEnergy",format:"decimal",decimalPlaces:1},collisionCount:{path:"collisionCount"}})}updateFrictionStats(){this.updateStats("friction",{frictionSurface:{path:"surfaceType"},frictionAngle:{path:"inclineAngle",format:"angle",decimalPlaces:2},frictionNetForce:{path:"netForce",format:"decimal",decimalPlaces:2},frictionAcceleration:{path:"acceleration",format:"decimal",decimalPlaces:2}})}updateMagneticFieldsStats(){this.updateStats("magneticFields",{"stat-magneticFieldStrength":{path:"fieldStrength"},"stat-magneticParticleCount":{path:"particleCount"}})}updateWaveParticleDualityStats(){this.updateStats("waveParticleDuality",{currentDualityMode:{path:"mode"},currentPhotonEnergy:{path:"photonEnergy",format:"unit",suffix:" eV"},currentDualityWavelength:{path:"wavelength",format:"unit",suffix:" nm"},waveFunctionStatus:{path:"showWaveFunction",format:"boolean"},interferenceStatus:{path:"showInterference",format:"boolean"},measurementCount:{path:"measurementCount"}})}updateFluidFlowStats(){this.updateStats("fluidFlow",{fluidFlowRate:{path:"flowRate",format:"decimal",decimalPlaces:1},fluidViscosity:{path:"viscosity",format:"decimal",decimalPlaces:1},"stat-reynoldsNumber":{path:"reynoldsNumber"},flowType:{path:"flowType"},averageVelocity:{path:"averageVelocity",format:"decimal",decimalPlaces:2},viscosityEffect:{path:"viscosityEffect",format:"percentage",decimalPlaces:0},velocityRatio:{path:"velocityRatio",format:"decimal",decimalPlaces:1},topPorosity:{path:"topPorosity",format:"percentage",decimalPlaces:0},bottomPorosity:{path:"bottomPorosity",format:"percentage",decimalPlaces:0}})}updateBernoulliStats(){this.updateStats("bernoulli",{bernoulliPressureDiff:{path:"pressureDifference",format:"decimal",decimalPlaces:1},velocityRatio:{path:"velocityRatio",format:"decimal",decimalPlaces:1},energyConservation:{path:"energyConservation"},particleCount:{path:"particleCount"},maxParticles:{path:"maxParticles"},flowEfficiency:{path:"flowEfficiency",format:"percentage"}})}updateSoundWavesStats(){this.updateStats("soundWaves",{"stat-soundWaveType":{path:"waveType",format:"capitalize"},"stat-soundFrequency":{path:"frequency",format:"unit",suffix:" Hz",decimalPlaces:2},"stat-soundWavelength":{path:"wavelength",format:"unit",suffix:" m",decimalPlaces:2},"stat-soundWaveSpeed":{path:"waveSpeed",format:"unit",suffix:" m/s",decimalPlaces:2}})}updateDiodeTransistorStats(){this.updateStats("diodeTransistor",{diodeComponentTypeDisplay:{path:"componentType",format:"uppercase"},diodeBiasTypeDisplay:{path:"biasType",format:"uppercase"},diodeInputVoltageDisplay:{path:"inputVoltage",format:"unit",suffix:"V"},diodeBaseVoltageDisplay:{path:"baseVoltage",format:"unit",suffix:"V"},diodeCurrent:{path:"current",format:"unit",suffix:"mA",decimalPlaces:1},diodePower:{path:"power",format:"unit",suffix:"mW",decimalPlaces:1},diodeStatus:{path:"isActive",format:"boolean"},diodeTemperature:{path:"temperature",format:"unit",suffix:"°C"},diodeTime:{path:"time",format:"time"}});const t=document.getElementById("baseVoltageStat");if(t){const i=this.diodeTransistor.getStats();t.style.display=i.componentType==="npn"||i.componentType==="pnp"?"block":"none"}}updateNeuralNetworkStats(){this.updateStats("neuralNetwork",{neuralEpoch:{path:"epoch"},neuralLoss:{path:"currentLoss",format:"decimal",decimalPlaces:2},neuralAccuracy:{path:"currentAccuracy",format:"percentage",decimalPlaces:2},neuralLearningRate:{path:"learningRate",format:"decimal",decimalPlaces:2},neuralSpeed:{path:"speed",format:"unit",suffix:"x",decimalPlaces:1},neuralPhase:{path:"animationPhase"},neuralDataIndex:{path:"trainingDataIndex"}})}showScienceExplanation(){const t=document.getElementById("scienceModal"),i=document.getElementById("modalTitle"),e=document.getElementById("modalContent"),s=this.getScienceContent();i.textContent=s.title,e.innerHTML=s.html,t.style.display="block"}closeModal(){const t=document.getElementById("scienceModal");t.style.display="none"}getCurrentAnimationState(){var i,e,s,a,n,o,h,r,l,c,g,x,u,f,p,S,v,k,P,T,b,M,R,d,y,B,I,E,A,m,w,F,W,D,X,z,Y,N,V,H,$,G,O,q,j,U,_,K,J,Q,Z,tt,it,et,st,at,nt,ot,ht,rt;const t={animation:this.currentAnimation,controls:{},stats:{}};switch(this.currentAnimation){case"brownian":t.controls={particleCount:((i=document.getElementById("brownianParticleCount"))==null?void 0:i.value)||"15",temperature:((e=document.getElementById("brownianTemperature"))==null?void 0:e.value)||"1.0",speed:((s=document.getElementById("brownianSpeed"))==null?void 0:s.value)||"1.0"},t.stats=((a=this.brownianMotion)==null?void 0:a.getStats())||{};break;case"pendulum":t.controls={length:((n=document.getElementById("pendulumLength"))==null?void 0:n.value)||"100",gravity:((o=document.getElementById("pendulumGravity"))==null?void 0:o.value)||"9.8",damping:((h=document.getElementById("pendulumDamping"))==null?void 0:h.value)||"0.01"},t.stats=((r=this.pendulum)==null?void 0:r.getStats())||{};break;case"waves":t.controls={waveType:((l=document.getElementById("waveType"))==null?void 0:l.value)||"transverse",frequency:((c=document.getElementById("waveFrequency"))==null?void 0:c.value)||"1.0",amplitude:((g=document.getElementById("waveAmplitude"))==null?void 0:g.value)||"50"},t.stats=((x=this.wavePropagation)==null?void 0:x.getStats())||{};break;case"electric-fields":t.controls={fieldStrength:((u=document.getElementById("efFieldStrength"))==null?void 0:u.value)||"1.0",particleCount:((f=document.getElementById("efParticleCount"))==null?void 0:f.value)||"20"},t.stats=((p=this.electricFields)==null?void 0:p.getStats())||{};break;case"magnetic-fields":t.controls={fieldStrength:((S=document.getElementById("magneticFieldStrength"))==null?void 0:S.value)||"1.0",particleCount:((v=document.getElementById("magneticParticleCount"))==null?void 0:v.value)||"15"},t.stats=((k=this.magneticFields)==null?void 0:k.getStats())||{};break;case"gas-laws":t.controls={temperature:((P=document.getElementById("gasTemperature"))==null?void 0:P.value)||"300",pressure:((T=document.getElementById("gasPressure"))==null?void 0:T.value)||"1.0",volume:((b=document.getElementById("gasVolume"))==null?void 0:b.value)||"300"},t.stats=((M=this.gasLaws)==null?void 0:M.getStats())||{};break;case"collisions":t.controls={ballCount:((R=document.getElementById("ballCount"))==null?void 0:R.value)||"5",restitution:((d=document.getElementById("restitution"))==null?void 0:d.value)||"0.8",gravity:((y=document.getElementById("collisionGravity"))==null?void 0:y.value)||"9.8"},t.stats=((B=this.collisions)==null?void 0:B.getStats())||{};break;case"friction":t.controls={angle:((I=document.getElementById("inclineAngle"))==null?void 0:I.value)||"20",frictionCoefficient:((E=document.getElementById("frictionCoefficient"))==null?void 0:E.value)||"0.3",mass:((A=document.getElementById("objectMass"))==null?void 0:A.value)||"1"},t.stats=((m=this.friction)==null?void 0:m.getStats())||{};break;case"wave-particle-duality":t.controls={mode:((w=document.getElementById("dualityMode"))==null?void 0:w.value)||"wave",energy:((F=document.getElementById("dualityEnergy"))==null?void 0:F.value)||"5.0",wavelength:((W=document.getElementById("dualityWavelength"))==null?void 0:W.value)||"150"},t.stats=((D=this.waveParticleDuality)==null?void 0:D.getStats())||{};break;case"sound-waves":t.controls={waveType:((X=document.getElementById("soundWaveType"))==null?void 0:X.value)||"transverse",frequency:((z=document.getElementById("soundFrequency"))==null?void 0:z.value)||"5",amplitude:((Y=document.getElementById("soundAmplitude"))==null?void 0:Y.value)||"50",waveSpeed:((N=document.getElementById("soundSpeed"))==null?void 0:N.value)||"343",particleCount:((V=document.getElementById("soundParticles"))==null?void 0:V.value)||"15",animationSpeed:((H=document.getElementById("soundAnimationSpeed"))==null?void 0:H.value)||"1.0"},t.stats=(($=this.soundWaves)==null?void 0:$.getStats())||{};break;case"diode-transistor":t.controls={componentType:((G=document.getElementById("diodeComponentType"))==null?void 0:G.value)||"diode",biasType:((O=document.getElementById("diodeBiasType"))==null?void 0:O.value)||"forward",inputVoltage:((q=document.getElementById("diodeInputVoltage"))==null?void 0:q.value)||"5",baseVoltage:((j=document.getElementById("diodeBaseVoltage"))==null?void 0:j.value)||"0.7",animationSpeed:((U=document.getElementById("diodeAnimationSpeed"))==null?void 0:U.value)||"1.0"},t.stats=((_=this.diodeTransistor)==null?void 0:_.getStats())||{};break;case"neural-network":t.controls={learningRate:((K=document.getElementById("neuralLearningRate"))==null?void 0:K.value)||"0.1",speed:((J=document.getElementById("neuralSpeed"))==null?void 0:J.value)||"1.0",mode:((Q=document.getElementById("neuralMode"))==null?void 0:Q.value)||"training",optimizer:((Z=document.getElementById("neuralOptimizer"))==null?void 0:Z.value)||"sgd",dataset:((tt=document.getElementById("neuralDataset"))==null?void 0:tt.value)||"shapes",batchSize:((it=document.getElementById("neuralBatchSize"))==null?void 0:it.value)||"4",dropout:((et=document.getElementById("neuralDropout"))==null?void 0:et.value)||"0",weightDecay:((st=document.getElementById("neuralWeightDecay"))==null?void 0:st.value)||"0"},t.stats=((at=this.neuralNetwork)==null?void 0:at.getStats())||{};break;case"memory-management":t.controls={mode:((nt=document.getElementById("memoryMode"))==null?void 0:nt.value)||"random",retentionRate:((ot=document.getElementById("retentionRate"))==null?void 0:ot.value)||"0.5",decayRate:((ht=document.getElementById("decayRate"))==null?void 0:ht.value)||"0.1"},t.stats=((rt=this.memoryManagement)==null?void 0:rt.getStats())||{};break}return t}getScienceContent(){switch(this.currentAnimation){case"brownian":return{title:"Brownian Motion - Random Particle Movement",html:`
                        <div class="science-content">
                            <h3>What is Brownian Motion?</h3>
                            <p>Brownian motion is the random, erratic movement of particles suspended in a fluid (liquid or gas) caused by collisions with fast-moving molecules in the surrounding medium. This phenomenon was first observed by botanist Robert Brown in 1827 when studying pollen grains in water.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Molecular Motion:</strong> All particles are in constant motion due to thermal energy</li>
                                <li><strong>Random Walk:</strong> Each collision changes the particle's direction randomly</li>
                                <li><strong>Temperature Dependence:</strong> Higher temperature = faster molecular motion = more vigorous Brownian motion</li>
                                <li><strong>Particle Size Effect:</strong> Smaller particles show more dramatic Brownian motion</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles moving in seemingly random directions</li>
                                <li>No predictable path - each particle follows a "random walk"</li>
                                <li>Particles occasionally changing direction due to collisions</li>
                                <li>Faster movement at higher temperatures</li>
                                <li>Different colored particles for easy tracking</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Diffusion of molecules in cells</li>
                                <li>Particle movement in air pollution</li>
                                <li>Understanding molecular motion in chemistry</li>
                                <li>Brownian motion in financial markets</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>The mean squared displacement (MSD) of a Brownian particle follows: <strong>MSD = 6Dt</strong>, where D is the diffusion coefficient and t is time. This relationship shows that the average distance a particle travels increases with the square root of time.</p>
                        </div>
                    `};case"sound-waves":return{title:"Sound Waves - Wave Propagation",html:`
                        <div class="science-content">
                            <h3>What are Sound Waves?</h3>
                            <p>Sound waves are mechanical waves that propagate through a medium (like air, water, or solids) by causing particles to vibrate. They are longitudinal waves, meaning the particles move back and forth in the same direction as the wave travels.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Longitudinal Waves:</strong> Particles oscillate parallel to wave direction</li>
                                <li><strong>Transverse Waves:</strong> Particles oscillate perpendicular to wave direction</li>
                                <li><strong>Compression & Rarefaction:</strong> High and low pressure regions in the medium</li>
                                <li><strong>Wave Speed:</strong> v = fλ, where f is frequency and λ is wavelength</li>
                                <li><strong>Amplitude:</strong> Maximum displacement of particles from equilibrium</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Wave pulse traveling from source to receiver</li>
                                <li>Particles moving as the wave passes through</li>
                                <li>Compression zones (orange) and rarefaction zones (cyan)</li>
                                <li>Different wave types: transverse, longitudinal, and combined</li>
                                <li>Wave speed and frequency effects on propagation</li>
                            </ul>
                            
                            <h3>Wave Types Explained</h3>
                            <ul>
                                <li><strong>Transverse:</strong> Like waves on a string - particles move up and down</li>
                                <li><strong>Longitudinal:</strong> Like sound in air - particles move back and forth</li>
                                <li><strong>Combined:</strong> Shows both transverse and longitudinal components</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Musical instruments and sound production</li>
                                <li>Ultrasound imaging in medicine</li>
                                <li>Seismic waves in earthquake detection</li>
                                <li>Sonar and underwater communication</li>
                                <li>Acoustic engineering and noise control</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>For a sound wave: <strong>v = √(B/ρ)</strong>, where v is wave speed, B is bulk modulus, and ρ is density. The frequency determines pitch, while amplitude determines loudness. The relationship <strong>v = fλ</strong> connects speed, frequency, and wavelength.</p>
                        </div>
                    `};case"diode-transistor":return{title:"Diode & Transistor - Electronic Components",html:`
                        <div class="science-content">
                            <h3>What are Diodes and Transistors?</h3>
                            <p>Diodes and transistors are fundamental electronic components that control the flow of electrical current. Diodes allow current to flow in one direction only, while transistors can amplify signals and act as electronic switches.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Semiconductor Physics:</strong> Materials with conductivity between conductors and insulators</li>
                                <li><strong>P-N Junction:</strong> Boundary between P-type (holes) and N-type (electrons) materials</li>
                                <li><strong>Forward Bias:</strong> Positive voltage applied to P-side, negative to N-side</li>
                                <li><strong>Reverse Bias:</strong> Opposite voltage polarity blocks current flow</li>
                                <li><strong>Transistor Amplification:</strong> Small base current controls large collector current</li>
                                <li><strong>Particle Flow:</strong> Electrons and holes flow in opposite directions but contribute to current in the same direction</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Electrons (blue circles):</strong> Move from N-type to P-type material during forward bias</li>
                                <li><strong>Holes (red outlined circles):</strong> Move from P-type to N-type material during forward bias</li>
                                <li><strong>Current Flow:</strong> Only occurs in forward bias conditions with sufficient voltage</li>
                                <li><strong>Voltage Drop:</strong> ~0.7V across diode in forward bias</li>
                                <li><strong>Transistor Control:</strong> Base voltage controls collector current amplification</li>
                                <li><strong>Energy Visualization:</strong> Pulsating circles represent electromagnetic field and power dissipation</li>
                            </ul>
                            
                            <h3>Component Behavior</h3>
                            <ul>
                                <li><strong>Diode Forward Bias:</strong> Current flows when voltage > 0.7V, voltage drop ~0.7V</li>
                                <li><strong>Diode Reverse Bias:</strong> No current flow, acts as insulator</li>
                                <li><strong>NPN Transistor:</strong> Electron flow from emitter to collector, base controls amplification</li>
                                <li><strong>PNP Transistor:</strong> Hole flow from emitter to collector, base controls amplification</li>
                                <li><strong>Amplification Factor:</strong> β = Ic/Ib (collector current / base current) ≈ 100</li>
                            </ul>
                            
                            <h3>Particle Physics</h3>
                            <ul>
                                <li><strong>Electrons:</strong> Filled blue circles representing negative charge carriers</li>
                                <li><strong>Holes:</strong> Red outlined circles representing positive charge carriers (absence of electrons)</li>
                                <li><strong>Flow Direction:</strong> Electrons and holes move in opposite directions but both contribute to conventional current flow</li>
                                <li><strong>Energy Levels:</strong> Particles move faster and glow brighter with higher voltage</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Rectifiers in power supplies</li>
                                <li>Amplifiers in audio systems</li>
                                <li>Digital logic circuits</li>
                                <li>Voltage regulators</li>
                                <li>Radio frequency circuits</li>
                                <li>Computer processors and memory</li>
                            </ul>
                            
                            <h3>Mathematical Description</h3>
                            <p>For a diode: <strong>I = I₀(e^(V/Vₜ) - 1)</strong>, where I is current, V is voltage, and Vₜ is thermal voltage (~26mV at room temperature). For a transistor: <strong>Ic = β × Ib</strong>, where β is the current gain factor (typically 50-200).</p>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li>Switch between diode, NPN, and PNP transistor modes</li>
                                <li>Adjust input voltage to see current flow changes</li>
                                <li>Control base voltage for transistor amplification</li>
                                <li>Observe different bias conditions (forward, reverse, off)</li>
                                <li>Watch real-time current and power calculations</li>
                            </ul>
                        </div>
                    `};case"pendulum":return{title:"Simple Pendulum - Harmonic Oscillation",html:`
                        <div class="science-content">
                            <h3>What is a Simple Pendulum?</h3>
                            <p>A simple pendulum consists of a point mass (bob) suspended from a fixed point by a massless, inextensible string. When displaced from its equilibrium position, it oscillates back and forth under the influence of gravity.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Simple Harmonic Motion:</strong> For small angles, the motion is approximately simple harmonic</li>
                                <li><strong>Period Formula:</strong> T = 2π√(L/g), where L is length and g is gravitational acceleration</li>
                                <li><strong>Energy Conservation:</strong> Kinetic and potential energy continuously convert between each other</li>
                                <li><strong>Damping:</strong> Air resistance causes the amplitude to gradually decrease</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Regular back-and-forth oscillation</li>
                                <li>Period remains constant regardless of amplitude (for small angles)</li>
                                <li>Longer pendulum = longer period</li>
                                <li>Gradual decrease in amplitude due to air resistance</li>
                                <li>Maximum speed at the bottom, zero speed at the extremes</li>
                            </ul>
                            
                            <h3>Energy Transformations</h3>
                            <ul>
                                <li><strong>At extremes:</strong> Maximum potential energy, zero kinetic energy</li>
                                <li><strong>At bottom:</strong> Maximum kinetic energy, minimum potential energy</li>
                                <li><strong>Total energy:</strong> Gradually decreases due to air resistance</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Clock mechanisms (grandfather clocks)</li>
                                <li>Seismometers for earthquake detection</li>
                                <li>Metronomes for musical timing</li>
                                <li>Amusement park rides</li>
                            </ul>
                        </div>
                    `};case"waves":return{title:"Wave Propagation - Energy Transfer",html:`
                        <div class="science-content">
                            <h3>What are Waves?</h3>
                            <p>Waves are disturbances that transfer energy through a medium without transferring matter. They can be mechanical (requiring a medium) or electromagnetic (can travel through vacuum).</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Transverse Waves:</strong> Particles move perpendicular to wave direction (like water waves)</li>
                                <li><strong>Longitudinal Waves:</strong> Particles move parallel to wave direction (like sound waves)</li>
                                <li><strong>Wave Properties:</strong> Amplitude, frequency, wavelength, and speed</li>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Interference:</strong> Waves can add together or cancel each other out</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Regular, repeating pattern of disturbance</li>
                                <li>Waves traveling at constant speed</li>
                                <li>Different wave types (transverse vs longitudinal)</li>
                                <li>Interference patterns when waves overlap</li>
                                <li>Energy transfer without matter movement</li>
                            </ul>
                            
                            <h3>Wave Characteristics</h3>
                            <ul>
                                <li><strong>Amplitude:</strong> Maximum displacement from equilibrium</li>
                                <li><strong>Frequency:</strong> Number of complete cycles per second (Hz)</li>
                                <li><strong>Wavelength:</strong> Distance between consecutive identical points</li>
                                <li><strong>Period:</strong> Time for one complete cycle</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Sound waves in air and water</li>
                                <li>Light waves and electromagnetic radiation</li>
                                <li>Earthquake waves (seismic waves)</li>
                                <li>Radio waves for communication</li>
                                <li>Ocean waves and tides</li>
                            </ul>
                        </div>
                    `};case"diffusion":return{title:"Diffusion - Particle Spread",html:`
                        <div class="science-content">
                            <h3>What is Diffusion?</h3>
                            <p>Diffusion is the process by which particles spread from regions of high concentration to regions of low concentration, driven by random molecular motion. This is a fundamental process in nature that leads to the uniform distribution of particles.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Fick's First Law:</strong> J = -D∇C (flux is proportional to concentration gradient)</li>
                                <li><strong>Concentration Gradient:</strong> Difference in concentration between regions</li>
                                <li><strong>Diffusion Coefficient:</strong> Measure of how quickly particles diffuse</li>
                                <li><strong>Temperature Effect:</strong> Higher temperature increases diffusion rate</li>
                                <li><strong>Particle Size:</strong> Smaller particles diffuse faster</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles spreading from concentrated areas</li>
                                <li>Gradual mixing of different particle types</li>
                                <li>Faster diffusion at higher temperatures</li>
                                <li>Concentration gradient decreasing over time</li>
                                <li>Eventually uniform distribution</li>
                            </ul>
                            
                            <h3>Diffusion Process</h3>
                            <ul>
                                <li><strong>Initial State:</strong> High concentration in one region</li>
                                <li><strong>Random Motion:</strong> Particles move randomly due to thermal energy</li>
                                <li><strong>Net Movement:</strong> More particles move from high to low concentration</li>
                                <li><strong>Equilibrium:</strong> Eventually uniform concentration throughout</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Oxygen diffusion in lungs</li>
                                <li>Nutrient absorption in cells</li>
                                <li>Perfume spreading in air</li>
                                <li>Salt dissolving in water</li>
                                <li>Heat conduction in materials</li>
                            </ul>
                        </div>
                    `};case"orbital":return{title:"Orbital Motion - Gravitational Dynamics",html:`
                        <div class="science-content">
                            <h3>What is Orbital Motion?</h3>
                            <p>Orbital motion describes the path of one object around another under the influence of gravity. This fundamental concept explains planetary orbits, satellite motion, and many other celestial phenomena.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Kepler's Laws:</strong> Three laws describing planetary motion</li>
                                <li><strong>Gravitational Force:</strong> F = GMm/r² (inverse square law)</li>
                                <li><strong>Orbital Velocity:</strong> v = √(GM/r) for circular orbits</li>
                                <li><strong>Eccentricity:</strong> Measure of how elliptical an orbit is (0 = circular, 1 = parabolic)</li>
                                <li><strong>Conservation of Angular Momentum:</strong> Orbital angular momentum remains constant</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Elliptical or circular paths around central mass</li>
                                <li>Faster motion when closer to the center (Kepler's Second Law)</li>
                                <li>Slower motion when farther from the center</li>
                                <li>Different orbital shapes based on eccentricity</li>
                                <li>Consistent orbital period for same central mass</li>
                            </ul>
                            
                            <h3>Kepler's Three Laws</h3>
                            <ol>
                                <li><strong>First Law:</strong> Orbits are ellipses with the central mass at one focus</li>
                                <li><strong>Second Law:</strong> Equal areas are swept in equal times (faster when closer)</li>
                                <li><strong>Third Law:</strong> Orbital period squared is proportional to semi-major axis cubed</li>
                            </ol>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Planetary orbits around the Sun</li>
                                <li>Satellite orbits around Earth</li>
                                <li>Electron orbits in atoms (Bohr model)</li>
                                <li>Binary star systems</li>
                                <li>Spacecraft trajectories</li>
                            </ul>
                        </div>
                    `};case"electric-fields":return{title:"Electric Fields - Charged Particle Interactions",html:`
                        <div class="science-content">
                            <h3>What are Electric Fields?</h3>
                            <p>Electric fields are regions of space around charged particles where other charges experience forces. They are invisible but can be visualized through their effects on test charges and field lines.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Coulomb's Law:</strong> F = kq₁q₂/r² (force between charges)</li>
                                <li><strong>Electric Field:</strong> E = F/q (force per unit charge)</li>
                                <li><strong>Field Lines:</strong> Imaginary lines showing field direction</li>
                                <li><strong>Superposition:</strong> Total field is sum of individual fields</li>
                                <li><strong>Conservation of Charge:</strong> Net charge remains constant</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Test particles moving along field lines</li>
                                <li>Positive particles repelled by positive charges</li>
                                <li>Negative particles attracted to positive charges</li>
                                <li>Field strength decreases with distance</li>
                                <li>Complex field patterns with multiple charges</li>
                            </ul>
                            
                            <h3>Field Properties</h3>
                            <ul>
                                <li><strong>Direction:</strong> Field lines point away from positive, toward negative</li>
                                <li><strong>Strength:</strong> Closer lines indicate stronger fields</li>
                                <li><strong>Superposition:</strong> Fields add vectorially</li>
                                <li><strong>Conservative:</strong> Work done is path-independent</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electrostatic precipitators</li>
                                <li>Capacitors and electronic circuits</li>
                                <li>Lightning and atmospheric electricity</li>
                                <li>Particle accelerators</li>
                                <li>Electron microscopes</li>
                            </ul>
                        </div>
                    `};case"gas-laws":return{title:"Gas Laws - Pressure, Volume, Temperature Relationships",html:`
                        <div class="science-content">
                            <h3>What are Gas Laws?</h3>
                            <p>Gas laws describe the relationships between pressure, volume, temperature, and amount of gas. These fundamental laws help us understand how gases behave under different conditions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Boyle's Law:</strong> P₁V₁ = P₂V₂ (inverse relationship between pressure and volume)</li>
                                <li><strong>Charles's Law:</strong> V₁/T₁ = V₂/T₂ (direct relationship between volume and temperature)</li>
                                <li><strong>Gay-Lussac's Law:</strong> P₁/T₁ = P₂/T₂ (direct relationship between pressure and temperature)</li>
                                <li><strong>Combined Gas Law:</strong> P₁V₁/T₁ = P₂V₂/T₂</li>
                                <li><strong>Ideal Gas Law:</strong> PV = nRT (universal gas law)</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Particles moving faster at higher temperatures</li>
                                <li>More frequent collisions at higher pressure</li>
                                <li>Particles spreading out in larger volumes</li>
                                <li>Pressure changes with volume and temperature</li>
                                <li>Random motion of gas particles</li>
                            </ul>
                            
                            <h3>Gas Law Relationships</h3>
                            <ul>
                                <li><strong>Boyle's Law:</strong> Decrease volume → increase pressure</li>
                                <li><strong>Charles's Law:</strong> Increase temperature → increase volume</li>
                                <li><strong>Gay-Lussac's Law:</strong> Increase temperature → increase pressure</li>
                                <li><strong>Avogadro's Law:</strong> More particles → larger volume</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Internal combustion engines</li>
                                <li>Refrigeration and air conditioning</li>
                                <li>Weather and atmospheric pressure</li>
                                <li>Scuba diving and pressure changes</li>
                                <li>Hot air balloons</li>
                            </ul>
                        </div>
                    `};case"collisions":return{title:"Collision Physics - Momentum and Energy Conservation",html:`
                        <div class="science-content">
                            <h3>What are Collisions?</h3>
                            <p>Collisions are interactions between objects that result in changes in their motion. Understanding collisions involves principles of momentum conservation and energy transfer.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Momentum Conservation:</strong> Total momentum before = total momentum after</li>
                                <li><strong>Elastic Collisions:</strong> Kinetic energy is conserved</li>
                                <li><strong>Inelastic Collisions:</strong> Some kinetic energy is lost</li>
                                <li><strong>Impulse:</strong> Change in momentum = force × time</li>
                                <li><strong>Coefficient of Restitution:</strong> Measure of collision elasticity</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Objects changing direction after collision</li>
                                <li>Speed changes based on collision type</li>
                                <li>Energy transfer between objects</li>
                                <li>Momentum conservation in all collisions</li>
                                <li>Different outcomes for elastic vs inelastic collisions</li>
                            </ul>
                            
                            <h3>Collision Types</h3>
                            <ul>
                                <li><strong>Elastic:</strong> Perfect bounce, energy conserved</li>
                                <li><strong>Inelastic:</strong> Objects stick together, energy lost</li>
                                <li><strong>Partially Elastic:</strong> Some energy lost, some bounce</li>
                                <li><strong>Explosive:</strong> Energy added, objects separate</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Car crash safety design</li>
                                <li>Sports equipment design</li>
                                <li>Particle physics experiments</li>
                                <li>Billiards and pool</li>
                                <li>Rocket propulsion</li>
                            </ul>
                        </div>
                    `};case"friction":return{title:"Friction & Inclined Planes - Force Analysis",html:`
                        <div class="science-content">
                            <h3>What is Friction?</h3>
                            <p>Friction is a force that opposes the relative motion of objects in contact. On inclined planes, friction plays a crucial role in determining whether objects slide or remain stationary.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Static Friction:</strong> Prevents motion when object is at rest</li>
                                <li><strong>Kinetic Friction:</strong> Opposes motion when object is sliding</li>
                                <li><strong>Friction Force:</strong> f = μN (coefficient × normal force)</li>
                                <li><strong>Normal Force:</strong> Component of weight perpendicular to surface</li>
                                <li><strong>Net Force:</strong> Determines acceleration down the incline</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Objects sliding down inclined surfaces</li>
                                <li>Different sliding speeds based on friction</li>
                                <li>Objects stopping when friction is high</li>
                                <li>Force vectors showing gravity and friction</li>
                                <li>Acceleration changes with angle and friction</li>
                            </ul>
                            
                            <h3>Force Analysis</h3>
                            <ul>
                                <li><strong>Gravity Component:</strong> mg sin(θ) down the incline</li>
                                <li><strong>Normal Force:</strong> mg cos(θ) perpendicular to surface</li>
                                <li><strong>Friction Force:</strong> μmg cos(θ) opposing motion</li>
                                <li><strong>Net Force:</strong> mg sin(θ) - μmg cos(θ)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Vehicle braking systems</li>
                                <li>Walking and running mechanics</li>
                                <li>Rock climbing and mountaineering</li>
                                <li>Industrial conveyor systems</li>
                                <li>Sports equipment design</li>
                            </ul>
                        </div>
                    `};case"magnetic-fields":return{title:"Magnetic Fields - Magnetic Force Interactions",html:`
                        <div class="science-content">
                            <h3>What are Magnetic Fields?</h3>
                            <p>Magnetic fields are regions of space around magnets where magnetic materials and moving charges experience forces. They are fundamental to electromagnetism and many modern technologies.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Magnetic Force:</strong> F = qvB sin(θ) on moving charges</li>
                                <li><strong>Field Lines:</strong> Imaginary lines showing field direction</li>
                                <li><strong>Right-Hand Rule:</strong> Determines force direction on moving charges</li>
                                <li><strong>Field Strength:</strong> Measured in Tesla (T) or Gauss</li>
                                <li><strong>Superposition:</strong> Total field is sum of individual fields</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Charged particles moving in curved paths</li>
                                <li>Different motion for positive vs negative charges</li>
                                <li>Circular motion in uniform magnetic fields</li>
                                <li>Field lines showing magnetic field direction</li>
                                <li>Force perpendicular to both velocity and field</li>
                            </ul>
                            
                            <h3>Magnetic Field Properties</h3>
                            <ul>
                                <li><strong>Direction:</strong> Field lines point from north to south pole</li>
                                <li><strong>Strength:</strong> Decreases with distance from magnet</li>
                                <li><strong>Force Direction:</strong> Perpendicular to both velocity and field</li>
                                <li><strong>No Work:</strong> Magnetic force does no work on charges</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electric motors and generators</li>
                                <li>Magnetic resonance imaging (MRI)</li>
                                <li>Particle accelerators</li>
                                <li>Magnetic levitation trains</li>
                                <li>Compass navigation</li>
                            </ul>
                        </div>
                    `};case"wave-particle-duality":return{title:"Wave-Particle Duality - Quantum Mechanics",html:`
                        <div class="science-content">
                            <h3>What is Wave-Particle Duality?</h3>
                            <p>Wave-particle duality is a fundamental concept in quantum mechanics where particles exhibit both wave-like and particle-like properties depending on how we observe them. This challenges our classical understanding of matter.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>De Broglie Wavelength:</strong> λ = h/p (wavelength = Planck's constant/momentum)</li>
                                <li><strong>Wave Function:</strong> Mathematical description of quantum state</li>
                                <li><strong>Superposition:</strong> Particles can exist in multiple states simultaneously</li>
                                <li><strong>Measurement Effect:</strong> Observation affects the system</li>
                                <li><strong>Interference:</strong> Wave-like behavior in experiments</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Wave-like interference patterns</li>
                                <li>Particle-like discrete measurements</li>
                                <li>Superposition of states</li>
                                <li>Measurement affecting the system</li>
                                <li>Dual behavior depending on observation method</li>
                            </ul>
                            
                            <h3>Quantum Phenomena</h3>
                            <ul>
                                <li><strong>Double-Slit Experiment:</strong> Shows both wave and particle behavior</li>
                                <li><strong>Uncertainty Principle:</strong> Can't know position and momentum precisely</li>
                                <li><strong>Quantum Tunneling:</strong> Particles can pass through barriers</li>
                                <li><strong>Entanglement:</strong> Particles can be correlated across distance</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Electron microscopes</li>
                                <li>Quantum computing</li>
                                <li>Quantum cryptography</li>
                                <li>Semiconductor technology</li>
                                <li>Quantum sensors</li>
                            </ul>
                        </div>
                    `};case"nuclear-reactions":return{title:"Nuclear Reactions - Fission and Fusion",html:`
                        <div class="science-content">
                            <h3>What are Nuclear Reactions?</h3>
                            <p>Nuclear reactions involve changes in the nucleus of atoms, releasing or absorbing tremendous amounts of energy. Fission (splitting) and fusion (combining) are the two main types of nuclear reactions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Nuclear Fission:</strong> Heavy nucleus splits into lighter nuclei + energy</li>
                                <li><strong>Nuclear Fusion:</strong> Light nuclei combine to form heavier nucleus + energy</li>
                                <li><strong>Mass-Energy Equivalence:</strong> E = mc² (Einstein's equation)</li>
                                <li><strong>Chain Reaction:</strong> Neutrons from one fission trigger more fissions</li>
                                <li><strong>Critical Mass:</strong> Minimum mass needed for sustained chain reaction</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>Nuclei splitting or combining</li>
                                <li>Energy release in the form of particles</li>
                                <li>Neutrons triggering additional reactions</li>
                                <li>Chain reactions spreading through material</li>
                                <li>Different reaction rates based on conditions</li>
                            </ul>
                            
                            <h3>Nuclear Processes</h3>
                            <ul>
                                <li><strong>Fission:</strong> Uranium-235 + neutron → lighter nuclei + 2-3 neutrons + energy</li>
                                <li><strong>Fusion:</strong> Hydrogen nuclei → Helium + energy (like in stars)</li>
                                <li><strong>Radioactive Decay:</strong> Unstable nuclei emit particles</li>
                                <li><strong>Neutron Capture:</strong> Nuclei absorb neutrons</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Nuclear power plants</li>
                                <li>Nuclear weapons</li>
                                <li>Medical radiation therapy</li>
                                <li>Radioactive dating</li>
                                <li>Fusion power research</li>
                            </ul>
                        </div>
                    `};case"fluid-flow":return{title:"Fluid Flow - Enhanced Viscosity & Porosity Effects",html:`
                        <div class="science-content">
                            <h3>What is Fluid Flow?</h3>
                            <p>Fluid flow describes how liquids and gases move through space and porous materials. This enhanced simulation demonstrates realistic fluid dynamics with visible viscosity effects, Reynolds number transitions, and porous media flow patterns.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Laminar Flow:</strong> Smooth, parallel streamlines with no mixing between layers (Re < 2300)</li>
                                <li><strong>Turbulent Flow:</strong> Chaotic, swirling motion with rapid mixing (Re > 4000)</li>
                                <li><strong>Reynolds Number:</strong> Re = ρvL/μ - determines flow regime and transition points</li>
                                <li><strong>Enhanced Viscosity Effects:</strong> Internal friction that visibly slows particle movement</li>
                                <li><strong>Porous Media Flow:</strong> Fluid movement through materials with different porosity levels</li>
                                <li><strong>Darcy's Law:</strong> Flow rate through porous media depends on permeability and pressure gradient</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Viscosity Effects:</strong> Particles move much slower with high viscosity (5x enhanced visibility)</li>
                                <li><strong>Flow Regimes:</strong> Smooth laminar flow vs chaotic turbulent flow based on Reynolds number</li>
                                <li><strong>Porosity Effects:</strong> Particles slow down significantly in porous materials</li>
                                <li><strong>Visualization Modes:</strong> Different analysis panels show pressure, velocity, and porosity effects</li>
                                <li><strong>Real-time Statistics:</strong> Live updates of Reynolds number, flow type, and viscosity effects</li>
                            </ul>
                            
                            <h3>Enhanced Features</h3>
                            <ul>
                                <li><strong>Visible Viscosity:</strong> 5x stronger effect makes viscosity changes clearly observable</li>
                                <li><strong>Reynolds Number Display:</strong> Real-time calculation and color-coded flow type indicators</li>
                                <li><strong>Porosity Analysis:</strong> Comparison between high and low porosity materials</li>
                                <li><strong>Velocity Analysis:</strong> Shows how porosity affects flow velocity</li>
                                <li><strong>Pressure Analysis:</strong> Demonstrates pressure build-up in porous materials</li>
                                <li><strong>Clean UI:</strong> Removed redundant information for better focus</li>
                            </ul>
                            
                            <h3>Flow Regimes & Transitions</h3>
                            <ul>
                                <li><strong>Laminar (Re < 2300):</strong> Green indicator - smooth, predictable flow</li>
                                <li><strong>Transitional (2300 < Re < 4000):</strong> Orange indicator - unstable, mixed flow</li>
                                <li><strong>Turbulent (Re > 4000):</strong> Red indicator - chaotic, highly mixed flow</li>
                                <li><strong>Viscosity Impact:</strong> High viscosity = lower Reynolds number = more laminar flow</li>
                                <li><strong>Flow Rate Impact:</strong> High flow rate = higher Reynolds number = more turbulent flow</li>
                            </ul>
                            
                            <h3>Porous Media Physics</h3>
                            <ul>
                                <li><strong>High Porosity Material:</strong> More open spaces, particles flow through more easily</li>
                                <li><strong>Low Porosity Material:</strong> Fewer open spaces, particles slow down significantly</li>
                                <li><strong>Velocity Ratio:</strong> Shows the speed difference between materials</li>
                                <li><strong>Pressure Build-up:</strong> Porous materials create resistance and pressure gradients</li>
                                <li><strong>Flow Patterns:</strong> Particles follow tortuous paths through porous structures</li>
                            </ul>
                            
                            <h3>Interactive Controls</h3>
                            <ul>
                                <li><strong>Flow Rate Slider:</strong> Adjusts particle speed and Reynolds number</li>
                                <li><strong>Viscosity Slider:</strong> Controls internal friction (now 5x more visible)</li>
                                <li><strong>Visualization Modes:</strong> Switch between particle flow, pressure, velocity, and porosity analysis</li>
                                <li><strong>Real-time Feedback:</strong> Watch statistics update as you adjust parameters</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Groundwater Flow:</strong> Water movement through soil and rock formations</li>
                                <li><strong>Oil Reservoir Engineering:</strong> Petroleum flow through porous rock</li>
                                <li><strong>Blood Flow:</strong> Circulation through capillaries and tissue</li>
                                <li><strong>Air Filtration:</strong> Gas flow through filter materials</li>
                                <li><strong>Chemical Processing:</strong> Fluid flow through catalyst beds</li>
                                <li><strong>Geothermal Systems:</strong> Heat transfer in porous media</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Reynolds Number:</strong> Re = (ρ × V × D) / μ where ρ=density, V=velocity, D=characteristic length, μ=viscosity</li>
                                <li><strong>Viscosity Effect:</strong> velocity_factor = 1 - (viscosity × 0.1) - 5x enhanced for visibility</li>
                                <li><strong>Porosity Factor:</strong> porosity_factor = 1 - (1 - porosity) × 0.6</li>
                                <li><strong>Darcy's Law:</strong> Q = -kA(ΔP/ΔL)/μ where k=permeability, A=cross-sectional area</li>
                            </ul>
                            
                            <h3>Educational Value</h3>
                            <ul>
                                <li><strong>Visual Learning:</strong> See abstract concepts like viscosity and Reynolds number in action</li>
                                <li><strong>Parameter Relationships:</strong> Understand how flow rate, viscosity, and porosity interact</li>
                                <li><strong>Real-time Analysis:</strong> Watch statistics update as you experiment with controls</li>
                                <li><strong>Multiple Perspectives:</strong> Different visualization modes show various aspects of fluid dynamics</li>
                                <li><strong>Scientific Accuracy:</strong> Based on real fluid dynamics equations and principles</li>
                            </ul>
                        </div>
                    `};case"bernoulli":return{title:"Bernoulli's Principle - Energy Conservation in Fluids",html:`
                        <div class="science-content">
                            <h3>What is Bernoulli's Principle?</h3>
                            <p>Bernoulli's principle states that in a flowing fluid, an increase in velocity is accompanied by a decrease in pressure. This is a consequence of energy conservation in fluid flow. Our enhanced simulation demonstrates this with continuous particle flow and realistic velocity transitions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Bernoulli's Equation:</strong> P + ½ρv² + ρgh = constant</li>
                                <li><strong>Energy Conservation:</strong> Total energy remains constant along a streamline</li>
                                <li><strong>Pressure-Velocity Trade-off:</strong> Higher velocity = lower pressure</li>
                                <li><strong>Continuity Equation:</strong> A₁v₁ = A₂v₂ (mass conservation)</li>
                                <li><strong>Venturi Effect:</strong> Pressure drop in constricted flow</li>
                                <li><strong>Enhanced Particle System:</strong> Continuous flow with 80 particles maintained</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Continuous Particle Flow:</strong> Steady stream without gaps or stops</li>
                                <li><strong>Velocity Transitions:</strong> Smooth speed changes through pipe constriction</li>
                                <li><strong>Bernoulli Effect:</strong> Particles speed up 1.8x in narrow section</li>
                                <li><strong>Energy Conservation:</strong> Total energy maintained throughout flow</li>
                                <li><strong>Pressure Changes:</strong> Lower pressure in high-velocity regions</li>
                                <li><strong>Flow Efficiency:</strong> Optimized particle management system</li>
                            </ul>
                            
                            <h3>Enhanced Simulation Features</h3>
                            <ul>
                                <li><strong>Continuous Flow:</strong> Particles added continuously to maintain steady stream</li>
                                <li><strong>Smart Particle Management:</strong> 80 particles with optimized addition/removal</li>
                                <li><strong>Realistic Transitions:</strong> Gradual velocity changes in pipe constrictions</li>
                                <li><strong>Energy Visualization:</strong> Color-coded particles show energy distribution</li>
                                <li><strong>Flow Efficiency:</strong> Real-time calculation of flow performance</li>
                            </ul>
                            
                            <h3>Energy Components</h3>
                            <ul>
                                <li><strong>Pressure Energy:</strong> P (work done by pressure)</li>
                                <li><strong>Kinetic Energy:</strong> ½ρv² (energy of motion)</li>
                                <li><strong>Potential Energy:</strong> ρgh (gravitational energy)</li>
                                <li><strong>Total Energy:</strong> Sum remains constant</li>
                                <li><strong>Flow Efficiency:</strong> Percentage of optimal flow achieved</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Airplane Wings:</strong> Curved upper surface creates lift</li>
                                <li><strong>Carburetors:</strong> Fuel mixing through pressure differences</li>
                                <li><strong>Venturi Meters:</strong> Flow measurement using pressure drop</li>
                                <li><strong>Spray Bottles:</strong> Atomization through constricted flow</li>
                                <li><strong>Blood Flow:</strong> Arterial constriction effects</li>
                                <li><strong>Wind Tunnels:</strong> Aerodynamic testing</li>
                            </ul>
                            
                            <h3>Technical Implementation</h3>
                            <ul>
                                <li><strong>Particle System:</strong> 80 particles with continuous addition</li>
                                <li><strong>Velocity Calculation:</strong> Based on cross-sectional area changes</li>
                                <li><strong>Energy Conservation:</strong> Maintained through velocity-pressure relationship</li>
                                <li><strong>Flow Monitoring:</strong> Real-time particle count and efficiency tracking</li>
                            </ul>
                        </div>
                    `};case"neural-network":return{title:"Neural Network Training - Object Recognition",html:`
                        <div class="science-content">
                            <h3>Overview</h3>
                            <p>This animation shows a small neural network learning to classify geometric shapes as <em>simple</em> or <em>complex</em> using two features: symmetry and edge complexity. You can watch data flow forward, errors flow backward, and weights update in real-time.</p>

                            <h3>Architecture</h3>
                            <ul>
                                <li><strong>Layers:</strong> 2 inputs → hidden layers (4, 3) → 1 output (binary)</li>
                                <li><strong>Activation:</strong> Sigmoid σ(x) = 1/(1 + e<sup>−x</sup>)</li>
                                <li><strong>Output:</strong> y ∈ (0,1) interpreted as probability of “complex”</li>
                            </ul>

                            <h3>Training process (science)</h3>
                            <ol>
                                <li><strong>Forward pass:</strong> y = σ(Wx + b)</li>
                                <li><strong>Loss (MSE):</strong> L = (t − y)², where t ∈ {0,1}</li>
                                <li><strong>Backpropagation:</strong> Compute ∂L/∂W via chain rule</li>
                                <li><strong>Gradient descent:</strong> W ← W − α·∂L/∂W, b ← b − α·∂L/∂b</li>
                            </ol>

                            <h3>Visual guide</h3>
                            <ul>
                                <li><strong>Decision Boundary (bottom-left):</strong> Background color shows the model’s output over the 2D feature space. Amber rings mark <em>misclassified</em> training points.</li>
                                <li><strong>Current Phase (top-right):</strong> Forward, Backward, Update, or Pause with progress.</li>
                                <li><strong>Particles:</strong> Blue = forward flow, Red = error flow. Updated connections flash subtly.</li>
                            </ul>

                            <h3>How to use</h3>
                            <ul>
                                <li><strong>Mode:</strong> Switch Training/Testing in the controls.</li>
                                <li><strong>Testing:</strong> Click a shape on the right to see prediction and confidence.</li>
                                <li><strong>Learning Rate & Speed:</strong> Adjust to explore dynamics without changing the concept.</li>
                            </ul>

                            <h3>Scientific context</h3>
                            <ul>
                                <li><strong>Feature learning:</strong> Hidden layers learn intermediate patterns from symmetry/edges.</li>
                                <li><strong>Bias/variance:</strong> Too few neurons underfit; too many can overfit. This network is sized to learn the task cleanly.</li>
                                <li><strong>Generalization:</strong> The decision boundary illustrates how the model separates classes beyond the training points.</li>
                            </ul>

                            <h3>Applications</h3>
                            <ul>
                                <li>Vision (image classification), NLP (text classification), speech, robotics, medicine, finance.</li>
                            </ul>
                        </div>
                    `};case"sound-waves":return{title:"Sound Waves - Wave Propagation in Air",html:`
                        <div class="science-content">
                            <h3>What are Sound Waves?</h3>
                            <p>Sound waves are longitudinal mechanical waves that travel through a medium (like air, water, or solids) by compressing and rarefying the particles of the medium. These waves carry energy and information, allowing us to hear sounds.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Longitudinal Waves:</strong> Particles oscillate parallel to wave direction (compression and rarefaction)</li>
                                <li><strong>Transverse Waves:</strong> Particles oscillate perpendicular to wave direction (like guitar strings)</li>
                                <li><strong>Wave Properties:</strong> Frequency (pitch), amplitude (loudness), wavelength, and speed</li>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Pressure Variations:</strong> High pressure (compression) and low pressure (rarefaction) zones</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Transverse Mode:</strong> Particles moving up and down like a guitar string</li>
                                <li><strong>Longitudinal Mode:</strong> Particles moving back and forth in the direction of wave travel</li>
                                <li><strong>Pressure Zones:</strong> Red areas (compression) and blue areas (rarefaction) in longitudinal waves</li>
                                <li><strong>Wave Speed:</strong> How fast the wave pattern travels through the medium</li>
                                <li><strong>Frequency Effect:</strong> Higher frequency = shorter wavelength = higher pitch</li>
                            </ul>
                            
                            <h3>Wave Characteristics</h3>
                            <ul>
                                <li><strong>Frequency (f):</strong> Number of complete cycles per second (Hz) - determines pitch</li>
                                <li><strong>Amplitude (A):</strong> Maximum displacement from equilibrium - determines loudness</li>
                                <li><strong>Wavelength (λ):</strong> Distance between consecutive identical points</li>
                                <li><strong>Wave Speed (v):</strong> How fast the wave travels through the medium</li>
                                <li><strong>Period (T):</strong> Time for one complete cycle (T = 1/f)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Musical instruments (guitar strings, air columns)</li>
                                <li>Human speech and hearing</li>
                <li>Ultrasound imaging in medicine</li>
                                <li>Sonar for underwater detection</li>
                                <li>Acoustic engineering and sound design</li>
                                <li>Earthquake detection (seismic waves)</li>
                            </ul>
                            
                            <h3>Mathematical Relationships</h3>
                            <ul>
                                <li><strong>Wave Equation:</strong> v = fλ (speed = frequency × wavelength)</li>
                                <li><strong>Period and Frequency:</strong> T = 1/f (period = 1/frequency)</li>
                                <li><strong>Energy:</strong> E ∝ A²f² (energy proportional to amplitude² × frequency²)</li>
                                <li><strong>Intensity:</strong> I ∝ A² (intensity proportional to amplitude squared)</li>
                            </ul>
                            
                            <h3>Wave Types Comparison</h3>
                            <ul>
                                <li><strong>Transverse Waves:</strong> Guitar strings, water waves, light waves</li>
                                <li><strong>Longitudinal Waves:</strong> Sound waves in air, seismic P-waves</li>
                                <li><strong>Combined Waves:</strong> Complex wave patterns with both components</li>
                            </ul>
                        </div>
                    `};case"neural-network":return{title:"Neural Network Training - Object Recognition",html:`
                        <div class="science-content">
                            <h3>What are Neural Networks?</h3>
                            <p>Neural networks are computational models inspired by biological neurons in the brain. They consist of interconnected nodes (neurons) organized in layers that process information and learn patterns from data. This animation demonstrates how neural networks learn to recognize and classify different geometric objects.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Artificial Neurons:</strong> Mathematical functions that receive inputs, apply weights, and produce outputs. Each neuron computes: output = σ(Σ(inputs × weights) + bias)</li>
                                <li><strong>Network Architecture:</strong> Input layer (2 neurons) → Hidden layer 1 (4 neurons) → Hidden layer 2 (3 neurons) → Output layer (1 neuron)</li>
                            </ul>
                            
                            <h3>Why This Architecture?</h3>
                            <ul>
                                <li><strong>2 Input Neurons:</strong> Perfect for our 2-feature problem (symmetry, edges)</li>
                                <li><strong>4 Hidden Neurons:</strong> Provides enough capacity to learn non-linear patterns without overfitting</li>
                                <li><strong>3 Hidden Neurons:</strong> Allows further feature refinement and abstraction</li>
                                <li><strong>1 Output Neuron:</strong> Binary classification (simple vs complex objects)</li>
                            </ul>
                            
                            <h3>Layer Size Effects</h3>
                            <ul>
                                <li><strong>Too Few Neurons:</strong> Network can't learn complex patterns (underfitting)</li>
                                <li><strong>Too Many Neurons:</strong> Network memorizes training data (overfitting)</li>
                                <li><strong>Optimal Size:</strong> Balances learning capacity with generalization</li>
                                <li><strong>Our Choice:</strong> 4→3 hidden layers provide sufficient complexity for this task</li>
                            </ul>
                                <li><strong>Weights & Biases:</strong> Numerical values that determine connection strength and neuron activation thresholds</li>
                                <li><strong>Sigmoid Activation:</strong> σ(x) = 1/(1 + e^(-x)) - transforms any input to a value between 0 and 1</li>
                                <li><strong>Backpropagation:</strong> Algorithm that calculates how much each weight should change to reduce prediction errors</li>
                                <li><strong>Learning Rate:</strong> Controls how big weight updates are during training</li>
                            </ul>
                            
                            <h3>Training Process Explained</h3>
                            <ol>
                                <li><strong>Forward Propagation:</strong> Input features flow through the network, each neuron computes its output using weights and activation function</li>
                                <li><strong>Loss Calculation:</strong> Compare network output with target value using Mean Squared Error: Loss = (target - output)²</li>
                                <li><strong>Backward Propagation:</strong> Calculate error gradients for each weight using chain rule of calculus</li>
                                <li><strong>Weight Updates:</strong> Adjust weights using gradient descent: Δw = learning_rate × gradient</li>
                            </ol>
                            
                            <h3>Object Recognition Task</h3>
                            <p>This network learns to classify geometric objects based on their complexity using 2 features:</p>
                            <ul>
                                <li><strong>Feature 1 - Symmetry Score (0-1):</strong> How symmetrical the object is (high = simple)</li>
                                <li><strong>Feature 2 - Edge Complexity (0-1):</strong> How many edges/corners the object has (high = complex)</li>
                                <li><strong>Simple Objects:</strong> Circle [0.9,0.1], Square [0.8,0.3] → Output: 0 (classified as simple)</li>
                                <li><strong>Complex Objects:</strong> Triangle [0.6,0.5], Star [0.3,0.9] → Output: 1 (classified as complex)</li>
                            </ul>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch data flow forward (blue particles), errors flow backward (red particles), and weights update (flashing connections)</li>
                                <li><strong>Testing Mode:</strong> See how the trained network processes new inputs and makes predictions with confidence scores</li>
                                <li><strong>Visual Indicators:</strong> Active neurons pulse, weight changes are highlighted, and prediction accuracy improves over time</li>
                                <li><strong>Object Context:</strong> Each training example shows the actual geometric object being learned</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Neuron Output:</strong> y = σ(w₁x₁ + w₂x₂ + ... + wₙxₙ + b)</li>
                                <li><strong>Loss Function:</strong> L = (y_target - y_predicted)²</li>
                                <li><strong>Weight Update:</strong> w_new = w_old - α × ∂L/∂w</li>
                                <li><strong>Gradient Calculation:</strong> ∂L/∂w = ∂L/∂y × ∂y/∂w (chain rule)</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Computer Vision:</strong> Image classification, object detection, facial recognition</li>
                                <li><strong>Natural Language Processing:</strong> Text classification, language translation, chatbots</li>
                                <li><strong>Speech Recognition:</strong> Voice assistants, transcription services</li>
                                <li><strong>Autonomous Systems:</strong> Self-driving cars, robotics, drones</li>
                                <li><strong>Medical Diagnosis:</strong> Disease detection, medical image analysis</li>
                                <li><strong>Financial Analysis:</strong> Fraud detection, stock prediction, risk assessment</li>
                            </ul>
                            
                            <h3>Educational Insights</h3>
                            <ul>
                                <li><strong>Learning Process:</strong> Neural networks learn by adjusting weights to minimize prediction errors</li>
                                <li><strong>Feature Learning:</strong> Hidden layers automatically learn useful features from raw input data</li>
                                <li><strong>Generalization:</strong> Well-trained networks can make accurate predictions on unseen data</li>
                                <li><strong>Overfitting:</strong> Networks can memorize training data instead of learning general patterns</li>
                                <li><strong>Hyperparameters:</strong> Learning rate, network architecture, and activation functions affect training success</li>
                            </ul>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li><strong>Training Mode:</strong> Watch the network learn through forward/backward propagation cycles</li>
                                <li><strong>Testing Mode:</strong> Test the trained network on different objects and see predictions</li>
                                <li><strong>Parameter Control:</strong> Adjust learning rate and animation speed to observe different training behaviors</li>
                                <li><strong>Visual Feedback:</strong> See real-time loss, accuracy, and confidence metrics</li>
                            </ul>
                            
                            <h3>Advanced Concepts</h3>
                            <ul>
                                <li><strong>Gradient Descent:</strong> Optimization algorithm that finds the best weights by following the steepest descent</li>
                                <li><strong>Vanishing Gradients:</strong> Problem where gradients become very small in deep networks</li>
                                <li><strong>Regularization:</strong> Techniques to prevent overfitting (dropout, weight decay)</li>
                                <li><strong>Batch Processing:</strong> Training on multiple examples simultaneously for better gradient estimates</li>
                                <li><strong>Transfer Learning:</strong> Using pre-trained networks for new tasks</li>
                            </ul>
                        </div>
                    `};case"memory-management":return{title:"Program Execution - Code, Memory, and Data Flow",html:`
                        <div class="science-content">
                            <h3>What is Program Execution?</h3>
                            <p>Program execution is the process by which a computer runs code, manages memory, and processes data. This animation visualizes how a real program is executed, showing the flow of control, function calls, memory allocation and deallocation, and the movement of data between stack and heap. It provides a unique window into what happens "under the hood" when a computer runs software.</p>
                            <h3>Key Concepts Demonstrated</h3>
                            <ul>
                                <li><strong>Code Execution:</strong> Step-by-step execution of a real program, including function calls and returns</li>
                                <li><strong>Call Stack Visualization:</strong> See how function calls create stack frames and how the stack grows and shrinks</li>
                                <li><strong>Heap Memory Management:</strong> Watch memory blocks being allocated (malloc) and freed (free), and observe fragmentation and memory usage</li>
                                <li><strong>Data Flow:</strong> Visualize how data moves between functions, stack, and heap during program execution</li>
                                <li><strong>Garbage Collection:</strong> Observe how unreachable memory is detected and cleaned up (if enabled)</li>
                                <li><strong>Performance Metrics:</strong> Track memory usage, allocation/deallocation counts, fragmentation, and efficiency</li>
                            </ul>
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li>How function calls and returns affect the call stack</li>
                                <li>How memory is allocated and deallocated on the heap</li>
                                <li>How data is passed between functions and stored in memory</li>
                                <li>How memory fragmentation and leaks can occur</li>
                                <li>How the program completes its execution and cleans up resources</li>
                            </ul>
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li>Understanding how operating systems and programming languages manage memory</li>
                                <li>Debugging and optimizing software for performance and reliability</li>
                                <li>Learning about stack overflows, memory leaks, and efficient resource management</li>
                                <li>Building better software by understanding what happens at runtime</li>
                            </ul>
                            <h3>Interactive Features</h3>
                            <ul>
                                <li>Step through program execution or watch it run automatically</li>
                                <li>View real-time statistics and performance metrics</li>
                                <li>Observe visual effects for memory allocation, deallocation, and data flow</li>
                                <li>Toggle output and statistics panels for deeper insights</li>
                            </ul>
                        </div>
                    `};case"blockchain":return{title:"Blockchain - Distributed Ledger Technology",html:`
                        <div class="science-content">
                            <h3>What is Blockchain?</h3>
                            <p>Blockchain is a distributed ledger technology that enables secure, transparent, and tamper-resistant record-keeping across a network of computers. Each block contains a list of transactions, and blocks are linked together in a chain using cryptographic hashes, creating an immutable record of all transactions.</p>
                            
                            <h3>Key Scientific Concepts</h3>
                            <ul>
                                <li><strong>Cryptographic Hashing:</strong> Mathematical function that converts data into a fixed-size string (hash) - any change in data produces a completely different hash</li>
                                <li><strong>Proof of Work:</strong> Consensus mechanism where miners solve complex mathematical puzzles to validate transactions and create new blocks</li>
                                <li><strong>Distributed Network:</strong> Multiple nodes maintain identical copies of the blockchain, ensuring redundancy and security</li>
                                <li><strong>Merkle Trees:</strong> Data structure that efficiently verifies transaction integrity by creating a single hash from multiple transactions</li>
                                <li><strong>Difficulty Adjustment:</strong> Network automatically adjusts mining difficulty to maintain consistent block creation rate</li>
                            </ul>
                            
                            <h3>Block Structure</h3>
                            <ul>
                                <li><strong>Block Header:</strong> Contains metadata including previous block hash, timestamp, nonce, and Merkle root</li>
                                <li><strong>Transactions:</strong> List of validated transactions waiting to be included in the block</li>
                                <li><strong>Nonce:</strong> Number that miners change to find a hash meeting the difficulty requirement</li>
                                <li><strong>Hash:</strong> Unique fingerprint of the block's content - any change invalidates the hash</li>
                                <li><strong>Previous Hash:</strong> Links each block to its predecessor, creating the chain</li>
                            </ul>
                            
                            <h3>Mining Process Explained</h3>
                            <ol>
                                <li><strong>Transaction Collection:</strong> Network collects pending transactions into a candidate block</li>
                                <li><strong>Hash Calculation:</strong> Block header is hashed using SHA-256 algorithm</li>
                                <li><strong>Difficulty Check:</strong> Hash must start with a specific number of zeros (target)</li>
                                <li><strong>Nonce Increment:</strong> If hash doesn't meet target, nonce is incremented and process repeats</li>
                                <li><strong>Block Discovery:</strong> When valid hash is found, block is broadcast to network</li>
                                <li><strong>Network Validation:</strong> Other nodes verify the block and add it to their chain</li>
                            </ol>
                            
                            <h3>What You Should Observe</h3>
                            <ul>
                                <li><strong>Modern Block Design:</strong> Rounded blocks with gradients, inner highlights, and modern typography</li>
                                <li><strong>Enhanced Mining Process:</strong> Watch miners (orange nodes with pulsing rings) working to find valid hashes</li>
                                <li><strong>Successful Miner Zoom:</strong> The successful miner node pulses and zooms to draw attention</li>
                                <li><strong>Dynamic Transaction Blocks:</strong> Transactions fade over time, show age indicators, and have priority colors</li>
                                <li><strong>Block Creation:</strong> See new blocks being added to the chain with celebration particles</li>
                                <li><strong>Network Propagation:</strong> Observe animated arrows showing blocks spreading through the network</li>
                                <li><strong>Transaction Flow:</strong> Watch pending transactions being included in blocks with real-time updates</li>
                                <li><strong>Difficulty Effects:</strong> Lower difficulty = faster mining, higher difficulty = slower mining</li>
                                <li><strong>Dynamic Network:</strong> Nodes join and leave the network automatically with enhanced visual effects</li>
                                <li><strong>Block Hashes:</strong> Always visible with modern monospace font (truncated for readability)</li>
                                <li><strong>Consensus Process:</strong> Watch network nodes reach agreement during guided mode</li>
                                <li><strong>Block Rejection:</strong> See blocks rejected with red particles when consensus fails (60% threshold)</li>
                                <li><strong>Transparent Info Panel:</strong> Network status panel with reduced opacity for better integration</li>
                            </ul>
                            
                            <h3>Block Rejection & Consensus</h3>
                            <p>In guided mode (difficulty 2+), the network implements a realistic consensus mechanism:</p>
                            <ul>
                                <li><strong>Consensus Threshold:</strong> 60% of network nodes must agree to accept a block</li>
                                <li><strong>Rejection Process:</strong> If consensus fails, the block is rejected with visual feedback</li>
                                <li><strong>Red Particles:</strong> Rejection particles appear around the mining block position</li>
                                <li><strong>Automatic Recovery:</strong> Mining automatically restarts after rejection</li>
                                <li><strong>Network Reset:</strong> All nodes return to default state after rejection</li>
                                <li><strong>Statistics Update:</strong> Phase indicator shows consensus percentage and rejection status</li>
                            </ul>
                            
                            <h3>Guided Mode (Difficulty 2+)</h3>
                            <p>When mining difficulty is set to 2 or higher, the simulation automatically activates a step-by-step guided mode that walks you through the entire block addition process:</p>
                            <ol>
                                <li><strong>Mining Success:</strong> Block is successfully mined with valid hash</li>
                                <li><strong>Validation:</strong> Network nodes validate the block's transactions and hash</li>
                                <li><strong>Propagation:</strong> Block spreads through the network via peer-to-peer communication</li>
                                <li><strong>Consensus:</strong> Network reaches agreement on block validity (requires 60% of nodes)</li>
                                <li><strong>Finalization:</strong> Block is permanently added to the blockchain OR rejected if consensus fails</li>
                            </ol>
                            <p><strong>Consensus Mechanism:</strong> The network requires 60% of nodes to reach consensus. If consensus fails, the block is rejected and mining restarts automatically.</p>
                            <p><strong>Note:</strong> For difficulty levels 1, blocks are added directly without guided mode for faster simulation.</p>
                            
                            <h3>Cryptographic Security</h3>
                            <ul>
                                <li><strong>Hash Function:</strong> SHA-256 produces 256-bit hashes - practically impossible to reverse</li>
                                <li><strong>Chain Integrity:</strong> Changing any block invalidates all subsequent blocks</li>
                                <li><strong>Immutability:</strong> Once added, blocks cannot be modified without detection</li>
                                <li><strong>Digital Signatures:</strong> Transactions are cryptographically signed to prevent forgery</li>
                                <li><strong>51% Attack Resistance:</strong> Network security depends on honest majority of computing power</li>
                            </ul>
                            
                            <h3>Network Architecture</h3>
                            <ul>
                                <li><strong>Full Nodes:</strong> Store complete blockchain and validate all transactions</li>
                                <li><strong>Mining Nodes:</strong> Specialized nodes that create new blocks through proof of work</li>
                                <li><strong>Light Nodes:</strong> Store only block headers for efficiency</li>
                                <li><strong>Peer-to-Peer:</strong> Direct communication between nodes without central authority</li>
                                <li><strong>Fork Resolution:</strong> Network automatically chooses the longest valid chain</li>
                            </ul>
                            
                            <h3>Mathematical Foundation</h3>
                            <ul>
                                <li><strong>Hash Function:</strong> H(x) = SHA-256(block_header) - deterministic and collision-resistant</li>
                                <li><strong>Difficulty Target:</strong> T = 2^(256-D) where D is difficulty level</li>
                                <li><strong>Mining Probability:</strong> P = T/2^256 - probability of finding valid hash in one attempt</li>
                                <li><strong>Expected Time:</strong> E[T] = 1/P attempts to find valid block</li>
                                <li><strong>Hashrate:</strong> H = attempts_per_second × network_size</li>
                            </ul>
                            
                            <h3>Real-World Applications</h3>
                            <ul>
                                <li><strong>Cryptocurrencies:</strong> Bitcoin, Ethereum, and other digital currencies</li>
                                <li><strong>Smart Contracts:</strong> Self-executing contracts with predefined conditions</li>
                                <li><strong>Supply Chain:</strong> Transparent tracking of goods from source to consumer</li>
                                <li><strong>Digital Identity:</strong> Secure, decentralized identity management</li>
                                <li><strong>Voting Systems:</strong> Tamper-resistant electronic voting</li>
                                <li><strong>Decentralized Finance (DeFi):</strong> Financial services without intermediaries</li>
                                <li><strong>NFTs:</strong> Non-fungible tokens for digital asset ownership</li>
                            </ul>
                            
                            <h3>Visual Enhancements</h3>
                            <ul>
                                <li><strong>Modern Block Design:</strong> Rounded corners, gradient backgrounds, inner highlights, and enhanced typography</li>
                                <li><strong>Golden Genesis Block:</strong> Special golden gradient to distinguish the first block</li>
                                <li><strong>Enhanced Node Design:</strong> Multi-stop gradients, gradient borders, and inner highlights for depth</li>
                                <li><strong>Successful Miner Zoom:</strong> Pulsing zoom effect (0.7x-1.3x) with additional rings for emphasis</li>
                                <li><strong>Dynamic Transaction Display:</strong> Age-based fading, priority indicators, and real-time updates</li>
                                <li><strong>Transaction Priority Colors:</strong> Green (High), Orange (Medium), Red (Low) based on fees</li>
                                <li><strong>Pulsing New Transactions:</strong> Fresh transactions have animated borders for 5 seconds</li>
                                <li><strong>Transparent Info Panel:</strong> Reduced opacity (75%-55%) with text shadows for readability</li>
                                <li><strong>Enhanced Typography:</strong> Modern fonts, better spacing, and improved readability</li>
                                <li><strong>Realistic Transaction Aging:</strong> Transactions expire after 30 seconds with visual feedback</li>
                            </ul>
                            
                            <h3>Interactive Features</h3>
                            <ul>
                                <li><strong>Mining Difficulty (1-8):</strong> Control how hard it is to mine blocks - affects block creation speed and guided mode activation</li>
                                <li><strong>Simulation Speed (0.1x-3x):</strong> Control how fast the entire simulation runs</li>
                                <li><strong>Auto Mining:</strong> Always enabled - simulation continuously mines new blocks</li>
                                <li><strong>Network Visualization:</strong> Always visible - watch nodes join, leave, and validate blocks</li>
                                <li><strong>Block Hashes:</strong> Always visible with modern monospace font (truncated for readability)</li>
                                <li><strong>Real-time Statistics:</strong> Monitor blocks, transactions, hashrate, network status, and current phase</li>
                                <li><strong>Guided Mode:</strong> Automatically activates for difficulty 2+ with step-by-step process visualization</li>
                            </ul>
                            
                            <h3>Dynamic Transaction System</h3>
                            <ul>
                                <li><strong>Real-time Generation:</strong> 1-4 new transactions every 1.5-3.5 seconds</li>
                                <li><strong>Transaction Types:</strong> Transfer, Smart Contract, Token Mint, Stake, Swap, Liquidity</li>
                                <li><strong>Dynamic Fees:</strong> Fees vary based on transaction type and complexity</li>
                                <li><strong>Age-based Fading:</strong> Transactions fade over 30 seconds with visual feedback</li>
                                <li><strong>Priority System:</strong> High/Medium/Low priority based on fee amounts</li>
                                <li><strong>Automatic Expiration:</strong> Transactions older than 30 seconds are removed</li>
                                <li><strong>Random Failures:</strong> 10% chance of low-fee transactions being rejected</li>
                                <li><strong>Mempool Management:</strong> Maximum 100 transactions with fee-based replacement</li>
                                <li><strong>Realistic Descriptions:</strong> Dynamic transaction descriptions for each type</li>
                                <li><strong>Visual Age Indicators:</strong> "Xs ago" display instead of absolute timestamps</li>
                            </ul>
                            
                            <h3>Advanced Concepts</h3>
                            <ul>
                                <li><strong>Consensus Mechanisms:</strong> Proof of Work, Proof of Stake, Delegated Proof of Stake</li>
                                <li><strong>Forking:</strong> Temporary chain splits that resolve through consensus</li>
                                <li><strong>Mempool:</strong> Pool of unconfirmed transactions waiting to be mined</li>
                                <li><strong>Block Rewards:</strong> Incentive system for miners to secure the network</li>
                                <li><strong>Transaction Fees:</strong> Additional incentive for miners to prioritize transactions</li>
                                <li><strong>Lightning Network:</strong> Layer 2 scaling solution for faster, cheaper transactions</li>
                            </ul>
                            
                            <h3>Security Considerations</h3>
                            <ul>
                                <li><strong>Double Spending:</strong> Prevented through consensus and transaction ordering</li>
                                <li><strong>Sybil Attacks:</strong> Mitigated through proof of work cost</li>
                                <li><strong>51% Attacks:</strong> Theoretical but economically unfeasible for large networks</li>
                                <li><strong>Quantum Resistance:</strong> Future consideration for post-quantum cryptography</li>
                                <li><strong>Privacy:</strong> Techniques like zero-knowledge proofs for transaction privacy</li>
                            </ul>
                            
                            <h3>Current Control Panel</h3>
                            <ul>
                                <li><strong>Mining Difficulty:</strong> Set to 1-8 (default: 4) - controls mining speed and guided mode activation</li>
                                <li><strong>Simulation Speed:</strong> Set to 0.1x-3x (default: 1.0x) - controls overall animation speed</li>
                                <li><strong>Reset Button:</strong> Resets the entire simulation to initial state</li>
                            </ul>
                            
                            <h3>Always Active Features</h3>
                            <ul>
                                <li><strong>Auto Mining:</strong> Continuously mines new blocks</li>
                                <li><strong>Network Visualization:</strong> Shows all nodes and their activities</li>
                                <li><strong>Block Hashes:</strong> Always visible in blocks (truncated for readability)</li>
                                <li><strong>Real-time Statistics:</strong> Live updates of all blockchain metrics</li>
                            </ul>
                            
                            <h3>Educational Insights</h3>
                            <ul>
                                <li><strong>Decentralization:</strong> No single point of failure or control</li>
                                <li><strong>Transparency:</strong> All transactions are publicly verifiable</li>
                                <li><strong>Immutability:</strong> Historical record cannot be altered</li>
                                <li><strong>Trustlessness:</strong> Participants don't need to trust each other, only the protocol</li>
                                <li><strong>Incentive Alignment:</strong> Economic incentives ensure network security and participation</li>
                            </ul>
                        </div>
                    `};default:return{title:"Animation Information",html:"<p>Select an animation to learn more about the physics concepts it demonstrates.</p>"}}}updateMemoryManagementStats(){this.updateStats("memoryManagement",{memoryBuildings:{path:"totalHeapUsed",fallback:0},memoryAllocated:{path:"totalHeapUsed",fallback:0},memoryGCCycles:{path:"gcCycles",fallback:0},memoryEfficiency:{path:"fragmentation",format:"percentage",decimalPlaces:1,transform:t=>t?100-t:100}})}updateBlockchainStats(){this.updateStats("blockchain",{blockchainBlocks:{path:"blocks",fallback:0},blockchainTransactions:{path:"transactions",fallback:0},blockchainPending:{path:"pending",fallback:0},blockchainDifficulty:{path:"difficulty",fallback:0},blockchainHashrate:{path:"hashrate",format:"unit",suffix:" H/s",fallback:0},blockchainMiners:{path:"miners",fallback:0},blockchainNodes:{path:"nodes",fallback:0},blockchainMining:{path:"isMining",format:"boolean"}});const t=document.getElementById("blockchainPhase");if(t){const i=this.blockchain.getStats();let e=i.phase||"idle";i.phase==="finalization"&&i.consensusPercentage!==void 0&&(i.consensusReached?e=`Finalization (${i.consensusPercentage}% consensus)`:e=`Rejection (${i.consensusPercentage}% < ${i.consensusThreshold}%)`),t.textContent=e}}}document.addEventListener("DOMContentLoaded",()=>{const C=document.getElementById("animationCanvas");new Ft(C),It()});function It(){const C=document.querySelector(".controls-panel"),t=document.querySelector(".controls-toggle");if(!C||!t)return;localStorage.getItem("controlsCollapsed")==="true"&&C.classList.add("collapsed"),t.addEventListener("click",()=>{C.classList.contains("collapsed")?(C.classList.remove("collapsed"),localStorage.setItem("controlsCollapsed","false")):(C.classList.add("collapsed"),localStorage.setItem("controlsCollapsed","true"))}),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="t"&&(e.preventDefault(),t.click())})}
//# sourceMappingURL=index-DXpTYOsv.js.map
